import{Q as QueryObserver,k as infiniteQueryBehavior,l as hasNextPage,m as hasPreviousPage,n as useBaseQuery,j as jsxRuntimeExports,P as ProgressBarBase,o as useStorageSummary,p as clsx,T as Trans,q as useMutation,t as toast,v as message,w as queryClient,W as WorkspaceQueryKeys,x as onFormQueryError,a as apiClient,y as useForm,z as useDialogContext,D as Dialog,A as DialogHeader,B as DialogBody,C as Form,E as FormTextField,G as DialogFooter,H as Button,I as useQuery,J as showHttpErrorToast,K as useActiveWorkspaceId,L as useAuth,M as PersonalWorkspace,O as ConfirmationDialog,S as ProgressCircle,V as AnimatePresence,X as m,Y as Avatar,r as reactExports,Z as useTrans,_ as useValueLists,$ as DialogTrigger,a0 as IconButton,a1 as ExitToAppIcon,a2 as CloseIcon,a3 as MenuTrigger,a4 as ArrowDropDownIcon,a5 as Menu,a6 as Item,i as useSettings,a7 as Link,a8 as LinkStyle,a9 as ButtonBase,aa as UnfoldMoreIcon,ab as useUserWorkspaces,ac as useActiveWorkspace,ad as openDialog,ae as AddIcon,af as CheckIcon,ag as KeyboardArrowDownIcon,ah as getBootstrapData,c as commonjsGlobal,ai as DriveQueryKeys,aj as invalidateEntryQueries,ak as useDriveUploadQueue,al as driveState,am as $458b0a5536c1a7cf$export$40bfa8c7b0832715,an as $9bf71ea28793e738$export$20e40289641fbbb6,ao as $9bf71ea28793e738$export$10c5169755ce7bd7,ap as createEventHandler,aq as useNavigate,ar as useDriveStore,as as $3ef42575df84b30b$export$9d1611c77c2fe928,at as getAxiosErrorMessage,au as CustomMenuItem,av as CustomMenu,aw as FileUploadIcon,ax as openUploadWindow,ay as useSearchParams,az as shallowEqual,aA as TextField,aB as SearchIcon,aC as LinkIcon,aD as ContentCopyIcon,aE as Tooltip,aF as ContextMenu,aG as useMediaQuery,aH as memoize,aI as prettyBytes,aJ as FormattedDate,aK as Checkbox,R as React,aL as Section,aM as MixedText,aN as opacityAnimation,aO as lazyLoader,aP as dot,aQ as IllustratedMessage,aR as SvgImage,aS as useFileUploadStore,aT as FileTypeIcon,aU as ErrorIcon,aV as WarningIcon,aW as CheckCircleIcon,aX as keepPreviousData,aY as List,aZ as ListItem,a_ as Chip,a$ as axios,b0 as UserAvatar,b1 as useActiveDialogEntry,b2 as useClipboard,b3 as $14e0f24ef4ac5c92$export$461939dd4422153,b4 as $14e0f24ef4ac5c92$export$aa8b41735afcabd2,b5 as ComboBoxForwardRef,b6 as useLocation,u as useParams,b7 as StaticPageTitle,b8 as FileUploadProvider,b9 as getActiveWorkspaceId,ba as create,bb as immer,bc as getFromLocalStorage,bd as setInLocalStorage,be as useIsMobileMediaQuery,N as Navbar$1,bf as secureFilesSvg,bg as useNavigate$1,bh as NotFoundPage,bi as ActiveWorkspaceProvider}from"./main-e798bedc.js";import{S as StorageIcon,G as GroupIcon,P as PersonAddIcon,A as ArrowRightIcon,B as BackupIcon,F as FolderIcon,U as UploadFileIcon,D as DriveFolderUploadIcon,C as CreateNewFolderIcon,R as RemoveRedEyeIcon,a as StarIcon,b as StarOutlineIcon,c as DriveFileMoveIcon,d as DriveFileRenameOutlineIcon,e as RestoreIcon,f as DeleteForeverIcon,g as SortIcon,h as RefreshIcon,i as PushPinIcon,j as GroupsIcon,V as ViewListIcon,k as ViewModuleIcon,I as ImportExportIcon,l as GridViewIcon}from"./GridView-85cded39.js";import{C as ChipField,D as DeleteIcon,u as useDroppable,a as useDraggable,h as hasNextPage$1,F as FILE_ENTRY_TYPE_FILTER,b as FilterOperator,c as FilterControlType,d as createdAtFilter,e as updatedAtFilter,f as DashboardLayoutContext,g as FilterList,i as droppables,j as usePointerEvents,k as activeInteraction,l as updateRects,m as useFileEntryUrls,n as FileDownloadIcon,o as downloadFileFromUrl,M as MoreVertIcon,T as TableContext,p as FileThumbnail,q as Table,r as isCtrlOrShiftPressed,$ as $62d8ded9296f3872$export$cfa2225e87938781,s as isCtrlKeyPressed,t as useVirtualizer,v as ChipList,w as FilePreviewDialog,x as useNormalizedModels,y as FormDatePicker,z as encodeBackendFilters,A as dragMonitors,I as InfoIcon,B as FileEntryUrlsContext,E as DashboardLayout,G as DashboardSidenav,H as DashboardContent,J as DashboardNavbar,K as FilePreviewContainer}from"./dashboard-layout-d83c0491.js";import{S as SectionHelper,E as EditIcon,B as Breadcrumb,a as BreadcrumbItem,C as ChevronRightIcon}from"./breadcrumb-f2553d42.js";import{S as Switch,F as FormSwitch,A as ArrowBackIcon}from"./ArrowBack-7e40eb40.js";import{G as GuestDownloadView}from"./guest-download-view-285b39b2.js";var InfiniteQueryObserver=class extends QueryObserver{constructor(e,t){super(e,t)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(e,t){super.setOptions({...e,behavior:infiniteQueryBehavior()},t)}getOptimisticResult(e){return e.behavior=infiniteQueryBehavior(),super.getOptimisticResult(e)}fetchNextPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"backward"}}})}createResult(e,t){var u,c,d,x;const{state:s}=e,n=super.createResult(e,t),{isFetching:i,isRefetching:o}=n,a=i&&((c=(u=s.fetchMeta)==null?void 0:u.fetchMore)==null?void 0:c.direction)==="forward",l=i&&((x=(d=s.fetchMeta)==null?void 0:d.fetchMore)==null?void 0:x.direction)==="backward";return{...n,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:hasNextPage(t,s.data),hasPreviousPage:hasPreviousPage(t,s.data),isFetchingNextPage:a,isFetchingPreviousPage:l,isRefetching:o&&!a&&!l}}};function useInfiniteQuery(e,t){return useBaseQuery(e,InfiniteQueryObserver,t)}function Meter(e){return jsxRuntimeExports.jsx(ProgressBarBase,{...e,role:"meter progressbar"})}function StorageMeter(){const{isLoading:e,data:t}=useStorageSummary(),s=jsxRuntimeExports.jsx("span",{className:clsx("whitespace-nowrap",e&&"invisible"),children:jsxRuntimeExports.jsx(Trans,{message:":used of :available used",values:{used:t==null?void 0:t.usedFormatted,available:t==null?void 0:t.availableFormatted}})});return jsxRuntimeExports.jsxs("div",{className:"mt-24 flex items-start gap-16 border-t pl-24 pt-24",children:[jsxRuntimeExports.jsx(StorageIcon,{className:"-mt-4 icon-md"}),jsxRuntimeExports.jsx(Meter,{className:"max-w-144 flex-auto",size:"xs",value:t==null?void 0:t.percentage,label:s,showValueLabel:!1,labelPosition:"bottom"})]})}function useCreateWorkspace(e){return useMutation({mutationFn:t=>createWorkspace(t),onSuccess:()=>{toast(message("Created workspace")),queryClient.invalidateQueries({queryKey:WorkspaceQueryKeys.fetchUserWorkspaces})},onError:t=>onFormQueryError(t,e)})}function createWorkspace(e){return apiClient.post("workspace",e).then(t=>t.data)}function NewWorkspaceDialog(){const e=useForm(),{formId:t,close:s}=useDialogContext(),n=useCreateWorkspace(e);return jsxRuntimeExports.jsxs(Dialog,{children:[jsxRuntimeExports.jsx(DialogHeader,{children:jsxRuntimeExports.jsx(Trans,{message:"Create workspace"})}),jsxRuntimeExports.jsx(DialogBody,{children:jsxRuntimeExports.jsx(Form,{form:e,id:t,onSubmit:()=>{n.mutate(e.getValues(),{onSuccess:i=>{s(i.workspace.id)}})},children:jsxRuntimeExports.jsx(FormTextField,{name:"name",autoFocus:!0,label:jsxRuntimeExports.jsx(Trans,{message:"Workspace name"}),minLength:3,required:!0})})}),jsxRuntimeExports.jsxs(DialogFooter,{children:[jsxRuntimeExports.jsx(Button,{variant:"text",onClick:s,children:jsxRuntimeExports.jsx(Trans,{message:"Cancel"})}),jsxRuntimeExports.jsx(Button,{variant:"flat",color:"primary",type:"submit",form:t,disabled:n.isPending,children:jsxRuntimeExports.jsx(Trans,{message:"Create"})})]})]})}function fetchWorkspaceWithMembers(e){return apiClient.get(`workspace/${e}`).then(t=>t.data)}function useWorkspaceWithMembers(e){return useQuery({queryKey:WorkspaceQueryKeys.workspaceWithMembers(e),queryFn:()=>fetchWorkspaceWithMembers(e)})}function InviteMembers({workspaceId:e,...t}){return apiClient.post(`workspace/${e}/invite`,t).then(s=>s.data)}function useInviteMembers(){return useMutation({mutationFn:e=>InviteMembers(e),onSuccess:(e,t)=>{queryClient.invalidateQueries({queryKey:WorkspaceQueryKeys.workspaceWithMembers(t.workspaceId)})},onError:e=>showHttpErrorToast(e)})}function ResendInvite({workspaceId:e,inviteId:t,...s}){return apiClient.post(`workspace/${e}/${t}/resend`,s).then(n=>n.data)}function useResendInvite(){return useMutation({mutationFn:e=>ResendInvite(e),onSuccess:()=>{toast("Invite sent")},onError:e=>showHttpErrorToast(e)})}function ChangeRole({workspaceId:e,member:t,...s}){const n=t.model_type,i=t.model_type==="invite"?t.id:t.member_id;return apiClient.post(`workspace/${e}/${n}/${i}/change-role`,s).then(o=>o.data)}function useChangeRole(){return useMutation({mutationFn:e=>ChangeRole(e),onSuccess:(e,t)=>{toast(message("Role changed")),queryClient.invalidateQueries({queryKey:WorkspaceQueryKeys.workspaceWithMembers(t.workspaceId)})},onError:e=>showHttpErrorToast(e)})}function removeMember({workspaceId:e,memberId:t,memberType:s}){const n=s==="invite"?`workspace/invite/${t}`:`workspace/${e}/member/${t}`;return apiClient.delete(n).then(i=>i.data)}function useRemoveMember(){const{workspaceId:e,setWorkspaceId:t}=useActiveWorkspaceId(),{user:s}=useAuth();return useMutation({mutationFn:n=>removeMember(n),onSuccess:(n,i)=>{queryClient.invalidateQueries({queryKey:WorkspaceQueryKeys.fetchUserWorkspaces}),queryClient.invalidateQueries({queryKey:WorkspaceQueryKeys.workspaceWithMembers(i.workspaceId)}),i.memberId===(s==null?void 0:s.id)&&e===i.workspaceId&&t(PersonalWorkspace.id)},onError:n=>showHttpErrorToast(n)})}function LeaveWorkspaceConfirmation({onConfirm:e,isLoading:t}){return jsxRuntimeExports.jsx(ConfirmationDialog,{isDanger:!0,title:jsxRuntimeExports.jsx(Trans,{message:"Leave workspace"}),isLoading:t,onConfirm:e,body:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Trans,{message:"Are you sure you want to leave this workspace?"}),jsxRuntimeExports.jsx("div",{className:"mt-8 font-semibold",children:jsxRuntimeExports.jsx(Trans,{message:"All resources you've created in the workspace will be transferred to workspace owner."})})]}),confirm:jsxRuntimeExports.jsx(Trans,{message:"Leave"})})}const matcher=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;function isEmail(e){return!e||e.length>320?!1:matcher.test(e)}function WorkspaceMembersDialog({workspace:e}){const{data:t,isLoading:s}=useWorkspaceWithMembers(e.id);return jsxRuntimeExports.jsxs(Dialog,{size:"lg",children:[jsxRuntimeExports.jsx(DialogHeader,{children:jsxRuntimeExports.jsx(Trans,{message:"Manage workspace members"})}),jsxRuntimeExports.jsx(DialogBody,{children:s?jsxRuntimeExports.jsx("div",{className:"flex min-h-[238px] items-center justify-center",children:jsxRuntimeExports.jsx(ProgressCircle,{isIndeterminate:!0,"aria-label":"Loading workspace..."})}):jsxRuntimeExports.jsx(Manager,{workspace:t.workspace})})]})}function Manager({workspace:e}){const{user:t}=useAuth(),s=usePermissions(e),n=[...e.members||[],...e.invites||[]],i=!s.update&&!s.delete;return jsxRuntimeExports.jsxs("div",{children:[s.invite&&jsxRuntimeExports.jsx(InviteChipField,{workspace:e}),jsxRuntimeExports.jsxs("div",{className:"mb-14 flex items-center gap-10 text-base",children:[jsxRuntimeExports.jsx(GroupIcon,{className:"icon-sm"}),jsxRuntimeExports.jsx(Trans,{message:"Members of `:workspace`",values:{workspace:e.name}})]}),jsxRuntimeExports.jsxs(AnimatePresence,{initial:!1,children:[n.map(o=>i&&o.id!==(t==null?void 0:t.id)?null:jsxRuntimeExports.jsx(MemberListItem$1,{workspace:e,member:o},`${o.model_type}.${o.id}`)),i&&jsxRuntimeExports.jsx("div",{className:"text-muted",children:jsxRuntimeExports.jsx(Trans,{message:"And [one one other member|:count other members]",values:{count:n.length}})})]})]})}function MemberListItem$1({workspace:e,member:t}){return jsxRuntimeExports.jsxs(m.div,{initial:{x:"-100%",opacity:0},animate:{x:0,opacity:1},exit:{x:"100%",opacity:0},transition:{type:"tween",duration:.125},className:"mb-20 flex items-start gap-14 text-sm",children:[jsxRuntimeExports.jsx(Avatar,{className:"flex-shrink-0",size:"lg",circle:!0,label:t.name,src:t.image,fallback:"initials"}),jsxRuntimeExports.jsxs("div",{className:"min-w-0 flex-auto items-center justify-between gap-14 md:flex",children:[jsxRuntimeExports.jsxs("div",{className:"mb-10 overflow-hidden md:mb-0 md:mr-10",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-start gap-6",children:[jsxRuntimeExports.jsx("div",{className:"overflow-hidden text-ellipsis whitespace-nowrap",children:t.name}),jsxRuntimeExports.jsx(MemberDisplayNameAppend,{workspace:e,member:t})]}),jsxRuntimeExports.jsx("div",{className:"text-muted",children:t.email})]}),jsxRuntimeExports.jsx(MemberActions,{workspace:e,member:t})]})]},`${t.model_type}.${t.id}`)}function usePermissions(e){var o;const{user:t}=useAuth(),s={update:!1,invite:!1,delete:!1},n=["update","invite","delete"],i=(o=e.members)==null?void 0:o.find(a=>a.id===(t==null?void 0:t.id));return i&&n.forEach(a=>{var l;s[a]=i.is_owner||!!((l=i.permissions)!=null&&l.find(u=>u.name===`workspace_members.${a}`))}),s}function MemberActions({workspace:e,member:t}){const[s,n]=reactExports.useState(t.role_id),i=useChangeRole(),{user:o}=useAuth(),a=usePermissions(e),l=t.model_type==="member"&&t.is_owner,u=t.model_type==="member"&&(o==null?void 0:o.id)===t.id,c=!a.update||l||u?jsxRuntimeExports.jsx("div",{className:"ml-auto text-muted first:capitalize",children:jsxRuntimeExports.jsx(Trans,{message:t.role_name})}):jsxRuntimeExports.jsx(RoleMenuTrigger,{className:"ml-auto flex-shrink-0",size:"xs",value:s,isDisabled:i.isPending,onChange:d=>{n(d),i.mutate({roleId:d,workspaceId:e.id,member:t})}});return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[c,!l&&(u||a.delete)&&jsxRuntimeExports.jsx(RemoveMemberButton,{type:u?"leave":"remove",member:t,workspace:e})]})}function InviteChipField({workspace:e}){const{trans:t}=useTrans(),[s,n]=reactExports.useState([]),i=s.every(d=>!d.invalid),o=d=>d.description||d.name,[a,l]=reactExports.useState(),u=useInviteMembers(),{data:c}=useValueLists(["workspaceRoles"]);return reactExports.useEffect(()=>{var d;!a&&((d=c==null?void 0:c.workspaceRoles)!=null&&d.length)&&l(c.workspaceRoles[0].id)},[c,a]),jsxRuntimeExports.jsxs("div",{className:"mb-30",children:[jsxRuntimeExports.jsx(ChipField,{value:s,onChange:n,displayWith:o,validateWith:d=>{const x=!isEmail(d.description);return{...d,invalid:x,errorMessage:x?t({message:"Not a valid email"}):void 0}},placeholder:t({message:"Enter email addresses"}),label:jsxRuntimeExports.jsx(Trans,{message:"Invite people"})}),jsxRuntimeExports.jsxs("div",{className:"mt-14 flex items-center justify-between gap-14",children:[jsxRuntimeExports.jsx(RoleMenuTrigger,{onChange:l,value:a}),s.length&&a?jsxRuntimeExports.jsx(Button,{variant:"flat",color:"primary",size:"sm",disabled:u.isPending||!i,onClick:()=>{u.mutate({emails:s.map(d=>o(d)),roleId:a,workspaceId:e.id},{onSuccess:()=>{n([])}})},children:jsxRuntimeExports.jsx(Trans,{message:"Invite"})}):null]})]})}function RemoveMemberButton({member:e,workspace:t,type:s}){const n=useRemoveMember(),{close:i}=useDialogContext();return jsxRuntimeExports.jsxs(DialogTrigger,{type:"modal",onClose:o=>{o&&(n.mutate({workspaceId:t.id,memberId:e.id,memberType:e.model_type}),s==="leave"&&(i(),toast(message("Left workspace"))))},children:[jsxRuntimeExports.jsx(IconButton,{size:"md",className:"flex-shrink-0 text-muted",disabled:n.isPending,children:s==="leave"?jsxRuntimeExports.jsx(ExitToAppIcon,{}):jsxRuntimeExports.jsx(CloseIcon,{})}),s==="leave"?jsxRuntimeExports.jsx(LeaveWorkspaceConfirmation,{}):jsxRuntimeExports.jsx(RemoveMemberConfirmation,{member:e})]})}function RemoveMemberConfirmation({member:e}){return jsxRuntimeExports.jsx(ConfirmationDialog,{isDanger:!0,title:jsxRuntimeExports.jsx(Trans,{message:"Remove member"}),body:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Trans,{message:"Are you sure you want to remove `:name`?",values:{name:e.name}}),jsxRuntimeExports.jsx("div",{className:"mt-8 font-semibold",children:jsxRuntimeExports.jsx(Trans,{message:"All workspace resources created by `:name` will be transferred to workspace owner.",values:{name:e.name}})})]}),confirm:jsxRuntimeExports.jsx(Trans,{message:"Remove"})})}function RoleMenuTrigger({value:e,onChange:t,size:s="xs",className:n,isDisabled:i}){var l;const{data:o}=useValueLists(["workspaceRoles"]),a=(l=o==null?void 0:o.workspaceRoles)==null?void 0:l.find(u=>u.id===e);return!e||!a||!(o!=null&&o.workspaceRoles)?null:jsxRuntimeExports.jsxs(MenuTrigger,{selectionMode:"single",selectedValue:e,onSelectionChange:u=>{t(u)},children:[jsxRuntimeExports.jsx(Button,{className:n,size:s,variant:"flat",color:"chip",disabled:i,endIcon:jsxRuntimeExports.jsx(ArrowDropDownIcon,{}),children:jsxRuntimeExports.jsx(Trans,{message:a.name})}),jsxRuntimeExports.jsx(Menu,{children:o.workspaceRoles.map(u=>jsxRuntimeExports.jsx(Item,{value:u.id,description:u.description,children:jsxRuntimeExports.jsx(Trans,{message:u.name})},u.id))})]})}function MemberDisplayNameAppend({member:e,workspace:t}){const{user:s}=useAuth(),n=usePermissions(t);return(s==null?void 0:s.id)===e.id?jsxRuntimeExports.jsxs("div",{className:"font-medium",children:["(",jsxRuntimeExports.jsx(Trans,{message:"You"}),")"]}):e.model_type==="invite"?jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4",children:[jsxRuntimeExports.jsx("div",{children:"·"}),jsxRuntimeExports.jsx("div",{className:"font-medium",children:jsxRuntimeExports.jsx(Trans,{message:"Invited"})}),n.invite?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{children:"·"}),jsxRuntimeExports.jsx(ResendInviteDialogTrigger,{member:e,workspace:t})]}):null]}):null}function ResendInviteDialogTrigger({member:e,workspace:t}){const s=useResendInvite();return jsxRuntimeExports.jsxs(DialogTrigger,{type:"modal",onClose:n=>{n&&s.mutate({workspaceId:t.id,inviteId:e.id})},children:[jsxRuntimeExports.jsx(Button,{variant:"link",size:"sm",color:"primary",disabled:s.isPending,children:jsxRuntimeExports.jsx(Trans,{message:"Resend invite"})}),jsxRuntimeExports.jsx(ConfirmationDialog,{title:jsxRuntimeExports.jsx(Trans,{message:"Resend invite"}),body:jsxRuntimeExports.jsx(Trans,{message:"Are you sure you want to send this invite again?"}),confirm:jsxRuntimeExports.jsx(Trans,{message:"Send"})})]})}function updateWorkspace({id:e,...t}){return apiClient.put(`workspace/${e}`,t).then(s=>s.data)}function useUpdateWorkspace(e){const{close:t}=useDialogContext();return useMutation({mutationFn:s=>updateWorkspace(s),onSuccess:s=>{t(),toast(message("Updated workspace")),queryClient.invalidateQueries({queryKey:WorkspaceQueryKeys.fetchUserWorkspaces}),queryClient.invalidateQueries({queryKey:WorkspaceQueryKeys.workspaceWithMembers(s.workspace.id)})},onError:s=>onFormQueryError(s,e)})}function RenameWorkspaceDialog({workspace:e}){const t=useForm({defaultValues:{id:e.id,name:e.name}}),{formId:s,close:n}=useDialogContext(),i=useUpdateWorkspace(t);return jsxRuntimeExports.jsxs(Dialog,{children:[jsxRuntimeExports.jsx(DialogHeader,{children:jsxRuntimeExports.jsx(Trans,{message:"Rename workspace"})}),jsxRuntimeExports.jsx(DialogBody,{children:jsxRuntimeExports.jsx(Form,{form:t,id:s,onSubmit:()=>{i.mutate(t.getValues())},children:jsxRuntimeExports.jsx(FormTextField,{name:"name",autoFocus:!0,label:jsxRuntimeExports.jsx(Trans,{message:"Name"}),minLength:3,required:!0})})}),jsxRuntimeExports.jsxs(DialogFooter,{children:[jsxRuntimeExports.jsx(Button,{variant:"text",onClick:n,children:jsxRuntimeExports.jsx(Trans,{message:"Cancel"})}),jsxRuntimeExports.jsx(Button,{variant:"flat",color:"primary",type:"submit",form:s,disabled:i.isPending,children:jsxRuntimeExports.jsx(Trans,{message:"Rename"})})]})]})}function deleteWorkspace({id:e}){return apiClient.delete(`workspace/${e}`).then(t=>t.data)}function useDeleteWorkspace(){const{workspaceId:e,setWorkspaceId:t}=useActiveWorkspaceId();return useMutation({mutationFn:s=>deleteWorkspace(s),onSuccess:(s,n)=>{toast(message("Deleted workspace")),queryClient.invalidateQueries({queryKey:WorkspaceQueryKeys.fetchUserWorkspaces}),queryClient.invalidateQueries({queryKey:WorkspaceQueryKeys.workspaceWithMembers(n.id)}),e===n.id&&t(PersonalWorkspace.id)},onError:s=>showHttpErrorToast(s)})}function PolicyFailMessage({resourceName:e,className:t,size:s="md",color:n="bgAlt",reason:i="overQuota",...o}){const a=o.message??jsxRuntimeExports.jsx(MessageText,{resourceName:e,reason:i});return jsxRuntimeExports.jsx(SectionHelper,{color:n,size:s,className:t,description:a})}function MessageText({resourceName:e,reason:t}){const{billing:s}=useSettings();if(t==="noWorkspacePermission")return jsxRuntimeExports.jsx(Trans,{message:"You can't create new :name in this workspace.",values:{name:e}});const n={name:e,a:i=>jsxRuntimeExports.jsx(Link,{className:LinkStyle,to:"/pricing",children:i})};return t==="overQuota"&&s.enable?jsxRuntimeExports.jsx(Trans,{message:"Your plan is at its maximum number of :name allowed. <a>Upgrade to add more.</a>",values:n}):t==="noPermission"&&s.enable?jsxRuntimeExports.jsx(Trans,{message:"To unlock ability to create :name. <a>Upgrade your plan.</a>",values:n}):jsxRuntimeExports.jsx(Trans,{message:"You don't have permissions to create :name."})}function WorkspaceSelector({onChange:e,className:t,trigger:s,placement:n="top"}){const{data:i,isFetched:o,isFetching:a}=useUserWorkspaces(),{setWorkspaceId:l}=useActiveWorkspaceId(),u=useActiveWorkspace(),[c,d]=reactExports.useState(!1),{hasPermission:x}=useAuth();return reactExports.useEffect(()=>{o&&!a&&!u&&l(PersonalWorkspace.id)},[u,i,l,o,a]),!s&&(!u||!x("workspaces.create")&&(i==null?void 0:i.length)===1)?null:jsxRuntimeExports.jsx(reactExports.Fragment,{children:jsxRuntimeExports.jsxs(DialogTrigger,{type:"popover",placement:n,isOpen:c,onClose:()=>{d(!1)},children:[s?reactExports.cloneElement(s,{onClick:()=>d(!c)}):jsxRuntimeExports.jsx(DefaultTrigger,{onClick:()=>d(!c),workspace:u,className:t}),jsxRuntimeExports.jsx(Dialog,{size:"min-w-320",children:jsxRuntimeExports.jsxs(DialogBody,{padding:"p-10",children:[jsxRuntimeExports.jsx("div",{className:"mb-16 border-b pb-10",children:i==null?void 0:i.map(p=>jsxRuntimeExports.jsx(WorkspaceItem,{workspace:p,setSelectorIsOpen:d,onChange:e},p.id))}),jsxRuntimeExports.jsx("div",{className:"mb-4 px-4 text-center",children:jsxRuntimeExports.jsx(CreateWorkspaceButton,{onClick:()=>d(!1),onCreated:p=>e==null?void 0:e(p),workspaceCount:i?i.length-1:0})})]})})]})})}function CreateWorkspaceButton({onClick:e,onCreated:t,workspaceCount:s}){const{setWorkspaceId:n}=useActiveWorkspaceId(),{checkOverQuotaOrNoPermission:i}=useAuth(),{overQuotaOrNoPermission:o}=i("workspaces.create","count",s);return jsxRuntimeExports.jsxs(reactExports.Fragment,{children:[jsxRuntimeExports.jsx(Button,{disabled:o,onClick:async a=>{a.preventDefault(),a.stopPropagation(),e();const l=await openDialog(NewWorkspaceDialog);l&&(n(l),t==null||t(l))},variant:"outline",startIcon:jsxRuntimeExports.jsx(AddIcon,{}),color:"primary",className:"h-40 w-full",children:jsxRuntimeExports.jsx(Trans,{message:"Create new workspace"})}),o&&jsxRuntimeExports.jsx(PolicyFailMessage,{size:"sm",className:"mt-12 max-w-288",resourceName:jsxRuntimeExports.jsx(Trans,{message:"worksapces"})})]})}const DefaultTrigger=reactExports.forwardRef(({workspace:e,className:t,onClick:s,...n},i)=>jsxRuntimeExports.jsxs(ButtonBase,{ref:i,onClick:s,className:clsx("flex items-center gap-10 rounded ring-inset hover:bg-hover focus-visible:ring-2",t),...n,children:[jsxRuntimeExports.jsxs("span",{className:"mr-auto block flex-auto overflow-hidden text-left",children:[jsxRuntimeExports.jsx("span",{className:"block overflow-hidden overflow-ellipsis text-sm font-medium text-main",children:e.default?jsxRuntimeExports.jsx(Trans,{message:e.name}):e.name}),jsxRuntimeExports.jsx("span",{className:"block text-xs text-muted",children:e.default?jsxRuntimeExports.jsx(Trans,{message:"Personal workspace"}):jsxRuntimeExports.jsx(Trans,{message:":count members",values:{count:e.members_count}})})]}),jsxRuntimeExports.jsx(UnfoldMoreIcon,{className:"shrink-0 icon-md"})]}));function WorkspaceItem({workspace:e,onChange:t,setSelectorIsOpen:s}){const{workspaceId:n,setWorkspaceId:i}=useActiveWorkspaceId(),o=n===e.id;return jsxRuntimeExports.jsxs("div",{onClick:()=>{i(e.id),t==null||t(e.id),s(!1)},className:clsx("mb-4 flex cursor-pointer items-center gap-12 rounded-lg p-10 text-left",o&&"bg-primary/5",!o&&"hover:bg-hover"),children:[jsxRuntimeExports.jsx(CheckIcon,{size:"sm",className:clsx("flex-shrink-0 text-primary",!o&&"invisible")}),jsxRuntimeExports.jsxs("div",{className:"flex-auto",children:[jsxRuntimeExports.jsx("div",{className:clsx("text-sm",o&&"font-semibold"),children:e.name}),jsxRuntimeExports.jsx("div",{className:"text-sm text-muted",children:e.default?jsxRuntimeExports.jsx(Trans,{message:"Personal workspace"}):jsxRuntimeExports.jsx(Trans,{message:":count members",values:{count:e.members_count}})})]}),e.id!==0&&jsxRuntimeExports.jsx(ManageButton,{setSelectorIsOpen:s,workspace:e,onChange:t})]})}function LeaveWorkspaceDialog({workspace:e,onChange:t}){const s=useRemoveMember(),{user:n}=useAuth(),{close:i}=useDialogContext();return jsxRuntimeExports.jsx(LeaveWorkspaceConfirmation,{isLoading:s.isPending,onConfirm:()=>{s.mutate({workspaceId:e.id,memberId:n.id,memberType:"member"},{onSuccess:()=>{i(),t==null||t(PersonalWorkspace.id)}})}})}function DeleteWorkspaceConfirmation({workspace:e,onChange:t}){const s=useDeleteWorkspace(),{close:n}=useDialogContext();return jsxRuntimeExports.jsx(ConfirmationDialog,{isDanger:!0,title:jsxRuntimeExports.jsx(Trans,{message:"Delete workspace"}),body:jsxRuntimeExports.jsx(Trans,{message:"Are you sure you want to delete “:name“?",values:{name:e.name}}),confirm:jsxRuntimeExports.jsx(Trans,{message:"Delete"}),isLoading:s.isPending,onConfirm:()=>{s.mutate({id:e.id},{onSuccess:()=>{n(),t==null||t(PersonalWorkspace.id)}})}})}function ManageButton({setSelectorIsOpen:e,workspace:t,onChange:s}){const{user:n}=useAuth();return jsxRuntimeExports.jsxs(MenuTrigger,{onItemSelected:()=>e(!1),children:[jsxRuntimeExports.jsx(Button,{onClick:i=>{i.preventDefault(),i.stopPropagation()},color:"primary",size:"xs",variant:"outline",endIcon:jsxRuntimeExports.jsx(KeyboardArrowDownIcon,{}),children:jsxRuntimeExports.jsx(Trans,{message:"Manage"})}),jsxRuntimeExports.jsxs(Menu,{children:[jsxRuntimeExports.jsx(Item,{onClick:i=>{i.stopPropagation(),openDialog(WorkspaceMembersDialog,{workspace:t})},value:"workspaceMembers",startIcon:jsxRuntimeExports.jsx(PersonAddIcon,{}),children:jsxRuntimeExports.jsx(Trans,{message:"Members"})}),t.owner_id===(n==null?void 0:n.id)&&jsxRuntimeExports.jsx(Item,{onClick:i=>{i.stopPropagation(),openDialog(RenameWorkspaceDialog,{workspace:t})},value:"updateWorkspace",startIcon:jsxRuntimeExports.jsx(EditIcon,{}),children:jsxRuntimeExports.jsx(Trans,{message:"Rename"})}),t.owner_id!==(n==null?void 0:n.id)&&jsxRuntimeExports.jsx(Item,{onClick:i=>{i.stopPropagation(),openDialog(LeaveWorkspaceDialog,{workspace:t,onChange:s})},value:"leaveWorkspace",startIcon:jsxRuntimeExports.jsx(ExitToAppIcon,{}),children:jsxRuntimeExports.jsx(Trans,{message:"Leave"})}),t.owner_id===(n==null?void 0:n.id)&&jsxRuntimeExports.jsx(Item,{onClick:i=>{i.stopPropagation(),openDialog(DeleteWorkspaceConfirmation,{workspace:t,onChange:s})},value:"deleteWorkspace",startIcon:jsxRuntimeExports.jsx(DeleteIcon,{}),children:jsxRuntimeExports.jsx(Trans,{message:"Delete"})})]})]})}const addFilesSvg=""+new URL("add-files-107c40dd.svg",import.meta.url).href,timeManagement=""+new URL("time-management-5219b76e.svg",import.meta.url).href,fileSearching=""+new URL("file-searching-49556098.svg",import.meta.url).href,throwAwaySvg=""+new URL("throw-away-389510cc.svg",import.meta.url).href,lovingItSvg=""+new URL("loving-it-585c130e.svg",import.meta.url).href,shareSvg=""+new URL("share-70babf29.svg",import.meta.url).href,defaultSortDescriptor={orderBy:"updated_at",orderDir:"desc"};function makeFolderPage(e){return{...makePartialFolderPage(e.hash),canUpload:e.permissions["files.create"]||e.permissions["files.update"],label:e.name,folder:e}}function makePartialFolderPage(e){return{name:"folder",uniqueId:e,label:"",path:getPathForFolder(e),hasActions:!0,canUpload:!1,sortDescriptor:defaultSortDescriptor,isFolderPage:!0,noContentMessage:()=>({title:message("Drop files or folders here"),description:message('Or use the "Upload" button'),image:addFilesSvg})}}function getPathForFolder(e){return e==="0"?"/drive":`/drive/folders/${e}`}const rootFolder=getBootstrapData().rootFolder,RootFolderPage={...makeFolderPage(rootFolder),name:"home"},RecentPage={name:"recent",uniqueId:"recent",label:message("Recent"),path:"/drive/recent",disableSort:!0,sortDescriptor:{orderBy:"created_at",orderDir:"desc"},queryParams:{recentOnly:!0},noContentMessage:()=>({title:message("No recent entries"),description:message("You have not uploaded any files or folders yet"),image:timeManagement})},SearchPage={name:"search",uniqueId:"search",label:message("Search results"),path:"/drive/search",sortDescriptor:defaultSortDescriptor,noContentMessage:e=>e?{title:message("No matching results"),description:message("Try changing your search query or filters"),image:fileSearching}:{title:message("Begin typing or select a filter to search"),description:message("Search for files, folders and other content"),image:fileSearching}},SharesPage={name:"sharedWithMe",uniqueId:"sharedWithMe",label:message("Shared"),path:"/drive/shares",sortDescriptor:defaultSortDescriptor,queryParams:{sharedOnly:!0},noContentMessage:()=>({title:message("Shared with me"),description:message("Files and folders other people have shared with you"),image:shareSvg})},TrashPage={name:"trash",uniqueId:"trash",label:message("Trash"),path:"/drive/trash",sortDescriptor:defaultSortDescriptor,hasActions:!0,queryParams:{deletedOnly:!0},noContentMessage:()=>({title:message("Trash is empty"),description:message("There are no files or folders in your trash currently"),image:throwAwaySvg})},StarredPage={name:"starred",uniqueId:"starred",label:message("Starred"),path:"/drive/starred",sortDescriptor:defaultSortDescriptor,queryParams:{starredOnly:!0},noContentMessage:()=>({title:message("Nothing is starred"),description:message("Add stars to files and folders that you want to easily find later"),image:lovingItSvg})},DRIVE_PAGES=[RootFolderPage,RecentPage,SearchPage,SharesPage,TrashPage,StarredPage];let MenuPositions=function(e){return e.DriveSidebar="drive-sidebar",e}({});var arrayToTree_min={};(function(e){var t=commonjsGlobal&&commonjsGlobal.__assign||function(){return(t=Object.assign||function(a){for(var l,u=1,c=arguments.length;u<c;u++)for(var d in l=arguments[u])Object.prototype.hasOwnProperty.call(l,d)&&(a[d]=l[d]);return a}).apply(this,arguments)},s=(Object.defineProperty(e,"__esModule",{value:!0}),{id:"id",parentId:"parentId",dataField:"data",childrenField:"children",throwIfOrphans:!1,rootParentIds:{"":!(e.countNodes=e.arrayToTree=void 0)},nestedIds:!0,assign:!1});function n(a,l){l===void 0&&(l={});for(var u,c=t(t({},s),l),d=[],x={},p=c.throwIfOrphans?new Set:null,h=0,f=a;h<f.length;h++){var j=f[h],g=c.nestedIds?o(j,c.id):j[c.id],v=c.nestedIds?o(j,c.parentId):j[c.parentId];if(c.rootParentIds[g])throw new Error("The item array contains a node whose parentId both exists in another node and is in "+'`rootParentIds` (`itemId`: "'.concat(g,'", `rootParentIds`: ').concat(Object.keys(c.rootParentIds).map(function(y){return'"'.concat(y,'"')}).join(", "),")."));Object.prototype.hasOwnProperty.call(x,g)||(x[g]=((u={})[c.childrenField]=[],u)),p&&p.delete(g),c.dataField?x[g][c.dataField]=j:c.assign?x[g]=Object.assign(j,((u={})[c.childrenField]=x[g][c.childrenField],u)):x[g]=t(t({},j),((j={})[c.childrenField]=x[g][c.childrenField],j)),j=x[g],v==null||c.rootParentIds[v]?d.push(j):(Object.prototype.hasOwnProperty.call(x,v)||(x[v]=((g={})[c.childrenField]=[],g),p&&p.add(v)),x[v][c.childrenField].push(j))}if(p!=null&&p.size)throw new Error("The items array contains orphans that point to the following parentIds: "+"[".concat(Array.from(p),"]. These parentIds do not exist in the items array. Hint: prevent orphans to result ")+"in an error by passing the following option: { throwIfOrphans: false }");if(c.throwIfOrphans&&i(d,c.childrenField)<Object.keys(x).length)throw new Error("The items array contains nodes with a circular parent/child relationship.");return d}function i(a,l){return a.reduce(function(u,c){return u+1+(c[l]&&i(c[l],l))},0)}function o(a,l){return l.split(".").reduce(function(u,c){return u&&u[c]},a)}e.arrayToTree=n,e.countNodes=i})(arrayToTree_min);function fetchUserFolders(e){return apiClient.get(`users/${e.userId}/folders`,{params:e}).then(t=>t.data)}function useFolders(){const{user:e}=useAuth(),{workspaceId:t}=useActiveWorkspaceId(),s={userId:e.id,workspaceId:t};return useQuery({queryKey:DriveQueryKeys.fetchUserFolders(s),queryFn:()=>fetchUserFolders(s),enabled:!!e})}function useMoveEntries(){return useMutation({mutationFn:e=>(toast.loading(message("Moving [one 1 item|other :count items]...",{values:{count:e.entryIds.length}}),{disableExitAnimation:!0}),moveEntries(e)),onSuccess:(e,t)=>{invalidateEntryQueries(),toast(message('Moved [one 1 item|other :count items] to ":destination"',{values:{count:t.entryIds.length,destination:(e.destination||RootFolderPage.folder).name}}),{disableEnterAnimation:!0})},onError:e=>showHttpErrorToast(e,message("Could not move items"),null,{disableEnterAnimation:!0})})}function moveEntries(e){return e.destinationId=e.destinationId?e.destinationId:null,apiClient.post("file-entries/move",e).then(t=>t.data)}function canMoveEntriesInto(e,t){return t.type!=="folder"||!t.permissions["files.update"]&&!e.every(s=>s.permissions["files.update"])?!1:e.every(s=>!s||t.id===s.parent_id||!s.parent_id&&t.id===0?!1:!destinationIsInTarget(t,s))}function destinationIsInTarget(e,t){const s=(e.path||"").split("/");return(t.path||"").split("/").every((i,o)=>s[o]===i)}function useFolderDropAction(e){const t=useMoveEntries(),{uploadFiles:s}=useDriveUploadQueue();return{onDrop:async i=>{if(e.type==="folder"){if(i.type==="nativeFile")s(await i.getData(),{metadata:{parentId:e.id}});else if(i.type==="fileEntry"){const o=i.getData();o!=null&&o.length&&canMoveEntriesInto(o,e)&&(t.mutate({destinationId:e.id,entryIds:o.map(a=>a.id)}),driveState().deselectEntries("all"))}}}}}function folderAcceptsDrop(e,t){if(e.type==="fileEntry"){const s=e.getData();return canMoveEntriesInto(s,t)}return!0}function makeFolderTreeDragId(e){return`${e.id}-tree`}function isFolderTreeDragId(e){return`${e}`.endsWith("-tree")}function useSidebarTreeDropTarget({folder:e,ref:t}){const[s,n]=reactExports.useState(!1),{onDrop:i}=useFolderDropAction(e);return{...useDroppable({id:makeFolderTreeDragId(e),ref:t,types:["fileEntry","nativeFile"],acceptsDrop:a=>folderAcceptsDrop(a,e),onDragEnter:a=>{folderAcceptsDrop(a,e)&&n(!0)},onDragLeave:()=>{n(!1)},onDropActivate:()=>{driveState().sidebarExpandedKeys.includes(e.id)||driveState().setSidebarExpandedKeys([...driveState().sidebarExpandedKeys,e.id])},onDrop:i}),isDragOver:s}}const TreeContext=reactExports.createContext(null);function renderTree({nodes:e,itemRenderer:t,parentNode:s,level:n}){return e.map((i,o)=>reactExports.cloneElement(t(i),{level:n==null?0:n+1,index:o,node:i,parentNode:s,key:i.id,itemRenderer:t}))}function Tree({children:e,nodes:t,...s}){const[n,i]=$458b0a5536c1a7cf$export$40bfa8c7b0832715(s.expandedKeys,s.defaultSelectedKeys,s.onExpandedKeysChange),[o,a]=$458b0a5536c1a7cf$export$40bfa8c7b0832715(s.selectedKeys,s.defaultSelectedKeys,s.onSelectedKeysChange),[l,u]=reactExports.useState(),c={expandedKeys:n,setExpandedKeys:i,selectedKeys:o,setSelectedKeys:a,focusedNode:l,setFocusedNode:u};return jsxRuntimeExports.jsx(TreeContext.Provider,{value:c,children:jsxRuntimeExports.jsx($9bf71ea28793e738$export$20e40289641fbbb6,{children:jsxRuntimeExports.jsx(TreeRoot,{nodes:t,itemRenderer:e})})})}function TreeRoot(e){return jsxRuntimeExports.jsx("ul",{className:"overflow-hidden text-sm",role:"tree",children:renderTree(e)})}const TreeLabel=reactExports.forwardRef(({icon:e,label:t,level:s=0,node:n,className:i,...o},a)=>{const{expandedKeys:l,setExpandedKeys:u,selectedKeys:c,setSelectedKeys:d}=reactExports.useContext(TreeContext),x=l.includes(n.id),p=c.includes(n.id),h=f=>{f.stopPropagation();const j=l.indexOf(n.id),g=[...l];j>-1?g.splice(j,1):g.push(n.id),u(g)};return jsxRuntimeExports.jsxs("div",{...o,ref:a,onClick:f=>{f.stopPropagation(),d([n.id])},className:clsx("header tree-label flex cursor-pointer flex-nowrap items-center gap-4 overflow-hidden text-ellipsis whitespace-nowrap rounded py-6",i,p&&"bg-primary/selected font-bold text-primary",!p&&"hover:bg-hover"),children:[s>0&&jsxRuntimeExports.jsx("div",{className:"flex",children:Array.from({length:s}).map((f,j)=>jsxRuntimeExports.jsx("div",{className:"h-24 w-24"},j))}),jsxRuntimeExports.jsx("div",{onClick:h,children:jsxRuntimeExports.jsx(ArrowRightIcon,{className:clsx("cursor-default transition-transform icon-sm",x&&"rotate-90")})}),e,jsxRuntimeExports.jsx("div",{className:"overflow-hidden text-ellipsis pr-6",children:t})]})});TreeLabel.displayName="TreeLabel";function TreeItem({label:e,icon:t,node:s,level:n,index:i,itemRenderer:o,labelRef:a,labelClassName:l,className:u,parentNode:c,...d}){const x=$9bf71ea28793e738$export$10c5169755ce7bd7(),{expandedKeys:p,selectedKeys:h,focusedNode:f,setFocusedNode:j,setExpandedKeys:g,setSelectedKeys:v}=reactExports.useContext(TreeContext);if(reactExports.useEffect(()=>()=>{f===(s==null?void 0:s.id)&&j(void 0)},[f,s==null?void 0:s.id,j]),!s||!o)return null;const y=s.children.length,E=y&&p.includes(s.id),b=h.includes(s.id),I=n===0&&i===0,S=f==null?I:f===s.id,T=R=>{var P,F;if(f!=null)switch(R.key){case"Enter":case" ":R.stopPropagation(),R.preventDefault(),v([f]);break;case"ArrowRight":if(R.stopPropagation(),R.preventDefault(),!y)return;E?x==null||x.focusNext():g([...p,f]);break;case"ArrowLeft":if(R.stopPropagation(),R.preventDefault(),E){const w=p.indexOf(f),D=[...p];D.splice(w,1),g(D)}else if(c){const w=(F=(P=document.activeElement)==null?void 0:P.parentElement)==null?void 0:F.closest("[tabindex]");w&&w.focus()}break;case"ArrowDown":R.stopPropagation(),R.preventDefault(),x==null||x.focusNext();break;case"ArrowUp":R.stopPropagation(),R.preventDefault(),x==null||x.focusPrevious();break;case"Home":R.stopPropagation(),R.preventDefault(),x==null||x.focusFirst();break;case"End":R.stopPropagation(),R.preventDefault(),x==null||x.focusLast();break;case"*":if(R.stopPropagation(),R.preventDefault(),c!=null&&c.children){const w=[...p];c.children.forEach(D=>{D.children.length&&!p.includes(D.id)&&w.push(D.id)}),w.length!==p.length&&g(w)}break}};return jsxRuntimeExports.jsxs("li",{role:"treeitem","aria-expanded":E?"true":"false","aria-selected":b,tabIndex:S?0:-1,onKeyDown:createEventHandler(T),onFocus:R=>{R.stopPropagation(),j(s.id)},onBlur:R=>{R.stopPropagation(),R.currentTarget.contains(R.relatedTarget)||j(void 0)},className:clsx("outline-none","[&>.tree-label]:focus-visible:ring [&>.tree-label]:focus-visible:ring-2 [&>.tree-label]:focus-visible:ring-inset",u),children:[jsxRuntimeExports.jsx(TreeLabel,{ref:a,className:l,node:s,level:n,label:e,icon:t,...d}),jsxRuntimeExports.jsx(AnimatePresence,{initial:!1,children:E?jsxRuntimeExports.jsx(m.ul,{role:"group",initial:"closed",animate:"open",exit:"closed",variants:{open:{opacity:1,height:"auto"},closed:{opacity:0,height:0,overflow:"hidden"}},children:renderTree({nodes:s.children,parentNode:s,itemRenderer:o,level:n})},`${s.id}-group`):null})]})}function FolderTree(){const e=useNavigate(),{data:t}=useFolders(),s=useDriveStore(a=>a.sidebarExpandedKeys),n=useDriveStore(a=>a.activePage);let i=[];n!=null&&n.isFolderPage&&(i=n.folder?[n.folder.id]:[]);const o=reactExports.useMemo(()=>{const a=arrayToTree_min.arrayToTree((t==null?void 0:t.folders)||[],{parentId:"parent_id",dataField:null});return[{...RootFolderPage.folder,children:a}]},[t==null?void 0:t.folders]);return jsxRuntimeExports.jsx(Tree,{nodes:o,expandedKeys:s,onExpandedKeysChange:a=>{driveState().setSidebarExpandedKeys(a)},selectedKeys:i,onSelectedKeysChange:([a])=>{const l=findHash(a,o);e(l?getPathForFolder(l):RootFolderPage.path)},children:()=>jsxRuntimeExports.jsx(FolderTreeItem,{})})}function FolderTreeItem(e){const{node:t}=e,s=reactExports.useRef(null),n=t.id===0,i=useDriveStore(u=>u.entriesBeingDragged.includes(t.id)),{draggableProps:o}=useDraggable({type:"fileEntry",id:makeFolderTreeDragId(t),ref:s,disabled:n,hidePreview:!0,onDragStart:(u,c)=>{const d=c;driveState().setEntriesBeingDragged(d.getData().map(x=>x.id)),driveState().selectEntries([])},onDragEnd:()=>{driveState().setEntriesBeingDragged([])},getData:()=>[t]}),{droppableProps:a,isDragOver:l}=useSidebarTreeDropTarget({folder:t,ref:s});return jsxRuntimeExports.jsx(TreeItem,{...$3ef42575df84b30b$export$9d1611c77c2fe928(o,a,e),onContextMenu:u=>{u.preventDefault(),u.stopPropagation(),driveState().deselectEntries("all"),driveState().setContextMenuData({x:u.clientX,y:u.clientY,entry:t})},labelRef:s,className:n?"focus-visible:ring-2":void 0,labelClassName:clsx(l&&"bg-primary/selected ring ring-2 ring-inset ring-primary",i&&"opacity-30",n&&"h-40"),icon:n?jsxRuntimeExports.jsx(BackupIcon,{size:"md",className:"mr-6"}):jsxRuntimeExports.jsx(FolderIcon,{size:"sm",className:"mr-4"}),label:t.name})}const findHash=(e,t)=>{for(const s of t){if(s.id===e)return s.hash;if(s.children){const n=findHash(e,s.children);if(n)return n}}};function deleteEntries(e){return apiClient.post("file-entries/delete",e).then(t=>t.data)}function useDeleteEntries(){return useMutation({mutationFn:e=>(toast.loading(getLoaderMessage(e),{disableExitAnimation:!0}),deleteEntries(e)),onSuccess:(e,{entryIds:t,emptyTrash:s,deleteForever:n})=>{invalidateEntryQueries(),queryClient.invalidateQueries({queryKey:DriveQueryKeys.fetchStorageSummary}),s?toast(message("Emptied trash"),{disableEnterAnimation:!0}):n?toast(message("Permanently deleted [one 1 item|other :count items]",{values:{count:t.length}}),{disableEnterAnimation:!0}):toast(message("Moved [one 1 item|other :count items] to trash",{values:{count:t.length}}),{disableEnterAnimation:!0})},onError:(e,{emptyTrash:t})=>{const s=getAxiosErrorMessage(e);s?toast.danger(s,{disableEnterAnimation:!0}):t?toast.danger("could not empty trash",{disableEnterAnimation:!0}):toast.danger("Could not delete items",{disableEnterAnimation:!0})}})}function getLoaderMessage(e){return e.emptyTrash?message("Emptying trash..."):e.deleteForever?message("Deleting files..."):message("Moving to trash...")}function SidebarMenu(){return jsxRuntimeExports.jsxs("div",{className:"mt-26 px-12 text-muted",children:[jsxRuntimeExports.jsx(FolderTree,{}),jsxRuntimeExports.jsx(CustomMenu,{menu:MenuPositions.DriveSidebar,orientation:"vertical",gap:"gap-0",children:e=>e.action==="/drive/trash"?jsxRuntimeExports.jsx(TrashMenuItem,{item:e},e.id):jsxRuntimeExports.jsx(MenuItem,{item:e},e.id)})]})}const MenuItem=reactExports.forwardRef(({item:e,className:t,...s},n)=>jsxRuntimeExports.jsx(CustomMenuItem,{className:({isActive:i})=>clsx(t,"my-4 h-40 w-full rounded px-24",i?"cursor-default bg-primary/selected font-bold text-primary":"hover:bg-hover"),item:e,ref:n,...s}));function TrashMenuItem({item:e}){const t=useDeleteEntries(),[s,n]=reactExports.useState(!1),i=reactExports.useRef(null),{droppableProps:o}=useDroppable({id:"trash",types:["fileEntry"],ref:i,onDragEnter:()=>{n(!0)},onDragLeave:()=>{n(!1)},onDrop:a=>{const l=a.getData().map(u=>u.id);t.mutate({entryIds:l,deleteForever:!1})}});return jsxRuntimeExports.jsx(MenuItem,{className:clsx(s&&"bg-primary/selected"),ref:i,...o,item:e})}function CreateNewButton({isCompact:e,className:t}){const s=useDriveStore(o=>o.activePage),{uploadFiles:n}=useDriveUploadQueue(),i=e?jsxRuntimeExports.jsx(IconButton,{size:"md",disabled:!(s!=null&&s.canUpload),children:jsxRuntimeExports.jsx(AddIcon,{})}):jsxRuntimeExports.jsx(Button,{className:"min-w-160",color:"primary",variant:"flat",size:"sm",startIcon:jsxRuntimeExports.jsx(FileUploadIcon,{}),disabled:!(s!=null&&s.canUpload),children:jsxRuntimeExports.jsx(Trans,{message:"Upload"})});return jsxRuntimeExports.jsx("div",{className:t,children:jsxRuntimeExports.jsxs(MenuTrigger,{onItemSelected:async o=>{var a;if(o==="uploadFiles")n(await openUploadWindow({multiple:!0}));else if(o==="uploadFolder")n(await openUploadWindow({directory:!0}));else if(o==="newFolder"){const l=(a=driveState().activePage)==null?void 0:a.folder;driveState().setActiveActionDialog("newFolder",l?[l]:[])}},children:[i,jsxRuntimeExports.jsxs(Menu,{children:[jsxRuntimeExports.jsx(Item,{value:"uploadFiles",startIcon:jsxRuntimeExports.jsx(UploadFileIcon,{}),children:jsxRuntimeExports.jsx(Trans,{message:"Upload files"})}),jsxRuntimeExports.jsx(Item,{value:"uploadFolder",startIcon:jsxRuntimeExports.jsx(DriveFolderUploadIcon,{}),children:jsxRuntimeExports.jsx(Trans,{message:"Upload folder"})}),jsxRuntimeExports.jsx(Item,{value:"newFolder",startIcon:jsxRuntimeExports.jsx(CreateNewFolderIcon,{}),children:jsxRuntimeExports.jsx(Trans,{message:"Create folder"})})]})]})})}function Sidebar({className:e}){const{isSubscribed:t}=useAuth(),{billing:s}=useSettings();return jsxRuntimeExports.jsxs("div",{className:clsx(e,"flex flex-col gap-20 border-r bg-alt text-sm font-medium text-muted"),children:[jsxRuntimeExports.jsxs("div",{className:"compact-scrollbar flex-auto overflow-y-auto",children:[jsxRuntimeExports.jsx(CreateNewButton,{className:"px-12 pt-28 text-center"}),jsxRuntimeExports.jsx(SidebarMenu,{}),jsxRuntimeExports.jsx(StorageMeter,{}),s.enable?jsxRuntimeExports.jsx("div",{className:"mt-14 pl-60",children:jsxRuntimeExports.jsx(Button,{elementType:Link,to:t?"/billing/change-plan":"/pricing",variant:"outline",color:"primary",size:"xs",children:jsxRuntimeExports.jsx(Trans,{message:"Upgrade"})})}):null]}),jsxRuntimeExports.jsx(WorkspaceSwitcher,{})]})}function WorkspaceSwitcher(){const e=useNavigate();return jsxRuntimeExports.jsx(WorkspaceSelector,{onChange:()=>{e(RootFolderPage.path)},className:"mt-auto w-full flex-shrink-0 border-t px-24 py-18"})}function fetchEntries$2(e){return apiClient.get("drive/file-entries",{params:e}).then(t=>t.data)}const setActiveFolder=e=>{var i;const s=e.pages[0].folder,n=driveState().activePage;return s&&n&&n.uniqueId===s.hash&&(!n.folder||!shallowEqual(s.permissions,(i=n.folder)==null?void 0:i.permissions))&&driveState().setActivePage(makeFolderPage(s)),e};function usePaginatedEntries(){const e=useDriveStore(l=>l.activePage),t=useDriveStore(l=>l.sortDescriptor),[s]=useSearchParams(),{workspaceId:n}=useActiveWorkspaceId(),i={section:e==null?void 0:e.name,...e==null?void 0:e.queryParams,...Object.fromEntries(s),folderId:e!=null&&e.isFolderPage?e.uniqueId:null,workspaceId:n,...t},o=e===SearchPage&&!i.query&&!i.filters,a=useInfiniteQuery({queryKey:DriveQueryKeys.fetchEntries(i),queryFn:({pageParam:l=1})=>fetchEntries$2({...i,page:l}),initialPageParam:1,getNextPageParam:l=>{const u=l.current_page;if(hasNextPage$1(l))return u+1},enabled:e!=null&&!o});return reactExports.useEffect(()=>{var l;(l=a.data)!=null&&l.pages[0].folder&&setActiveFolder(a.data)},[a.data]),a}function getAllEntries(){return queryClient.getQueriesData({queryKey:DriveQueryKeys.fetchEntries()}).reduce((t,s)=>{const n=s[1]?s[1].pages.flatMap(i=>i.data):[];return[...t,...n]},[])}const driveSearchFilters=[FILE_ENTRY_TYPE_FILTER,{key:"owner_id",label:message("Owner"),description:message("User file was uploaded by"),defaultOperator:FilterOperator.eq,control:{type:FilterControlType.Select,defaultValue:"02",options:[{key:"01",label:message("anyone"),value:{value:null,operator:"!="}},{key:"02",label:message("me"),value:"{authId}"},{key:"03",label:message("not me"),value:{value:"{authId}",operator:"!="}}]}},createdAtFilter({description:message("Date file was uploaded")}),updatedAtFilter({description:message("Date file was last changed")}),{key:"deleted_at",label:message("In trash"),description:message("Only show files that are in the trash"),defaultOperator:FilterOperator.ne,control:{type:FilterControlType.BooleanToggle,defaultValue:null}},{key:"shareableLink",label:message("Has shareable link"),description:message("Only show files that have a shareable link"),defaultOperator:FilterOperator.has,control:{type:FilterControlType.BooleanToggle,defaultValue:"*"}},{control:{type:FilterControlType.BooleanToggle,defaultValue:!0},key:"sharedByMe",label:message("Shared by me"),description:message("Only show files that are shared with someone"),defaultOperator:FilterOperator.eq}],alwaysShownFilters=driveSearchFilters.map(e=>e.key);function SearchFilterList(){const e=useDriveStore(l=>l.activePage),{isMobileMode:t}=reactExports.useContext(DashboardLayoutContext),{trans:s}=useTrans(),n=useNavigate(),[i]=useSearchParams(),[o,a]=reactExports.useState(i.get("query")||"");return e!==SearchPage?null:jsxRuntimeExports.jsxs("div",{className:"mb-30 mt-10 px-10 md:px-26",children:[t&&jsxRuntimeExports.jsx("form",{className:"contents",onSubmit:l=>{var u;l.preventDefault(),((u=document.activeElement)==null?void 0:u.tagName)==="INPUT"&&document.activeElement.blur(),n({pathname:SearchPage.path,search:`?query=${o}`},{replace:!0})},children:jsxRuntimeExports.jsx(TextField,{autoFocus:!0,className:"mb-20",startAdornment:jsxRuntimeExports.jsx(IconButton,{type:"submit",children:jsxRuntimeExports.jsx(SearchIcon,{})}),placeholder:s(message("Type to search")),value:o,onChange:l=>a(l.target.value)})}),jsxRuntimeExports.jsx(FilterList,{filters:driveSearchFilters,pinnedFilters:alwaysShownFilters})]})}function restrictResizableWithinBoundary(e,t){const s={...e};s.left=Math.max(0,s.left);const n=s.left-e.left;n>0&&(s.width-=n),s.top=Math.max(0,s.top);const i=s.top-e.top;return i>0&&(s.height-=i),s.width=Math.min(s.width,t.width-s.left),s.height=Math.min(s.height,t.height-s.top),s}const mouseSelectables=new Map;function useMouseSelectable(e){const{id:t,ref:s}=e,n=reactExports.useRef(e);n.current=e,reactExports.useLayoutEffect(()=>{if(s.current)return mouseSelectables.set(t,{...mouseSelectables.get(t),id:t,ref:s,onSelected:()=>{var i,o;(o=(i=n.current).onSelected)==null||o.call(i)},onDeselected:()=>{var i,o;return(o=(i=n.current).onDeselected)==null?void 0:o.call(i)}}),()=>{droppables.delete(t)}},[t,n,s])}function rectsIntersect(e,t){return!e||!t?!1:e.left<=t.left+t.width&&e.left+e.width>=t.left&&e.top<=t.top+t.height&&e.top+e.height>=t.top}function useMouseSelectionBox({onPointerDown:e,...t}={}){const s=reactExports.useRef(null),n=t.containerRef||s,i=reactExports.useRef(null);let o=reactExports.useRef({}).current;const a=()=>{var v,y,E,b,I,S,T;if(o.rafId&&cancelAnimationFrame(o.rafId),!o.startPoint||!o.endPoint||!o.boundaryRect)return;const u=o.startPoint,c=o.endPoint,d=u.scrollTop||0,x=((v=n.current)==null?void 0:v.scrollTop)||0,p={left:Math.min(u.x,c.x),top:Math.min(u.y,c.y),width:Math.abs(u.x-c.x),height:Math.abs(u.y-c.y)};p.left-=o.boundaryRect.left,p.top-=o.boundaryRect.top,p.top+=d;const h=x-d,f=Math.abs(h);h<0&&(p.top-=f),p.height+=f;const j=o.boundaryRect?restrictResizableWithinBoundary(p,o.boundaryRect):{...p};i.current&&(o.rafId=requestAnimationFrame(()=>{i.current&&(i.current.style.display="block",i.current.style.transform=`translate(${j.left}px, ${j.top}px)`,i.current.style.width=`${j.width}px`,i.current.style.height=`${j.height}px`),o.rafId=void 0}));const g={...j,left:j.left+o.boundaryRect.left,top:j.top+o.boundaryRect.top-x};for(const[,R]of mouseSelectables){const P=rectsIntersect(R.rect,g);P&&!((y=o.selectedIds)!=null&&y.has(R.id))?((E=o.selectedIds)==null||E.add(R.id),(b=R.onSelected)==null||b.call(R)):!P&&((I=o.selectedIds)!=null&&I.has(R.id))&&((S=o.selectedIds)==null||S.delete(R.id),(T=R.onDeselected)==null||T.call(R))}};return{containerProps:{...usePointerEvents({minimumMovement:4,onPointerDown:e,onMoveStart:u=>{if(activeInteraction)return!1;updateRects(mouseSelectables),o={selectedIds:new Set};const c=n.current;if(o.startPoint={x:u.clientX,y:u.clientY,scrollTop:(c==null?void 0:c.scrollTop)||0},o.scrollListener=d=>{var x;o.startPoint&&(updateRects(mouseSelectables),(x=o.boundaryRect)!=null&&x.height&&(o.boundaryRect.height=d.target.scrollHeight),a())},c){const d=c.getBoundingClientRect();c.addEventListener("scroll",o.scrollListener),o.boundaryRect={top:d.top,left:d.left,height:c.scrollHeight,heightWithoutScroll:d.height,width:c.scrollWidth}}},onMove:u=>{if(o.endPoint={x:u.clientX,y:u.clientY},o.boundaryRect&&n.current){const c=u.clientY+20>o.boundaryRect.heightWithoutScroll+o.boundaryRect.top,d=u.clientY-20<o.boundaryRect.top;c?n.current.scrollBy({top:10}):d&&n.current.scrollBy({top:-10})}a()},onMoveEnd:()=>{o.rafId&&cancelAnimationFrame(o.rafId),n.current&&o.scrollListener&&n.current.removeEventListener("scroll",o.scrollListener),i.current&&(i.current.style.display="none",i.current.style.transform="",i.current.style.width="",i.current.style.height=""),o={}}}).domProps,ref:n},boxProps:{ref:i}}}function createShareableLink(e){return e?apiClient.post(`file-entries/${e}/shareable-link`).then(t=>t.data):Promise.reject(new Error("Invalid entry id"))}function useCreateShareableLink(){return useMutation({mutationFn:({entryId:e})=>createShareableLink(e),onSuccess:(e,{entryId:t})=>{queryClient.setQueryData(DriveQueryKeys.fetchEntryShareableLink(t),e)},onError:e=>showHttpErrorToast(e,message("Could not create link"))})}function addStarToEntries({entryIds:e}){return apiClient.post("file-entries/star",{entryIds:e}).then(t=>t.data)}function useAddStarToEntries(){return useMutation({mutationFn:e=>addStarToEntries(e),onSuccess:(e,{entryIds:t})=>{invalidateEntryQueries(),toast(message("Starred [one 1 item|other :count items]",{values:{count:t.length}}))},onError:e=>showHttpErrorToast(e,message("Could not star items"))})}function removeStarFromEntries({entryIds:e}){return apiClient.post("file-entries/unstar",{entryIds:e}).then(t=>t.data)}function useRemoveStarFromEntries(){return useMutation({mutationFn:e=>removeStarFromEntries(e),onSuccess:(e,{entryIds:t})=>{invalidateEntryQueries(),toast(message("Removed star from [one 1 item|other :count items]",{values:{count:t.length}}))},onError:e=>showHttpErrorToast(e,message("Could not remove star"))})}function duplicateEntries(e){return apiClient.post("file-entries/duplicate",e).then(t=>t.data)}function useDuplicateEntries(){return useMutation({mutationFn:e=>(toast.loading(message("Duplicating [one 1 item|other :count items]...",{values:{count:e.entryIds.length}}),{disableExitAnimation:!0}),duplicateEntries(e)),onSuccess:(e,t)=>{invalidateEntryQueries(),queryClient.invalidateQueries({queryKey:DriveQueryKeys.fetchStorageSummary}),toast(message("Duplicated [one 1 item|other :count items]",{values:{count:t.entryIds.length}}),{disableEnterAnimation:!0})},onError:e=>showHttpErrorToast(e,message("Could not duplicate items"),null,{disableEnterAnimation:!0})})}function useUnshareEntries(){return useMutation({mutationFn:e=>unshareEntries(e),onSuccess:()=>invalidateEntryQueries()})}function unshareEntries({entryIds:e,...t}){return apiClient.post(`file-entries/${e.join(",")}/unshare`,t).then(s=>s.data)}function useRestoreEntries(){return useMutation({mutationFn:e=>restoreEntries(e),onSuccess:(e,t)=>{invalidateEntryQueries(),toast(message("Restored [one 1 item|other :count items]",{values:{count:t.entryIds.length}}))},onError:e=>showHttpErrorToast(e,message("Could not restore items"))})}function restoreEntries(e){return apiClient.post("file-entries/restore",e).then(t=>t.data)}function useEntryActions(e){const t=usePreviewAction(e),s=useShareAction(e),n=useGetLinkAction(e),i=useAddToStarredAction(e),o=useRemoveFromStarred(e),a=useMoveToAction(e),l=useRenameAction(e),u=useMakeCopyAction(e),c=useDownloadEntriesAction(e),d=useDeleteEntriesAction(e),x=useRemoveSharedEntriesAction(e),p=useRestoreEntriesAction(e);return[t,s,n,i,o,a,l,u,c,d,x,p].filter(h=>!!h)}function usePreviewAction(e){if(e.some(t=>t.type!=="folder"))return{label:message("Preview"),icon:RemoveRedEyeIcon,key:"preview",execute:()=>{driveState().setActiveActionDialog("preview",e)}}}function useShareAction(e){const t=useDriveStore(s=>s.activePage);if(!(e.length>1||!e.every(s=>s.permissions["files.update"])||t===TrashPage))return{label:message("Share"),icon:PersonAddIcon,key:"share",execute:()=>{driveState().setActiveActionDialog("share",e)}}}function useGetLinkAction(e){const t=useDriveStore(n=>n.activePage),s=useCreateShareableLink();if(!(e.length>1||!e.every(n=>n.permissions["files.update"])||t===TrashPage))return{label:message("Get link"),icon:LinkIcon,key:"getLink",execute:()=>{s.mutate({entryId:e[0].id}),driveState().setActiveActionDialog("getLink",e)}}}function useAddToStarredAction(e){const t=useDriveStore(n=>n.activePage),s=useAddStarToEntries();if(!(e.every(n=>{var i;return(i=n.tags)==null?void 0:i.find(o=>o.name==="starred")})||!e.every(n=>n.permissions["files.update"])||t===TrashPage))return{label:message("Add to starred"),icon:StarIcon,key:"addToStarred",execute:()=>{s.mutate({entryIds:e.map(n=>n.id)}),driveState().selectEntries([])}}}function useRemoveFromStarred(e){const t=useDriveStore(n=>n.activePage),s=useRemoveStarFromEntries();if(!(!e.every(n=>{var i;return(i=n.tags)==null?void 0:i.find(o=>o.name==="starred")})||t===TrashPage))return{label:message("Remove from starred"),icon:StarOutlineIcon,key:"removeFromStarred",execute:()=>{s.mutate({entryIds:e.map(n=>n.id)}),driveState().selectEntries([])}}}function useMoveToAction(e){const t=useDriveStore(s=>s.activePage);if(!(!e.every(s=>s.permissions["files.update"])||t===SharesPage||t===TrashPage))return{label:message("Move to"),icon:DriveFileMoveIcon,key:"moveTo",execute:()=>{driveState().setActiveActionDialog("moveTo",e)}}}function useRenameAction(e){const t=useDriveStore(s=>s.activePage);if(!(e.length>1||!e.every(s=>s.permissions["files.update"])||t===TrashPage))return{label:message("Rename"),icon:DriveFileRenameOutlineIcon,key:"rename",execute:()=>{driveState().setActiveActionDialog("rename",e)}}}function useMakeCopyAction(e){const t=useDriveStore(n=>n.activePage),s=useDuplicateEntries();if(!(e.length>1||!e.every(n=>n.permissions["files.update"])||t===TrashPage))return{label:message("Make a copy"),icon:ContentCopyIcon,key:"makeCopy",execute:()=>{var n;s.mutate({entryIds:e.map(i=>i.id),destinationId:(n=t==null?void 0:t.folder)==null?void 0:n.id}),driveState().selectEntries([])}}}function useDownloadEntriesAction(e){const{downloadUrl:t}=useFileEntryUrls(e[0],{downloadHashes:e.map(s=>s.hash)});if(e.every(s=>s.permissions["files.download"]))return{label:message("Download"),icon:FileDownloadIcon,key:"download",execute:()=>{t&&downloadFileFromUrl(t),driveState().selectEntries([])}}}function useDeleteEntriesAction(e){const t=useDeleteEntries(),s=useDriveStore(n=>n.activePage);if(!(s===SharesPage||!e.every(n=>n.permissions["files.delete"])))return{label:s===TrashPage?message("Delete forever"):message("Remove"),icon:DeleteIcon,key:"delete",execute:()=>{s===TrashPage?driveState().setActiveActionDialog("confirmAndDeleteForever",e):(t.mutate({entryIds:e.map(n=>n.id),deleteForever:s===TrashPage}),driveState().selectEntries([]))}}}function useRestoreEntriesAction(e){const t=useRestoreEntries();if(!(useDriveStore(n=>n.activePage)!==TrashPage||!e.every(n=>n.permissions["files.delete"])))return{label:message("Restore"),icon:RestoreIcon,key:"restore",execute:()=>{t.mutate({entryIds:e.map(n=>n.id)}),driveState().selectEntries([])}}}function useRemoveSharedEntriesAction(e){const t=useUnshareEntries();if(useDriveStore(n=>n.activePage)===SharesPage)return{label:message("Remove"),icon:DeleteIcon,key:"removeSharedEntry",execute:()=>{t.mutate({entryIds:e.map(n=>n.id),userId:"me"},{onSuccess:(n,i)=>{toast(message("Removed [one 1 item|other {count} items]",{values:{count:i.entryIds.length}}))},onError:n=>showHttpErrorToast(n,message("Could not remove items"))}),driveState().selectEntries([])}}}function useDrivePageActions(e){const t=useNewFolderAction(e),s=useUploadFilesAction(e),n=useUploadFolderAction(e),i=useEmptyTrashAction();return[t,s,n,i].filter(o=>!!o)}function useNewFolderAction(e){if(!(!e.folder||!e.folder.permissions["files.update"]))return{label:message("New folder"),icon:CreateNewFolderIcon,key:"newFolder",execute:()=>{e.folder&&driveState().setActiveActionDialog("newFolder",[e.folder])}}}function useUploadFilesAction(e){const{uploadFiles:t}=useDriveUploadQueue();if(!(!e.folder||!e.folder.permissions["files.update"]))return{label:message("Upload files"),icon:FileUploadIcon,key:"uploadFiles",execute:async()=>{t(await openUploadWindow({multiple:!0}))}}}function useUploadFolderAction(e){const{uploadFiles:t}=useDriveUploadQueue();if(!(!e.folder||!e.folder.permissions["files.update"]))return{label:message("Upload folder"),icon:DriveFolderUploadIcon,key:"uploadFolder",execute:async()=>{t(await openUploadWindow({directory:!0}))}}}function useEmptyTrashAction(e){const t=useDeleteEntries();if(useDriveStore(n=>n.activePage)===TrashPage)return{label:message("Empty trash"),icon:DeleteForeverIcon,key:"emptyTrash",execute:()=>{t.mutate({entryIds:[],emptyTrash:!0}),driveState().selectEntries([])}}}function EntryActionMenuTrigger({children:e,entries:t,page:s,showIfNoActions:n}){return(s==null?void 0:s.name)===RootFolderPage.name?jsxRuntimeExports.jsx(PageMenu,{page:RootFolderPage,showIfNoActions:n,children:e}):s===TrashPage?jsxRuntimeExports.jsx(PageMenu,{page:TrashPage,showIfNoActions:n,children:e}):s!=null&&s.folder?jsxRuntimeExports.jsx(EntriesMenu,{entries:[s.folder],showIfNoActions:n,children:e}):t!=null&&t.length?jsxRuntimeExports.jsx(EntriesMenu,{entries:t,showIfNoActions:n,children:e}):null}function EntriesMenu({entries:e,children:t,showIfNoActions:s}){const n=useEntryActions(e);return jsxRuntimeExports.jsx(BaseMenu,{actions:n,showIfNoActions:s,children:t})}function PageMenu({page:e,children:t,showIfNoActions:s}){const n=useDrivePageActions(e);return jsxRuntimeExports.jsx(BaseMenu,{actions:n,showIfNoActions:s,children:t})}function BaseMenu({actions:e,children:t,showIfNoActions:s}){return!e.length&&!s?null:jsxRuntimeExports.jsxs(MenuTrigger,{children:[t,jsxRuntimeExports.jsx(Menu,{children:e.map(n=>jsxRuntimeExports.jsx(Item,{onSelected:()=>{n.execute()},value:n.key,startIcon:reactExports.createElement(n.icon),children:jsxRuntimeExports.jsx(Trans,{...n.label})},n.key))})]})}function useEntries(){const e=usePaginatedEntries();return e.data?e.data.pages.flatMap(t=>t.data):[]}function useSelectedEntries(){const e=useDriveStore(s=>s.selectedEntries),t=useEntries();return Array.from(e).map(s=>t.find(n=>n.id===s)).filter(s=>!!s)}function useSelectedEntry(){return useSelectedEntries()[0]}function useSelectedEntryParent(){const e=useSelectedEntry(),{data:t}=useFolders();if(!(!e||!(t!=null&&t.folders)))return t.folders.find(s=>s.id===e.parent_id)}function getSelectedEntries(){const e=Array.from(driveState().selectedEntries),t=getAllEntries();return e.map(s=>t.find(n=>n.id===s)).filter(s=>!!s)}function EntryActionList({className:e}){const t=useSelectedEntries();return t.length?jsxRuntimeExports.jsx("div",{className:e,children:jsxRuntimeExports.jsx(ActionList,{entries:t})}):null}function ActionList({entries:e}){const t=usePreviewAction(e),s=useShareAction(e),n=useDeleteEntriesAction(e),i=useRemoveSharedEntriesAction(e),o=[t,s,n,i].filter(a=>!!a);return jsxRuntimeExports.jsxs("div",{className:"entry-action-list",children:[o.map(a=>jsxRuntimeExports.jsx(Tooltip,{label:jsxRuntimeExports.jsx(Trans,{...a.label}),children:jsxRuntimeExports.jsx(IconButton,{size:"sm",onClick:()=>{a.execute()},children:reactExports.createElement(a.icon)})},a.key)),jsxRuntimeExports.jsx(EntryActionMenuTrigger,{entries:e,children:jsxRuntimeExports.jsx(Tooltip,{label:jsxRuntimeExports.jsx(Trans,{message:"More actions"}),children:jsxRuntimeExports.jsx(IconButton,{children:jsxRuntimeExports.jsx(MoreVertIcon,{})})})})]})}function DriveContextMenu(){var i;const e=useSelectedEntries(),t=useDriveStore(o=>o.activePage),s=useDriveStore(o=>o.contextMenuData),n=s!=null&&s.entry?[s.entry]:e;return((i=s==null?void 0:s.entry)==null?void 0:i.id)===0?jsxRuntimeExports.jsx(PageContextMenu,{position:s,page:RootFolderPage}):s&&n.length?jsxRuntimeExports.jsx(EntriesContextMenu,{entries:n,position:s}):s&&t?jsxRuntimeExports.jsx(PageContextMenu,{position:s,page:t}):null}function EntriesContextMenu({entries:e,position:t}){const s=useEntryActions(e);return jsxRuntimeExports.jsx(BaseContextMenu,{position:t,actions:s})}function PageContextMenu({page:e,position:t}){const s=useDrivePageActions(e);return jsxRuntimeExports.jsx(BaseContextMenu,{position:t,actions:s})}function BaseContextMenu({position:e,actions:t}){return jsxRuntimeExports.jsx(ContextMenu,{position:e,onOpenChange:s=>{s||driveState().setContextMenuData(null)},children:t.map(s=>jsxRuntimeExports.jsx(Item,{value:s.key,onSelected:s.execute,startIcon:reactExports.createElement(s.icon),children:jsxRuntimeExports.jsx(Trans,{...s.label})},s.key))})}function useIsTouchDevice(){return useMediaQuery("((pointer: coarse))")}function useFileViewDnd(e){const t=useIsTouchDevice(),s=reactExports.useRef(null),{onDrop:n}=useFolderDropAction(e),[i,o]=reactExports.useState(!1),a=useDriveStore(x=>x.entriesBeingDragged.includes(e.id)),l=useDriveStore(x=>x.activePage),{draggableProps:u}=useDraggable({disabled:!!t||l===TrashPage,id:e.id,type:"fileEntry",ref:s,hidePreview:!0,onDragStart:(x,p)=>{driveState().selectedEntries.has(e.id)||driveState().selectEntries([e.id]),driveState().setEntriesBeingDragged(p.getData().map(h=>h.id))},onDragEnd:()=>{driveState().setEntriesBeingDragged([])},getData:()=>getSelectedEntries()}),{droppableProps:c}=useDroppable({id:e.id,disabled:t||e.type!=="folder",ref:s,types:["fileEntry","nativeFile"],acceptsDrop:x=>folderAcceptsDrop(x,e),onDragEnter:()=>o(!0),onDragLeave:()=>o(!1),onDrop:n});useMouseSelectable({id:e.id,ref:s,onSelected:()=>{driveState().selectEntries([e.id],!0)},onDeselected:()=>{driveState().deselectEntries([e.id])}});const d=clsx(a&&"opacity-20",i&&"ring ring-offset-4 ring-primary bg-primary-light/10 rounded");return{draggableProps:u,droppableProps:c,isDragOver:i,isDragging:a,itemClassName:d,ref:s}}function FileTableRow({item:e,children:t,className:s,...n}){const{isCollapsedMode:i}=reactExports.useContext(TableContext),{draggableProps:o,droppableProps:a,itemClassName:l,ref:u}=useFileViewDnd(e);return jsxRuntimeExports.jsx("div",{className:clsx(s,l),ref:u,...$3ef42575df84b30b$export$9d1611c77c2fe928(o,a,n,{onContextMenu:c=>{c.preventDefault(),c.stopPropagation(),i||(driveState().selectedEntries.has(e.id)||driveState().selectEntries([e.id]),driveState().setContextMenuData({x:c.clientX,y:c.clientY}))}}),children:t})}function useViewItemActionHandler(){const e=useNavigate();return{performViewItemAction:reactExports.useCallback(s=>{if(s&&s.type==="folder")driveState().activePage===TrashPage?driveState().setActiveActionDialog("trashFolderBlock",[s]):e(getPathForFolder(s.hash));else{const n=getSelectedEntries();driveState().setActiveActionDialog("preview",n.length?n:[s])}},[e])}}const formatFileSize=memoize(e=>prettyBytes(e)),fileTableColumns=[{key:"name",allowsSorting:!0,header:()=>jsxRuntimeExports.jsx(Trans,{message:"Name"}),visibleInMode:"all",width:"flex-3 min-w-200",body:e=>jsxRuntimeExports.jsx(FileNameColumn,{entry:e})},{key:"updated_at",allowsSorting:!0,maxWidth:"max-w-184",header:()=>jsxRuntimeExports.jsx(Trans,{message:"Last modified"}),body:e=>jsxRuntimeExports.jsx(FormattedDate,{date:e.updated_at})},{key:"file_size",allowsSorting:!0,header:()=>jsxRuntimeExports.jsx(Trans,{message:"Size"}),maxWidth:"max-w-144",body:e=>formatFileSize(e.file_size)??"-"},{key:"actions",hideHeader:!0,header:()=>jsxRuntimeExports.jsx(Trans,{message:"Actions"}),align:"end",width:"w-42 flex-shrink-0",visibleInMode:"all",body:e=>jsxRuntimeExports.jsx(ActionsColumn,{entry:e})}];function FileNameColumn({entry:e}){const{isCollapsedMode:t}=reactExports.useContext(TableContext),s=t?"w-30 h-30":"w-24 h-24";return jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-14",children:[jsxRuntimeExports.jsx(FileThumbnail,{className:clsx("rounded",s),iconClassName:s,file:e}),jsxRuntimeExports.jsxs("div",{className:"min-w-0",children:[jsxRuntimeExports.jsx("div",{className:"overflow-hidden overflow-ellipsis",children:e.name}),t&&jsxRuntimeExports.jsxs("div",{className:"mt-4 flex items-center text-xs text-muted",children:[jsxRuntimeExports.jsx(FormattedDate,{date:e.updated_at}),jsxRuntimeExports.jsx("div",{children:"·"}),jsxRuntimeExports.jsx("div",{children:formatFileSize(e.file_size)})]})]})]})}function ActionsColumn({entry:e}){const{selectedRows:t}=reactExports.useContext(TableContext);return t.length?jsxRuntimeExports.jsx(Checkbox,{className:"mr-8 block",checked:t.includes(e.id)}):jsxRuntimeExports.jsx(EntryActionMenuTrigger,{entries:[e],children:jsxRuntimeExports.jsx(IconButton,{className:"text-muted",children:jsxRuntimeExports.jsx(MoreVertIcon,{})})})}function FileTable({entries:e}){const{performViewItemAction:t}=useViewItemActionHandler(),s=useDriveStore(o=>o.selectedEntries),n=useDriveStore(o=>o.sortDescriptor),i=reactExports.useMemo(()=>[...s],[s]);return jsxRuntimeExports.jsx(Table,{columns:fileTableColumns,data:e,sortDescriptor:n,onSortChange:o=>{driveState().setSortDescriptor(o)},onAction:t,selectedRows:i,selectionStyle:"highlight",renderRowAs:FileTableRow,onSelectionChange:o=>{driveState().selectEntries(o)}})}const BaseFileGridItem=React.forwardRef(({entry:e,className:t,isSelected:s,isMobileMode:n,footerAdornment:i,...o},a)=>jsxRuntimeExports.jsxs("div",{...o,ref:a,className:clsx("grid-item flex aspect-square select-none flex-col overflow-hidden rounded border shadow outline-none transition-shadow-opacity dark:bg-alt",s&&"border-primary",t),children:[jsxRuntimeExports.jsx("div",{className:"relative min-h-0 flex-auto",children:jsxRuntimeExports.jsx(FileThumbnail,{className:"h-full w-full",iconClassName:"block w-70 h-70 absolute m-auto inset-0",file:e})}),jsxRuntimeExports.jsx(Footer$1,{entry:e,isSelected:s,isMobile:n,adornment:i})]}));function Footer$1({entry:e,isSelected:t,isMobile:s,adornment:n}){return jsxRuntimeExports.jsxs("div",{className:clsx("flex h-48 flex-shrink-0 items-center text-sm",s?"justify-between gap-10 pl-18 pr-2":"justify-center px-16",t&&"bg-primary-light/20"),children:[jsxRuntimeExports.jsx("div",{className:"min-w-0 overflow-hidden overflow-ellipsis whitespace-nowrap",children:e.name}),n]})}function FileGridItem({entry:e}){const t=useDriveStore(h=>h.selectedEntries.has(e.id)),{performViewItemAction:s}=useViewItemActionHandler(),{isMobileMode:n}=reactExports.useContext(DashboardLayoutContext),{draggableProps:i,droppableProps:o,itemClassName:a,ref:l}=useFileViewDnd(e),u=()=>{t?driveState().deselectEntries([e.id]):driveState().selectEntries([e.id],!0)},c=(h,f)=>{n?driveState().selectedEntries.size?u():s(e):isCtrlOrShiftPressed(h)?u():driveState().selectEntries([e.id])},{domProps:d}=usePointerEvents({onLongPress:n?()=>u():void 0,onPress:c}),x=h=>{(h.key==="Enter"||h.key===" ")&&(h.preventDefault(),h.stopPropagation(),s(e))},p=h=>{h.preventDefault(),h.stopPropagation(),n||(driveState().selectedEntries.has(e.id)||driveState().selectEntries([e.id]),driveState().setContextMenuData({x:h.clientX,y:h.clientY}))};return jsxRuntimeExports.jsx(BaseFileGridItem,{...$3ef42575df84b30b$export$9d1611c77c2fe928(i,o,d,{onKeyDown:createEventHandler(x)}),ref:l,entry:e,isSelected:t,isMobileMode:!!n,tabIndex:-1,onDoubleClick:h=>{h.preventDefault(),h.stopPropagation(),n||s(e)},footerAdornment:n&&jsxRuntimeExports.jsx(FooterAdornment,{entry:e,isSelected:t}),onContextMenu:createEventHandler(p),className:a})}function FooterAdornment({entry:e,isSelected:t}){return useDriveStore(n=>n.selectedEntries.size)?jsxRuntimeExports.jsx(Checkbox,{className:"mr-8 block",checked:t}):jsxRuntimeExports.jsx(EntryActionMenuTrigger,{entries:[e],children:jsxRuntimeExports.jsx(IconButton,{className:"text-muted",onPointerDown:n=>{n.stopPropagation()},children:jsxRuntimeExports.jsx(MoreVertIcon,{})})})}function FileGrid({entries:e}){return jsxRuntimeExports.jsx("div",{className:"file-grid-container",children:jsxRuntimeExports.jsx("div",{className:"file-grid",children:e.map(t=>jsxRuntimeExports.jsx(FileGridItem,{entry:t},t.id))})})}const AVAILABLE_SORTS=[{id:"file_size",label:message("Size")},{id:"name",label:message("Name")},{id:"updated_at",label:message("Last modified")},{id:"created_at",label:message("Upload date")},{id:"type",label:message("Type")},{id:"extension",label:message("Extension")}];function EntriesSortButton({descriptor:e,onChange:t,isDisabled:s=!1}){const n=e.orderBy,i=e.orderDir,o=AVAILABLE_SORTS.find(a=>a.id===n);return jsxRuntimeExports.jsxs(MenuTrigger,{showCheckmark:!0,selectionMode:"multiple",selectedValue:[i||"desc",n||""],onItemSelected:a=>{t(a==="asc"||a==="desc"?{orderBy:n,orderDir:a}:{orderBy:a,orderDir:i})},children:[jsxRuntimeExports.jsx(Button,{className:"text-muted",variant:"text",size:"sm",startIcon:jsxRuntimeExports.jsx(SortIcon,{}),disabled:s,children:o?jsxRuntimeExports.jsx(Trans,{...o.label}):null}),jsxRuntimeExports.jsxs(Menu,{children:[jsxRuntimeExports.jsxs(Section,{label:jsxRuntimeExports.jsx(Trans,{message:"Direction"}),children:[jsxRuntimeExports.jsx(Item,{value:"asc",children:jsxRuntimeExports.jsx(Trans,{message:"Ascending"})}),jsxRuntimeExports.jsx(Item,{value:"desc",children:jsxRuntimeExports.jsx(Trans,{message:"Descending"})})]}),jsxRuntimeExports.jsx(Section,{label:jsxRuntimeExports.jsx(Trans,{message:"Sort By"}),children:AVAILABLE_SORTS.map(a=>jsxRuntimeExports.jsx(Item,{value:a.id,children:jsxRuntimeExports.jsx(Trans,{...a.label})},a.id))})]})]})}function DriveSortButton({isDisabled:e}){const t=useDriveStore(s=>s.sortDescriptor);return jsxRuntimeExports.jsx(EntriesSortButton,{isDisabled:e,descriptor:t,onChange:s=>{driveState().setSortDescriptor(s)}})}function useFolderPath({hash:e,params:t,isEnabled:s=!0}){return useQuery({queryKey:DriveQueryKeys.fetchFolderPath(e,t),queryFn:()=>fetchFolderPath(e,t),enabled:!!e&&s})}function fetchFolderPath(e,t){return apiClient.get(`folders/${e}/path`,{params:t}).then(s=>s.data)}function PageBreadcrumbs({className:e}){const{isMobileMode:t}=reactExports.useContext(DashboardLayoutContext),s=useNavigate(),n=useDriveStore(d=>d.activePage),i=n==null?void 0:n.folder,o=useFolderPath({hash:i==null?void 0:i.hash,isEnabled:(i==null?void 0:i.hash)!==RootFolderPage.folder.hash}),a=useActiveWorkspace(),l=useRootItem(),u=!n||!a||n.isFolderPage&&!i||o.fetchStatus!=="idle";let c;if(u)c=null;else{const d=l?[l]:[];o.data&&o.data.path.forEach(x=>{d.push({page:makeFolderPage(x),label:x.name})}),c=jsxRuntimeExports.jsx(Breadcrumb,{className:e,size:t?"md":"lg",currentIsClickable:!0,children:d.map((x,p)=>p===d.length-1?jsxRuntimeExports.jsx(BreadcrumbItem,{children:({isMenuItem:f})=>f||!x.page.folder&&x.page!==TrashPage?jsxRuntimeExports.jsx(MixedText,{value:x.label}):jsxRuntimeExports.jsx(EntryActionMenuTrigger,{page:x.page,showIfNoActions:!0,children:jsxRuntimeExports.jsxs(ButtonBase,{className:"flex items-center gap-2 rounded focus-visible:ring-offset-4",children:[jsxRuntimeExports.jsx(MixedText,{value:x.label}),jsxRuntimeExports.jsx(ArrowDropDownIcon,{className:"text-muted icon-md"})]})})},x.page.uniqueId):jsxRuntimeExports.jsx(BreadcrumbItem,{onSelected:()=>{s(x.page.path)},children:jsxRuntimeExports.jsx(MixedText,{value:x.label})},x.page.uniqueId))})}return c}function useRootItem(){var n,i;const e=useDriveStore(o=>o.activePage),t=useActiveWorkspace(),{user:s}=useAuth();if(!e)return null;if(t&&!t.default&&e!=null&&e.isFolderPage&&((e==null?void 0:e.name)===RootFolderPage.name||((n=e.folder)==null?void 0:n.workspace_id)===t.id))return{label:t.name,page:RootFolderPage};if(e!=null&&e.isFolderPage){const o=(i=e.folder)==null?void 0:i.users.find(a=>a.owns_entry);return(o==null?void 0:o.id)!==(s==null?void 0:s.id)?{label:SharesPage.label,page:SharesPage}:{label:RootFolderPage.label,page:RootFolderPage}}return{label:e.label,page:e}}function InfiniteScrollSentinel({query:{isInitialLoading:e,fetchNextPage:t,isFetchingNextPage:s,hasNextPage:n},children:i,loaderMarginTop:o="mt-24",style:a,className:l,variant:u="infiniteScroll",loadMoreExtraContent:c,size:d="sm"}){const x=reactExports.useRef(null),p=s||e,[h,f]=reactExports.useState(0),j=u==="loadMore"&&h<3?"loadMore":"infiniteScroll",g=reactExports.useRef(!1);reactExports.useEffect(()=>{const y=x.current;if(!y||j==="loadMore")return;const E=new IntersectionObserver(([b])=>{if(b.isIntersecting){if(!g.current)return;n&&!p&&(g.current=!1,t())}else g.current=!0});return E.observe(y),()=>{E.unobserve(y)}},[t,n,p,j]);let v;return i?v=s?i:null:j==="loadMore"?v=!e&&n&&jsxRuntimeExports.jsxs("div",{className:clsx("flex items-center gap-8",o),children:[c,jsxRuntimeExports.jsx(Button,{size:d==="md"?"sm":"xs",className:clsx(d==="sm"?"min-h-24 min-w-96":"min-h-36 min-w-112"),variant:"outline",color:"primary",onClick:()=>{t(),f(h+1)},disabled:p,children:h>=2&&!s?jsxRuntimeExports.jsx(Trans,{message:"Load all"}):jsxRuntimeExports.jsx(Trans,{message:"Show more"})})]}):v=jsxRuntimeExports.jsx(AnimatePresence,{children:s&&jsxRuntimeExports.jsx(m.div,{className:clsx("flex w-full justify-center",o),...opacityAnimation,children:jsxRuntimeExports.jsx(ProgressCircle,{size:d,isIndeterminate:!0,"aria-label":"loading"})})}),jsxRuntimeExports.jsxs("div",{style:a,className:clsx("w-full",l,n&&"min-h-36"),role:"presentation",children:[jsxRuntimeExports.jsx("div",{ref:x,"aria-hidden":!0}),v]})}function AdHost({slot:e,className:t}){var o;const s=useSettings(),{isSubscribed:n}=useAuth(),i=reactExports.useMemo(()=>dot.pick(`ads.${e}`,s),[e,s]);return(o=s.ads)!=null&&o.disable||n||!i?null:jsxRuntimeExports.jsx(InvariantAd,{className:t,slot:e,adCode:i})}const InvariantAd=reactExports.memo(({slot:e,adCode:t,className:s})=>{const n=reactExports.useRef(null),i=reactExports.useId();return reactExports.useEffect(()=>(n.current&&loadAdScripts(t,n.current).then(()=>{executeAdJavascript(t,i)}),()=>{delete window.google_ad_modifications}),[t,i]),reactExports.useEffect(()=>{if(n.current){const o=$62d8ded9296f3872$export$cfa2225e87938781(n.current);if(o){const a=new MutationObserver(function(){o.style.height="",o.style.minHeight=""});return a.observe(o,{attributes:!0,attributeFilter:["style"]}),()=>a.disconnect()}}},[]),jsxRuntimeExports.jsx("div",{ref:n,id:i,className:clsx("ad-host flex max-h-[600px] min-h-90 w-full max-w-full items-center justify-center overflow-hidden",`${e.replace(/\./g,"-")}-host`,s),dangerouslySetInnerHTML:{__html:getAdHtml(t)}})},()=>!1);function getAdHtml(e){return e==null?void 0:e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").trim()}function loadAdScripts(e,t){const s=[],n=/<script.*?src=['"](.*?)['"]/g;let i;for(;i=n.exec(e);)i[1]&&s.push(lazyLoader.loadAsset(i[1],{type:"js",parentEl:t}));return Promise.all(s)}function executeAdJavascript(adCode,id){const pattern=/<script\b[^>]*>([\s\S]*?)<\/script>/g;let content;for(;content=pattern.exec(adCode);)if(content[1]){const r=`var d = document.createElement('div'); d.innerHTML = $1; document.getElementById('${id}').appendChild(d.firstChild);`,toEval=content[1].replace(/document.write\((.+?)\);/,r);eval(toEval)}}function DropTargetMask({isVisible:e}){const t=jsxRuntimeExports.jsx(m.div,{...opacityAnimation,transition:{duration:.3},className:"pointer-events-none absolute inset-0 min-h-full w-full border-2 border-dashed border-primary bg-primary-light/30",children:jsxRuntimeExports.jsx(m.div,{initial:{y:"100%",opacity:0},animate:{y:"-10px",opacity:1},exit:{y:"100%",opacity:0},className:"fixed bottom-0 left-0 right-0 mx-auto max-w-max rounded bg-primary p-10 text-on-primary",children:jsxRuntimeExports.jsx(Trans,{message:"Drop files to upload them to this folder."})})},"dragTargetMask");return jsxRuntimeExports.jsx(AnimatePresence,{children:e?t:null})}function FileView({className:e}){const[t]=useSearchParams(),s=!!t.get("query")||!!t.get("filters"),n=reactExports.useRef(null),i=usePaginatedEntries(),o=useEntries(),{uploadFiles:a}=useDriveUploadQueue(),l=useDeleteEntries(),u=useDriveStore(E=>E.activePage),[c,d]=reactExports.useState(!1),x=useDriveStore(E=>E.viewMode),{isMobileMode:p}=reactExports.useContext(DashboardLayoutContext),{containerProps:h,boxProps:f}=useMouseSelectionBox({containerRef:n,onPointerDown:E=>{E.target.closest(".entry-action-list")||driveState().deselectEntries("all")}}),{droppableProps:j}=useDroppable({id:"driveRoot",ref:n,types:["nativeFile"],disabled:!(u!=null&&u.canUpload),onDragEnter:()=>{d(!0)},onDragLeave:()=>{d(!1)},onDrop:async E=>{E.type==="nativeFile"&&a(await E.getData())}});if(!u)return null;let g;if(!o.length&&(!i.isLoading||i.fetchStatus==="idle")){const E=u.noContentMessage(s);g=jsxRuntimeExports.jsx(IllustratedMessage,{className:"mt-40",image:jsxRuntimeExports.jsx(SvgImage,{src:E.image}),title:jsxRuntimeExports.jsx(Trans,{...E.title}),description:jsxRuntimeExports.jsx(Trans,{...E.description})})}else i.isLoading||(g=x==="list"?jsxRuntimeExports.jsx(FileTable,{entries:o}):jsxRuntimeExports.jsx(FileGrid,{entries:o}));const v=E=>{E.preventDefault(),E.stopPropagation(),driveState().deselectEntries("all"),driveState().setContextMenuData({x:E.clientX,y:E.clientY})},y=E=>{E.key==="a"&&isCtrlKeyPressed(E)&&(E.preventDefault(),E.stopPropagation(),driveState().selectEntries(o.map(b=>b.id))),E.key==="Delete"&&(E.preventDefault(),E.stopPropagation(),driveState().selectedEntries.size&&!l.isPending&&(u===TrashPage?driveState().setActiveActionDialog("confirmAndDeleteForever",getSelectedEntries()):(l.mutate({entryIds:[...driveState().selectedEntries],deleteForever:u===TrashPage}),driveState().selectEntries([]))))};return jsxRuntimeExports.jsx("div",{className:clsx("relative outline-none",e),tabIndex:-1,...$3ef42575df84b30b$export$9d1611c77c2fe928(h,j,{onKeyDown:createEventHandler(y)}),onContextMenu:v,children:jsxRuntimeExports.jsxs("div",{className:"relative flex min-h-full flex-col pt-10",children:[p?jsxRuntimeExports.jsx(PageBreadcrumbs,{className:"mb-10 px-14"}):jsxRuntimeExports.jsx(Toolbar,{}),jsxRuntimeExports.jsx(SearchFilterList,{}),jsxRuntimeExports.jsxs("div",{className:"relative flex-auto px-18 pb-18 md:px-24",children:[jsxRuntimeExports.jsx(AdHost,{slot:"drive",className:"mb-24"}),g,jsxRuntimeExports.jsx(InfiniteScrollSentinel,{query:i})]}),jsxRuntimeExports.jsx("div",{...f,className:"pointer-events-none absolute left-0 top-0 z-10 hidden border border-primary-light bg-primary-light/20 shadow-md"}),jsxRuntimeExports.jsx(DriveContextMenu,{}),jsxRuntimeExports.jsx(DropTargetMask,{isVisible:c})]})})}function Toolbar(){const e=useDriveStore(t=>t.activePage);return jsxRuntimeExports.jsxs("div",{className:"my-10 flex min-h-42 items-center justify-between gap-40 px-10 text-muted md:px-18",children:[jsxRuntimeExports.jsx(DriveSortButton,{isDisabled:e==null?void 0:e.disableSort}),jsxRuntimeExports.jsx(EntryActionList,{className:"text-muted"})]})}function formatSpeed(e){if(e===0)return"";const t=["B/s","KB/s","MB/s","GB/s"];let s=e,n=0;for(;s>=1024&&n<t.length-1;)s/=1024,n++;return`${s.toFixed(1)} ${t[n]}`}function formatETA(e){if(e===0||!isFinite(e))return"";const t=Math.floor(e/3600),s=Math.floor(e%3600/60),n=Math.floor(e%60);return t>0?`${t}h ${s}m ${n}s`:s>0?`${s}m ${n}s`:`${n}s`}function useUploadAnalytics(e){const t=useFileUploadStore(s=>s.fileUploads.get(e));return reactExports.useMemo(()=>{const s=(t==null?void 0:t.percentage)||0,n=(t==null?void 0:t.bytesUploaded)||0,i=(t==null?void 0:t.speed)||0,o=(t==null?void 0:t.eta)||0,a=(t==null?void 0:t.status)||"pending";return{percentage:s,bytesUploaded:n,speed:i,eta:o,speedFormatted:formatSpeed(i),etaFormatted:formatETA(o),status:a}},[t==null?void 0:t.percentage,t==null?void 0:t.bytesUploaded,t==null?void 0:t.speed,t==null?void 0:t.eta,t==null?void 0:t.status])}const UploadQueueItem=reactExports.memo(({file:e,style:t})=>jsxRuntimeExports.jsxs("div",{className:"absolute left-0 top-0 flex w-full items-center gap-14 p-10",style:t,children:[jsxRuntimeExports.jsx("div",{className:"shrink-0 rounded border p-8",children:jsxRuntimeExports.jsx(FileTypeIcon,{className:"h-22 w-22",mime:e.mime})}),jsxRuntimeExports.jsxs("div",{className:"min-w-0 flex-auto pr-10",children:[jsxRuntimeExports.jsx("div",{className:"mb-2 flex min-w-0 items-center gap-10",children:jsxRuntimeExports.jsx("div",{className:"min-w-0 flex-auto overflow-hidden overflow-ellipsis whitespace-nowrap font-medium",children:e.name})}),jsxRuntimeExports.jsx(SizeInfo,{file:e})]}),jsxRuntimeExports.jsx("div",{className:"mr-10",children:jsxRuntimeExports.jsx(FileStatus,{file:e})})]}));function SizeInfo({file:e}){const t=useUploadAnalytics(e.id),s=useFileUploadStore(a=>a.fileUploads.get(e.id)),n=reactExports.useMemo(()=>prettyBytes(e.size),[e]),i=reactExports.useMemo(()=>prettyBytes(t.bytesUploaded),[t.bytesUploaded]);let o;if(t.status==="completed")o=jsxRuntimeExports.jsx(Trans,{message:"Upload complete"});else if(t.status==="aborted")o=jsxRuntimeExports.jsx(Trans,{message:"Upload cancelled"});else if(t.status==="failed"){const a=(s==null?void 0:s.retryCount)||0,l=(s==null?void 0:s.maxRetries)||0,u=((s==null?void 0:s.errorType)==="network"||(s==null?void 0:s.errorType)==="server")&&a<l;let c="Upload failed";(s==null?void 0:s.errorType)==="network"?c="Network error - check your connection":(s==null?void 0:s.errorType)==="server"?c="Server error - please try again":(s==null?void 0:s.errorType)==="validation"&&(c="File validation failed"),u&&a>0&&(c+=` (Attempt ${a}/${l})`),o=jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4",children:[jsxRuntimeExports.jsx(Trans,{message:c}),u&&jsxRuntimeExports.jsx("span",{className:"text-primary",children:"• Click retry button"})]})}else{const{speedFormatted:a,etaFormatted:l}=t;if(s!=null&&s.isRetrying){const u=(s==null?void 0:s.retryCount)||0;o=jsxRuntimeExports.jsx(Trans,{message:"Retrying... (Attempt :attempt)",values:{attempt:u}})}else o=jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4",children:[jsxRuntimeExports.jsx(Trans,{message:":bytesUploaded of :totalBytes",values:{bytesUploaded:i,totalBytes:n}}),a&&jsxRuntimeExports.jsx("span",{children:"-"}),jsxRuntimeExports.jsx("span",{children:a}),l&&jsxRuntimeExports.jsx("span",{children:"-"}),jsxRuntimeExports.jsx("span",{children:l})]})}return jsxRuntimeExports.jsx("div",{className:"text-xs text-muted",children:o})}function FileStatus({file:e}){const t=useFileUploadStore(p=>p.fileUploads.get(e.id)),s=useFileUploadStore(p=>p.abortUpload),n=useFileUploadStore(p=>p.retryUpload),i=useUploadAnalytics(e.id),o=t==null?void 0:t.errorMessage,[a,l]=reactExports.useState(!1),u=jsxRuntimeExports.jsx(IconButton,{size:"xs",iconSize:"sm",onClick:()=>{s(e.id)},children:jsxRuntimeExports.jsx(CloseIcon,{})}),c=jsxRuntimeExports.jsx(ProgressCircle,{"aria-label":"Upload progress",size:"w-24 h-24",value:i.percentage,trackWidth:3}),d=jsxRuntimeExports.jsx(Tooltip,{label:"Retry Upload",children:jsxRuntimeExports.jsx(IconButton,{size:"xs",iconSize:"sm",onClick:()=>n(e.id),children:jsxRuntimeExports.jsx(RefreshIcon,{})})});let x;if(i.status==="failed"){const p=o||message("This file could not be uploaded"),h=(t==null?void 0:t.errorType)==="network"||(t==null?void 0:t.errorType)==="server";x=jsxRuntimeExports.jsx(AnimatedStatus,{children:jsxRuntimeExports.jsx(Tooltip,{variant:"danger",label:jsxRuntimeExports.jsx(MixedText,{value:`${p} (Error code: ${(t==null?void 0:t.errorCode)||"N/A"})`}),children:h?d:jsxRuntimeExports.jsx(ErrorIcon,{className:"text-danger",size:"md"})})})}else i.status==="aborted"?x=jsxRuntimeExports.jsx(AnimatedStatus,{children:jsxRuntimeExports.jsx(WarningIcon,{className:"text-warning",size:"md"})}):i.status==="completed"?x=jsxRuntimeExports.jsx(AnimatedStatus,{children:jsxRuntimeExports.jsx(CheckCircleIcon,{size:"md",className:"text-positive"})}):x=jsxRuntimeExports.jsx(AnimatedStatus,{onPointerEnter:p=>{p.pointerType==="mouse"&&l(!0)},onPointerLeave:p=>{p.pointerType==="mouse"&&l(!1)},children:a?u:c});return jsxRuntimeExports.jsx(AnimatePresence,{children:x})}function AnimatedStatus({children:e,...t}){return jsxRuntimeExports.jsx(m.div,{...t,initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},children:e})}function UploadQueue(){const e=useDriveStore(t=>t.uploadQueueIsOpen);return jsxRuntimeExports.jsx(AnimatePresence,{children:e&&jsxRuntimeExports.jsxs(m.div,{className:"fixed bottom-16 right-16 z-modal w-375 rounded border bg text-sm shadow-xl",initial:{y:"100%",opacity:0},animate:{y:0,opacity:1},exit:{y:"100%",opacity:0},children:[jsxRuntimeExports.jsx(Header,{}),jsxRuntimeExports.jsx(UploadList,{})]},"upload-queue")})}function Header(){const e=useFileUploadStore(i=>i.activeUploadsCount),t=useFileUploadStore(i=>i.completedUploadsCount),s=useFileUploadStore(i=>i.clearInactive);let n;return e?n=jsxRuntimeExports.jsx(Trans,{message:"Uploading :count files",values:{count:e}}):t?n=jsxRuntimeExports.jsx(Trans,{message:"Uploaded :count files",values:{count:t}}):n=jsxRuntimeExports.jsx(Trans,{message:"No active uploads"}),jsxRuntimeExports.jsxs("div",{className:"flex min-h-[45px] items-center justify-between gap-10 border-b bg-alt px-10 py-4",children:[n,e===0?jsxRuntimeExports.jsx(IconButton,{size:"sm",onClick:()=>{driveState().setUploadQueueIsOpen(!1),setTimeout(()=>{s()},200)},children:jsxRuntimeExports.jsx(CloseIcon,{})}):void 0]})}function UploadList(){const e=useFileUploadStore(i=>i.fileUploads),t=[...e.values()],s=reactExports.useRef(null),n=useVirtualizer({count:e.size,getScrollElement:()=>s.current,estimateSize:()=>60,overscan:4});return jsxRuntimeExports.jsx("div",{className:"max-h-320 overflow-y-auto",ref:s,children:jsxRuntimeExports.jsx("div",{className:"relative w-full",style:{height:`${n.getTotalSize()}px`},children:n.getVirtualItems().map(i=>{const o=t[i.index];return jsxRuntimeExports.jsx(UploadQueueItem,{style:{height:`${i.size}px`,transform:`translateY(${i.start}px)`},file:o.file},o.file.id)})})})}const detailedExamination=""+new URL("detailed-examination-33c85772.svg",import.meta.url).href;function DetailsSidebarHeader({entryType:e,entryName:t}){const{setRightSidenavStatus:s}=reactExports.useContext(DashboardLayoutContext);return jsxRuntimeExports.jsxs("div",{className:"mb-38 flex items-center gap-16 text-text-main",children:[jsxRuntimeExports.jsx(FileTypeIcon,{className:"h-24 w-24",type:e}),jsxRuntimeExports.jsx("div",{className:"mr-auto min-w-0 flex-auto text-ellipsis break-words text-xl font-normal",children:t}),jsxRuntimeExports.jsx(IconButton,{size:"md",className:"flex-shrink-0",onClick:()=>{s("closed")},children:jsxRuntimeExports.jsx(CloseIcon,{})})]})}function DetailsSidebarSectionHeader({children:e,margin:t="mb-20"}){return jsxRuntimeExports.jsx("div",{className:clsx("text-base text-main",t),children:e})}function useTaggableTags(e){return useQuery({queryKey:getQueryKey(e),queryFn:()=>fetchTaggableTags(e),initialData:e.initialData?{tags:e.initialData}:void 0})}function getQueryKey(e){const{taggableType:t,taggableId:s,type:n,notType:i}=e,o=["tags","taggable",t,`${s}`];return n!=null&&o.push(n),i!=null&&o.push(i),o}function invalidateTaggableTagsQuery({taggableType:e,taggableIds:t}){return Promise.allSettled(t.map(s=>queryClient.invalidateQueries({queryKey:getQueryKey({taggableType:e,taggableId:s})})))}async function fetchTaggableTags({taggableType:e,taggableId:t,notType:s,type:n}){return apiClient.get(`taggable/${e}/${t}/list-tags`,{params:{notType:s,type:n}}).then(i=>i.data)}function useDetachTagFromTaggables(){return useMutation({mutationFn:e=>detachTag(e),onSuccess:(e,t)=>{invalidateTaggableTagsQuery(t)},onError:e=>showHttpErrorToast(e)})}function detachTag(e){return apiClient.post("taggable/detach-tag",e).then(t=>t.data)}function useTags(e){return useQuery({queryKey:["tags",e],queryFn:({signal:t})=>fetchTags(e,t),placeholderData:keepPreviousData})}async function fetchTags(e,t){return e.query&&await new Promise(s=>setTimeout(s,300)),apiClient.get("tags",{params:{paginate:"simple",...e},signal:e.query?t:void 0}).then(s=>s.data)}function useAttachTagToTaggables(){return useMutation({mutationFn:e=>attachTag(e),onSuccess:async(e,t)=>{invalidateTaggableTagsQuery(t)},onError:e=>showHttpErrorToast(e)})}function attachTag(e){return apiClient.post("taggable/attach-tag",e).then(t=>t.data)}function ManageTagsDialog({attachedTags:e,tagType:t,notTagType:s,taggableType:n,taggableIds:i,userId:o,isLoading:a,onChange:l}){const{trans:u}=useTrans(),[c,d]=reactExports.useState(""),{data:x,isPlaceholderData:p,isLoading:h}=useTags({type:t,notType:s,query:c,userId:o}),f=useDetachTagFromTaggables(),j=useAttachTagToTaggables(),{tags:g,attachedTagIds:v}=reactExports.useMemo(()=>{const y=(x==null?void 0:x.pagination.data)||[],E=e||[],b=E.map(S=>S.id),I=y.filter(S=>!b.includes(S.id));return I.unshift(...E),{tags:I,attachedTagIds:b}},[e,x]);return jsxRuntimeExports.jsx(Dialog,{children:jsxRuntimeExports.jsxs(DialogBody,{padding:"p-8",children:[jsxRuntimeExports.jsx("form",{children:jsxRuntimeExports.jsx(TextField,{placeholder:u({message:"Type tag name..."}),inputBorder:"border-b",inputRadius:"rounded-none",inputRing:"ring-0",inputShadow:"shadow-none",startAdornment:jsxRuntimeExports.jsx(SearchIcon,{}),value:c,onChange:y=>d(y.target.value),endAdornment:p&&jsxRuntimeExports.jsx(ProgressCircle,{isIndeterminate:!0,size:"w-24 h-24"})})}),jsxRuntimeExports.jsxs(List,{className:"compact-scrollbar h-320 overflow-y-auto stable-scrollbar",children:[g.map(y=>{const E=v.includes(y.id),b=j.isPending||f.isPending||a;return jsxRuntimeExports.jsx(ListItem,{isDisabled:b,onSelected:()=>{E?f.mutate({tagId:y.id,taggableIds:i,taggableType:n},{onSuccess:()=>l==null?void 0:l(y.id)}):j.mutate({taggableType:n,taggableIds:i,tagName:y.name,userId:o,tagType:t},{onSuccess:()=>l==null?void 0:l(y.id)})},className:clsx(E&&(b?"text-primary-light":"text-primary")),startIcon:jsxRuntimeExports.jsx(PushPinIcon,{size:"xs"}),endSection:E?jsxRuntimeExports.jsx(CheckIcon,{size:"sm",className:"block text-primary"}):jsxRuntimeExports.jsx("div",{className:"h-20 w-20"}),children:y.display_name||y.name},y.id)}),!p&&!(x!=null&&x.pagination.data.length)&&c&&jsxRuntimeExports.jsx(ListItem,{startIcon:jsxRuntimeExports.jsx(PushPinIcon,{size:"xs"}),onSelected:()=>{j.mutate({taggableType:n,taggableIds:i,tagName:c,userId:o,tagType:t},{onSuccess:y=>{d(""),l==null||l(y.tag.id)}})},children:jsxRuntimeExports.jsx(Trans,{message:'Create tag ":name"',values:{name:c}})}),x&&!g.length&&!c&&jsxRuntimeExports.jsx("li",{className:"text-center text-muted",children:jsxRuntimeExports.jsx(Trans,{message:"No tags found"})}),h&&jsxRuntimeExports.jsx("li",{className:"flex justify-center",children:jsxRuntimeExports.jsx(ProgressCircle,{isIndeterminate:!0,size:"w-24 h24"})})]})]})})}function DetailsSidebarTags({entry:e}){var o;const{user:t}=useAuth(),s=useDetachTagFromTaggables(),{data:n,isFetching:i}=useTaggableTags({taggableType:"fileEntry",taggableId:e.id,initialData:(o=e.tags)==null?void 0:o.filter(a=>a.type!=="label"),type:"custom"});return jsxRuntimeExports.jsxs("div",{className:"mt-20 border-t pt-20",children:[jsxRuntimeExports.jsx(DetailsSidebarSectionHeader,{margin:"mb-10",children:jsxRuntimeExports.jsx(Trans,{message:"Tags"})}),jsxRuntimeExports.jsx("div",{className:"flex items-center gap-8",children:jsxRuntimeExports.jsx(ChipList,{size:"sm",radius:"rounded-button",startButton:jsxRuntimeExports.jsxs(DialogTrigger,{type:"modal",children:[jsxRuntimeExports.jsx(Button,{variant:"outline",startIcon:jsxRuntimeExports.jsx(AddIcon,{}),size:"2xs",className:"min-h-26",children:jsxRuntimeExports.jsx(Trans,{message:"Add tag"})}),jsxRuntimeExports.jsx(ManageTagsDialog,{attachedTags:n==null?void 0:n.tags,isLoading:i,tagType:"custom",taggableType:"fileEntry",taggableIds:[e.id],userId:t==null?void 0:t.id})]}),children:n==null?void 0:n.tags.map(a=>jsxRuntimeExports.jsx(Chip,{disabled:s.isPending||i,onRemove:()=>{s.mutate({tagId:a.id,taggableIds:[e.id],taggableType:"fileEntry"})},children:a.display_name||a.name},a.id))})})]})}function DetailsSidebarProperties({entry:e}){return jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(DetailsSidebarHeader,{entryType:e.type,entryName:e.name}),e.type==="image"&&jsxRuntimeExports.jsx(FileThumbnail,{className:"mb-20",file:e}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(DetailsSidebarSectionHeader,{children:jsxRuntimeExports.jsx(Trans,{message:"Who has access"})}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-14",children:[e.workspace_id?jsxRuntimeExports.jsx("div",{className:"flex h-32 w-32 items-center justify-center rounded-full border",children:jsxRuntimeExports.jsx(GroupsIcon,{className:"icon-md"})}):null,e.users.map(t=>jsxRuntimeExports.jsx(Tooltip,{label:t.name,children:jsxRuntimeExports.jsx(Avatar,{src:t.image,size:"md",circle:!0})},t.id))]}),e.permissions["files.update"]&&jsxRuntimeExports.jsx(Button,{className:"mt-20 block",variant:"link",color:"primary",onClick:()=>{driveState().setActiveActionDialog("share",[e])},children:jsxRuntimeExports.jsx(Trans,{message:"Manage Access"})})]}),jsxRuntimeExports.jsx(PropertyList,{entry:e}),jsxRuntimeExports.jsx(DetailsSidebarTags,{entry:e})]})}function PropertyList({entry:e}){const t=useSelectedEntryParent(),s=useNavigate(),n=e.users.find(o=>o.owns_entry),i=reactExports.useMemo(()=>prettyBytes(e.file_size),[e.file_size]);return jsxRuntimeExports.jsxs("div",{className:"mt-20 border-t pt-20",children:[jsxRuntimeExports.jsx(DetailsSidebarSectionHeader,{children:jsxRuntimeExports.jsx(Trans,{message:"Properties"})}),jsxRuntimeExports.jsx(PropertyItem,{label:jsxRuntimeExports.jsx(Trans,{message:"Type"}),value:jsxRuntimeExports.jsx("span",{className:"capitalize",children:jsxRuntimeExports.jsx(Trans,{message:e.type})})}),jsxRuntimeExports.jsx(PropertyItem,{label:jsxRuntimeExports.jsx(Trans,{message:"Size"}),value:e.file_size?i:"-"}),jsxRuntimeExports.jsx(PropertyItem,{label:jsxRuntimeExports.jsx(Trans,{message:"Location"}),value:jsxRuntimeExports.jsx(Button,{variant:"link",startIcon:jsxRuntimeExports.jsx(FolderIcon,{}),onClick:()=>{s(t?getPathForFolder(t.hash):RootFolderPage.path)},children:t?t.name:jsxRuntimeExports.jsx(Trans,{message:"Root"})})}),n&&jsxRuntimeExports.jsx(PropertyItem,{label:jsxRuntimeExports.jsx(Trans,{message:"Owner"}),value:n.name}),jsxRuntimeExports.jsx(PropertyItem,{label:jsxRuntimeExports.jsx(Trans,{message:"Modified"}),value:jsxRuntimeExports.jsx(FormattedDate,{date:e.updated_at})}),jsxRuntimeExports.jsx(PropertyItem,{label:jsxRuntimeExports.jsx(Trans,{message:"Created"}),value:jsxRuntimeExports.jsx(FormattedDate,{date:e.updated_at})})]})}function PropertyItem({label:e,value:t}){return jsxRuntimeExports.jsxs("div",{className:"mb-14 flex items-center",children:[jsxRuntimeExports.jsx("div",{className:"w-1/3 text-xs text-muted",children:e}),jsxRuntimeExports.jsx("div",{className:"w-2/3 text-sm text-main",children:t})]})}function DetailsSidebar({className:e}){const t=useSelectedEntry();return jsxRuntimeExports.jsx("div",{className:clsx(e,"h-full overflow-y-auto border-l bg p-18 text-sm text-muted"),children:t?jsxRuntimeExports.jsx(DetailsSidebarProperties,{entry:t}):jsxRuntimeExports.jsx(NothingSelected,{})})}function NothingSelected(){return jsxRuntimeExports.jsxs(reactExports.Fragment,{children:[jsxRuntimeExports.jsx(DetailsSidebarHeader,{entryType:"folder",entryName:jsxRuntimeExports.jsx(Trans,{message:"All files"})}),jsxRuntimeExports.jsx(IllustratedMessage,{image:jsxRuntimeExports.jsx(SvgImage,{src:detailedExamination}),description:jsxRuntimeExports.jsx(Trans,{message:"Select file or folder to see details here"})})]})}function useRenameEntry(e){return useMutation({mutationFn:t=>renameEntry(t),onSuccess:(t,s)=>{invalidateEntryQueries(),toast(message(":oldName renamed to :newName",{values:{oldName:s.initialName,newName:t.fileEntry.name}}))},onError:t=>onFormQueryError(t,e)})}function renameEntry({entryId:e,...t}){return apiClient.put(`file-entries/${e}`,t).then(s=>s.data)}function RenameEntryDialog({entries:e}){var l;const{close:t,formId:s}=useDialogContext(),n=(l=e[0])==null?void 0:l.name,i=useForm({defaultValues:{name:n}}),o=useRenameEntry(i),a=u=>{o.mutate({entryId:e[0].id,name:u.name,initialName:n},{onSuccess:t})};return jsxRuntimeExports.jsxs(Dialog,{children:[jsxRuntimeExports.jsx(DialogHeader,{children:jsxRuntimeExports.jsx(Trans,{message:"Rename"})}),jsxRuntimeExports.jsx(DialogBody,{children:jsxRuntimeExports.jsx(Form,{onSubmit:a,form:i,id:s,children:jsxRuntimeExports.jsx(FormTextField,{placeholder:"Enter a name...","aria-label":"Entry name",autoFocus:!0,name:"name",required:!0,minLength:3,maxLength:200})})}),jsxRuntimeExports.jsxs(DialogFooter,{children:[jsxRuntimeExports.jsx(Button,{variant:"flat",onClick:()=>t(),children:jsxRuntimeExports.jsx(Trans,{message:"Cancel"})}),jsxRuntimeExports.jsx(Button,{form:s,type:"submit",variant:"flat",color:"primary",disabled:o.isPending||!i.formState.isDirty,children:jsxRuntimeExports.jsx(Trans,{message:"Save"})})]})]})}function createFolder({name:e,parentId:t}){return apiClient.post("folders",{name:e,parentId:t===0?null:t}).then(s=>s.data)}function useCreateFolder(e){return useMutation({mutationFn:({name:t,parentId:s})=>createFolder({name:t,parentId:s}),onSuccess:()=>invalidateEntryQueries(),onError:t=>onFormQueryError(t,e)})}function NewFolderDialog({parentId:e}){const{close:t,formId:s}=useDialogContext(),{trans:n}=useTrans(),i=useForm({defaultValues:{name:n({message:"Untitled Folder"})}}),o=useCreateFolder(i),a=l=>{o.mutate({...l,parentId:e},{onSuccess:u=>{t(u.folder),toast(message("Folder created"))}})};return jsxRuntimeExports.jsxs(Dialog,{children:[jsxRuntimeExports.jsx(DialogHeader,{children:jsxRuntimeExports.jsx(Trans,{message:"New Folder"})}),jsxRuntimeExports.jsx(DialogBody,{children:jsxRuntimeExports.jsx(Form,{onSubmit:a,form:i,id:s,children:jsxRuntimeExports.jsx(FormTextField,{placeholder:n({message:"Enter a name..."}),"aria-label":"Entry name",autoFocus:!0,autoSelectText:!0,name:"name",required:!0,minLength:3,maxLength:200})})}),jsxRuntimeExports.jsxs(DialogFooter,{children:[jsxRuntimeExports.jsx(Button,{variant:"flat",onClick:()=>t(),children:jsxRuntimeExports.jsx(Trans,{message:"Cancel"})}),jsxRuntimeExports.jsx(Button,{form:s,type:"submit",variant:"flat",color:"primary",disabled:o.isPending,children:jsxRuntimeExports.jsx(Trans,{message:"Create"})})]})]})}function EntryPreviewDialog({selectedEntry:e}){const t=useEntries().filter(o=>o.type!=="folder"),s=t.findIndex(o=>o.id===(e==null?void 0:e.id)),[n,i]=reactExports.useState(s);return jsxRuntimeExports.jsx(FilePreviewDialog,{allowDownload:e.permissions["files.download"],headerActionsLeft:jsxRuntimeExports.jsx(DriveActions,{activeIndex:n,entries:t}),activeIndex:n,onActiveIndexChange:i,entries:t})}function DriveActions({activeIndex:e,entries:t}){const s=t[e],n=useShareAction([s]);return!s||!n?null:jsxRuntimeExports.jsxs(reactExports.Fragment,{children:[jsxRuntimeExports.jsx(IconButton,{className:"md:hidden",onClick:()=>{n.execute()},children:reactExports.createElement(n.icon)}),jsxRuntimeExports.jsx(Button,{className:"max-md:hidden",variant:"text",startIcon:reactExports.createElement(n.icon),onClick:()=>{n.execute()},children:jsxRuntimeExports.jsx(Trans,{...n.label})})]})}function shareEntry({entryId:e,...t}){return apiClient.post(`file-entries/${e}/share`,t).then(s=>s.data)}function useShareEntry(){return useMutation({mutationFn:e=>shareEntry(e),onSuccess:()=>{invalidateEntryQueries()},onError:e=>{var t,s;if(axios.isAxiosError(e)&&e.response){const n=e.response.data;(t=n.errors)!=null&&t.emails?toast.danger((s=n.errors)==null?void 0:s.emails[0]):showHttpErrorToast(e)}}})}const DRIVE_ENTRY_FULL_PERMISSIONS={edit:!0,view:!0,download:!0},PermissionSelectorItems=[{key:"view",value:{view:!0},label:message("Can view")},{key:"download",value:{view:!0,download:!0},label:message("Can Download")},{key:"edit",value:DRIVE_ENTRY_FULL_PERMISSIONS,label:message("Can edit")}];function PermissionSelector({value:e,onChange:t,isDisabled:s}){return jsxRuntimeExports.jsxs(MenuTrigger,{selectedValue:e.key,selectionMode:"single",onSelectionChange:n=>{n!==e.key&&t(PermissionSelectorItems.find(i=>i.key===n))},children:[jsxRuntimeExports.jsx(Button,{variant:"flat",color:"chip",size:"xs",endIcon:jsxRuntimeExports.jsx(ArrowDropDownIcon,{}),disabled:s,children:jsxRuntimeExports.jsx(Trans,{...e.label})}),jsxRuntimeExports.jsx(Menu,{children:PermissionSelectorItems.map(n=>jsxRuntimeExports.jsx(Item,{value:n.key,children:jsxRuntimeExports.jsx(Trans,{...n.label})},n.key))})]})}function getPermissionItemForUser(e){const{download:t,edit:s}=e.entry_permissions;return s?PermissionSelectorItems.find(n=>n.key==="edit"):t?PermissionSelectorItems.find(n=>n.key==="download"):PermissionSelectorItems.find(n=>n.key==="view")}function useChangePermission(){return useMutation({mutationFn:e=>changePermission(e),onSuccess:()=>{invalidateEntryQueries(),toast(message("Updated user permissions"))},onError:e=>showHttpErrorToast(e,message("Could not update permissions"))})}function changePermission({entryId:e,...t}){return apiClient.put(`file-entries/${e}/change-permissions`,t).then(s=>s.data)}function MemberList({className:e,entry:t}){if(!t)return null;const s=t.users;return jsxRuntimeExports.jsxs("div",{className:clsx(e,"overflow-hidden"),children:[jsxRuntimeExports.jsx("div",{className:"mb-14 text-sm",children:jsxRuntimeExports.jsx(Trans,{message:"Who has access"})}),jsxRuntimeExports.jsx(AnimatePresence,{initial:!1,children:s.map(n=>jsxRuntimeExports.jsx(MemberListItem,{user:n,entry:t},n.id))})]})}function MemberListItem({user:e,entry:t}){return jsxRuntimeExports.jsxs(m.div,{initial:{x:"-100%",opacity:0},animate:{x:0,opacity:1},exit:{x:"100%",opacity:0},transition:{type:"tween",duration:.125},className:"mb-20 flex items-center gap-14 text-sm",children:[jsxRuntimeExports.jsx(UserAvatar,{user:e,circle:!0,size:"w-44 h-44"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{children:e.name}),jsxRuntimeExports.jsx("div",{className:"text-muted",children:e.email})]}),jsxRuntimeExports.jsx("div",{className:"ml-auto",children:e.owns_entry?jsxRuntimeExports.jsx("span",{className:"text-muted",children:jsxRuntimeExports.jsx(Trans,{message:"Owner"})}):jsxRuntimeExports.jsx(ActionButtons,{user:e,entry:t})})]},e.id)}function ActionButtons({user:e,entry:t}){const s=useChangePermission(),n=useUnshareEntries(),[i,o]=reactExports.useState(()=>getPermissionItemForUser(e));return jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-10",children:[jsxRuntimeExports.jsx(PermissionSelector,{isDisabled:s.isPending,onChange:a=>{s.mutate({userId:e.id,permissions:a.value,entryId:t.id}),o(a)},value:i}),jsxRuntimeExports.jsx(IconButton,{disabled:n.isPending,onClick:()=>{n.mutate({userId:e.id,entryIds:[t.id]},{onSuccess:()=>{toast(message("Member removed"))},onError:a=>showHttpErrorToast(a,message("Could not remove member"))})},children:jsxRuntimeExports.jsx(CloseIcon,{})})]})}function SharePanel({className:e,entry:t}){var g;const{trans:s}=useTrans(),{share:n}=useSettings(),i=useShareEntry(),[o,a]=reactExports.useState([]),[l,u]=reactExports.useState(!1),[c,d]=reactExports.useState(PermissionSelectorItems[0]),x=o.every(v=>!v.invalid),[p,h]=reactExports.useState(""),f=useNormalizedModels("normalized-models/user",{perPage:7,query:p},{enabled:n==null?void 0:n.suggest_emails}),j=v=>v.description||v.name;return jsxRuntimeExports.jsxs("div",{className:e,children:[jsxRuntimeExports.jsx(ChipField,{value:o,onChange:a,isAsync:!0,isLoading:f.fetchStatus==="fetching",inputValue:p,onInputValueChange:h,suggestions:(g=f.data)==null?void 0:g.results,displayWith:j,validateWith:v=>{const y=!isEmail(v.description);return{...v,invalid:y,errorMessage:y?s({message:"Not a valid email"}):void 0}},placeholder:s({message:"Enter email addresses"}),label:jsxRuntimeExports.jsx(Trans,{message:"Invite people"}),children:v=>jsxRuntimeExports.jsx(Item,{value:v.id,startIcon:jsxRuntimeExports.jsx(Avatar,{circle:!0,src:v.image,alt:""}),description:v.description,children:v.name})}),jsxRuntimeExports.jsxs("div",{className:"mt-14 flex items-center justify-between gap-14",children:[jsxRuntimeExports.jsx(PermissionSelector,{onChange:d,value:c}),o.length?jsxRuntimeExports.jsx(Button,{variant:"flat",color:"primary",size:"sm",disabled:l||!x,onClick:()=>{u(!0),i.mutate({emails:o.map(v=>j(v)),permissions:c.value,entryId:t.id},{onSuccess:()=>{a([])},onSettled:()=>{u(!1)}})},children:jsxRuntimeExports.jsx(Trans,{message:"Share"})}):null]}),jsxRuntimeExports.jsx(MemberList,{className:"mt-30",entry:t})]})}function useEntryShareableLink(e){return useQuery({queryKey:DriveQueryKeys.fetchEntryShareableLink(e),queryFn:()=>fetchLinkByEntryId(e),enabled:!!e})}function fetchLinkByEntryId(e){return apiClient.get(`file-entries/${e}/shareable-link`,{params:{loader:"shareableLink"}}).then(t=>t.data)}function deleteShareableLink({entryId:e}){return apiClient.delete(`file-entries/${e}/shareable-link`).then(t=>t.data)}function useDeleteShareableLink(){return useMutation({mutationFn:({entryId:e})=>deleteShareableLink({entryId:e}),onSuccess:(e,{entryId:t})=>{queryClient.setQueryData(DriveQueryKeys.fetchEntryShareableLink(t),{...e,link:null})},onError:e=>showHttpErrorToast(e,message("Could not delete link"))})}function randomString(e=36){let t="";const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let n=0;n<e;n+=1)t+=s.charAt(Math.floor(Math.random()*s.length));return t}function ShareableLinkPanel({setActivePanel:e,entry:t,focusInput:s}){var u,c;const n=useEntryShareableLink(t.id),i=!!((u=n.data)!=null&&u.link),o=useCreateShareableLink(),a=useDeleteShareableLink(),l=n.isLoading||o.isPending||a.isPending;return jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"mb-10",children:jsxRuntimeExports.jsx(Trans,{message:"Share link"})}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between gap-14 px-2 pb-4",children:[jsxRuntimeExports.jsx(Switch,{checked:i,disabled:l,onChange:()=>{i?a.mutate({entryId:t.id}):o.mutate({entryId:t.id})},children:i?jsxRuntimeExports.jsx(Trans,{message:"Shareable link is created"}):jsxRuntimeExports.jsx(Trans,{message:"Create shareable link"})}),i&&jsxRuntimeExports.jsx(Button,{variant:"link",color:"primary",onClick:()=>{e("linkSettings")},children:jsxRuntimeExports.jsx(Trans,{message:"Link settings"})})]}),jsxRuntimeExports.jsx(ShareableLinkInput,{autoFocus:s,link:(c=n.data)==null?void 0:c.link})]})}function ShareableLinkInput({link:e,autoFocus:t}){const{base_url:s}=useSettings(),{trans:n}=useTrans(),i=useActiveDialogEntry(),o=(e==null?void 0:e.hash)||(i==null?void 0:i.hash)||randomString(),a=`${s}/drive/s/${o}`,[l,u]=useClipboard(a,{successDuration:1e3});return jsxRuntimeExports.jsx(TextField,{autoFocus:t,disabled:!e,className:"mt-10",readOnly:!0,value:a,"aria-label":n({message:"Shareable link"}),onFocus:c=>{c.target.select()},endAppend:jsxRuntimeExports.jsx(Button,{className:"min-w-100",variant:"flat",color:"primary",onClick:u,children:l?jsxRuntimeExports.jsx(Trans,{message:"Copied!"}):jsxRuntimeExports.jsx(Trans,{message:"Copy"})})})}function updateShareableLink({entryId:e,...t}){return apiClient.put(`file-entries/${e}/shareable-link`,t).then(s=>s.data)}function useUpdateShareableLink(e){return useMutation({mutationFn:t=>updateShareableLink(t),onSuccess:(t,{entryId:s})=>{queryClient.setQueryData(DriveQueryKeys.fetchEntryShareableLink(s),t)},onError:t=>onFormQueryError(t,e)})}function LinkSettingsDialog({className:e,setActivePanel:t,entry:s}){const{formId:n}=useDialogContext(),{data:i}=useEntryShareableLink(s.id),o=i==null?void 0:i.link,a=useForm({defaultValues:{allowDownload:o==null?void 0:o.allow_download,allowEdit:o==null?void 0:o.allow_edit,expiresAt:o==null?void 0:o.expires_at,entryId:s.id}}),l=useUpdateShareableLink(a);return jsxRuntimeExports.jsxs(reactExports.Fragment,{children:[jsxRuntimeExports.jsx(DialogHeader,{onDismiss:()=>{t("main")},children:jsxRuntimeExports.jsx(Trans,{message:"Shareable Link Settings"})}),jsxRuntimeExports.jsx(DialogBody,{children:jsxRuntimeExports.jsx(m.div,{className:"min-h-[335px]",animate:{opacity:1,y:0},initial:{opacity:0,y:20},exit:{opacity:0,y:-20},transition:{duration:.1},children:jsxRuntimeExports.jsxs(Form,{id:n,className:e,form:a,onSubmit:u=>{l.mutate(u,{onSuccess:()=>{t("main"),toast(message("Link settings saved"))}})},children:[jsxRuntimeExports.jsx(LinkExpirationOption,{showField:!!(o!=null&&o.expires_at)}),jsxRuntimeExports.jsx(LinkPasswordOption,{showField:!!(o!=null&&o.password)}),jsxRuntimeExports.jsxs(LinkOption,{children:[jsxRuntimeExports.jsx(Trans,{message:"Allow download"}),jsxRuntimeExports.jsx(FormSwitch,{name:"allowDownload",children:jsxRuntimeExports.jsx(Trans,{message:"Users with link can download this item"})})]}),jsxRuntimeExports.jsxs(LinkOption,{showBorder:!1,children:[jsxRuntimeExports.jsx(Trans,{message:"Allow import"}),jsxRuntimeExports.jsx(FormSwitch,{name:"allowEdit",children:jsxRuntimeExports.jsx(Trans,{message:"Users with link can import this item into their own drive"})})]})]})},"link-settings-content")}),jsxRuntimeExports.jsxs(DialogFooter,{children:[jsxRuntimeExports.jsx(Button,{type:"button",onClick:()=>{t("main")},children:jsxRuntimeExports.jsx(Trans,{message:"Cancel"})}),jsxRuntimeExports.jsx(Button,{type:"submit",form:n,variant:"flat",color:"primary",disabled:l.isPending,children:jsxRuntimeExports.jsx(Trans,{message:"Save"})})]})]})}const minDate=$14e0f24ef4ac5c92$export$461939dd4422153($14e0f24ef4ac5c92$export$aa8b41735afcabd2());function LinkExpirationOption({showField:e}){const{trans:t}=useTrans(),[s,n]=reactExports.useState(e);return jsxRuntimeExports.jsxs(LinkOption,{children:[jsxRuntimeExports.jsx(Trans,{message:"Link expiration"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Switch,{checked:s,onChange:i=>{n(i.target.checked)},children:jsxRuntimeExports.jsx(Trans,{message:"Link is valid until"})}),s&&jsxRuntimeExports.jsx(FormDatePicker,{min:minDate,name:"expiresAt",granularity:"minute",className:"mt-20","aria-label":t({message:"Link expiration date and time"})})]})]})}function LinkPasswordOption({showField:e}){const{trans:t}=useTrans(),[s,n]=reactExports.useState(e);return jsxRuntimeExports.jsxs(LinkOption,{children:[jsxRuntimeExports.jsx(Trans,{message:"Password protect"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Switch,{checked:s,onChange:i=>{n(i.target.checked)},children:jsxRuntimeExports.jsx(Trans,{message:"Users will need to enter password in order to view this link"})}),s&&jsxRuntimeExports.jsx(FormTextField,{type:"password",autoFocus:!0,name:"password",className:"mt-20","aria-label":t({message:"Link password"}),description:jsxRuntimeExports.jsx(Trans,{message:"Password will not be requested when viewing the link as file owner."}),placeholder:t({message:"Enter new password..."})})]})]})}function LinkOption({children:e,showBorder:t=!0}){const[s,n]=e;return jsxRuntimeExports.jsxs("div",{className:clsx(t&&"mb-20 border-b pb-20"),children:[jsxRuntimeExports.jsx("div",{className:"mb-8 text-sm font-medium",children:s}),n]})}function ShareDialog({entry:e,focusLinkInput:t}){const{data:{fileEntry:s}}=useQuery({queryKey:DriveQueryKeys.fetchFileEntry(e.id),queryFn:()=>apiClient.get(`drive/file-entries/${e.id}/model`).then(o=>o.data),initialData:{fileEntry:e}}),[n,i]=reactExports.useState("main");return jsxRuntimeExports.jsx(Dialog,{size:"lg",children:jsxRuntimeExports.jsx(AnimatePresence,{initial:!1,mode:"wait",children:n==="linkSettings"?jsxRuntimeExports.jsx(LinkSettingsDialog,{setActivePanel:i,entry:s},"one"):jsxRuntimeExports.jsx(MainDialog,{setActivePanel:i,entry:s,focusLinkInput:t},"two")})})}function MainDialog({setActivePanel:e,entry:t,focusLinkInput:s}){return jsxRuntimeExports.jsxs(reactExports.Fragment,{children:[jsxRuntimeExports.jsx(DialogHeader,{children:jsxRuntimeExports.jsx(Trans,{message:"Share ‘:name’",values:{name:t.name}})}),jsxRuntimeExports.jsx(DialogBody,{className:"relative",children:jsxRuntimeExports.jsxs(m.div,{animate:{opacity:1,y:0},initial:{opacity:0,y:20},exit:{opacity:0,y:-20},transition:{duration:.1},children:[jsxRuntimeExports.jsx(SharePanel,{className:"mb-30 border-b pb-30",entry:t}),jsxRuntimeExports.jsx(ShareableLinkPanel,{setActivePanel:e,entry:t,focusInput:!!s})]},"share-content")})]})}function useMoveEntriesDialogFolderSearch({query:e}){const{workspaceId:t}=useActiveWorkspaceId(),s=reactExports.useMemo(()=>({section:"search",workspaceId:t,query:e,filters:encodeBackendFilters([{key:"type",value:"folder"}])}),[t,e]);return useQuery({queryKey:DriveQueryKeys.fetchEntries(s),queryFn:({signal:n})=>fetchEntries$1(s,n),enabled:!!e,placeholderData:keepPreviousData})}async function fetchEntries$1(e,t){return e.query&&await new Promise(s=>setTimeout(s,300)),apiClient.get("drive/file-entries",{params:e,signal:e.query?t:void 0}).then(s=>s.data)}function MoveEntriesDialogSearch({onFolderSelected:e}){const{trans:t}=useTrans(),s=t({message:"Search folders"}),[n,i]=reactExports.useState(""),{isFetching:o,data:a}=useMoveEntriesDialogFolderSearch({query:n}),l=a==null?void 0:a.data;return jsxRuntimeExports.jsx(ComboBoxForwardRef,{size:"sm",maxItems:10,placeholder:s,"aria-label":s,className:"pt-20",endAdornmentIcon:jsxRuntimeExports.jsx(SearchIcon,{}),isAsync:!0,isLoading:o,inputValue:n,onInputValueChange:i,blurReferenceOnItemSelection:!0,clearInputOnItemSelection:!0,selectionMode:"none",openMenuOnFocus:!1,children:l==null?void 0:l.map(u=>jsxRuntimeExports.jsx(Item,{value:u.id,textLabel:u.name,onSelected:()=>{e(u)},children:u.name},u.id))})}function MoveEntriesDialogBreadcrumbs({selectedFolder:e,onFolderSelected:t}){const{data:s}=useFolderPath({hash:e.hash,isEnabled:(e==null?void 0:e.hash)!==RootFolderPage.folder.hash});let n=null;return s!=null&&s.path&&(s.path.length===1?n=RootFolderPage.folder:n=s.path[s.path.length-2]),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-6 border-b pb-10",children:[jsxRuntimeExports.jsx(IconButton,{className:"flex-shrink-0",variant:"outline",size:"xs",disabled:!n,onClick:()=>{n&&t(n)},children:jsxRuntimeExports.jsx(ArrowBackIcon,{})}),jsxRuntimeExports.jsxs(Breadcrumb,{size:"sm",className:"flex-auto",children:[jsxRuntimeExports.jsxs(BreadcrumbItem,{onSelected:()=>{t(RootFolderPage.folder)},className:"flex items-center gap-8",children:[jsxRuntimeExports.jsx(FolderIcon,{className:"icon-sm"}),jsxRuntimeExports.jsx(Trans,{message:RootFolderPage.folder.name})]}),s==null?void 0:s.path.map(i=>jsxRuntimeExports.jsxs(BreadcrumbItem,{onSelected:()=>{t(i)},className:"flex items-center gap-8",children:[!i.id&&jsxRuntimeExports.jsx(FolderIcon,{className:"icon-sm"}),i.name]},i.id||"root"))]})]})}const myFilesSvg=""+new URL("my-files-88476671.svg",import.meta.url).href;function useMoveEntriesDialogFolders({selectedFolder:e,movingSharedFiles:t}){const{workspaceId:s}=useActiveWorkspaceId(),n=reactExports.useMemo(()=>{const i=encodeBackendFilters([{key:"type",value:"folder"}]);return{section:"folder",folderId:e.hash=="0"&&t?"sharedWithMe":e.hash,workspaceId:s,filters:i}},[s,e.hash,t]);return useInfiniteQuery({queryKey:DriveQueryKeys.fetchEntries(n),queryFn:({pageParam:i=1})=>fetchEntries({...n,page:i}),initialPageParam:1,getNextPageParam:i=>{const o=i.current_page;if(hasNextPage$1(i))return o+1}})}function fetchEntries(e){return apiClient.get("drive/file-entries",{params:e}).then(t=>t.data)}function MoveEntriesDialogFolderList({onFolderSelected:e,selectedFolder:t,movingSharedFiles:s}){var o,a,l;const n=useMoveEntriesDialogFolders({selectedFolder:t,movingSharedFiles:s});let i;return n.isLoading?i=jsxRuntimeExports.jsx("div",{className:"flex h-full w-full items-center justify-center",children:jsxRuntimeExports.jsx(ProgressCircle,{isIndeterminate:!0,size:"md"})}):((a=(o=n.data)==null?void 0:o.pages[0])==null?void 0:a.data.length)===0?i=jsxRuntimeExports.jsx(IllustratedMessage,{size:"xs",className:"pb-20 pt-64",image:jsxRuntimeExports.jsx(SvgImage,{src:myFilesSvg}),title:jsxRuntimeExports.jsx(Trans,{message:'There are no subfolders in ":folder"',values:{folder:t.name}})}):i=jsxRuntimeExports.jsxs(reactExports.Fragment,{children:[jsxRuntimeExports.jsx(List,{children:(l=n.data)==null?void 0:l.pages.flatMap(u=>u.data).map(u=>jsxRuntimeExports.jsx(ListItem,{className:"min-h-48 border-b",onSelected:()=>{e(u)},startIcon:jsxRuntimeExports.jsx(FileTypeIcon,{type:"folder"}),endIcon:jsxRuntimeExports.jsx(ChevronRightIcon,{size:"md"}),children:u.name},u.id))}),jsxRuntimeExports.jsx(InfiniteScrollSentinel,{query:n})]}),jsxRuntimeExports.jsx("div",{className:"h-288 overflow-y-auto",children:i})}function MoveEntriesDialog({entries:e}){const{user:t}=useAuth(),s=useDriveStore(a=>a.activePage),[n,i]=reactExports.useState((s==null?void 0:s.folder)||RootFolderPage.folder),o=e.some(a=>{var l;return!((l=a.users.find(u=>u.id===t.id))!=null&&l.owns_entry)});return jsxRuntimeExports.jsxs(Dialog,{size:"lg",children:[jsxRuntimeExports.jsx(DialogHeader,{children:jsxRuntimeExports.jsx(Trans,{message:"Move [one ‘:name‘|other :count items]",values:{count:e.length,name:e[0].name}})}),jsxRuntimeExports.jsxs(DialogBody,{children:[jsxRuntimeExports.jsx("div",{className:"text-sm",children:jsxRuntimeExports.jsx(Trans,{message:"Select a destination folder."})}),jsxRuntimeExports.jsx(MoveEntriesDialogSearch,{onFolderSelected:i}),jsxRuntimeExports.jsxs("div",{className:"mb-20 mt-40",children:[jsxRuntimeExports.jsx(MoveEntriesDialogBreadcrumbs,{selectedFolder:n,onFolderSelected:i}),jsxRuntimeExports.jsx(MoveEntriesDialogFolderList,{movingSharedFiles:o,selectedFolder:n,onFolderSelected:i})]})]}),jsxRuntimeExports.jsx(Footer,{selectedFolder:n,setSelectedFolder:i,entries:e})]})}function Footer({selectedFolder:e,setSelectedFolder:t,entries:s}){const{close:n}=useDialogContext(),i=useMoveEntries();return jsxRuntimeExports.jsxs(DialogFooter,{className:"border-t",startAction:jsxRuntimeExports.jsxs(DialogTrigger,{type:"modal",onClose:o=>{o&&t(o)},children:[jsxRuntimeExports.jsx(Button,{startIcon:jsxRuntimeExports.jsx(CreateNewFolderIcon,{}),variant:"text",children:jsxRuntimeExports.jsx(Trans,{message:"New Folder"})}),jsxRuntimeExports.jsx(NewFolderDialog,{parentId:e.id})]}),children:[jsxRuntimeExports.jsx(Button,{className:"max-md:hidden",variant:"flat",onClick:()=>n(),children:jsxRuntimeExports.jsx(Trans,{message:"Cancel"})}),jsxRuntimeExports.jsx(Button,{type:"submit",variant:"flat",color:"primary",disabled:!canMoveEntriesInto(s,e)||i.isPending,onClick:()=>{i.mutate({destinationId:e.id,entryIds:s.map(o=>o.id)},{onSuccess:n})},children:jsxRuntimeExports.jsx(Trans,{message:"Move here"})})]})}function DeleteEntriesForeverDialog({entries:e}){const t=useDeleteEntries(),{close:s}=useDialogContext(),n=e.length===1?jsxRuntimeExports.jsx(Trans,{message:"‘:name‘ will be deleted forever and you won't be able to restore it.",values:{name:e[0].name}}):jsxRuntimeExports.jsx(Trans,{message:":count items will be deleted forever and you won't be able to restore them.",values:{count:e.length}});return jsxRuntimeExports.jsx(ConfirmationDialog,{isDanger:!0,title:jsxRuntimeExports.jsx(Trans,{message:"Delete forever?"}),body:n,confirm:jsxRuntimeExports.jsx(Trans,{message:"Delete forever"}),isLoading:t.isPending,onConfirm:()=>{t.mutate({entryIds:e.map(i=>i.id),deleteForever:!0},{onSuccess:()=>{s(),driveState().selectEntries([])}})}})}function BlockTrashFolderViewDialog({entries:e}){const t=useRestoreEntries(),{close:s}=useDialogContext();return jsxRuntimeExports.jsx(ConfirmationDialog,{title:jsxRuntimeExports.jsx(Trans,{message:"This folder is in your trash"}),body:jsxRuntimeExports.jsx(Trans,{message:"To view this folder, restore it from the trash."}),confirm:jsxRuntimeExports.jsx(Trans,{message:"Restore"}),isLoading:t.isPending,onConfirm:()=>{t.mutate({entryIds:e.map(n=>n.id)},{onSuccess:()=>{s(),driveState().selectEntries([])}})}})}function DriveDialogsContainer(){const e=useDriveStore(s=>s.activeActionDialog),t=getDialog(e);return jsxRuntimeExports.jsx(DialogTrigger,{type:"modal",isOpen:!!t,onClose:()=>{driveState().setActiveActionDialog(null)},children:t})}function getDialog(e){var t;switch(e==null?void 0:e.name){case"rename":return jsxRuntimeExports.jsx(RenameEntryDialog,{entries:e.entries});case"newFolder":return jsxRuntimeExports.jsx(NewFolderDialog,{parentId:(t=e.entries[0])==null?void 0:t.id});case"preview":return jsxRuntimeExports.jsx(EntryPreviewDialog,{selectedEntry:e.entries[0]});case"share":return jsxRuntimeExports.jsx(ShareDialog,{entry:e.entries[0]});case"getLink":return jsxRuntimeExports.jsx(ShareDialog,{entry:e.entries[0],focusLinkInput:!0});case"moveTo":return jsxRuntimeExports.jsx(MoveEntriesDialog,{entries:e.entries});case"confirmAndDeleteForever":return jsxRuntimeExports.jsx(DeleteEntriesForeverDialog,{entries:e.entries});case"trashFolderBlock":return jsxRuntimeExports.jsx(BlockTrashFolderViewDialog,{entries:e.entries});default:return null}}function NavbarSearch(){const{trans:e}=useTrans(),t=useNavigate(),s=useDriveStore(a=>a.activePage),[n]=useSearchParams(),[i,o]=reactExports.useState(n.get("query")||"");return jsxRuntimeExports.jsx("form",{className:"max-w-620 flex-auto",onSubmit:a=>{a.preventDefault(),t({pathname:SearchPage.path,search:`?query=${i}`},{replace:!0})},children:jsxRuntimeExports.jsx(TextField,{size:"sm",background:"bg",value:i,onChange:a=>o(a.target.value),onFocus:()=>{s!==SearchPage&&t(SearchPage.path)},startAdornment:jsxRuntimeExports.jsx(IconButton,{type:"submit",children:jsxRuntimeExports.jsx(SearchIcon,{})}),className:"max-w-620 flex-auto",placeholder:e({message:"Search"}),"aria-label":e({message:"Search files and folders"})})})}function useDragMonitor(e){const t=reactExports.useRef(e),s=reactExports.useId();reactExports.useEffect(()=>(dragMonitors.set(s,t.current),()=>{dragMonitors.delete(s)}),[s])}function EntryDragPreview(){const e=reactExports.useRef(null),[t,s]=reactExports.useState(),[n,i]=reactExports.useState({});useDragMonitor({type:"fileEntry",onDragStart:(a,l)=>{const u=l;u&&(i({entries:u.getData(),e:a,draggingTreeItem:isFolderTreeDragId(u.id)}),s({start:a}))},onDragMove:a=>{i(l=>({...l,e:a})),s(l=>({...l,end:a}))},onDragEnd:(a,l,u)=>{i({status:u})}});let o=null;return n.entries&&n.e&&(o=jsxRuntimeExports.jsx("div",{ref:e,style:n.e?{transform:`translate(${n.e.x}px, ${n.e.y}px)`,width:`${n.e.rect.width}px`}:void 0,className:"pointer-events-none fixed left-0 top-0 isolate",children:n.entries.map((a,l)=>jsxRuntimeExports.jsx(EntryPreview,{index:l,entry:a,points:t,state:n},a.id))})),jsxRuntimeExports.jsx(AnimatePresence,{custom:n.status,children:o})}const EntryPreview=reactExports.memo(({entry:e,points:t,index:s,state:n})=>{var d,x,p,h;const i=useDriveStore(f=>f.viewMode),o=n.draggingTreeItem?makeFolderTreeDragId(e):e.id,a=droppables.get(o);if(!(a!=null&&a.rect)||!(t!=null&&t.start))return null;const l=a.rect,u=((d=n.entries)==null?void 0:d.length)||0,c=f=>{var j,g,v;return f==="dropSuccess"?{x:0,y:0,opacity:0,transition:{duration:.1,delay:0}}:{x:l.left-(((j=t.end)==null?void 0:j.x)||0),y:l.top-(((g=t.end)==null?void 0:g.y)||0),width:`${(v=n.e)==null?void 0:v.rect.width}px`}};return jsxRuntimeExports.jsxs(m.div,{transition:{delay:.01*s,bounce:0,duration:.2},initial:{x:l.left-t.start.x,y:l.top-t.start.y,width:`${(x=n.e)==null?void 0:x.rect.width}px`},animate:{x:0,y:0,width:i==="list"?288:void 0},exit:c,style:{width:i==="grid"?`${(p=n.e)==null?void 0:p.rect.width}px`:void 0,height:`${(h=n.e)==null?void 0:h.rect.height}px`},className:clsx("absolute max-h-48 whitespace-nowrap rounded border border-primary-light bg-paper",s<2&&"shadow",s===0&&"left-0 top-0 z-10",s>0&&"left-6 top-6"),children:[u>1&&s===0&&jsxRuntimeExports.jsx(EntryCount,{count:u}),jsxRuntimeExports.jsxs("div",{className:"flex h-full items-center justify-center gap-10 overflow-hidden bg-primary-light/20 px-16 text-sm",children:[jsxRuntimeExports.jsx(FileTypeIcon,{type:e.type}),jsxRuntimeExports.jsx("div",{className:"flex-auto overflow-hidden text-ellipsis",children:e.name})]})]},e.id)}),EntryCount=reactExports.memo(({count:e})=>jsxRuntimeExports.jsx(m.div,{initial:{opacity:0},animate:{opacity:1,transition:{delay:.1}},exit:{opacity:0},transition:{duration:.1},className:"absolute -right-6 -top-6 z-10 z-30 flex h-20 w-20 items-center justify-center rounded-full bg-danger text-sm font-bold text-white shadow-lg",children:e},"entryCount"));function DashboardContentHeader({children:e,className:t}){return jsxRuntimeExports.jsx("div",{className:clsx(t,"dashboard-grid-header"),children:e})}function DriveContentHeader(){const{isMobileMode:e}=reactExports.useContext(DashboardLayoutContext),t=useDriveStore(s=>s.activePage);return jsxRuntimeExports.jsxs(DashboardContentHeader,{className:"flex h-60 items-center gap-20 border-b px-8 py-4 md:px-26",children:[e?jsxRuntimeExports.jsx(DriveSortButton,{isDisabled:t==null?void 0:t.disableSort}):jsxRuntimeExports.jsx(PageBreadcrumbs,{}),jsxRuntimeExports.jsxs("div",{className:"ml-auto flex-shrink-0 text-muted",children:[jsxRuntimeExports.jsx(ToggleViewModeButton,{}),jsxRuntimeExports.jsx(ToggleDetailsButton,{})]})]})}function ToggleViewModeButton(){const e=useDriveStore(s=>s.viewMode),t=e==="grid"?jsxRuntimeExports.jsx(Trans,{message:"List view"}):jsxRuntimeExports.jsx(Trans,{message:"Grid view"});return jsxRuntimeExports.jsx(Tooltip,{label:t,children:jsxRuntimeExports.jsx(IconButton,{size:"md",onClick:()=>{driveState().setViewMode(driveState().viewMode==="list"?"grid":"list")},children:e==="list"?jsxRuntimeExports.jsx(ViewListIcon,{}):jsxRuntimeExports.jsx(ViewModuleIcon,{})})})}function ToggleDetailsButton(){const{rightSidenavStatus:e,setRightSidenavStatus:t}=reactExports.useContext(DashboardLayoutContext),s=e?jsxRuntimeExports.jsx(Trans,{message:"Hide details"}):jsxRuntimeExports.jsx(Trans,{message:"Show details"});return jsxRuntimeExports.jsx(Tooltip,{label:s,children:jsxRuntimeExports.jsx(IconButton,{size:"md",color:e==="open"?"primary":null,onClick:()=>{t(e==="open"?"closed":"open")},children:jsxRuntimeExports.jsx(InfoIcon,{})})})}const uploadStoreOptions={modifyUploadedFile:e=>{const t=getActiveWorkspaceId();return e.fingerprint=`${e.fingerprint}-w-${t}`,e}};function DriveLayout(){const{pathname:e}=useLocation(),{hash:t}=useParams(),{workspaceId:s}=useActiveWorkspaceId(),n=useDriveStore(o=>o.activePage);reactExports.useEffect(()=>{driveState().setActivePage(DRIVE_PAGES.find(o=>o.path===e)||makePartialFolderPage(t))},[e,t]);const i=reactExports.useMemo(()=>({workspaceId:s}),[s]);return reactExports.useEffect(()=>()=>{driveState().reset()},[]),jsxRuntimeExports.jsxs(reactExports.Fragment,{children:[(n==null?void 0:n.label)&&jsxRuntimeExports.jsx(StaticPageTitle,{children:jsxRuntimeExports.jsx(Trans,{message:typeof n.label=="string"?n.label:n.label.message})}),jsxRuntimeExports.jsxs(FileUploadProvider,{options:uploadStoreOptions,children:[jsxRuntimeExports.jsx(FileEntryUrlsContext.Provider,{value:i,children:jsxRuntimeExports.jsxs(DashboardLayout,{name:"drive",onDragOver:o=>{o.preventDefault(),o.stopPropagation(),o.dataTransfer.dropEffect="none"},onDrop:o=>{o.preventDefault()},children:[jsxRuntimeExports.jsx(Navbar,{}),jsxRuntimeExports.jsx(DashboardSidenav,{position:"left",size:"md",children:jsxRuntimeExports.jsx(Sidebar,{})}),jsxRuntimeExports.jsx(DriveContentHeader,{}),jsxRuntimeExports.jsx(DashboardContent,{children:jsxRuntimeExports.jsx(FileView,{})}),jsxRuntimeExports.jsx(UploadQueue,{}),jsxRuntimeExports.jsx(DriveDialogsContainer,{}),jsxRuntimeExports.jsx(DashboardSidenav,{position:"right",size:"lg",children:jsxRuntimeExports.jsx(DetailsSidebar,{})})]})}),jsxRuntimeExports.jsx(EntryDragPreview,{})]})]})}function Navbar(){const{isMobileMode:e}=reactExports.useContext(DashboardLayoutContext),t=useDriveStore(o=>o.activePage),s=e?null:jsxRuntimeExports.jsx(NavbarSearch,{}),n=jsxRuntimeExports.jsx(IconButton,{elementType:Link,to:SearchPage.path,children:jsxRuntimeExports.jsx(SearchIcon,{})}),i=jsxRuntimeExports.jsxs(reactExports.Fragment,{children:[t!==SearchPage&&n,jsxRuntimeExports.jsx(CreateNewButton,{isCompact:!0})]});return jsxRuntimeExports.jsxs(reactExports.Fragment,{children:[jsxRuntimeExports.jsx(DashboardNavbar,{rightChildren:e&&i,menuPosition:"drive-navbar",children:s}),e&&jsxRuntimeExports.jsx(FloatingActionList,{})]})}function FloatingActionList(){const e=useDriveStore(t=>t.selectedEntries.size);return e?jsxRuntimeExports.jsxs("div",{className:"fixed right-0 top-0 z-10 flex h-54 w-full items-center justify-center gap-10 rounded bg-primary px-6 text-on-primary shadow-xl",children:[jsxRuntimeExports.jsx(IconButton,{onClick:()=>{driveState().selectEntries([])},children:jsxRuntimeExports.jsx(CloseIcon,{})}),jsxRuntimeExports.jsx(Trans,{message:":count selected",values:{count:e}}),jsxRuntimeExports.jsx(EntryActionList,{className:"ml-auto"})]}):null}const useLinkPageStore=create()(immer(e=>({password:null,viewMode:getFromLocalStorage("drive.viewMode"),activeSort:{orderBy:"updated_at",orderDir:"desc"},setPassword:t=>{e(s=>{s.password=t})},isPasswordProtected:!1,setIsPasswordProtected:t=>{e(s=>{s.isPasswordProtected=t})},setViewMode:t=>{e(s=>{s.viewMode=t,setInLocalStorage("drive.viewMode",t)})},setActiveSort:t=>{e(s=>{s.activeSort=t})}})));function linkPageState(){return useLinkPageStore.getState()}function useShareableLinkPage(){var l,u;const{hash:e}=useParams(),{orderBy:t,orderDir:s}=useLinkPageStore(c=>c.activeSort),n=`${t}:${s}`,i=useLinkPageStore(c=>c.isPasswordProtected),o=useLinkPageStore(c=>c.password),a=useInfiniteQuery({queryKey:DriveQueryKeys.fetchShareableLink({hash:e,sort:n}),queryFn:async({pageParam:c=1})=>{const d=await fetchLinkByHash({hash:e,page:c,order:n,password:o});return d.passwordInvalid&&linkPageState().setIsPasswordProtected(!0),d},initialData:()=>{var d,x;const c=(d=getBootstrapData().loaders)==null?void 0:d.shareableLinkPage;if(c&&((x=c.link)==null?void 0:x.hash)===e)return c.passwordInvalid&&linkPageState().setIsPasswordProtected(!0),{pageParams:[void 0,1],pages:[c]}},initialPageParam:1,getNextPageParam:c=>{if(!c.folderChildren)return;const d=c.folderChildren.current_page,x=c.folderChildren.last_page;if(!(d>=x))return d+1},enabled:!!e&&!i||o!=null,placeholderData:keepPreviousData});return{...a,link:(l=a.data)==null?void 0:l.pages[0].link,entries:(u=a.data)==null?void 0:u.pages.flatMap(c=>{var d;return(d=c.folderChildren)==null?void 0:d.data})}}function fetchLinkByHash({hash:e,page:t=1,order:s,password:n}){return apiClient.get(`shareable-links/${e}`,{params:{loader:"shareableLinkPage",page:t,order:s,password:n}}).then(i=>i.data)}function checkLinkPassword({password:e,linkHash:t}){return apiClient.post(`shareable-links/${t}/check-password`,{password:e}).then(s=>s.data)}function useCheckLinkPassword(){return useMutation({mutationFn:e=>checkLinkPassword(e),onSuccess:(e,t)=>{e.matches&&linkPageState().setPassword(t.password)},onError:e=>showHttpErrorToast(e,message("Could not create link"))})}function importIntoOwnDrive({linkId:e,password:t}){return apiClient.post(`shareable-links/${e}/import`,{password:t}).then(s=>s.data)}function useImportIntoOwnDrive(){const e=useLinkPageStore(t=>t.password);return useMutation({mutationFn:t=>importIntoOwnDrive({...t,password:e}),onSuccess:async()=>{await queryClient.invalidateQueries({queryKey:DriveQueryKeys.fetchShareableLink()}),toast(message("Item imported into your drive"))},onError:t=>showHttpErrorToast(t,message("Could not create link"))})}function ShareableLinkPageActionButtons(){var a;const{link:e}=useShareableLinkPage(),{user:t,isLoggedIn:s}=useAuth(),{downloadUrl:n}=useFileEntryUrls(e==null?void 0:e.entry),i=useImportIntoOwnDrive(),o=(a=e==null?void 0:e.entry)==null?void 0:a.users.find(l=>l.id===(t==null?void 0:t.id));return e!=null&&e.entry?jsxRuntimeExports.jsxs("div",{children:[e.allow_download&&jsxRuntimeExports.jsx(DownloadButton,{downloadUrl:n}),!o&&s&&e.allow_edit&&jsxRuntimeExports.jsxs(MenuTrigger,{onItemSelected:l=>{l==="import"?i.mutate({linkId:e.id}):l==="download"&&n&&downloadFileFromUrl(n)},children:[jsxRuntimeExports.jsx(IconButton,{className:"ml-6",disabled:i.isPending,children:jsxRuntimeExports.jsx(KeyboardArrowDownIcon,{})}),jsxRuntimeExports.jsxs(Menu,{children:[jsxRuntimeExports.jsx(Item,{value:"download",startIcon:jsxRuntimeExports.jsx(FileDownloadIcon,{}),children:jsxRuntimeExports.jsx(Trans,{message:"Download"})}),jsxRuntimeExports.jsx(Item,{value:"import",startIcon:jsxRuntimeExports.jsx(ImportExportIcon,{}),children:jsxRuntimeExports.jsx(Trans,{message:"Save a copy to your own drive"})})]})]})]}):null}function DownloadButton({downloadUrl:e}){return jsxRuntimeExports.jsxs(reactExports.Fragment,{children:[jsxRuntimeExports.jsx(Tooltip,{label:jsxRuntimeExports.jsx(Trans,{message:"Download"}),children:jsxRuntimeExports.jsx(IconButton,{className:"md:hidden",onClick:()=>{e&&downloadFileFromUrl(e)},children:jsxRuntimeExports.jsx(FileDownloadIcon,{})})}),jsxRuntimeExports.jsx(Button,{className:"max-md:hidden",size:"sm",variant:"flat",color:"chip",startIcon:jsxRuntimeExports.jsx(FileDownloadIcon,{}),onClick:()=>{e&&downloadFileFromUrl(e)},children:jsxRuntimeExports.jsx(Trans,{message:"Download"})})]})}function ShareableLinkNavbar(){const{link:e}=useShareableLinkPage(),t=useIsMobileMediaQuery();return jsxRuntimeExports.jsx(Navbar$1,{size:"md",color:"bg",className:"flex-shrink-0",rightChildren:(e==null?void 0:e.entry)&&jsxRuntimeExports.jsx(ShareableLinkPageActionButtons,{}),menuPosition:"shareable-link-page",hideLogo:t,children:(e==null?void 0:e.entry)&&e.entry.type!=="folder"&&jsxRuntimeExports.jsxs("div",{className:"fex-auto flex min-w-0 items-center gap-10",children:[jsxRuntimeExports.jsx(FileTypeIcon,{className:"flex-shrink-0",type:e.entry.type}),jsxRuntimeExports.jsx("div",{className:"flex-auto overflow-hidden overflow-ellipsis whitespace-nowrap font-medium",children:e.entry.name})]})})}function PasswordPage(){const{trans:e}=useTrans(),{hash:t}=useParams(),s=e({message:"Password"}),[n,i]=reactExports.useState(""),o=useCheckLinkPassword(),a=t?t.split(":")[0]:null,l=o.data&&!o.data.matches;return jsxRuntimeExports.jsxs("div",{className:"flex h-screen flex-col bg-alt",children:[jsxRuntimeExports.jsx(ShareableLinkNavbar,{}),jsxRuntimeExports.jsx("div",{className:"mx-auto my-80 px-10 md:px-20",children:jsxRuntimeExports.jsxs("div",{className:"flex max-w-[560px] flex-col items-center gap-40 rounded border bg p-24 md:flex-row md:gap-14",children:[jsxRuntimeExports.jsx("div",{className:"h-132 w-[165px]",children:jsxRuntimeExports.jsx(SvgImage,{src:secureFilesSvg})}),jsxRuntimeExports.jsxs("form",{onSubmit:u=>{u.preventDefault(),o.mutate({linkHash:a,password:n})},children:[jsxRuntimeExports.jsx("span",{className:"text-sm",children:jsxRuntimeExports.jsx(Trans,{message:"The link you are trying to access is password protected."})}),jsxRuntimeExports.jsx(TextField,{autoFocus:!0,placeholder:s,"aria-label":s,className:"mb-20 mt-10",type:"password",value:n,required:!0,errorMessage:l&&jsxRuntimeExports.jsx(Trans,{message:"Password is not valid"}),onChange:u=>{i(u.target.value)}}),jsxRuntimeExports.jsx("div",{className:"text-right",children:jsxRuntimeExports.jsx(Button,{variant:"flat",color:"primary",type:"submit",className:"w-full md:w-auto",disabled:o.isPending,children:jsxRuntimeExports.jsx(Trans,{message:"Enter"})})})]})]})})]})}function FolderPreviewFileGrid({entries:e,onEntrySelected:t}){return jsxRuntimeExports.jsx("div",{className:"file-grid",children:e.map((s,n)=>jsxRuntimeExports.jsx(BaseFileGridItem,{tabIndex:-1,className:"hover:shadow-md cursor-pointer bg",entry:s,onContextMenu:i=>{i.preventDefault()},onKeyDown:i=>{(i.key==="Enter"||i.key===" ")&&t(s,n)},onClick:()=>{t(s,n)}},s.id))})}const mobileColumns=fileTableColumns.filter(e=>e.key!=="updated_at");function FolderPreviewFileTable({entries:e,onEntrySelected:t}){const s=useLinkPageStore(i=>i.activeSort),n=useIsMobileMediaQuery();return jsxRuntimeExports.jsx(Table,{columns:n?mobileColumns:fileTableColumns,data:e,sortDescriptor:s,onSortChange:i=>{linkPageState().setActiveSort(i)},onAction:(i,o)=>{t(i,o)},enableSelection:!1})}function buildFolderHash(e,t){var n;let s=e.hash;return t&&((n=e.entry)==null?void 0:n.hash)!==t&&(s=`${s}:${t}`),s}function useNavigateToSubfolder(){const{link:e}=useShareableLinkPage(),t=useNavigate$1();return s=>{e&&t(`/drive/s/${buildFolderHash(e,s)}`)}}function FolderPreviewFileView({className:e}){const{pathname:t}=useLocation(),s=useNavigateToSubfolder(),[n,i]=reactExports.useState(),o=useLinkPageStore(j=>j.viewMode),a=reactExports.useRef(null),{link:l,entries:u,isFetchingNextPage:c,hasNextPage:d,fetchNextPage:x,isPlaceholderData:p}=useShareableLinkPage();if(reactExports.useEffect(()=>{i(void 0)},[t]),reactExports.useEffect(()=>{const j=a.current;if(!j)return;const g=new IntersectionObserver(([v])=>{v.isIntersecting&&d&&x()});return g.observe(j),()=>{g.unobserve(j)}},[d,x]),!l||p)return jsxRuntimeExports.jsx("div",{className:clsx("flex justify-center",e),children:jsxRuntimeExports.jsx(ProgressCircle,{isIndeterminate:!0})});const h=(j,g)=>{j.type==="folder"?s(j.hash):i(g)},f=u||[];return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:clsx("file-grid-container flex-auto overflow-auto px-14 pb-14 md:px-24 md:pb-24",e),children:[jsxRuntimeExports.jsx(AdHost,{slot:"file-preview",className:"mb-40"}),o==="grid"?jsxRuntimeExports.jsx(FolderPreviewFileGrid,{entries:f,onEntrySelected:h}):jsxRuntimeExports.jsx(FolderPreviewFileTable,{entries:f,onEntrySelected:h}),jsxRuntimeExports.jsx("span",{ref:a,"aria-hidden":!0}),jsxRuntimeExports.jsx(AnimatePresence,{children:c&&jsxRuntimeExports.jsx(m.div,{className:"mt-24 flex w-full justify-center",...opacityAnimation,children:jsxRuntimeExports.jsx(ProgressCircle,{isIndeterminate:!0,"aria-label":"loading"})})})]}),jsxRuntimeExports.jsx(DialogTrigger,{type:"modal",isOpen:n!=null,onClose:()=>i(void 0),children:jsxRuntimeExports.jsx(FilePreviewDialog,{entries:f,defaultActiveIndex:n,allowDownload:l.allow_download})})]})}function FolderPreviewBreadcrumb({className:e,folder:t,link:s}){const n=useNavigateToSubfolder(),i=useLinkPageStore(l=>l.password),o=useFolderPath({hash:t==null?void 0:t.hash,params:{shareable_link:s.id,password:i}});let a;if(o.isLoading)a=null;else{const l=[];o.data&&o.data.path.forEach(u=>{l.push({folder:u,label:jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:u.name})})}),a=jsxRuntimeExports.jsx(Breadcrumb,{size:"lg",isNavigation:!0,children:l.map(u=>jsxRuntimeExports.jsx(BreadcrumbItem,{onSelected:()=>{n(u.folder.hash)},children:u.label},u.folder.hash))})}return jsxRuntimeExports.jsx("div",{className:clsx("h-36 flex-shrink-0",e),children:a})}function FolderPreviewHeader(){const e=useLinkPageStore(i=>i.activeSort),{link:t,isFetching:s}=useShareableLinkPage(),n=t&&t.entry;return jsxRuntimeExports.jsxs("div",{className:"flex flex-col justify-between gap-14 p-14 md:h-90 md:flex-row md:items-center md:p-24",children:[n&&jsxRuntimeExports.jsx(FolderPreviewBreadcrumb,{link:t,folder:t.entry,className:"flex-auto"}),n&&jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between text-muted md:justify-start",children:[jsxRuntimeExports.jsx(EntriesSortButton,{isDisabled:s,descriptor:e,onChange:i=>{linkPageState().setActiveSort(i)}}),jsxRuntimeExports.jsx("div",{className:"ml-10 md:border-l md:pl-10",children:jsxRuntimeExports.jsx(IconButton,{onClick:()=>{linkPageState().setViewMode(linkPageState().viewMode==="grid"?"list":"grid")},children:jsxRuntimeExports.jsx(GridViewIcon,{})})})]})]})}function FolderPreview(){const{entries:e,isFetched:t}=useShareableLinkPage(),s=t&&!(e!=null&&e.length);return jsxRuntimeExports.jsxs(DashboardLayout,{name:"folder-preview",children:[jsxRuntimeExports.jsx(DashboardNavbar,{hideToggleButton:!0,rightChildren:jsxRuntimeExports.jsx(ShareableLinkPageActionButtons,{}),color:"bg"}),jsxRuntimeExports.jsx(DashboardContentHeader,{children:jsxRuntimeExports.jsx(FolderPreviewHeader,{})}),jsxRuntimeExports.jsx(FileUploadProvider,{children:jsxRuntimeExports.jsx(DashboardContent,{children:s?jsxRuntimeExports.jsx(EmptyMessage,{}):jsxRuntimeExports.jsx(FolderPreviewFileView,{})})})]})}function EmptyMessage({className:e}){return jsxRuntimeExports.jsx(IllustratedMessage,{className:clsx(e,"mt-80"),image:jsxRuntimeExports.jsx(SvgImage,{src:shareSvg}),title:jsxRuntimeExports.jsx(Trans,{message:"Folder is empty"}),description:jsxRuntimeExports.jsx(Trans,{message:"No files have been uploaded to this folder yet"})})}function ShareableLinkPageFilePreview(){const{link:e}=useShareableLinkPage();return e!=null&&e.entry?jsxRuntimeExports.jsxs("div",{className:"flex h-screen flex-col bg-alt",children:[jsxRuntimeExports.jsx(ShareableLinkNavbar,{}),jsxRuntimeExports.jsx(AdHost,{slot:"file-preview",className:"mx-auto mt-24"}),jsxRuntimeExports.jsx(FilePreviewContainer,{entries:[e.entry],showHeader:!1,allowDownload:e.allow_download})]}):null}function ShareableLinkPage(){var x;const{status:e,link:t,entries:s}=useShareableLinkPage(),{user:n,isLoggedIn:i}=useAuth(),o=!i,a=(s==null?void 0:s.reduce((p,h)=>p+(h.file_size||0),0))||0,{trans:l}=useTrans(),u=useLinkPageStore(p=>p.isPasswordProtected),c=useLinkPageStore(p=>p.password);let d;if(e==="pending")d=jsxRuntimeExports.jsx("div",{className:"flex h-screen flex-auto items-center justify-center",children:jsxRuntimeExports.jsx(ProgressCircle,{"aria-label":l({message:"Loading link"}),isIndeterminate:!0})});else{if(!t&&!u)return jsxRuntimeExports.jsx(NotFoundPage,{});u&&!c?d=jsxRuntimeExports.jsx(PasswordPage,{}):((x=t==null?void 0:t.entry)==null?void 0:x.type)==="folder"?d=jsxRuntimeExports.jsx(FolderPreview,{}):o?d=jsxRuntimeExports.jsx(GuestDownloadView,{files:s,totalSize:a,expiresAt:t==null?void 0:t.expires_at}):d=jsxRuntimeExports.jsx(ShareableLinkPageFilePreview,{})}return jsxRuntimeExports.jsx(ActiveWorkspaceProvider,{children:jsxRuntimeExports.jsx(FileEntryUrlsContext.Provider,{value:{shareable_link:t==null?void 0:t.id,password:c},children:d})})}export{DriveLayout,ShareableLinkPage};
//# sourceMappingURL=drive-routes.lazy-9254298e.js.map
