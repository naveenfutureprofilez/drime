{"version":3,"file":"guest-download-view-fb119a0f.js","sources":["../../../resources/client/drive/shareable-link/shareable-link-page/guest-download-view.jsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { Button } from '@ui/buttons/button';\nimport { Trans } from '@ui/i18n/trans';\nimport { prettyBytes } from '@ui/utils/files/pretty-bytes';\nimport { apiClient } from '@common/http/query-client';\nimport { LockIcon } from '@ui/icons/material/Lock';\nexport const GuestDownloadView = ({\n  files,\n  totalSize,\n  expiresAt,\n  hash,\n  hasPassword\n}) => {\n  const [password, setPassword] = useState('');\n  const [isVerifying, setIsVerifying] = useState(false);\n  const [isUnlocked, setIsUnlocked] = useState(!hasPassword);\n  const [passwordError, setPasswordError] = useState('');\n  \n  console.log('GuestDownloadView props:', { files, totalSize, expiresAt, hash, hasPassword });\n  \n  const handlePasswordSubmit = async (e) => {\n    e.preventDefault();\n    if (!password.trim()) return;\n    \n    setIsVerifying(true);\n    setPasswordError('');\n    \n    try {\n      const response = await apiClient.post(`guest/upload/${hash}/verify-password`, { password });\n      if (response.data.valid) {\n        setIsUnlocked(true);\n      } else {\n        setPasswordError('Incorrect password. Please try again.');\n      }\n    } catch (error) {\n      setPasswordError('Error verifying password. Please try again.');\n    } finally {\n      setIsVerifying(false);\n    }\n  };\n  \n  // If password protected and not unlocked, show password form\n  if (hasPassword && !isUnlocked) {\n    return (\n      <div className=\"max-w-md mx-auto\">\n        <div className=\"bg-white rounded-xl shadow-lg p-8 text-center\">\n          <div className=\"w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-6\">\n            <LockIcon className=\"w-8 h-8 text-yellow-600\" />\n          </div>\n          \n          <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">\n            <Trans message=\"Password Protected\" />\n          </h2>\n          \n          <p className=\"text-gray-600 mb-6\">\n            <Trans message=\"This file share is password protected. Please enter the password to access the files.\" />\n          </p>\n          \n          <form onSubmit={handlePasswordSubmit} className=\"space-y-4\">\n            <div>\n              <input\n                type=\"password\"\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                placeholder=\"Enter password\"\n                className=\"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                disabled={isVerifying}\n                autoFocus\n              />\n              {passwordError && (\n                <p className=\"text-red-600 text-sm mt-2\">{passwordError}</p>\n              )}\n            </div>\n            \n            <button\n              type=\"submit\"\n              disabled={isVerifying || !password.trim()}\n              className=\"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-300 text-white font-medium py-3 px-6 rounded-lg transition-colors\"\n            >\n              {isVerifying ? (\n                <Trans message=\"Verifying...\" />\n              ) : (\n                <Trans message=\"Access Files\" />\n              )}\n            </button>\n          </form>\n        </div>\n      </div>\n    );\n  }\n  return <div className=\"space-y-6\">\n      <div className=\"bg-white text-black rounded-xl p-4\">\n        <h3 className=\"font-medium  mb-3\">\n          <Trans message=\"Download Files\" />\n        </h3>\n        <div className=\"space-y-2\">\n          {files?.map((file, index) => <div key={index} className=\"flex items-center gap-3 bg-white border border-black rounded-lg p-3\">\n              <div className=\"flex-1 text-left\">\n                <div className=\"text-sm font-medium \">{file.name || file.filename || file.original_filename}</div>\n                <div className=\"text-xs \">{prettyBytes(file.file_size || file.size || 0)}</div>\n              </div>\n            </div>) || []}\n        </div>\n\n        <div className=\"mt-3 pt-3 border-t border-gray-200 flex justify-between text-sm\">\n          <span className=\"text-gray-600\">\n            <Trans message=\"Total size:\" />\n          </span>\n          <span className=\"font-medium\">{prettyBytes(totalSize)}</span>\n        </div>\n\n        {expiresAt && <div className=\"mt-2 text-xs \">\n            <Trans message=\"Expires on :date\" values={{\n          date: new Date(expiresAt).toLocaleDateString()\n        }} />\n          </div>}\n      </div>\n\n      {/* Download Button */}\n      <div className=\"flex justify-center pt-4\">\n        <button \n          className=\"bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-8 rounded-lg transition-colors\" \n          onClick={() => {\n            if (!hash) {\n              alert('Invalid download link.');\n              return;\n            }\n            \n            const downloadParams = hasPassword && password ? `?password=${encodeURIComponent(password)}` : '';\n            \n            if (files && files.length === 1) {\n              // Single file - direct download using file ID\n              const file = files[0];\n              const downloadUrl = `/download/${hash}/${file.id}${downloadParams}`;\n              window.open(downloadUrl, '_blank');\n            } else if (files && files.length > 1) {\n              // Multiple files - ZIP download \n              const downloadUrl = `/download/${hash}${downloadParams}`;\n              window.open(downloadUrl, '_blank');\n            } else {\n              alert('No files available for download.');\n            }\n          }}\n        >\n          <Trans message=\"Download all\" />\n        </button>\n      </div>\n    </div>;\n};"],"names":["GuestDownloadView","files","totalSize","expiresAt","hash","hasPassword","password","setPassword","useState","isVerifying","setIsVerifying","isUnlocked","setIsUnlocked","passwordError","setPasswordError","handlePasswordSubmit","e","apiClient","jsxs","jsx","LockIcon","Trans","file","index","prettyBytes","downloadParams","downloadUrl"],"mappings":"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"}