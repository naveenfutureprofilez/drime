import{Q as QueryObserver,i as infiniteQueryBehavior,k as hasNextPage,l as hasPreviousPage,m as useBaseQuery,j as jsxRuntimeExports,P as ProgressBarBase,n as useStorageSummary,o as clsx,T as Trans,p as useMutation,t as toast,q as message,v as queryClient,W as WorkspaceQueryKeys,w as onFormQueryError,a as apiClient,x as useForm,y as useDialogContext,D as Dialog,z as DialogHeader,A as DialogBody,B as Form,C as FormTextField,E as DialogFooter,G as Button,H as useQuery,I as showHttpErrorToast,J as useActiveWorkspaceId,K as useAuth,M as PersonalWorkspace,O as ConfirmationDialog,S as ProgressCircle,V as AnimatePresence,X as m,Y as Avatar,r as reactExports,Z as useTrans,_ as useValueLists,$ as DialogTrigger,a0 as IconButton,a1 as ExitToAppIcon,a2 as CloseIcon,a3 as MenuTrigger,a4 as ArrowDropDownIcon,a5 as Menu,a6 as Item,h as useSettings,a7 as Link,a8 as LinkStyle,a9 as ButtonBase,aa as UnfoldMoreIcon,ab as useUserWorkspaces,ac as useActiveWorkspace,ad as openDialog,ae as AddIcon,af as CheckIcon,ag as KeyboardArrowDownIcon,ah as getBootstrapData,c as commonjsGlobal,ai as DriveQueryKeys,aj as invalidateEntryQueries,ak as useDriveUploadQueue,al as driveState,am as $458b0a5536c1a7cf$export$40bfa8c7b0832715,an as $9bf71ea28793e738$export$20e40289641fbbb6,ao as $9bf71ea28793e738$export$10c5169755ce7bd7,ap as createEventHandler,aq as useNavigate,ar as useDriveStore,as as $3ef42575df84b30b$export$9d1611c77c2fe928,at as getAxiosErrorMessage,au as CustomMenuItem,av as CustomMenu,aw as FileUploadIcon,ax as openUploadWindow,ay as useSearchParams,az as shallowEqual,aA as TextField,aB as SearchIcon,aC as Tooltip,aD as ContextMenu,aE as useMediaQuery,aF as memoize,aG as prettyBytes,aH as FormattedDate,aI as Checkbox,R as React,aJ as Section,aK as MixedText,aL as opacityAnimation,aM as lazyLoader,aN as dot,aO as IllustratedMessage,aP as SvgImage,aQ as useFileUploadStore,aR as FileTypeIcon,aS as ErrorIcon,aT as WarningIcon,aU as CheckCircleIcon,aV as keepPreviousData,aW as List,aX as ListItem,aY as Chip,aZ as axios,a_ as UserAvatar,a$ as useActiveDialogEntry,b0 as useClipboard,b1 as $14e0f24ef4ac5c92$export$461939dd4422153,b2 as $14e0f24ef4ac5c92$export$aa8b41735afcabd2,b3 as ComboBoxForwardRef,N as Navbar$1,b4 as setInLocalStorage,b5 as getFromLocalStorage,b6 as Underlay,b7 as useLocation,u as useParams,b8 as StaticPageTitle,b9 as FileUploadProvider,ba as getActiveWorkspaceId,bb as create,bc as immer,bd as useIsMobileMediaQuery,be as secureFilesSvg,bf as useNavigate$1,bg as NotFoundPage,bh as ActiveWorkspaceProvider}from"./main-036cb1f7.js";import{S as StorageIcon,G as GroupIcon,P as PersonAddIcon,A as ArrowRightIcon,B as BackupIcon,F as FolderIcon,U as UploadFileIcon,D as DriveFolderUploadIcon,C as CreateNewFolderIcon,R as RemoveRedEyeIcon,a as StarIcon,b as StarOutlineIcon,c as DriveFileMoveIcon,d as DriveFileRenameOutlineIcon,e as ContentCopyIcon,f as RestoreIcon,g as DeleteForeverIcon,h as SortIcon,i as RefreshIcon,j as PushPinIcon,k as GroupsIcon,V as ViewListIcon,l as ViewModuleIcon,M as MenuOpenIcon,I as ImportExportIcon,m as GridViewIcon}from"./GridView-496dee45.js";import{C as ChipField,D as DeleteIcon,h as hasNextPage$1,F as FilterOperator,a as FilterControlType,b as FilterList,u as usePointerEvents,L as LinkIcon,T as TableContext,c as Table,i as isCtrlOrShiftPressed,d as isCtrlKeyPressed,e as ChipList,f as useNormalizedModels,g as encodeBackendFilters}from"./table-c0039120.js";import{E as EditIcon}from"./Edit-f18cb09d.js";import{S as SectionHelper,B as Breadcrumb,a as BreadcrumbItem,C as ChevronRightIcon}from"./breadcrumb-0393ab07.js";import{u as useDroppable,a as useDraggable,F as FILE_ENTRY_TYPE_FILTER,c as createdAtFilter,b as updatedAtFilter,d as droppables,e as activeInteraction,f as updateRects,g as useFileEntryUrls,h as FileDownloadIcon,i as downloadFileFromUrl,M as MoreVertIcon,j as FileThumbnail,$ as $62d8ded9296f3872$export$cfa2225e87938781,k as useVirtualizer,l as FilePreviewDialog,m as FormDatePicker,n as dragMonitors,I as InfoIcon,o as usePrevious,p as FileEntryUrlsContext,D as DashboardContent,q as FilePreviewContainer}from"./use-previous-f4ede441.js";import{S as Switch,F as FormSwitch}from"./formatted-number-14f69e88.js";import{A as ArrowBackIcon}from"./ArrowBack-c37c2b1c.js";import{G as GuestDownloadView}from"./guest-download-view-f59f2cad.js";var InfiniteQueryObserver=class extends QueryObserver{constructor(e,t){super(e,t)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(e){super.setOptions({...e,behavior:infiniteQueryBehavior()})}getOptimisticResult(e){return e.behavior=infiniteQueryBehavior(),super.getOptimisticResult(e)}fetchNextPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"backward"}}})}createResult(e,t){var g,j;const{state:s}=e,n=super.createResult(e,t),{isFetching:o,isRefetching:i,isError:a,isRefetchError:l}=n,u=(j=(g=s.fetchMeta)==null?void 0:g.fetchMore)==null?void 0:j.direction,c=a&&u==="forward",x=o&&u==="forward",d=a&&u==="backward",p=o&&u==="backward";return{...n,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:hasNextPage(t,s.data),hasPreviousPage:hasPreviousPage(t,s.data),isFetchNextPageError:c,isFetchingNextPage:x,isFetchPreviousPageError:d,isFetchingPreviousPage:p,isRefetchError:l&&!c&&!d,isRefetching:i&&!x&&!p}}};function useInfiniteQuery(e,t){return useBaseQuery(e,InfiniteQueryObserver,t)}function Meter(e){return jsxRuntimeExports.jsx(ProgressBarBase,{...e,role:"meter progressbar"})}function StorageMeter(){const{isLoading:e,data:t}=useStorageSummary(),s=jsxRuntimeExports.jsx("span",{className:clsx("whitespace-nowrap",e&&"invisible"),children:jsxRuntimeExports.jsx(Trans,{message:":used of :available used",values:{used:t==null?void 0:t.usedFormatted,available:t==null?void 0:t.availableFormatted}})});return jsxRuntimeExports.jsxs("div",{className:"mt-24 flex items-start gap-16 border-t pl-24 pt-24",children:[jsxRuntimeExports.jsx(StorageIcon,{className:"-mt-4 icon-md"}),jsxRuntimeExports.jsx(Meter,{className:"max-w-144 flex-auto",size:"xs",value:t==null?void 0:t.percentage,label:s,showValueLabel:!1,labelPosition:"bottom"})]})}function useCreateWorkspace(e){return useMutation({mutationFn:t=>createWorkspace(t),onSuccess:()=>{toast(message("Created workspace")),queryClient.invalidateQueries({queryKey:WorkspaceQueryKeys.fetchUserWorkspaces})},onError:t=>onFormQueryError(t,e)})}function createWorkspace(e){return apiClient.post("workspace",e).then(t=>t.data)}function NewWorkspaceDialog(){const e=useForm(),{formId:t,close:s}=useDialogContext(),n=useCreateWorkspace(e);return jsxRuntimeExports.jsxs(Dialog,{children:[jsxRuntimeExports.jsx(DialogHeader,{children:jsxRuntimeExports.jsx(Trans,{message:"Create workspace"})}),jsxRuntimeExports.jsx(DialogBody,{children:jsxRuntimeExports.jsx(Form,{form:e,id:t,onSubmit:()=>{n.mutate(e.getValues(),{onSuccess:o=>{s(o.workspace.id)}})},children:jsxRuntimeExports.jsx(FormTextField,{name:"name",autoFocus:!0,label:jsxRuntimeExports.jsx(Trans,{message:"Workspace name"}),minLength:3,required:!0})})}),jsxRuntimeExports.jsxs(DialogFooter,{children:[jsxRuntimeExports.jsx(Button,{variant:"text",onClick:s,children:jsxRuntimeExports.jsx(Trans,{message:"Cancel"})}),jsxRuntimeExports.jsx(Button,{variant:"flat",color:"primary",type:"submit",form:t,disabled:n.isPending,children:jsxRuntimeExports.jsx(Trans,{message:"Create"})})]})]})}function fetchWorkspaceWithMembers(e){return apiClient.get(`workspace/${e}`).then(t=>t.data)}function useWorkspaceWithMembers(e){return useQuery({queryKey:WorkspaceQueryKeys.workspaceWithMembers(e),queryFn:()=>fetchWorkspaceWithMembers(e)})}function InviteMembers({workspaceId:e,...t}){return apiClient.post(`workspace/${e}/invite`,t).then(s=>s.data)}function useInviteMembers(){return useMutation({mutationFn:e=>InviteMembers(e),onSuccess:(e,t)=>{queryClient.invalidateQueries({queryKey:WorkspaceQueryKeys.workspaceWithMembers(t.workspaceId)})},onError:e=>showHttpErrorToast(e)})}function ResendInvite({workspaceId:e,inviteId:t,...s}){return apiClient.post(`workspace/${e}/${t}/resend`,s).then(n=>n.data)}function useResendInvite(){return useMutation({mutationFn:e=>ResendInvite(e),onSuccess:()=>{toast("Invite sent")},onError:e=>showHttpErrorToast(e)})}function ChangeRole({workspaceId:e,member:t,...s}){const n=t.model_type,o=t.model_type==="invite"?t.id:t.member_id;return apiClient.post(`workspace/${e}/${n}/${o}/change-role`,s).then(i=>i.data)}function useChangeRole(){return useMutation({mutationFn:e=>ChangeRole(e),onSuccess:(e,t)=>{toast(message("Role changed")),queryClient.invalidateQueries({queryKey:WorkspaceQueryKeys.workspaceWithMembers(t.workspaceId)})},onError:e=>showHttpErrorToast(e)})}function removeMember({workspaceId:e,memberId:t,memberType:s}){const n=s==="invite"?`workspace/invite/${t}`:`workspace/${e}/member/${t}`;return apiClient.delete(n).then(o=>o.data)}function useRemoveMember(){const{workspaceId:e,setWorkspaceId:t}=useActiveWorkspaceId(),{user:s}=useAuth();return useMutation({mutationFn:n=>removeMember(n),onSuccess:(n,o)=>{queryClient.invalidateQueries({queryKey:WorkspaceQueryKeys.fetchUserWorkspaces}),queryClient.invalidateQueries({queryKey:WorkspaceQueryKeys.workspaceWithMembers(o.workspaceId)}),o.memberId===(s==null?void 0:s.id)&&e===o.workspaceId&&t(PersonalWorkspace.id)},onError:n=>showHttpErrorToast(n)})}function LeaveWorkspaceConfirmation({onConfirm:e,isLoading:t}){return jsxRuntimeExports.jsx(ConfirmationDialog,{isDanger:!0,title:jsxRuntimeExports.jsx(Trans,{message:"Leave workspace"}),isLoading:t,onConfirm:e,body:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Trans,{message:"Are you sure you want to leave this workspace?"}),jsxRuntimeExports.jsx("div",{className:"mt-8 font-semibold",children:jsxRuntimeExports.jsx(Trans,{message:"All resources you've created in the workspace will be transferred to workspace owner."})})]}),confirm:jsxRuntimeExports.jsx(Trans,{message:"Leave"})})}const matcher=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;function isEmail(e){return!e||e.length>320?!1:matcher.test(e)}function WorkspaceMembersDialog({workspace:e}){const{data:t,isLoading:s}=useWorkspaceWithMembers(e.id);return jsxRuntimeExports.jsxs(Dialog,{size:"lg",children:[jsxRuntimeExports.jsx(DialogHeader,{children:jsxRuntimeExports.jsx(Trans,{message:"Manage workspace members"})}),jsxRuntimeExports.jsx(DialogBody,{children:s?jsxRuntimeExports.jsx("div",{className:"flex min-h-[238px] items-center justify-center",children:jsxRuntimeExports.jsx(ProgressCircle,{isIndeterminate:!0,"aria-label":"Loading workspace..."})}):jsxRuntimeExports.jsx(Manager,{workspace:t.workspace})})]})}function Manager({workspace:e}){const{user:t}=useAuth(),s=usePermissions(e),n=[...e.members||[],...e.invites||[]],o=!s.update&&!s.delete;return jsxRuntimeExports.jsxs("div",{children:[s.invite&&jsxRuntimeExports.jsx(InviteChipField,{workspace:e}),jsxRuntimeExports.jsxs("div",{className:"mb-14 flex items-center gap-10 text-base",children:[jsxRuntimeExports.jsx(GroupIcon,{className:"icon-sm"}),jsxRuntimeExports.jsx(Trans,{message:"Members of `:workspace`",values:{workspace:e.name}})]}),jsxRuntimeExports.jsxs(AnimatePresence,{initial:!1,children:[n.map(i=>o&&i.id!==(t==null?void 0:t.id)?null:jsxRuntimeExports.jsx(MemberListItem$1,{workspace:e,member:i},`${i.model_type}.${i.id}`)),o&&jsxRuntimeExports.jsx("div",{className:"text-muted",children:jsxRuntimeExports.jsx(Trans,{message:"And [one one other member|:count other members]",values:{count:n.length}})})]})]})}function MemberListItem$1({workspace:e,member:t}){return jsxRuntimeExports.jsxs(m.div,{initial:{x:"-100%",opacity:0},animate:{x:0,opacity:1},exit:{x:"100%",opacity:0},transition:{type:"tween",duration:.125},className:"mb-20 flex items-start gap-14 text-sm",children:[jsxRuntimeExports.jsx(Avatar,{className:"flex-shrink-0",size:"lg",circle:!0,label:t.name,src:t.image,fallback:"initials"}),jsxRuntimeExports.jsxs("div",{className:"min-w-0 flex-auto items-center justify-between gap-14 md:flex",children:[jsxRuntimeExports.jsxs("div",{className:"mb-10 overflow-hidden md:mb-0 md:mr-10",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-start gap-6",children:[jsxRuntimeExports.jsx("div",{className:"overflow-hidden text-ellipsis whitespace-nowrap",children:t.name}),jsxRuntimeExports.jsx(MemberDisplayNameAppend,{workspace:e,member:t})]}),jsxRuntimeExports.jsx("div",{className:"text-muted",children:t.email})]}),jsxRuntimeExports.jsx(MemberActions,{workspace:e,member:t})]})]},`${t.model_type}.${t.id}`)}function usePermissions(e){var i;const{user:t}=useAuth(),s={update:!1,invite:!1,delete:!1},n=["update","invite","delete"],o=(i=e.members)==null?void 0:i.find(a=>a.id===(t==null?void 0:t.id));return o&&n.forEach(a=>{var l;s[a]=o.is_owner||!!((l=o.permissions)!=null&&l.find(u=>u.name===`workspace_members.${a}`))}),s}function MemberActions({workspace:e,member:t}){const[s,n]=reactExports.useState(t.role_id),o=useChangeRole(),{user:i}=useAuth(),a=usePermissions(e),l=t.model_type==="member"&&t.is_owner,u=t.model_type==="member"&&(i==null?void 0:i.id)===t.id,c=!a.update||l||u?jsxRuntimeExports.jsx("div",{className:"ml-auto text-muted first:capitalize",children:jsxRuntimeExports.jsx(Trans,{message:t.role_name})}):jsxRuntimeExports.jsx(RoleMenuTrigger,{className:"ml-auto flex-shrink-0",size:"xs",value:s,isDisabled:o.isPending,onChange:x=>{n(x),o.mutate({roleId:x,workspaceId:e.id,member:t})}});return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[c,!l&&(u||a.delete)&&jsxRuntimeExports.jsx(RemoveMemberButton,{type:u?"leave":"remove",member:t,workspace:e})]})}function InviteChipField({workspace:e}){const{trans:t}=useTrans(),[s,n]=reactExports.useState([]),o=s.every(x=>!x.invalid),i=x=>x.description||x.name,[a,l]=reactExports.useState(),u=useInviteMembers(),{data:c}=useValueLists(["workspaceRoles"]);return reactExports.useEffect(()=>{var x;!a&&((x=c==null?void 0:c.workspaceRoles)!=null&&x.length)&&l(c.workspaceRoles[0].id)},[c,a]),jsxRuntimeExports.jsxs("div",{className:"mb-30",children:[jsxRuntimeExports.jsx(ChipField,{value:s,onChange:n,displayWith:i,validateWith:x=>{const d=!isEmail(x.description);return{...x,invalid:d,errorMessage:d?t({message:"Not a valid email"}):void 0}},placeholder:t({message:"Enter email addresses"}),label:jsxRuntimeExports.jsx(Trans,{message:"Invite people"})}),jsxRuntimeExports.jsxs("div",{className:"mt-14 flex items-center justify-between gap-14",children:[jsxRuntimeExports.jsx(RoleMenuTrigger,{onChange:l,value:a}),s.length&&a?jsxRuntimeExports.jsx(Button,{variant:"flat",color:"primary",size:"sm",disabled:u.isPending||!o,onClick:()=>{u.mutate({emails:s.map(x=>i(x)),roleId:a,workspaceId:e.id},{onSuccess:()=>{n([])}})},children:jsxRuntimeExports.jsx(Trans,{message:"Invite"})}):null]})]})}function RemoveMemberButton({member:e,workspace:t,type:s}){const n=useRemoveMember(),{close:o}=useDialogContext();return jsxRuntimeExports.jsxs(DialogTrigger,{type:"modal",onClose:i=>{i&&(n.mutate({workspaceId:t.id,memberId:e.id,memberType:e.model_type}),s==="leave"&&(o(),toast(message("Left workspace"))))},children:[jsxRuntimeExports.jsx(IconButton,{size:"md",className:"flex-shrink-0 text-muted",disabled:n.isPending,children:s==="leave"?jsxRuntimeExports.jsx(ExitToAppIcon,{}):jsxRuntimeExports.jsx(CloseIcon,{})}),s==="leave"?jsxRuntimeExports.jsx(LeaveWorkspaceConfirmation,{}):jsxRuntimeExports.jsx(RemoveMemberConfirmation,{member:e})]})}function RemoveMemberConfirmation({member:e}){return jsxRuntimeExports.jsx(ConfirmationDialog,{isDanger:!0,title:jsxRuntimeExports.jsx(Trans,{message:"Remove member"}),body:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Trans,{message:"Are you sure you want to remove `:name`?",values:{name:e.name}}),jsxRuntimeExports.jsx("div",{className:"mt-8 font-semibold",children:jsxRuntimeExports.jsx(Trans,{message:"All workspace resources created by `:name` will be transferred to workspace owner.",values:{name:e.name}})})]}),confirm:jsxRuntimeExports.jsx(Trans,{message:"Remove"})})}function RoleMenuTrigger({value:e,onChange:t,size:s="xs",className:n,isDisabled:o}){var l;const{data:i}=useValueLists(["workspaceRoles"]),a=(l=i==null?void 0:i.workspaceRoles)==null?void 0:l.find(u=>u.id===e);return!e||!a||!(i!=null&&i.workspaceRoles)?null:jsxRuntimeExports.jsxs(MenuTrigger,{selectionMode:"single",selectedValue:e,onSelectionChange:u=>{t(u)},children:[jsxRuntimeExports.jsx(Button,{className:n,size:s,variant:"flat",color:"chip",disabled:o,endIcon:jsxRuntimeExports.jsx(ArrowDropDownIcon,{}),children:jsxRuntimeExports.jsx(Trans,{message:a.name})}),jsxRuntimeExports.jsx(Menu,{children:i.workspaceRoles.map(u=>jsxRuntimeExports.jsx(Item,{value:u.id,description:u.description,children:jsxRuntimeExports.jsx(Trans,{message:u.name})},u.id))})]})}function MemberDisplayNameAppend({member:e,workspace:t}){const{user:s}=useAuth(),n=usePermissions(t);return(s==null?void 0:s.id)===e.id?jsxRuntimeExports.jsxs("div",{className:"font-medium",children:["(",jsxRuntimeExports.jsx(Trans,{message:"You"}),")"]}):e.model_type==="invite"?jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4",children:[jsxRuntimeExports.jsx("div",{children:"·"}),jsxRuntimeExports.jsx("div",{className:"font-medium",children:jsxRuntimeExports.jsx(Trans,{message:"Invited"})}),n.invite?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{children:"·"}),jsxRuntimeExports.jsx(ResendInviteDialogTrigger,{member:e,workspace:t})]}):null]}):null}function ResendInviteDialogTrigger({member:e,workspace:t}){const s=useResendInvite();return jsxRuntimeExports.jsxs(DialogTrigger,{type:"modal",onClose:n=>{n&&s.mutate({workspaceId:t.id,inviteId:e.id})},children:[jsxRuntimeExports.jsx(Button,{variant:"link",size:"sm",color:"primary",disabled:s.isPending,children:jsxRuntimeExports.jsx(Trans,{message:"Resend invite"})}),jsxRuntimeExports.jsx(ConfirmationDialog,{title:jsxRuntimeExports.jsx(Trans,{message:"Resend invite"}),body:jsxRuntimeExports.jsx(Trans,{message:"Are you sure you want to send this invite again?"}),confirm:jsxRuntimeExports.jsx(Trans,{message:"Send"})})]})}function updateWorkspace({id:e,...t}){return apiClient.put(`workspace/${e}`,t).then(s=>s.data)}function useUpdateWorkspace(e){const{close:t}=useDialogContext();return useMutation({mutationFn:s=>updateWorkspace(s),onSuccess:s=>{t(),toast(message("Updated workspace")),queryClient.invalidateQueries({queryKey:WorkspaceQueryKeys.fetchUserWorkspaces}),queryClient.invalidateQueries({queryKey:WorkspaceQueryKeys.workspaceWithMembers(s.workspace.id)})},onError:s=>onFormQueryError(s,e)})}function RenameWorkspaceDialog({workspace:e}){const t=useForm({defaultValues:{id:e.id,name:e.name}}),{formId:s,close:n}=useDialogContext(),o=useUpdateWorkspace(t);return jsxRuntimeExports.jsxs(Dialog,{children:[jsxRuntimeExports.jsx(DialogHeader,{children:jsxRuntimeExports.jsx(Trans,{message:"Rename workspace"})}),jsxRuntimeExports.jsx(DialogBody,{children:jsxRuntimeExports.jsx(Form,{form:t,id:s,onSubmit:()=>{o.mutate(t.getValues())},children:jsxRuntimeExports.jsx(FormTextField,{name:"name",autoFocus:!0,label:jsxRuntimeExports.jsx(Trans,{message:"Name"}),minLength:3,required:!0})})}),jsxRuntimeExports.jsxs(DialogFooter,{children:[jsxRuntimeExports.jsx(Button,{variant:"text",onClick:n,children:jsxRuntimeExports.jsx(Trans,{message:"Cancel"})}),jsxRuntimeExports.jsx(Button,{variant:"flat",color:"primary",type:"submit",form:s,disabled:o.isPending,children:jsxRuntimeExports.jsx(Trans,{message:"Rename"})})]})]})}function deleteWorkspace({id:e}){return apiClient.delete(`workspace/${e}`).then(t=>t.data)}function useDeleteWorkspace(){const{workspaceId:e,setWorkspaceId:t}=useActiveWorkspaceId();return useMutation({mutationFn:s=>deleteWorkspace(s),onSuccess:(s,n)=>{toast(message("Deleted workspace")),queryClient.invalidateQueries({queryKey:WorkspaceQueryKeys.fetchUserWorkspaces}),queryClient.invalidateQueries({queryKey:WorkspaceQueryKeys.workspaceWithMembers(n.id)}),e===n.id&&t(PersonalWorkspace.id)},onError:s=>showHttpErrorToast(s)})}function PolicyFailMessage({resourceName:e,className:t,size:s="md",color:n="bgAlt",reason:o="overQuota",...i}){const a=i.message??jsxRuntimeExports.jsx(MessageText,{resourceName:e,reason:o});return jsxRuntimeExports.jsx(SectionHelper,{color:n,size:s,className:t,description:a})}function MessageText({resourceName:e,reason:t}){const{billing:s}=useSettings();if(t==="noWorkspacePermission")return jsxRuntimeExports.jsx(Trans,{message:"You can't create new :name in this workspace.",values:{name:e}});const n={name:e,a:o=>jsxRuntimeExports.jsx(Link,{className:LinkStyle,to:"/pricing",children:o})};return t==="overQuota"&&s.enable?jsxRuntimeExports.jsx(Trans,{message:"Your plan is at its maximum number of :name allowed. <a>Upgrade to add more.</a>",values:n}):t==="noPermission"&&s.enable?jsxRuntimeExports.jsx(Trans,{message:"To unlock ability to create :name. <a>Upgrade your plan.</a>",values:n}):jsxRuntimeExports.jsx(Trans,{message:"You don't have permissions to create :name."})}function WorkspaceSelector({onChange:e,className:t,trigger:s,placement:n="top"}){const{data:o,isFetched:i,isFetching:a}=useUserWorkspaces(),{setWorkspaceId:l}=useActiveWorkspaceId(),u=useActiveWorkspace(),[c,x]=reactExports.useState(!1),{hasPermission:d}=useAuth();return reactExports.useEffect(()=>{i&&!a&&!u&&l(PersonalWorkspace.id)},[u,o,l,i,a]),!s&&(!u||!d("workspaces.create")&&(o==null?void 0:o.length)===1)?null:jsxRuntimeExports.jsx(reactExports.Fragment,{children:jsxRuntimeExports.jsxs(DialogTrigger,{type:"popover",placement:n,isOpen:c,onClose:()=>{x(!1)},children:[s?reactExports.cloneElement(s,{onClick:()=>x(!c)}):jsxRuntimeExports.jsx(DefaultTrigger,{onClick:()=>x(!c),workspace:u,className:t}),jsxRuntimeExports.jsx(Dialog,{size:"min-w-320",children:jsxRuntimeExports.jsxs(DialogBody,{padding:"p-10",children:[jsxRuntimeExports.jsx("div",{className:"mb-16 border-b pb-10",children:o==null?void 0:o.map(p=>jsxRuntimeExports.jsx(WorkspaceItem,{workspace:p,setSelectorIsOpen:x,onChange:e},p.id))}),jsxRuntimeExports.jsx("div",{className:"mb-4 px-4 text-center",children:jsxRuntimeExports.jsx(CreateWorkspaceButton,{onClick:()=>x(!1),onCreated:p=>e==null?void 0:e(p),workspaceCount:o?o.length-1:0})})]})})]})})}function CreateWorkspaceButton({onClick:e,onCreated:t,workspaceCount:s}){const{setWorkspaceId:n}=useActiveWorkspaceId(),{checkOverQuotaOrNoPermission:o}=useAuth(),{overQuotaOrNoPermission:i}=o("workspaces.create","count",s);return jsxRuntimeExports.jsxs(reactExports.Fragment,{children:[jsxRuntimeExports.jsx(Button,{disabled:i,onClick:async a=>{a.preventDefault(),a.stopPropagation(),e();const l=await openDialog(NewWorkspaceDialog);l&&(n(l),t==null||t(l))},variant:"outline",startIcon:jsxRuntimeExports.jsx(AddIcon,{}),color:"primary",className:"h-40 w-full",children:jsxRuntimeExports.jsx(Trans,{message:"Create new workspace"})}),i&&jsxRuntimeExports.jsx(PolicyFailMessage,{size:"sm",className:"mt-12 max-w-288",resourceName:jsxRuntimeExports.jsx(Trans,{message:"worksapces"})})]})}const DefaultTrigger=reactExports.forwardRef(({workspace:e,className:t,onClick:s,...n},o)=>jsxRuntimeExports.jsxs(ButtonBase,{ref:o,onClick:s,className:clsx("flex items-center gap-10 rounded ring-inset hover:bg-hover focus-visible:ring-2",t),...n,children:[jsxRuntimeExports.jsxs("span",{className:"mr-auto block flex-auto overflow-hidden text-left",children:[jsxRuntimeExports.jsx("span",{className:"block overflow-hidden overflow-ellipsis text-sm font-medium text-main",children:e.default?jsxRuntimeExports.jsx(Trans,{message:e.name}):e.name}),jsxRuntimeExports.jsx("span",{className:"block text-xs text-muted",children:e.default?jsxRuntimeExports.jsx(Trans,{message:"Personal workspace"}):jsxRuntimeExports.jsx(Trans,{message:":count members",values:{count:e.members_count}})})]}),jsxRuntimeExports.jsx(UnfoldMoreIcon,{className:"shrink-0 icon-md"})]}));function WorkspaceItem({workspace:e,onChange:t,setSelectorIsOpen:s}){const{workspaceId:n,setWorkspaceId:o}=useActiveWorkspaceId(),i=n===e.id;return jsxRuntimeExports.jsxs("div",{onClick:()=>{o(e.id),t==null||t(e.id),s(!1)},className:clsx("mb-4 flex cursor-pointer items-center gap-12 rounded-lg p-10 text-left",i&&"bg-primary/5",!i&&"hover:bg-hover"),children:[jsxRuntimeExports.jsx(CheckIcon,{size:"sm",className:clsx("flex-shrink-0 text-primary",!i&&"invisible")}),jsxRuntimeExports.jsxs("div",{className:"flex-auto",children:[jsxRuntimeExports.jsx("div",{className:clsx("text-sm",i&&"font-semibold"),children:e.name}),jsxRuntimeExports.jsx("div",{className:"text-sm text-muted",children:e.default?jsxRuntimeExports.jsx(Trans,{message:"Personal workspace"}):jsxRuntimeExports.jsx(Trans,{message:":count members",values:{count:e.members_count}})})]}),e.id!==0&&jsxRuntimeExports.jsx(ManageButton,{setSelectorIsOpen:s,workspace:e,onChange:t})]})}function LeaveWorkspaceDialog({workspace:e,onChange:t}){const s=useRemoveMember(),{user:n}=useAuth(),{close:o}=useDialogContext();return jsxRuntimeExports.jsx(LeaveWorkspaceConfirmation,{isLoading:s.isPending,onConfirm:()=>{s.mutate({workspaceId:e.id,memberId:n.id,memberType:"member"},{onSuccess:()=>{o(),t==null||t(PersonalWorkspace.id)}})}})}function DeleteWorkspaceConfirmation({workspace:e,onChange:t}){const s=useDeleteWorkspace(),{close:n}=useDialogContext();return jsxRuntimeExports.jsx(ConfirmationDialog,{isDanger:!0,title:jsxRuntimeExports.jsx(Trans,{message:"Delete workspace"}),body:jsxRuntimeExports.jsx(Trans,{message:"Are you sure you want to delete “:name“?",values:{name:e.name}}),confirm:jsxRuntimeExports.jsx(Trans,{message:"Delete"}),isLoading:s.isPending,onConfirm:()=>{s.mutate({id:e.id},{onSuccess:()=>{n(),t==null||t(PersonalWorkspace.id)}})}})}function ManageButton({setSelectorIsOpen:e,workspace:t,onChange:s}){const{user:n}=useAuth();return jsxRuntimeExports.jsxs(MenuTrigger,{onItemSelected:()=>e(!1),children:[jsxRuntimeExports.jsx(Button,{onClick:o=>{o.preventDefault(),o.stopPropagation()},color:"primary",size:"xs",variant:"outline",endIcon:jsxRuntimeExports.jsx(KeyboardArrowDownIcon,{}),children:jsxRuntimeExports.jsx(Trans,{message:"Manage"})}),jsxRuntimeExports.jsxs(Menu,{children:[jsxRuntimeExports.jsx(Item,{onClick:o=>{o.stopPropagation(),openDialog(WorkspaceMembersDialog,{workspace:t})},value:"workspaceMembers",startIcon:jsxRuntimeExports.jsx(PersonAddIcon,{}),children:jsxRuntimeExports.jsx(Trans,{message:"Members"})}),t.owner_id===(n==null?void 0:n.id)&&jsxRuntimeExports.jsx(Item,{onClick:o=>{o.stopPropagation(),openDialog(RenameWorkspaceDialog,{workspace:t})},value:"updateWorkspace",startIcon:jsxRuntimeExports.jsx(EditIcon,{}),children:jsxRuntimeExports.jsx(Trans,{message:"Rename"})}),t.owner_id!==(n==null?void 0:n.id)&&jsxRuntimeExports.jsx(Item,{onClick:o=>{o.stopPropagation(),openDialog(LeaveWorkspaceDialog,{workspace:t,onChange:s})},value:"leaveWorkspace",startIcon:jsxRuntimeExports.jsx(ExitToAppIcon,{}),children:jsxRuntimeExports.jsx(Trans,{message:"Leave"})}),t.owner_id===(n==null?void 0:n.id)&&jsxRuntimeExports.jsx(Item,{onClick:o=>{o.stopPropagation(),openDialog(DeleteWorkspaceConfirmation,{workspace:t,onChange:s})},value:"deleteWorkspace",startIcon:jsxRuntimeExports.jsx(DeleteIcon,{}),children:jsxRuntimeExports.jsx(Trans,{message:"Delete"})})]})]})}const addFilesSvg=""+new URL("add-files-107c40dd.svg",import.meta.url).href,timeManagement=""+new URL("time-management-5219b76e.svg",import.meta.url).href,fileSearching=""+new URL("file-searching-49556098.svg",import.meta.url).href,throwAwaySvg=""+new URL("throw-away-389510cc.svg",import.meta.url).href,lovingItSvg=""+new URL("loving-it-585c130e.svg",import.meta.url).href,shareSvg=""+new URL("share-70babf29.svg",import.meta.url).href,defaultSortDescriptor={orderBy:"updated_at",orderDir:"desc"};function makeFolderPage(e){return{...makePartialFolderPage(e.hash),canUpload:e.permissions["files.create"]||e.permissions["files.update"],label:e.name,folder:e}}function makePartialFolderPage(e){return{name:"folder",uniqueId:e,label:"",path:getPathForFolder(e),hasActions:!0,canUpload:!1,sortDescriptor:defaultSortDescriptor,isFolderPage:!0,noContentMessage:()=>({title:message("Drop files or folders here"),description:message('Or use the "Upload" button'),image:addFilesSvg})}}function getPathForFolder(e){return e==="0"?"/drive":`/drive/folders/${e}`}const rootFolder=getBootstrapData().rootFolder,RootFolderPage={...makeFolderPage(rootFolder),name:"home"},RecentPage={name:"recent",uniqueId:"recent",label:message("Recent"),path:"/drive/recent",disableSort:!0,sortDescriptor:{orderBy:"created_at",orderDir:"desc"},queryParams:{recentOnly:!0},noContentMessage:()=>({title:message("No recent entries"),description:message("You have not uploaded any files or folders yet"),image:timeManagement})},SearchPage={name:"search",uniqueId:"search",label:message("Search results"),path:"/drive/search",sortDescriptor:defaultSortDescriptor,noContentMessage:e=>e?{title:message("No matching results"),description:message("Try changing your search query or filters"),image:fileSearching}:{title:message("Begin typing or select a filter to search"),description:message("Search for files, folders and other content"),image:fileSearching}},SharesPage={name:"sharedWithMe",uniqueId:"sharedWithMe",label:message("Shared"),path:"/drive/shares",sortDescriptor:defaultSortDescriptor,queryParams:{sharedOnly:!0},noContentMessage:()=>({title:message("Shared with me"),description:message("Files and folders other people have shared with you"),image:shareSvg})},TrashPage={name:"trash",uniqueId:"trash",label:message("Trash"),path:"/drive/trash",sortDescriptor:defaultSortDescriptor,hasActions:!0,queryParams:{deletedOnly:!0},noContentMessage:()=>({title:message("Trash is empty"),description:message("There are no files or folders in your trash currently"),image:throwAwaySvg})},StarredPage={name:"starred",uniqueId:"starred",label:message("Starred"),path:"/drive/starred",sortDescriptor:defaultSortDescriptor,queryParams:{starredOnly:!0},noContentMessage:()=>({title:message("Nothing is starred"),description:message("Add stars to files and folders that you want to easily find later"),image:lovingItSvg})},DRIVE_PAGES=[RootFolderPage,RecentPage,SearchPage,SharesPage,TrashPage,StarredPage];let MenuPositions=function(e){return e.DriveSidebar="drive-sidebar",e}({});var arrayToTree_min={};(function(e){var t=commonjsGlobal&&commonjsGlobal.__assign||function(){return(t=Object.assign||function(a){for(var l,u=1,c=arguments.length;u<c;u++)for(var x in l=arguments[u])Object.prototype.hasOwnProperty.call(l,x)&&(a[x]=l[x]);return a}).apply(this,arguments)},s=(Object.defineProperty(e,"__esModule",{value:!0}),{id:"id",parentId:"parentId",dataField:"data",childrenField:"children",throwIfOrphans:!1,rootParentIds:{"":!(e.countNodes=e.arrayToTree=void 0)},nestedIds:!0,assign:!1});function n(a,l){l===void 0&&(l={});for(var u,c=t(t({},s),l),x=[],d={},p=c.throwIfOrphans?new Set:null,h=0,g=a;h<g.length;h++){var j=g[h],f=c.nestedIds?i(j,c.id):j[c.id],v=c.nestedIds?i(j,c.parentId):j[c.parentId];if(c.rootParentIds[f])throw new Error("The item array contains a node whose parentId both exists in another node and is in "+'`rootParentIds` (`itemId`: "'.concat(f,'", `rootParentIds`: ').concat(Object.keys(c.rootParentIds).map(function(R){return'"'.concat(R,'"')}).join(", "),")."));Object.prototype.hasOwnProperty.call(d,f)||(d[f]=((u={})[c.childrenField]=[],u)),p&&p.delete(f),c.dataField?d[f][c.dataField]=j:c.assign?d[f]=Object.assign(j,((u={})[c.childrenField]=d[f][c.childrenField],u)):d[f]=t(t({},j),((j={})[c.childrenField]=d[f][c.childrenField],j)),j=d[f],v==null||c.rootParentIds[v]?x.push(j):(Object.prototype.hasOwnProperty.call(d,v)||(d[v]=((f={})[c.childrenField]=[],f),p&&p.add(v)),d[v][c.childrenField].push(j))}if(p!=null&&p.size)throw new Error("The items array contains orphans that point to the following parentIds: "+"[".concat(Array.from(p),"]. These parentIds do not exist in the items array. Hint: prevent orphans to result ")+"in an error by passing the following option: { throwIfOrphans: false }");if(c.throwIfOrphans&&o(x,c.childrenField)<Object.keys(d).length)throw new Error("The items array contains nodes with a circular parent/child relationship.");return x}function o(a,l){return a.reduce(function(u,c){return u+1+(c[l]&&o(c[l],l))},0)}function i(a,l){return l.split(".").reduce(function(u,c){return u&&u[c]},a)}e.arrayToTree=n,e.countNodes=o})(arrayToTree_min);function fetchUserFolders(e){return apiClient.get(`users/${e.userId}/folders`,{params:e}).then(t=>t.data)}function useFolders(){const{user:e}=useAuth(),{workspaceId:t}=useActiveWorkspaceId(),s={userId:e.id,workspaceId:t};return useQuery({queryKey:DriveQueryKeys.fetchUserFolders(s),queryFn:()=>fetchUserFolders(s),enabled:!!e})}function useMoveEntries(){return useMutation({mutationFn:e=>(toast.loading(message("Moving [one 1 item|other :count items]...",{values:{count:e.entryIds.length}}),{disableExitAnimation:!0}),moveEntries(e)),onSuccess:(e,t)=>{invalidateEntryQueries(),toast(message('Moved [one 1 item|other :count items] to ":destination"',{values:{count:t.entryIds.length,destination:(e.destination||RootFolderPage.folder).name}}),{disableEnterAnimation:!0})},onError:e=>showHttpErrorToast(e,message("Could not move items"),null,{disableEnterAnimation:!0})})}function moveEntries(e){return e.destinationId=e.destinationId?e.destinationId:null,apiClient.post("file-entries/move",e).then(t=>t.data)}function canMoveEntriesInto(e,t){return t.type!=="folder"||!t.permissions["files.update"]&&!e.every(s=>s.permissions["files.update"])?!1:e.every(s=>!s||t.id===s.parent_id||!s.parent_id&&t.id===0?!1:!destinationIsInTarget(t,s))}function destinationIsInTarget(e,t){const s=(e.path||"").split("/");return(t.path||"").split("/").every((o,i)=>s[i]===o)}function useFolderDropAction(e){const t=useMoveEntries(),{uploadFiles:s}=useDriveUploadQueue();return{onDrop:async o=>{if(e.type==="folder"){if(o.type==="nativeFile")s(await o.getData(),{metadata:{parentId:e.id}});else if(o.type==="fileEntry"){const i=o.getData();i!=null&&i.length&&canMoveEntriesInto(i,e)&&(t.mutate({destinationId:e.id,entryIds:i.map(a=>a.id)}),driveState().deselectEntries("all"))}}}}}function folderAcceptsDrop(e,t){if(e.type==="fileEntry"){const s=e.getData();return canMoveEntriesInto(s,t)}return!0}function makeFolderTreeDragId(e){return`${e.id}-tree`}function isFolderTreeDragId(e){return`${e}`.endsWith("-tree")}function useSidebarTreeDropTarget({folder:e,ref:t}){const[s,n]=reactExports.useState(!1),{onDrop:o}=useFolderDropAction(e);return{...useDroppable({id:makeFolderTreeDragId(e),ref:t,types:["fileEntry","nativeFile"],acceptsDrop:a=>folderAcceptsDrop(a,e),onDragEnter:a=>{folderAcceptsDrop(a,e)&&n(!0)},onDragLeave:()=>{n(!1)},onDropActivate:()=>{driveState().sidebarExpandedKeys.includes(e.id)||driveState().setSidebarExpandedKeys([...driveState().sidebarExpandedKeys,e.id])},onDrop:o}),isDragOver:s}}const TreeContext=reactExports.createContext(null);function renderTree({nodes:e,itemRenderer:t,parentNode:s,level:n}){return e.map((o,i)=>reactExports.cloneElement(t(o),{level:n==null?0:n+1,index:i,node:o,parentNode:s,key:o.id,itemRenderer:t}))}function Tree({children:e,nodes:t,...s}){const[n,o]=$458b0a5536c1a7cf$export$40bfa8c7b0832715(s.expandedKeys,s.defaultSelectedKeys,s.onExpandedKeysChange),[i,a]=$458b0a5536c1a7cf$export$40bfa8c7b0832715(s.selectedKeys,s.defaultSelectedKeys,s.onSelectedKeysChange),[l,u]=reactExports.useState(),c={expandedKeys:n,setExpandedKeys:o,selectedKeys:i,setSelectedKeys:a,focusedNode:l,setFocusedNode:u};return jsxRuntimeExports.jsx(TreeContext.Provider,{value:c,children:jsxRuntimeExports.jsx($9bf71ea28793e738$export$20e40289641fbbb6,{children:jsxRuntimeExports.jsx(TreeRoot,{nodes:t,itemRenderer:e})})})}function TreeRoot(e){return jsxRuntimeExports.jsx("ul",{className:"overflow-hidden text-sm",role:"tree",children:renderTree(e)})}const TreeLabel=reactExports.forwardRef(({icon:e,label:t,level:s=0,node:n,className:o,...i},a)=>{const{expandedKeys:l,setExpandedKeys:u,selectedKeys:c,setSelectedKeys:x}=reactExports.useContext(TreeContext),d=l.includes(n.id),p=c.includes(n.id),h=g=>{g.stopPropagation();const j=l.indexOf(n.id),f=[...l];j>-1?f.splice(j,1):f.push(n.id),u(f)};return jsxRuntimeExports.jsxs("div",{...i,ref:a,onClick:g=>{g.stopPropagation(),x([n.id])},className:clsx("header tree-label flex cursor-pointer flex-nowrap items-center gap-4 overflow-hidden text-ellipsis whitespace-nowrap rounded py-6",o,p&&"bg-primary/selected font-bold text-primary",!p&&"hover:bg-hover"),children:[s>0&&jsxRuntimeExports.jsx("div",{className:"flex",children:Array.from({length:s}).map((g,j)=>jsxRuntimeExports.jsx("div",{className:"h-24 w-24"},j))}),jsxRuntimeExports.jsx("div",{onClick:h,children:jsxRuntimeExports.jsx(ArrowRightIcon,{className:clsx("cursor-default transition-transform icon-sm",d&&"rotate-90")})}),e,jsxRuntimeExports.jsx("div",{className:"overflow-hidden text-ellipsis pr-6",children:t})]})});TreeLabel.displayName="TreeLabel";function TreeItem({label:e,icon:t,node:s,level:n,index:o,itemRenderer:i,labelRef:a,labelClassName:l,className:u,parentNode:c,...x}){const d=$9bf71ea28793e738$export$10c5169755ce7bd7(),{expandedKeys:p,selectedKeys:h,focusedNode:g,setFocusedNode:j,setExpandedKeys:f,setSelectedKeys:v}=reactExports.useContext(TreeContext);if(reactExports.useEffect(()=>()=>{g===(s==null?void 0:s.id)&&j(void 0)},[g,s==null?void 0:s.id,j]),!s||!i)return null;const R=s.children.length,E=R&&p.includes(s.id),b=h.includes(s.id),I=n===0&&o===0,S=g==null?I:g===s.id,P=y=>{var w,F;if(g!=null)switch(y.key){case"Enter":case" ":y.stopPropagation(),y.preventDefault(),v([g]);break;case"ArrowRight":if(y.stopPropagation(),y.preventDefault(),!R)return;E?d==null||d.focusNext():f([...p,g]);break;case"ArrowLeft":if(y.stopPropagation(),y.preventDefault(),E){const D=p.indexOf(g),T=[...p];T.splice(D,1),f(T)}else if(c){const D=(F=(w=document.activeElement)==null?void 0:w.parentElement)==null?void 0:F.closest("[tabindex]");D&&D.focus()}break;case"ArrowDown":y.stopPropagation(),y.preventDefault(),d==null||d.focusNext();break;case"ArrowUp":y.stopPropagation(),y.preventDefault(),d==null||d.focusPrevious();break;case"Home":y.stopPropagation(),y.preventDefault(),d==null||d.focusFirst();break;case"End":y.stopPropagation(),y.preventDefault(),d==null||d.focusLast();break;case"*":if(y.stopPropagation(),y.preventDefault(),c!=null&&c.children){const D=[...p];c.children.forEach(T=>{T.children.length&&!p.includes(T.id)&&D.push(T.id)}),D.length!==p.length&&f(D)}break}};return jsxRuntimeExports.jsxs("li",{role:"treeitem","aria-expanded":E?"true":"false","aria-selected":b,tabIndex:S?0:-1,onKeyDown:createEventHandler(P),onFocus:y=>{y.stopPropagation(),j(s.id)},onBlur:y=>{y.stopPropagation(),y.currentTarget.contains(y.relatedTarget)||j(void 0)},className:clsx("outline-none","[&>.tree-label]:focus-visible:ring [&>.tree-label]:focus-visible:ring-2 [&>.tree-label]:focus-visible:ring-inset",u),children:[jsxRuntimeExports.jsx(TreeLabel,{ref:a,className:l,node:s,level:n,label:e,icon:t,...x}),jsxRuntimeExports.jsx(AnimatePresence,{initial:!1,children:E?jsxRuntimeExports.jsx(m.ul,{role:"group",initial:"closed",animate:"open",exit:"closed",variants:{open:{opacity:1,height:"auto"},closed:{opacity:0,height:0,overflow:"hidden"}},children:renderTree({nodes:s.children,parentNode:s,itemRenderer:i,level:n})},`${s.id}-group`):null})]})}function FolderTree(){const e=useNavigate(),{data:t}=useFolders(),s=useDriveStore(a=>a.sidebarExpandedKeys),n=useDriveStore(a=>a.activePage);let o=[];n!=null&&n.isFolderPage&&(o=n.folder?[n.folder.id]:[]);const i=reactExports.useMemo(()=>{const a=arrayToTree_min.arrayToTree((t==null?void 0:t.folders)||[],{parentId:"parent_id",dataField:null});return[{...RootFolderPage.folder,children:a}]},[t==null?void 0:t.folders]);return jsxRuntimeExports.jsx(Tree,{nodes:i,expandedKeys:s,onExpandedKeysChange:a=>{driveState().setSidebarExpandedKeys(a)},selectedKeys:o,onSelectedKeysChange:([a])=>{const l=findHash(a,i);e(l?getPathForFolder(l):RootFolderPage.path)},children:()=>jsxRuntimeExports.jsx(FolderTreeItem,{})})}function FolderTreeItem(e){const{node:t}=e,s=reactExports.useRef(null),n=t.id===0,o=useDriveStore(u=>u.entriesBeingDragged.includes(t.id)),{draggableProps:i}=useDraggable({type:"fileEntry",id:makeFolderTreeDragId(t),ref:s,disabled:n,hidePreview:!0,onDragStart:(u,c)=>{const x=c;driveState().setEntriesBeingDragged(x.getData().map(d=>d.id)),driveState().selectEntries([])},onDragEnd:()=>{driveState().setEntriesBeingDragged([])},getData:()=>[t]}),{droppableProps:a,isDragOver:l}=useSidebarTreeDropTarget({folder:t,ref:s});return jsxRuntimeExports.jsx(TreeItem,{...$3ef42575df84b30b$export$9d1611c77c2fe928(i,a,e),onContextMenu:u=>{u.preventDefault(),u.stopPropagation(),driveState().deselectEntries("all"),driveState().setContextMenuData({x:u.clientX,y:u.clientY,entry:t})},labelRef:s,className:n?"focus-visible:ring-2":void 0,labelClassName:clsx(l&&"bg-primary/selected ring ring-2 ring-inset ring-primary",o&&"opacity-30",n&&"h-40"),icon:n?jsxRuntimeExports.jsx(BackupIcon,{size:"md",className:"mr-6"}):jsxRuntimeExports.jsx(FolderIcon,{size:"sm",className:"mr-4"}),label:t.name})}const findHash=(e,t)=>{for(const s of t){if(s.id===e)return s.hash;if(s.children){const n=findHash(e,s.children);if(n)return n}}};function deleteEntries(e){return apiClient.post("file-entries/delete",e).then(t=>t.data)}function useDeleteEntries(){return useMutation({mutationFn:e=>(toast.loading(getLoaderMessage(e),{disableExitAnimation:!0}),deleteEntries(e)),onSuccess:(e,{entryIds:t,emptyTrash:s,deleteForever:n})=>{invalidateEntryQueries(),queryClient.invalidateQueries({queryKey:DriveQueryKeys.fetchStorageSummary}),s?toast(message("Emptied trash"),{disableEnterAnimation:!0}):n?toast(message("Permanently deleted [one 1 item|other :count items]",{values:{count:t.length}}),{disableEnterAnimation:!0}):toast(message("Moved [one 1 item|other :count items] to trash",{values:{count:t.length}}),{disableEnterAnimation:!0})},onError:(e,{emptyTrash:t})=>{const s=getAxiosErrorMessage(e);s?toast.danger(s,{disableEnterAnimation:!0}):t?toast.danger("could not empty trash",{disableEnterAnimation:!0}):toast.danger("Could not delete items",{disableEnterAnimation:!0})}})}function getLoaderMessage(e){return e.emptyTrash?message("Emptying trash..."):e.deleteForever?message("Deleting files..."):message("Moving to trash...")}function SidebarMenu(){return jsxRuntimeExports.jsxs("div",{className:"mt-2 px-2 text-muted",children:[jsxRuntimeExports.jsx(FolderTree,{}),jsxRuntimeExports.jsx(CustomMenu,{menu:MenuPositions.DriveSidebar,orientation:"vertical",gap:"gap-0",children:e=>e.action==="/drive/trash"?jsxRuntimeExports.jsx(TrashMenuItem,{item:e},e.id):jsxRuntimeExports.jsx(MenuItem,{item:e},e.id)})]})}const MenuItem=reactExports.forwardRef(({item:e,className:t,...s},n)=>jsxRuntimeExports.jsx(CustomMenuItem,{className:({isActive:o})=>clsx(t,"my-4 h-40 w-full rounded px-24",o?"cursor-default bg-primary/selected font-bold text-primary":"hover:bg-hover"),item:e,ref:n,...s}));function TrashMenuItem({item:e}){const t=useDeleteEntries(),[s,n]=reactExports.useState(!1),o=reactExports.useRef(null),{droppableProps:i}=useDroppable({id:"trash",types:["fileEntry"],ref:o,onDragEnter:()=>{n(!0)},onDragLeave:()=>{n(!1)},onDrop:a=>{const l=a.getData().map(u=>u.id);t.mutate({entryIds:l,deleteForever:!1})}});return jsxRuntimeExports.jsx(MenuItem,{className:clsx(s&&"bg-primary/selected"),ref:o,...i,item:e})}function CreateNewButton({isCompact:e,className:t}){const s=useDriveStore(i=>i.activePage),{uploadFiles:n}=useDriveUploadQueue(),o=e?jsxRuntimeExports.jsx(IconButton,{size:"md",disabled:!(s!=null&&s.canUpload),children:jsxRuntimeExports.jsx(AddIcon,{})}):jsxRuntimeExports.jsx(Button,{color:"primary",variant:"flat",size:"sm",startIcon:jsxRuntimeExports.jsx(FileUploadIcon,{}),disabled:!(s!=null&&s.canUpload),children:jsxRuntimeExports.jsx(Trans,{message:"Upload"})});return jsxRuntimeExports.jsx("div",{className:t,children:jsxRuntimeExports.jsxs(MenuTrigger,{onItemSelected:async i=>{var a;if(i==="uploadFiles")n(await openUploadWindow({multiple:!0}));else if(i==="uploadFolder")n(await openUploadWindow({directory:!0}));else if(i==="newFolder"){const l=(a=driveState().activePage)==null?void 0:a.folder;driveState().setActiveActionDialog("newFolder",l?[l]:[])}},children:[o,jsxRuntimeExports.jsxs(Menu,{children:[jsxRuntimeExports.jsx(Item,{value:"uploadFiles",startIcon:jsxRuntimeExports.jsx(UploadFileIcon,{}),children:jsxRuntimeExports.jsx(Trans,{message:"Upload files"})}),jsxRuntimeExports.jsx(Item,{value:"uploadFolder",startIcon:jsxRuntimeExports.jsx(DriveFolderUploadIcon,{}),children:jsxRuntimeExports.jsx(Trans,{message:"Upload folder"})}),jsxRuntimeExports.jsx(Item,{value:"newFolder",startIcon:jsxRuntimeExports.jsx(CreateNewFolderIcon,{}),children:jsxRuntimeExports.jsx(Trans,{message:"Create folder"})})]})]})})}function Sidebar({className:e}){const{isSubscribed:t}=useAuth(),{billing:s}=useSettings();return jsxRuntimeExports.jsxs("div",{className:clsx(e,"flex flex-col gap-20 border-r bg-alt text-sm font-medium text-muted"),children:[jsxRuntimeExports.jsxs("div",{className:"compact-scrollbar flex-auto overflow-y-auto",children:[jsxRuntimeExports.jsx(CreateNewButton,{className:"px-2 pt-2 text-center"}),jsxRuntimeExports.jsx(SidebarMenu,{}),jsxRuntimeExports.jsx(StorageMeter,{}),s.enable?jsxRuntimeExports.jsx("div",{className:"mt-2 pl-60",children:jsxRuntimeExports.jsx(Button,{elementType:Link,to:t?"/billing/change-plan":"/pricing",variant:"outline",color:"primary",size:"xs",children:jsxRuntimeExports.jsx(Trans,{message:"Upgrade"})})}):null]}),jsxRuntimeExports.jsx(WorkspaceSwitcher,{})]})}function WorkspaceSwitcher(){const e=useNavigate();return jsxRuntimeExports.jsx(WorkspaceSelector,{onChange:()=>{e(RootFolderPage.path)},className:"mt-auto w-full flex-shrink-0 border-t px-24 py-18"})}function fetchEntries$2(e){return apiClient.get("drive/file-entries",{params:e}).then(t=>t.data)}const setActiveFolder=e=>{var o;const s=e.pages[0].folder,n=driveState().activePage;return s&&n&&n.uniqueId===s.hash&&(!n.folder||!shallowEqual(s.permissions,(o=n.folder)==null?void 0:o.permissions))&&driveState().setActivePage(makeFolderPage(s)),e};function usePaginatedEntries(){const e=useDriveStore(l=>l.activePage),t=useDriveStore(l=>l.sortDescriptor),[s]=useSearchParams(),{workspaceId:n}=useActiveWorkspaceId(),o={section:e==null?void 0:e.name,...e==null?void 0:e.queryParams,...Object.fromEntries(s),folderId:e!=null&&e.isFolderPage?e.uniqueId:null,workspaceId:n,...t},i=e===SearchPage&&!o.query&&!o.filters,a=useInfiniteQuery({queryKey:DriveQueryKeys.fetchEntries(o),queryFn:({pageParam:l=1})=>fetchEntries$2({...o,page:l}),initialPageParam:1,getNextPageParam:l=>{const u=l.current_page;if(hasNextPage$1(l))return u+1},enabled:e!=null&&!i});return reactExports.useEffect(()=>{var l;(l=a.data)!=null&&l.pages[0].folder&&setActiveFolder(a.data)},[a.data]),a}function getAllEntries(){return queryClient.getQueriesData({queryKey:DriveQueryKeys.fetchEntries()}).reduce((t,s)=>{const n=s[1]?s[1].pages.flatMap(o=>o.data):[];return[...t,...n]},[])}const driveSearchFilters=[FILE_ENTRY_TYPE_FILTER,{key:"owner_id",label:message("Owner"),description:message("User file was uploaded by"),defaultOperator:FilterOperator.eq,control:{type:FilterControlType.Select,defaultValue:"02",options:[{key:"01",label:message("anyone"),value:{value:null,operator:"!="}},{key:"02",label:message("me"),value:"{authId}"},{key:"03",label:message("not me"),value:{value:"{authId}",operator:"!="}}]}},createdAtFilter({description:message("Date file was uploaded")}),updatedAtFilter({description:message("Date file was last changed")}),{key:"deleted_at",label:message("In trash"),description:message("Only show files that are in the trash"),defaultOperator:FilterOperator.ne,control:{type:FilterControlType.BooleanToggle,defaultValue:null}},{key:"shareableLink",label:message("Has shareable link"),description:message("Only show files that have a shareable link"),defaultOperator:FilterOperator.has,control:{type:FilterControlType.BooleanToggle,defaultValue:"*"}},{control:{type:FilterControlType.BooleanToggle,defaultValue:!0},key:"sharedByMe",label:message("Shared by me"),description:message("Only show files that are shared with someone"),defaultOperator:FilterOperator.eq}],DashboardLayoutContext=reactExports.createContext(null),alwaysShownFilters=driveSearchFilters.map(e=>e.key);function SearchFilterList(){const e=useDriveStore(l=>l.activePage),{isMobileMode:t}=reactExports.useContext(DashboardLayoutContext),{trans:s}=useTrans(),n=useNavigate(),[o]=useSearchParams(),[i,a]=reactExports.useState(o.get("query")||"");return e!==SearchPage?null:jsxRuntimeExports.jsxs("div",{className:"mb-30 mt-10 px-10 md:px-26",children:[t&&jsxRuntimeExports.jsx("form",{className:"contents",onSubmit:l=>{var u;l.preventDefault(),((u=document.activeElement)==null?void 0:u.tagName)==="INPUT"&&document.activeElement.blur(),n({pathname:SearchPage.path,search:`?query=${i}`},{replace:!0})},children:jsxRuntimeExports.jsx(TextField,{autoFocus:!0,className:"mb-20",startAdornment:jsxRuntimeExports.jsx(IconButton,{type:"submit",children:jsxRuntimeExports.jsx(SearchIcon,{})}),placeholder:s(message("Type to search")),value:i,onChange:l=>a(l.target.value)})}),jsxRuntimeExports.jsx(FilterList,{filters:driveSearchFilters,pinnedFilters:alwaysShownFilters})]})}function restrictResizableWithinBoundary(e,t){const s={...e};s.left=Math.max(0,s.left);const n=s.left-e.left;n>0&&(s.width-=n),s.top=Math.max(0,s.top);const o=s.top-e.top;return o>0&&(s.height-=o),s.width=Math.min(s.width,t.width-s.left),s.height=Math.min(s.height,t.height-s.top),s}const mouseSelectables=new Map;function useMouseSelectable(e){const{id:t,ref:s}=e,n=reactExports.useRef(e);n.current=e,reactExports.useLayoutEffect(()=>{if(s.current)return mouseSelectables.set(t,{...mouseSelectables.get(t),id:t,ref:s,onSelected:()=>{var o,i;(i=(o=n.current).onSelected)==null||i.call(o)},onDeselected:()=>{var o,i;return(i=(o=n.current).onDeselected)==null?void 0:i.call(o)}}),()=>{droppables.delete(t)}},[t,n,s])}function rectsIntersect(e,t){return!e||!t?!1:e.left<=t.left+t.width&&e.left+e.width>=t.left&&e.top<=t.top+t.height&&e.top+e.height>=t.top}function useMouseSelectionBox({onPointerDown:e,...t}={}){const s=reactExports.useRef(null),n=t.containerRef||s,o=reactExports.useRef(null);let i=reactExports.useRef({}).current;const a=()=>{var v,R,E,b,I,S,P;if(i.rafId&&cancelAnimationFrame(i.rafId),!i.startPoint||!i.endPoint||!i.boundaryRect)return;const u=i.startPoint,c=i.endPoint,x=u.scrollTop||0,d=((v=n.current)==null?void 0:v.scrollTop)||0,p={left:Math.min(u.x,c.x),top:Math.min(u.y,c.y),width:Math.abs(u.x-c.x),height:Math.abs(u.y-c.y)};p.left-=i.boundaryRect.left,p.top-=i.boundaryRect.top,p.top+=x;const h=d-x,g=Math.abs(h);h<0&&(p.top-=g),p.height+=g;const j=i.boundaryRect?restrictResizableWithinBoundary(p,i.boundaryRect):{...p};o.current&&(i.rafId=requestAnimationFrame(()=>{o.current&&(o.current.style.display="block",o.current.style.transform=`translate(${j.left}px, ${j.top}px)`,o.current.style.width=`${j.width}px`,o.current.style.height=`${j.height}px`),i.rafId=void 0}));const f={...j,left:j.left+i.boundaryRect.left,top:j.top+i.boundaryRect.top-d};for(const[,y]of mouseSelectables){const w=rectsIntersect(y.rect,f);w&&!((R=i.selectedIds)!=null&&R.has(y.id))?((E=i.selectedIds)==null||E.add(y.id),(b=y.onSelected)==null||b.call(y)):!w&&((I=i.selectedIds)!=null&&I.has(y.id))&&((S=i.selectedIds)==null||S.delete(y.id),(P=y.onDeselected)==null||P.call(y))}};return{containerProps:{...usePointerEvents({minimumMovement:4,onPointerDown:e,onMoveStart:u=>{if(activeInteraction)return!1;updateRects(mouseSelectables),i={selectedIds:new Set};const c=n.current;if(i.startPoint={x:u.clientX,y:u.clientY,scrollTop:(c==null?void 0:c.scrollTop)||0},i.scrollListener=x=>{var d;i.startPoint&&(updateRects(mouseSelectables),(d=i.boundaryRect)!=null&&d.height&&(i.boundaryRect.height=x.target.scrollHeight),a())},c){const x=c.getBoundingClientRect();c.addEventListener("scroll",i.scrollListener),i.boundaryRect={top:x.top,left:x.left,height:c.scrollHeight,heightWithoutScroll:x.height,width:c.scrollWidth}}},onMove:u=>{if(i.endPoint={x:u.clientX,y:u.clientY},i.boundaryRect&&n.current){const c=u.clientY+20>i.boundaryRect.heightWithoutScroll+i.boundaryRect.top,x=u.clientY-20<i.boundaryRect.top;c?n.current.scrollBy({top:10}):x&&n.current.scrollBy({top:-10})}a()},onMoveEnd:()=>{i.rafId&&cancelAnimationFrame(i.rafId),n.current&&i.scrollListener&&n.current.removeEventListener("scroll",i.scrollListener),o.current&&(o.current.style.display="none",o.current.style.transform="",o.current.style.width="",o.current.style.height=""),i={}}}).domProps,ref:n},boxProps:{ref:o}}}function createShareableLink(e){return e?apiClient.post(`file-entries/${e}/shareable-link`).then(t=>t.data):Promise.reject(new Error("Invalid entry id"))}function useCreateShareableLink(){return useMutation({mutationFn:({entryId:e})=>createShareableLink(e),onSuccess:(e,{entryId:t})=>{queryClient.setQueryData(DriveQueryKeys.fetchEntryShareableLink(t),e)},onError:e=>showHttpErrorToast(e,message("Could not create link"))})}function addStarToEntries({entryIds:e}){return apiClient.post("file-entries/star",{entryIds:e}).then(t=>t.data)}function useAddStarToEntries(){return useMutation({mutationFn:e=>addStarToEntries(e),onSuccess:(e,{entryIds:t})=>{invalidateEntryQueries(),toast(message("Starred [one 1 item|other :count items]",{values:{count:t.length}}))},onError:e=>showHttpErrorToast(e,message("Could not star items"))})}function removeStarFromEntries({entryIds:e}){return apiClient.post("file-entries/unstar",{entryIds:e}).then(t=>t.data)}function useRemoveStarFromEntries(){return useMutation({mutationFn:e=>removeStarFromEntries(e),onSuccess:(e,{entryIds:t})=>{invalidateEntryQueries(),toast(message("Removed star from [one 1 item|other :count items]",{values:{count:t.length}}))},onError:e=>showHttpErrorToast(e,message("Could not remove star"))})}function duplicateEntries(e){return apiClient.post("file-entries/duplicate",e).then(t=>t.data)}function useDuplicateEntries(){return useMutation({mutationFn:e=>(toast.loading(message("Duplicating [one 1 item|other :count items]...",{values:{count:e.entryIds.length}}),{disableExitAnimation:!0}),duplicateEntries(e)),onSuccess:(e,t)=>{invalidateEntryQueries(),queryClient.invalidateQueries({queryKey:DriveQueryKeys.fetchStorageSummary}),toast(message("Duplicated [one 1 item|other :count items]",{values:{count:t.entryIds.length}}),{disableEnterAnimation:!0})},onError:e=>showHttpErrorToast(e,message("Could not duplicate items"),null,{disableEnterAnimation:!0})})}function useUnshareEntries(){return useMutation({mutationFn:e=>unshareEntries(e),onSuccess:()=>invalidateEntryQueries()})}function unshareEntries({entryIds:e,...t}){return apiClient.post(`file-entries/${e.join(",")}/unshare`,t).then(s=>s.data)}function useRestoreEntries(){return useMutation({mutationFn:e=>restoreEntries(e),onSuccess:(e,t)=>{invalidateEntryQueries(),toast(message("Restored [one 1 item|other :count items]",{values:{count:t.entryIds.length}}))},onError:e=>showHttpErrorToast(e,message("Could not restore items"))})}function restoreEntries(e){return apiClient.post("file-entries/restore",e).then(t=>t.data)}function useEntryActions(e){const t=usePreviewAction(e),s=useShareAction(e),n=useGetLinkAction(e),o=useAddToStarredAction(e),i=useRemoveFromStarred(e),a=useMoveToAction(e),l=useRenameAction(e),u=useMakeCopyAction(e),c=useDownloadEntriesAction(e),x=useDeleteEntriesAction(e),d=useRemoveSharedEntriesAction(e),p=useRestoreEntriesAction(e);return[t,s,n,o,i,a,l,u,c,x,d,p].filter(h=>!!h)}function usePreviewAction(e){if(e.some(t=>t.type!=="folder"))return{label:message("Preview"),icon:RemoveRedEyeIcon,key:"preview",execute:()=>{driveState().setActiveActionDialog("preview",e)}}}function useShareAction(e){const t=useDriveStore(s=>s.activePage);if(!(e.length>1||!e.every(s=>s.permissions["files.update"])||t===TrashPage))return{label:message("Share"),icon:PersonAddIcon,key:"share",execute:()=>{driveState().setActiveActionDialog("share",e)}}}function useGetLinkAction(e){const t=useDriveStore(n=>n.activePage),s=useCreateShareableLink();if(!(e.length>1||!e.every(n=>n.permissions["files.update"])||t===TrashPage))return{label:message("Get link"),icon:LinkIcon,key:"getLink",execute:()=>{s.mutate({entryId:e[0].id}),driveState().setActiveActionDialog("getLink",e)}}}function useAddToStarredAction(e){const t=useDriveStore(n=>n.activePage),s=useAddStarToEntries();if(!(e.every(n=>{var o;return(o=n.tags)==null?void 0:o.find(i=>i.name==="starred")})||!e.every(n=>n.permissions["files.update"])||t===TrashPage))return{label:message("Add to starred"),icon:StarIcon,key:"addToStarred",execute:()=>{s.mutate({entryIds:e.map(n=>n.id)}),driveState().selectEntries([])}}}function useRemoveFromStarred(e){const t=useDriveStore(n=>n.activePage),s=useRemoveStarFromEntries();if(!(!e.every(n=>{var o;return(o=n.tags)==null?void 0:o.find(i=>i.name==="starred")})||t===TrashPage))return{label:message("Remove from starred"),icon:StarOutlineIcon,key:"removeFromStarred",execute:()=>{s.mutate({entryIds:e.map(n=>n.id)}),driveState().selectEntries([])}}}function useMoveToAction(e){const t=useDriveStore(s=>s.activePage);if(!(!e.every(s=>s.permissions["files.update"])||t===SharesPage||t===TrashPage))return{label:message("Move to"),icon:DriveFileMoveIcon,key:"moveTo",execute:()=>{driveState().setActiveActionDialog("moveTo",e)}}}function useRenameAction(e){const t=useDriveStore(s=>s.activePage);if(!(e.length>1||!e.every(s=>s.permissions["files.update"])||t===TrashPage))return{label:message("Rename"),icon:DriveFileRenameOutlineIcon,key:"rename",execute:()=>{driveState().setActiveActionDialog("rename",e)}}}function useMakeCopyAction(e){const t=useDriveStore(n=>n.activePage),s=useDuplicateEntries();if(!(e.length>1||!e.every(n=>n.permissions["files.update"])||t===TrashPage))return{label:message("Make a copy"),icon:ContentCopyIcon,key:"makeCopy",execute:()=>{var n;s.mutate({entryIds:e.map(o=>o.id),destinationId:(n=t==null?void 0:t.folder)==null?void 0:n.id}),driveState().selectEntries([])}}}function useDownloadEntriesAction(e){const{downloadUrl:t}=useFileEntryUrls(e[0],{downloadHashes:e.map(s=>s.hash)});if(e.every(s=>s.permissions["files.download"]))return{label:message("Download"),icon:FileDownloadIcon,key:"download",execute:()=>{t&&downloadFileFromUrl(t),driveState().selectEntries([])}}}function useDeleteEntriesAction(e){const t=useDeleteEntries(),s=useDriveStore(n=>n.activePage);if(!(s===SharesPage||!e.every(n=>n.permissions["files.delete"])))return{label:s===TrashPage?message("Delete forever"):message("Remove"),icon:DeleteIcon,key:"delete",execute:()=>{s===TrashPage?driveState().setActiveActionDialog("confirmAndDeleteForever",e):(t.mutate({entryIds:e.map(n=>n.id),deleteForever:s===TrashPage}),driveState().selectEntries([]))}}}function useRestoreEntriesAction(e){const t=useRestoreEntries();if(!(useDriveStore(n=>n.activePage)!==TrashPage||!e.every(n=>n.permissions["files.delete"])))return{label:message("Restore"),icon:RestoreIcon,key:"restore",execute:()=>{t.mutate({entryIds:e.map(n=>n.id)}),driveState().selectEntries([])}}}function useRemoveSharedEntriesAction(e){const t=useUnshareEntries();if(useDriveStore(n=>n.activePage)===SharesPage)return{label:message("Remove"),icon:DeleteIcon,key:"removeSharedEntry",execute:()=>{t.mutate({entryIds:e.map(n=>n.id),userId:"me"},{onSuccess:(n,o)=>{toast(message("Removed [one 1 item|other {count} items]",{values:{count:o.entryIds.length}}))},onError:n=>showHttpErrorToast(n,message("Could not remove items"))}),driveState().selectEntries([])}}}function useDrivePageActions(e){const t=useNewFolderAction(e),s=useUploadFilesAction(e),n=useUploadFolderAction(e),o=useEmptyTrashAction();return[t,s,n,o].filter(i=>!!i)}function useNewFolderAction(e){if(!(!e.folder||!e.folder.permissions["files.update"]))return{label:message("New folder"),icon:CreateNewFolderIcon,key:"newFolder",execute:()=>{e.folder&&driveState().setActiveActionDialog("newFolder",[e.folder])}}}function useUploadFilesAction(e){const{uploadFiles:t}=useDriveUploadQueue();if(!(!e.folder||!e.folder.permissions["files.update"]))return{label:message("Upload files"),icon:FileUploadIcon,key:"uploadFiles",execute:async()=>{t(await openUploadWindow({multiple:!0}))}}}function useUploadFolderAction(e){const{uploadFiles:t}=useDriveUploadQueue();if(!(!e.folder||!e.folder.permissions["files.update"]))return{label:message("Upload folder"),icon:DriveFolderUploadIcon,key:"uploadFolder",execute:async()=>{t(await openUploadWindow({directory:!0}))}}}function useEmptyTrashAction(e){const t=useDeleteEntries();if(useDriveStore(n=>n.activePage)===TrashPage)return{label:message("Empty trash"),icon:DeleteForeverIcon,key:"emptyTrash",execute:()=>{t.mutate({entryIds:[],emptyTrash:!0}),driveState().selectEntries([])}}}function EntryActionMenuTrigger({children:e,entries:t,page:s,showIfNoActions:n}){return(s==null?void 0:s.name)===RootFolderPage.name?jsxRuntimeExports.jsx(PageMenu,{page:RootFolderPage,showIfNoActions:n,children:e}):s===TrashPage?jsxRuntimeExports.jsx(PageMenu,{page:TrashPage,showIfNoActions:n,children:e}):s!=null&&s.folder?jsxRuntimeExports.jsx(EntriesMenu,{entries:[s.folder],showIfNoActions:n,children:e}):t!=null&&t.length?jsxRuntimeExports.jsx(EntriesMenu,{entries:t,showIfNoActions:n,children:e}):null}function EntriesMenu({entries:e,children:t,showIfNoActions:s}){const n=useEntryActions(e);return jsxRuntimeExports.jsx(BaseMenu,{actions:n,showIfNoActions:s,children:t})}function PageMenu({page:e,children:t,showIfNoActions:s}){const n=useDrivePageActions(e);return jsxRuntimeExports.jsx(BaseMenu,{actions:n,showIfNoActions:s,children:t})}function BaseMenu({actions:e,children:t,showIfNoActions:s}){return!e.length&&!s?null:jsxRuntimeExports.jsxs(MenuTrigger,{children:[t,jsxRuntimeExports.jsx(Menu,{children:e.map(n=>jsxRuntimeExports.jsx(Item,{onSelected:()=>{n.execute()},value:n.key,startIcon:reactExports.createElement(n.icon),children:jsxRuntimeExports.jsx(Trans,{...n.label})},n.key))})]})}function useEntries(){const e=usePaginatedEntries();return e.data?e.data.pages.flatMap(t=>t.data):[]}function useSelectedEntries(){const e=useDriveStore(s=>s.selectedEntries),t=useEntries();return Array.from(e).map(s=>t.find(n=>n.id===s)).filter(s=>!!s)}function useSelectedEntry(){return useSelectedEntries()[0]}function useSelectedEntryParent(){const e=useSelectedEntry(),{data:t}=useFolders();if(!(!e||!(t!=null&&t.folders)))return t.folders.find(s=>s.id===e.parent_id)}function getSelectedEntries(){const e=Array.from(driveState().selectedEntries),t=getAllEntries();return e.map(s=>t.find(n=>n.id===s)).filter(s=>!!s)}function EntryActionList({className:e}){const t=useSelectedEntries();return t.length?jsxRuntimeExports.jsx("div",{className:e,children:jsxRuntimeExports.jsx(ActionList,{entries:t})}):null}function ActionList({entries:e}){const t=usePreviewAction(e),s=useShareAction(e),n=useDeleteEntriesAction(e),o=useRemoveSharedEntriesAction(e),i=[t,s,n,o].filter(a=>!!a);return jsxRuntimeExports.jsxs("div",{className:"entry-action-list",children:[i.map(a=>jsxRuntimeExports.jsx(Tooltip,{label:jsxRuntimeExports.jsx(Trans,{...a.label}),children:jsxRuntimeExports.jsx(IconButton,{size:"sm",onClick:()=>{a.execute()},children:reactExports.createElement(a.icon)})},a.key)),jsxRuntimeExports.jsx(EntryActionMenuTrigger,{entries:e,children:jsxRuntimeExports.jsx(Tooltip,{label:jsxRuntimeExports.jsx(Trans,{message:"More actions"}),children:jsxRuntimeExports.jsx(IconButton,{children:jsxRuntimeExports.jsx(MoreVertIcon,{})})})})]})}function DriveContextMenu(){var o;const e=useSelectedEntries(),t=useDriveStore(i=>i.activePage),s=useDriveStore(i=>i.contextMenuData),n=s!=null&&s.entry?[s.entry]:e;return((o=s==null?void 0:s.entry)==null?void 0:o.id)===0?jsxRuntimeExports.jsx(PageContextMenu,{position:s,page:RootFolderPage}):s&&n.length?jsxRuntimeExports.jsx(EntriesContextMenu,{entries:n,position:s}):s&&t?jsxRuntimeExports.jsx(PageContextMenu,{position:s,page:t}):null}function EntriesContextMenu({entries:e,position:t}){const s=useEntryActions(e);return jsxRuntimeExports.jsx(BaseContextMenu,{position:t,actions:s})}function PageContextMenu({page:e,position:t}){const s=useDrivePageActions(e);return jsxRuntimeExports.jsx(BaseContextMenu,{position:t,actions:s})}function BaseContextMenu({position:e,actions:t}){return jsxRuntimeExports.jsx(ContextMenu,{position:e,onOpenChange:s=>{s||driveState().setContextMenuData(null)},children:t.map(s=>jsxRuntimeExports.jsx(Item,{value:s.key,onSelected:s.execute,startIcon:reactExports.createElement(s.icon),children:jsxRuntimeExports.jsx(Trans,{...s.label})},s.key))})}function useIsTouchDevice(){return useMediaQuery("((pointer: coarse))")}function useFileViewDnd(e){const t=useIsTouchDevice(),s=reactExports.useRef(null),{onDrop:n}=useFolderDropAction(e),[o,i]=reactExports.useState(!1),a=useDriveStore(d=>d.entriesBeingDragged.includes(e.id)),l=useDriveStore(d=>d.activePage),{draggableProps:u}=useDraggable({disabled:!!t||l===TrashPage,id:e.id,type:"fileEntry",ref:s,hidePreview:!0,onDragStart:(d,p)=>{driveState().selectedEntries.has(e.id)||driveState().selectEntries([e.id]),driveState().setEntriesBeingDragged(p.getData().map(h=>h.id))},onDragEnd:()=>{driveState().setEntriesBeingDragged([])},getData:()=>getSelectedEntries()}),{droppableProps:c}=useDroppable({id:e.id,disabled:t||e.type!=="folder",ref:s,types:["fileEntry","nativeFile"],acceptsDrop:d=>folderAcceptsDrop(d,e),onDragEnter:()=>i(!0),onDragLeave:()=>i(!1),onDrop:n});useMouseSelectable({id:e.id,ref:s,onSelected:()=>{driveState().selectEntries([e.id],!0)},onDeselected:()=>{driveState().deselectEntries([e.id])}});const x=clsx(a&&"opacity-20",o&&"ring ring-offset-4 ring-primary bg-primary-light/10 rounded");return{draggableProps:u,droppableProps:c,isDragOver:o,isDragging:a,itemClassName:x,ref:s}}function FileTableRow({item:e,children:t,className:s,...n}){const{isCollapsedMode:o}=reactExports.useContext(TableContext),{draggableProps:i,droppableProps:a,itemClassName:l,ref:u}=useFileViewDnd(e);return jsxRuntimeExports.jsx("div",{className:clsx(s,l),ref:u,...$3ef42575df84b30b$export$9d1611c77c2fe928(i,a,n,{onContextMenu:c=>{c.preventDefault(),c.stopPropagation(),o||(driveState().selectedEntries.has(e.id)||driveState().selectEntries([e.id]),driveState().setContextMenuData({x:c.clientX,y:c.clientY}))}}),children:t})}function useViewItemActionHandler(){const e=useNavigate();return{performViewItemAction:reactExports.useCallback(s=>{if(s&&s.type==="folder")driveState().activePage===TrashPage?driveState().setActiveActionDialog("trashFolderBlock",[s]):e(getPathForFolder(s.hash));else{const n=getSelectedEntries();driveState().setActiveActionDialog("preview",n.length?n:[s])}},[e])}}const formatFileSize=memoize(e=>prettyBytes(e)),fileTableColumns=[{key:"name",allowsSorting:!0,header:()=>jsxRuntimeExports.jsx(Trans,{message:"Name"}),visibleInMode:"all",width:"flex-3 min-w-200",body:e=>jsxRuntimeExports.jsx(FileNameColumn,{entry:e})},{key:"updated_at",allowsSorting:!0,maxWidth:"max-w-184",header:()=>jsxRuntimeExports.jsx(Trans,{message:"Last modified"}),body:e=>jsxRuntimeExports.jsx(FormattedDate,{date:e.updated_at})},{key:"file_size",allowsSorting:!0,header:()=>jsxRuntimeExports.jsx(Trans,{message:"Size"}),maxWidth:"max-w-144",body:e=>formatFileSize(e.file_size)??"-"},{key:"actions",hideHeader:!0,header:()=>jsxRuntimeExports.jsx(Trans,{message:"Actions"}),align:"end",width:"w-42 flex-shrink-0",visibleInMode:"all",body:e=>jsxRuntimeExports.jsx(ActionsColumn,{entry:e})}];function FileNameColumn({entry:e}){const{isCollapsedMode:t}=reactExports.useContext(TableContext),s=t?"w-30 h-30":"w-24 h-24";return jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-14",children:[jsxRuntimeExports.jsx(FileThumbnail,{className:clsx("rounded",s),iconClassName:s,file:e}),jsxRuntimeExports.jsxs("div",{className:"min-w-0",children:[jsxRuntimeExports.jsx("div",{className:"overflow-hidden overflow-ellipsis",children:e.name}),t&&jsxRuntimeExports.jsxs("div",{className:"mt-4 flex items-center text-xs text-muted",children:[jsxRuntimeExports.jsx(FormattedDate,{date:e.updated_at}),jsxRuntimeExports.jsx("div",{children:"·"}),jsxRuntimeExports.jsx("div",{children:formatFileSize(e.file_size)})]})]})]})}function ActionsColumn({entry:e}){const{selectedRows:t}=reactExports.useContext(TableContext);return t.length?jsxRuntimeExports.jsx(Checkbox,{className:"mr-8 block",checked:t.includes(e.id)}):jsxRuntimeExports.jsx(EntryActionMenuTrigger,{entries:[e],children:jsxRuntimeExports.jsx(IconButton,{className:"text-muted",children:jsxRuntimeExports.jsx(MoreVertIcon,{})})})}function FileTable({entries:e}){const{performViewItemAction:t}=useViewItemActionHandler(),s=useDriveStore(i=>i.selectedEntries),n=useDriveStore(i=>i.sortDescriptor),o=reactExports.useMemo(()=>[...s],[s]);return jsxRuntimeExports.jsx(Table,{columns:fileTableColumns,data:e,sortDescriptor:n,onSortChange:i=>{driveState().setSortDescriptor(i)},onAction:t,selectedRows:o,selectionStyle:"highlight",renderRowAs:FileTableRow,onSelectionChange:i=>{driveState().selectEntries(i)}})}const BaseFileGridItem=React.forwardRef(({entry:e,className:t,isSelected:s,isMobileMode:n,footerAdornment:o,...i},a)=>jsxRuntimeExports.jsxs("div",{...i,ref:a,className:clsx("grid-item flex aspect-square select-none flex-col overflow-hidden rounded border shadow outline-none transition-shadow-opacity dark:bg-alt",s&&"border-primary",t),children:[jsxRuntimeExports.jsx("div",{className:"relative min-h-0 flex-auto",children:jsxRuntimeExports.jsx(FileThumbnail,{className:"h-full w-full",iconClassName:"block w-70 h-70 absolute m-auto inset-0",file:e})}),jsxRuntimeExports.jsx(Footer$1,{entry:e,isSelected:s,isMobile:n,adornment:o})]}));function Footer$1({entry:e,isSelected:t,isMobile:s,adornment:n}){return jsxRuntimeExports.jsxs("div",{className:clsx("flex h-48 flex-shrink-0 items-center text-sm",s?"justify-between gap-10 pl-18 pr-2":"justify-center px-16",t&&"bg-primary-light/20"),children:[jsxRuntimeExports.jsx("div",{className:"min-w-0 overflow-hidden overflow-ellipsis whitespace-nowrap",children:e.name}),n]})}function FileGridItem({entry:e}){const t=useDriveStore(h=>h.selectedEntries.has(e.id)),{performViewItemAction:s}=useViewItemActionHandler(),{isMobileMode:n}=reactExports.useContext(DashboardLayoutContext),{draggableProps:o,droppableProps:i,itemClassName:a,ref:l}=useFileViewDnd(e),u=()=>{t?driveState().deselectEntries([e.id]):driveState().selectEntries([e.id],!0)},c=(h,g)=>{n?driveState().selectedEntries.size?u():s(e):isCtrlOrShiftPressed(h)?u():driveState().selectEntries([e.id])},{domProps:x}=usePointerEvents({onLongPress:n?()=>u():void 0,onPress:c}),d=h=>{(h.key==="Enter"||h.key===" ")&&(h.preventDefault(),h.stopPropagation(),s(e))},p=h=>{h.preventDefault(),h.stopPropagation(),n||(driveState().selectedEntries.has(e.id)||driveState().selectEntries([e.id]),driveState().setContextMenuData({x:h.clientX,y:h.clientY}))};return jsxRuntimeExports.jsx(BaseFileGridItem,{...$3ef42575df84b30b$export$9d1611c77c2fe928(o,i,x,{onKeyDown:createEventHandler(d)}),ref:l,entry:e,isSelected:t,isMobileMode:!!n,tabIndex:-1,onDoubleClick:h=>{h.preventDefault(),h.stopPropagation(),n||s(e)},footerAdornment:n&&jsxRuntimeExports.jsx(FooterAdornment,{entry:e,isSelected:t}),onContextMenu:createEventHandler(p),className:a})}function FooterAdornment({entry:e,isSelected:t}){return useDriveStore(n=>n.selectedEntries.size)?jsxRuntimeExports.jsx(Checkbox,{className:"mr-8 block",checked:t}):jsxRuntimeExports.jsx(EntryActionMenuTrigger,{entries:[e],children:jsxRuntimeExports.jsx(IconButton,{className:"text-muted",onPointerDown:n=>{n.stopPropagation()},children:jsxRuntimeExports.jsx(MoreVertIcon,{})})})}function FileGrid({entries:e}){return jsxRuntimeExports.jsx("div",{className:"file-grid-container",children:jsxRuntimeExports.jsx("div",{className:"file-grid",children:e.map(t=>jsxRuntimeExports.jsx(FileGridItem,{entry:t},t.id))})})}const AVAILABLE_SORTS=[{id:"file_size",label:message("Size")},{id:"name",label:message("Name")},{id:"updated_at",label:message("Last modified")},{id:"created_at",label:message("Upload date")},{id:"type",label:message("Type")},{id:"extension",label:message("Extension")}];function EntriesSortButton({descriptor:e,onChange:t,isDisabled:s=!1}){const n=e.orderBy,o=e.orderDir,i=AVAILABLE_SORTS.find(a=>a.id===n);return jsxRuntimeExports.jsxs(MenuTrigger,{showCheckmark:!0,selectionMode:"multiple",selectedValue:[o||"desc",n||""],onItemSelected:a=>{t(a==="asc"||a==="desc"?{orderBy:n,orderDir:a}:{orderBy:a,orderDir:o})},children:[jsxRuntimeExports.jsx(Button,{className:"text-muted",variant:"text",size:"sm",startIcon:jsxRuntimeExports.jsx(SortIcon,{}),disabled:s,children:i?jsxRuntimeExports.jsx(Trans,{...i.label}):null}),jsxRuntimeExports.jsxs(Menu,{children:[jsxRuntimeExports.jsxs(Section,{label:jsxRuntimeExports.jsx(Trans,{message:"Direction"}),children:[jsxRuntimeExports.jsx(Item,{value:"asc",children:jsxRuntimeExports.jsx(Trans,{message:"Ascending"})}),jsxRuntimeExports.jsx(Item,{value:"desc",children:jsxRuntimeExports.jsx(Trans,{message:"Descending"})})]}),jsxRuntimeExports.jsx(Section,{label:jsxRuntimeExports.jsx(Trans,{message:"Sort By"}),children:AVAILABLE_SORTS.map(a=>jsxRuntimeExports.jsx(Item,{value:a.id,children:jsxRuntimeExports.jsx(Trans,{...a.label})},a.id))})]})]})}function DriveSortButton({isDisabled:e}){const t=useDriveStore(s=>s.sortDescriptor);return jsxRuntimeExports.jsx(EntriesSortButton,{isDisabled:e,descriptor:t,onChange:s=>{driveState().setSortDescriptor(s)}})}function useFolderPath({hash:e,params:t,isEnabled:s=!0}){return useQuery({queryKey:DriveQueryKeys.fetchFolderPath(e,t),queryFn:()=>fetchFolderPath(e,t),enabled:!!e&&s})}function fetchFolderPath(e,t){return apiClient.get(`folders/${e}/path`,{params:t}).then(s=>s.data)}function PageBreadcrumbs({className:e}){const{isMobileMode:t}=reactExports.useContext(DashboardLayoutContext),s=useNavigate(),n=useDriveStore(x=>x.activePage),o=n==null?void 0:n.folder,i=useFolderPath({hash:o==null?void 0:o.hash,isEnabled:(o==null?void 0:o.hash)!==RootFolderPage.folder.hash}),a=useActiveWorkspace(),l=useRootItem(),u=!n||!a||n.isFolderPage&&!o||i.fetchStatus!=="idle";let c;if(u)c=null;else{const x=l?[l]:[];i.data&&i.data.path.forEach(d=>{x.push({page:makeFolderPage(d),label:d.name})}),c=jsxRuntimeExports.jsx(Breadcrumb,{className:e,size:t?"md":"lg",currentIsClickable:!0,children:x.map((d,p)=>p===x.length-1?jsxRuntimeExports.jsx(BreadcrumbItem,{children:({isMenuItem:g})=>g||!d.page.folder&&d.page!==TrashPage?jsxRuntimeExports.jsx(MixedText,{value:d.label}):jsxRuntimeExports.jsx(EntryActionMenuTrigger,{page:d.page,showIfNoActions:!0,children:jsxRuntimeExports.jsxs(ButtonBase,{className:"flex items-center gap-2 rounded focus-visible:ring-offset-4",children:[jsxRuntimeExports.jsx(MixedText,{value:d.label}),jsxRuntimeExports.jsx(ArrowDropDownIcon,{className:"text-muted icon-md"})]})})},d.page.uniqueId):jsxRuntimeExports.jsx(BreadcrumbItem,{onSelected:()=>{s(d.page.path)},children:jsxRuntimeExports.jsx(MixedText,{value:d.label})},d.page.uniqueId))})}return c}function useRootItem(){var n,o;const e=useDriveStore(i=>i.activePage),t=useActiveWorkspace(),{user:s}=useAuth();if(!e)return null;if(t&&!t.default&&e!=null&&e.isFolderPage&&((e==null?void 0:e.name)===RootFolderPage.name||((n=e.folder)==null?void 0:n.workspace_id)===t.id))return{label:t.name,page:RootFolderPage};if(e!=null&&e.isFolderPage){const i=(o=e.folder)==null?void 0:o.users.find(a=>a.owns_entry);return(i==null?void 0:i.id)!==(s==null?void 0:s.id)?{label:SharesPage.label,page:SharesPage}:{label:RootFolderPage.label,page:RootFolderPage}}return{label:e.label,page:e}}function InfiniteScrollSentinel({query:{isInitialLoading:e,fetchNextPage:t,isFetchingNextPage:s,hasNextPage:n},children:o,loaderMarginTop:i="mt-24",style:a,className:l,variant:u="infiniteScroll",loadMoreExtraContent:c,size:x="sm"}){const d=reactExports.useRef(null),p=s||e,[h,g]=reactExports.useState(0),j=u==="loadMore"&&h<3?"loadMore":"infiniteScroll",f=reactExports.useRef(!1);reactExports.useEffect(()=>{const R=d.current;if(!R||j==="loadMore")return;const E=new IntersectionObserver(([b])=>{if(b.isIntersecting){if(!f.current)return;n&&!p&&(f.current=!1,t())}else f.current=!0});return E.observe(R),()=>{E.unobserve(R)}},[t,n,p,j]);let v;return o?v=s?o:null:j==="loadMore"?v=!e&&n&&jsxRuntimeExports.jsxs("div",{className:clsx("flex items-center gap-8",i),children:[c,jsxRuntimeExports.jsx(Button,{size:x==="md"?"sm":"xs",className:clsx(x==="sm"?"min-h-24 min-w-96":"min-h-36 min-w-112"),variant:"outline",color:"primary",onClick:()=>{t(),g(h+1)},disabled:p,children:h>=2&&!s?jsxRuntimeExports.jsx(Trans,{message:"Load all"}):jsxRuntimeExports.jsx(Trans,{message:"Show more"})})]}):v=jsxRuntimeExports.jsx(AnimatePresence,{children:s&&jsxRuntimeExports.jsx(m.div,{className:clsx("flex w-full justify-center",i),...opacityAnimation,children:jsxRuntimeExports.jsx(ProgressCircle,{size:x,isIndeterminate:!0,"aria-label":"loading"})})}),jsxRuntimeExports.jsxs("div",{style:a,className:clsx("w-full",l,n&&"min-h-36"),role:"presentation",children:[jsxRuntimeExports.jsx("div",{ref:d,"aria-hidden":!0}),v]})}function AdHost({slot:e,className:t}){var i;const s=useSettings(),{isSubscribed:n}=useAuth(),o=reactExports.useMemo(()=>dot.pick(`ads.${e}`,s),[e,s]);return(i=s.ads)!=null&&i.disable||n||!o?null:jsxRuntimeExports.jsx(InvariantAd,{className:t,slot:e,adCode:o})}const InvariantAd=reactExports.memo(({slot:e,adCode:t,className:s})=>{const n=reactExports.useRef(null),o=reactExports.useId();return reactExports.useEffect(()=>(n.current&&loadAdScripts(t,n.current).then(()=>{executeAdJavascript(t,o)}),()=>{delete window.google_ad_modifications}),[t,o]),reactExports.useEffect(()=>{if(n.current){const i=$62d8ded9296f3872$export$cfa2225e87938781(n.current);if(i){const a=new MutationObserver(function(){i.style.height="",i.style.minHeight=""});return a.observe(i,{attributes:!0,attributeFilter:["style"]}),()=>a.disconnect()}}},[]),jsxRuntimeExports.jsx("div",{ref:n,id:o,className:clsx("ad-host flex max-h-[600px] min-h-90 w-full max-w-full items-center justify-center overflow-hidden",`${e.replace(/\./g,"-")}-host`,s),dangerouslySetInnerHTML:{__html:getAdHtml(t)}})},()=>!1);function getAdHtml(e){return e==null?void 0:e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").trim()}function loadAdScripts(e,t){const s=[],n=/<script.*?src=['"](.*?)['"]/g;let o;for(;o=n.exec(e);)o[1]&&s.push(lazyLoader.loadAsset(o[1],{type:"js",parentEl:t}));return Promise.all(s)}function executeAdJavascript(adCode,id){const pattern=/<script\b[^>]*>([\s\S]*?)<\/script>/g;let content;for(;content=pattern.exec(adCode);)if(content[1]){const r=`var d = document.createElement('div'); d.innerHTML = $1; document.getElementById('${id}').appendChild(d.firstChild);`,toEval=content[1].replace(/document.write\((.+?)\);/,r);eval(toEval)}}function DropTargetMask({isVisible:e}){const t=jsxRuntimeExports.jsx(m.div,{...opacityAnimation,transition:{duration:.3},className:"pointer-events-none absolute inset-0 min-h-full w-full border-2 border-dashed border-primary bg-primary-light/30",children:jsxRuntimeExports.jsx(m.div,{initial:{y:"100%",opacity:0},animate:{y:"-10px",opacity:1},exit:{y:"100%",opacity:0},className:"fixed bottom-0 left-0 right-0 mx-auto max-w-max rounded bg-primary p-10 text-on-primary",children:jsxRuntimeExports.jsx(Trans,{message:"Drop files to upload them to this folder."})})},"dragTargetMask");return jsxRuntimeExports.jsx(AnimatePresence,{children:e?t:null})}function FileView({className:e}){const[t]=useSearchParams(),s=!!t.get("query")||!!t.get("filters"),n=reactExports.useRef(null),o=usePaginatedEntries(),i=useEntries(),{uploadFiles:a}=useDriveUploadQueue(),l=useDeleteEntries(),u=useDriveStore(E=>E.activePage),[c,x]=reactExports.useState(!1),d=useDriveStore(E=>E.viewMode),{isMobileMode:p}=reactExports.useContext(DashboardLayoutContext),{containerProps:h,boxProps:g}=useMouseSelectionBox({containerRef:n,onPointerDown:E=>{E.target.closest(".entry-action-list")||driveState().deselectEntries("all")}}),{droppableProps:j}=useDroppable({id:"driveRoot",ref:n,types:["nativeFile"],disabled:!(u!=null&&u.canUpload),onDragEnter:()=>{x(!0)},onDragLeave:()=>{x(!1)},onDrop:async E=>{E.type==="nativeFile"&&a(await E.getData())}});if(!u)return null;let f;if(!i.length&&(!o.isLoading||o.fetchStatus==="idle")){const E=u.noContentMessage(s);f=jsxRuntimeExports.jsx(IllustratedMessage,{className:"mt-40",image:jsxRuntimeExports.jsx(SvgImage,{src:E.image}),title:jsxRuntimeExports.jsx(Trans,{...E.title}),description:jsxRuntimeExports.jsx(Trans,{...E.description})})}else o.isLoading||(f=d==="list"?jsxRuntimeExports.jsx(FileTable,{entries:i}):jsxRuntimeExports.jsx(FileGrid,{entries:i}));const v=E=>{E.preventDefault(),E.stopPropagation(),driveState().deselectEntries("all"),driveState().setContextMenuData({x:E.clientX,y:E.clientY})},R=E=>{E.key==="a"&&isCtrlKeyPressed(E)&&(E.preventDefault(),E.stopPropagation(),driveState().selectEntries(i.map(b=>b.id))),E.key==="Delete"&&(E.preventDefault(),E.stopPropagation(),driveState().selectedEntries.size&&!l.isPending&&(u===TrashPage?driveState().setActiveActionDialog("confirmAndDeleteForever",getSelectedEntries()):(l.mutate({entryIds:[...driveState().selectedEntries],deleteForever:u===TrashPage}),driveState().selectEntries([]))))};return jsxRuntimeExports.jsx("div",{className:clsx("relative outline-none",e),tabIndex:-1,...$3ef42575df84b30b$export$9d1611c77c2fe928(h,j,{onKeyDown:createEventHandler(R)}),onContextMenu:v,children:jsxRuntimeExports.jsxs("div",{className:"relative flex min-h-full flex-col pt-10",children:[p?jsxRuntimeExports.jsx(PageBreadcrumbs,{className:"mb-10 px-14"}):jsxRuntimeExports.jsx(Toolbar,{}),jsxRuntimeExports.jsx(SearchFilterList,{}),jsxRuntimeExports.jsxs("div",{className:"relative flex-auto px-18 pb-18 md:px-24",children:[jsxRuntimeExports.jsx(AdHost,{slot:"drive",className:"mb-24"}),f,jsxRuntimeExports.jsx(InfiniteScrollSentinel,{query:o})]}),jsxRuntimeExports.jsx("div",{...g,className:"pointer-events-none absolute left-0 top-0 z-10 hidden border border-primary-light bg-primary-light/20 shadow-md"}),jsxRuntimeExports.jsx(DriveContextMenu,{}),jsxRuntimeExports.jsx(DropTargetMask,{isVisible:c})]})})}function Toolbar(){const e=useDriveStore(t=>t.activePage);return jsxRuntimeExports.jsxs("div",{className:"my-10 flex min-h-42 items-center justify-between gap-40 px-10 text-muted md:px-18",children:[jsxRuntimeExports.jsx(DriveSortButton,{isDisabled:e==null?void 0:e.disableSort}),jsxRuntimeExports.jsx(EntryActionList,{className:"text-muted"})]})}function formatSpeed(e){if(e===0)return"";const t=["B/s","KB/s","MB/s","GB/s"];let s=e,n=0;for(;s>=1024&&n<t.length-1;)s/=1024,n++;return`${s.toFixed(1)} ${t[n]}`}function formatETA(e){if(e===0||!isFinite(e))return"";const t=Math.floor(e/3600),s=Math.floor(e%3600/60),n=Math.floor(e%60);return t>0?`${t}h ${s}m ${n}s`:s>0?`${s}m ${n}s`:`${n}s`}function useUploadAnalytics(e){const t=useFileUploadStore(s=>s.fileUploads.get(e));return reactExports.useMemo(()=>{const s=(t==null?void 0:t.percentage)||0,n=(t==null?void 0:t.bytesUploaded)||0,o=(t==null?void 0:t.speed)||0,i=(t==null?void 0:t.eta)||0,a=(t==null?void 0:t.status)||"pending";return{percentage:s,bytesUploaded:n,speed:o,eta:i,speedFormatted:formatSpeed(o),etaFormatted:formatETA(i),status:a}},[t==null?void 0:t.percentage,t==null?void 0:t.bytesUploaded,t==null?void 0:t.speed,t==null?void 0:t.eta,t==null?void 0:t.status])}const UploadQueueItem=reactExports.memo(({file:e,style:t})=>jsxRuntimeExports.jsxs("div",{className:"absolute left-0 top-0 flex w-full items-center gap-14 p-10",style:t,children:[jsxRuntimeExports.jsx("div",{className:"shrink-0 rounded border p-8",children:jsxRuntimeExports.jsx(FileTypeIcon,{className:"h-22 w-22",mime:e.mime})}),jsxRuntimeExports.jsxs("div",{className:"min-w-0 flex-auto pr-10",children:[jsxRuntimeExports.jsx("div",{className:"mb-2 flex min-w-0 items-center gap-10",children:jsxRuntimeExports.jsx("div",{className:"min-w-0 flex-auto overflow-hidden overflow-ellipsis whitespace-nowrap font-medium",children:e.name})}),jsxRuntimeExports.jsx(SizeInfo,{file:e})]}),jsxRuntimeExports.jsx("div",{className:"mr-10",children:jsxRuntimeExports.jsx(FileStatus,{file:e})})]}));function SizeInfo({file:e}){const t=useUploadAnalytics(e.id),s=useFileUploadStore(a=>a.fileUploads.get(e.id)),n=reactExports.useMemo(()=>prettyBytes(e.size),[e]),o=reactExports.useMemo(()=>prettyBytes(t.bytesUploaded),[t.bytesUploaded]);let i;if(t.status==="completed")i=jsxRuntimeExports.jsx(Trans,{message:"Upload complete"});else if(t.status==="aborted")i=jsxRuntimeExports.jsx(Trans,{message:"Upload cancelled"});else if(t.status==="failed"){const a=(s==null?void 0:s.retryCount)||0,l=(s==null?void 0:s.maxRetries)||0,u=((s==null?void 0:s.errorType)==="network"||(s==null?void 0:s.errorType)==="server")&&a<l;let c="Upload failed";(s==null?void 0:s.errorType)==="network"?c="Network error - check your connection":(s==null?void 0:s.errorType)==="server"?c="Server error - please try again":(s==null?void 0:s.errorType)==="validation"&&(c="File validation failed"),u&&a>0&&(c+=` (Attempt ${a}/${l})`),i=jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4",children:[jsxRuntimeExports.jsx(Trans,{message:c}),u&&jsxRuntimeExports.jsx("span",{className:"text-primary",children:"• Click retry button"})]})}else{const{speedFormatted:a,etaFormatted:l}=t;if(s!=null&&s.isRetrying){const u=(s==null?void 0:s.retryCount)||0;i=jsxRuntimeExports.jsx(Trans,{message:"Retrying... (Attempt :attempt)",values:{attempt:u}})}else i=jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4",children:[jsxRuntimeExports.jsx(Trans,{message:":bytesUploaded of :totalBytes",values:{bytesUploaded:o,totalBytes:n}}),a&&jsxRuntimeExports.jsx("span",{children:"-"}),jsxRuntimeExports.jsx("span",{children:a}),l&&jsxRuntimeExports.jsx("span",{children:"-"}),jsxRuntimeExports.jsx("span",{children:l})]})}return jsxRuntimeExports.jsx("div",{className:"text-xs text-muted",children:i})}function FileStatus({file:e}){const t=useFileUploadStore(p=>p.fileUploads.get(e.id)),s=useFileUploadStore(p=>p.abortUpload),n=useFileUploadStore(p=>p.retryUpload),o=useUploadAnalytics(e.id),i=t==null?void 0:t.errorMessage,[a,l]=reactExports.useState(!1),u=jsxRuntimeExports.jsx(IconButton,{size:"xs",iconSize:"sm",onClick:()=>{s(e.id)},children:jsxRuntimeExports.jsx(CloseIcon,{})}),c=jsxRuntimeExports.jsx(ProgressCircle,{"aria-label":"Upload progress",size:"w-24 h-24",value:o.percentage,trackWidth:3}),x=jsxRuntimeExports.jsx(Tooltip,{label:"Retry Upload",children:jsxRuntimeExports.jsx(IconButton,{size:"xs",iconSize:"sm",onClick:()=>n(e.id),children:jsxRuntimeExports.jsx(RefreshIcon,{})})});let d;if(o.status==="failed"){const p=i||message("This file could not be uploaded"),h=(t==null?void 0:t.errorType)==="network"||(t==null?void 0:t.errorType)==="server";d=jsxRuntimeExports.jsx(AnimatedStatus,{children:jsxRuntimeExports.jsx(Tooltip,{variant:"danger",label:jsxRuntimeExports.jsx(MixedText,{value:`${p} (Error code: ${(t==null?void 0:t.errorCode)||"N/A"})`}),children:h?x:jsxRuntimeExports.jsx(ErrorIcon,{className:"text-danger",size:"md"})})})}else o.status==="aborted"?d=jsxRuntimeExports.jsx(AnimatedStatus,{children:jsxRuntimeExports.jsx(WarningIcon,{className:"text-warning",size:"md"})}):o.status==="completed"?d=jsxRuntimeExports.jsx(AnimatedStatus,{children:jsxRuntimeExports.jsx(CheckCircleIcon,{size:"md",className:"text-positive"})}):d=jsxRuntimeExports.jsx(AnimatedStatus,{onPointerEnter:p=>{p.pointerType==="mouse"&&l(!0)},onPointerLeave:p=>{p.pointerType==="mouse"&&l(!1)},children:a?u:c});return jsxRuntimeExports.jsx(AnimatePresence,{children:d})}function AnimatedStatus({children:e,...t}){return jsxRuntimeExports.jsx(m.div,{...t,initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},children:e})}function UploadQueue(){const e=useDriveStore(t=>t.uploadQueueIsOpen);return jsxRuntimeExports.jsx(AnimatePresence,{children:e&&jsxRuntimeExports.jsxs(m.div,{className:"fixed bottom-16 right-16 z-modal w-375 rounded border bg text-sm shadow-xl",initial:{y:"100%",opacity:0},animate:{y:0,opacity:1},exit:{y:"100%",opacity:0},children:[jsxRuntimeExports.jsx(Header,{}),jsxRuntimeExports.jsx(UploadList,{})]},"upload-queue")})}function Header(){const e=useFileUploadStore(o=>o.activeUploadsCount),t=useFileUploadStore(o=>o.completedUploadsCount),s=useFileUploadStore(o=>o.clearInactive);let n;return e?n=jsxRuntimeExports.jsx(Trans,{message:"Uploading :count files",values:{count:e}}):t?n=jsxRuntimeExports.jsx(Trans,{message:"Uploaded :count files",values:{count:t}}):n=jsxRuntimeExports.jsx(Trans,{message:"No active uploads"}),jsxRuntimeExports.jsxs("div",{className:"flex min-h-[45px] items-center justify-between gap-10 border-b bg-alt px-10 py-4",children:[n,e===0?jsxRuntimeExports.jsx(IconButton,{size:"sm",onClick:()=>{driveState().setUploadQueueIsOpen(!1),setTimeout(()=>{s()},200)},children:jsxRuntimeExports.jsx(CloseIcon,{})}):void 0]})}function UploadList(){const e=useFileUploadStore(o=>o.fileUploads),t=[...e.values()],s=reactExports.useRef(null),n=useVirtualizer({count:e.size,getScrollElement:()=>s.current,estimateSize:()=>60,overscan:4});return jsxRuntimeExports.jsx("div",{className:"max-h-320 overflow-y-auto",ref:s,children:jsxRuntimeExports.jsx("div",{className:"relative w-full",style:{height:`${n.getTotalSize()}px`},children:n.getVirtualItems().map(o=>{const i=t[o.index];return jsxRuntimeExports.jsx(UploadQueueItem,{style:{height:`${o.size}px`,transform:`translateY(${o.start}px)`},file:i.file},i.file.id)})})})}const detailedExamination=""+new URL("detailed-examination-33c85772.svg",import.meta.url).href;function DetailsSidebarHeader({entryType:e,entryName:t}){const{setRightSidenavStatus:s}=reactExports.useContext(DashboardLayoutContext);return jsxRuntimeExports.jsxs("div",{className:"mb-38 flex items-center gap-16 text-text-main",children:[jsxRuntimeExports.jsx(FileTypeIcon,{className:"h-24 w-24",type:e}),jsxRuntimeExports.jsx("div",{className:"mr-auto min-w-0 flex-auto text-ellipsis break-words text-xl font-normal",children:t}),jsxRuntimeExports.jsx(IconButton,{size:"md",className:"flex-shrink-0",onClick:()=>{s("closed")},children:jsxRuntimeExports.jsx(CloseIcon,{})})]})}function DetailsSidebarSectionHeader({children:e,margin:t="mb-20"}){return jsxRuntimeExports.jsx("div",{className:clsx("text-base text-main",t),children:e})}function useTaggableTags(e){return useQuery({queryKey:getQueryKey(e),queryFn:()=>fetchTaggableTags(e),initialData:e.initialData?{tags:e.initialData}:void 0})}function getQueryKey(e){const{taggableType:t,taggableId:s,type:n,notType:o}=e,i=["tags","taggable",t,`${s}`];return n!=null&&i.push(n),o!=null&&i.push(o),i}function invalidateTaggableTagsQuery({taggableType:e,taggableIds:t}){return Promise.allSettled(t.map(s=>queryClient.invalidateQueries({queryKey:getQueryKey({taggableType:e,taggableId:s})})))}async function fetchTaggableTags({taggableType:e,taggableId:t,notType:s,type:n}){return apiClient.get(`taggable/${e}/${t}/list-tags`,{params:{notType:s,type:n}}).then(o=>o.data)}function useDetachTagFromTaggables(){return useMutation({mutationFn:e=>detachTag(e),onSuccess:(e,t)=>{invalidateTaggableTagsQuery(t)},onError:e=>showHttpErrorToast(e)})}function detachTag(e){return apiClient.post("taggable/detach-tag",e).then(t=>t.data)}function useTags(e){return useQuery({queryKey:["tags",e],queryFn:({signal:t})=>fetchTags(e,t),placeholderData:keepPreviousData})}async function fetchTags(e,t){return e.query&&await new Promise(s=>setTimeout(s,300)),apiClient.get("tags",{params:{paginate:"simple",...e},signal:e.query?t:void 0}).then(s=>s.data)}function useAttachTagToTaggables(){return useMutation({mutationFn:e=>attachTag(e),onSuccess:async(e,t)=>{invalidateTaggableTagsQuery(t)},onError:e=>showHttpErrorToast(e)})}function attachTag(e){return apiClient.post("taggable/attach-tag",e).then(t=>t.data)}function ManageTagsDialog({attachedTags:e,tagType:t,notTagType:s,taggableType:n,taggableIds:o,userId:i,isLoading:a,onChange:l}){const{trans:u}=useTrans(),[c,x]=reactExports.useState(""),{data:d,isPlaceholderData:p,isLoading:h}=useTags({type:t,notType:s,query:c,userId:i}),g=useDetachTagFromTaggables(),j=useAttachTagToTaggables(),{tags:f,attachedTagIds:v}=reactExports.useMemo(()=>{const R=(d==null?void 0:d.pagination.data)||[],E=e||[],b=E.map(S=>S.id),I=R.filter(S=>!b.includes(S.id));return I.unshift(...E),{tags:I,attachedTagIds:b}},[e,d]);return jsxRuntimeExports.jsx(Dialog,{children:jsxRuntimeExports.jsxs(DialogBody,{padding:"p-8",children:[jsxRuntimeExports.jsx("form",{children:jsxRuntimeExports.jsx(TextField,{placeholder:u({message:"Type tag name..."}),inputBorder:"border-b",inputRadius:"rounded-none",inputRing:"ring-0",inputShadow:"shadow-none",startAdornment:jsxRuntimeExports.jsx(SearchIcon,{}),value:c,onChange:R=>x(R.target.value),endAdornment:p&&jsxRuntimeExports.jsx(ProgressCircle,{isIndeterminate:!0,size:"w-24 h-24"})})}),jsxRuntimeExports.jsxs(List,{className:"compact-scrollbar h-320 overflow-y-auto stable-scrollbar",children:[f.map(R=>{const E=v.includes(R.id),b=j.isPending||g.isPending||a;return jsxRuntimeExports.jsx(ListItem,{isDisabled:b,onSelected:()=>{E?g.mutate({tagId:R.id,taggableIds:o,taggableType:n},{onSuccess:()=>l==null?void 0:l(R.id)}):j.mutate({taggableType:n,taggableIds:o,tagName:R.name,userId:i,tagType:t},{onSuccess:()=>l==null?void 0:l(R.id)})},className:clsx(E&&(b?"text-primary-light":"text-primary")),startIcon:jsxRuntimeExports.jsx(PushPinIcon,{size:"xs"}),endSection:E?jsxRuntimeExports.jsx(CheckIcon,{size:"sm",className:"block text-primary"}):jsxRuntimeExports.jsx("div",{className:"h-20 w-20"}),children:R.display_name||R.name},R.id)}),!p&&!(d!=null&&d.pagination.data.length)&&c&&jsxRuntimeExports.jsx(ListItem,{startIcon:jsxRuntimeExports.jsx(PushPinIcon,{size:"xs"}),onSelected:()=>{j.mutate({taggableType:n,taggableIds:o,tagName:c,userId:i,tagType:t},{onSuccess:R=>{x(""),l==null||l(R.tag.id)}})},children:jsxRuntimeExports.jsx(Trans,{message:'Create tag ":name"',values:{name:c}})}),d&&!f.length&&!c&&jsxRuntimeExports.jsx("li",{className:"text-center text-muted",children:jsxRuntimeExports.jsx(Trans,{message:"No tags found"})}),h&&jsxRuntimeExports.jsx("li",{className:"flex justify-center",children:jsxRuntimeExports.jsx(ProgressCircle,{isIndeterminate:!0,size:"w-24 h24"})})]})]})})}function DetailsSidebarTags({entry:e}){var i;const{user:t}=useAuth(),s=useDetachTagFromTaggables(),{data:n,isFetching:o}=useTaggableTags({taggableType:"fileEntry",taggableId:e.id,initialData:(i=e.tags)==null?void 0:i.filter(a=>a.type!=="label"),type:"custom"});return jsxRuntimeExports.jsxs("div",{className:"mt-20 border-t pt-20",children:[jsxRuntimeExports.jsx(DetailsSidebarSectionHeader,{margin:"mb-10",children:jsxRuntimeExports.jsx(Trans,{message:"Tags"})}),jsxRuntimeExports.jsx("div",{className:"flex items-center gap-8",children:jsxRuntimeExports.jsx(ChipList,{size:"sm",radius:"rounded-button",startButton:jsxRuntimeExports.jsxs(DialogTrigger,{type:"modal",children:[jsxRuntimeExports.jsx(Button,{variant:"outline",startIcon:jsxRuntimeExports.jsx(AddIcon,{}),size:"2xs",className:"min-h-26",children:jsxRuntimeExports.jsx(Trans,{message:"Add tag"})}),jsxRuntimeExports.jsx(ManageTagsDialog,{attachedTags:n==null?void 0:n.tags,isLoading:o,tagType:"custom",taggableType:"fileEntry",taggableIds:[e.id],userId:t==null?void 0:t.id})]}),children:n==null?void 0:n.tags.map(a=>jsxRuntimeExports.jsx(Chip,{disabled:s.isPending||o,onRemove:()=>{s.mutate({tagId:a.id,taggableIds:[e.id],taggableType:"fileEntry"})},children:a.display_name||a.name},a.id))})})]})}function DetailsSidebarProperties({entry:e}){return jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(DetailsSidebarHeader,{entryType:e.type,entryName:e.name}),e.type==="image"&&jsxRuntimeExports.jsx(FileThumbnail,{className:"mb-20",file:e}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(DetailsSidebarSectionHeader,{children:jsxRuntimeExports.jsx(Trans,{message:"Who has access"})}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-14",children:[e.workspace_id?jsxRuntimeExports.jsx("div",{className:"flex h-32 w-32 items-center justify-center rounded-full border",children:jsxRuntimeExports.jsx(GroupsIcon,{className:"icon-md"})}):null,e.users.map(t=>jsxRuntimeExports.jsx(Tooltip,{label:t.name,children:jsxRuntimeExports.jsx(Avatar,{src:t.image,size:"md",circle:!0})},t.id))]}),e.permissions["files.update"]&&jsxRuntimeExports.jsx(Button,{className:"mt-20 block",variant:"link",color:"primary",onClick:()=>{driveState().setActiveActionDialog("share",[e])},children:jsxRuntimeExports.jsx(Trans,{message:"Manage Access"})})]}),jsxRuntimeExports.jsx(PropertyList,{entry:e}),jsxRuntimeExports.jsx(DetailsSidebarTags,{entry:e})]})}function PropertyList({entry:e}){const t=useSelectedEntryParent(),s=useNavigate(),n=e.users.find(i=>i.owns_entry),o=reactExports.useMemo(()=>prettyBytes(e.file_size),[e.file_size]);return jsxRuntimeExports.jsxs("div",{className:"mt-20 border-t pt-20",children:[jsxRuntimeExports.jsx(DetailsSidebarSectionHeader,{children:jsxRuntimeExports.jsx(Trans,{message:"Properties"})}),jsxRuntimeExports.jsx(PropertyItem,{label:jsxRuntimeExports.jsx(Trans,{message:"Type"}),value:jsxRuntimeExports.jsx("span",{className:"capitalize",children:jsxRuntimeExports.jsx(Trans,{message:e.type})})}),jsxRuntimeExports.jsx(PropertyItem,{label:jsxRuntimeExports.jsx(Trans,{message:"Size"}),value:e.file_size?o:"-"}),jsxRuntimeExports.jsx(PropertyItem,{label:jsxRuntimeExports.jsx(Trans,{message:"Location"}),value:jsxRuntimeExports.jsx(Button,{variant:"link",startIcon:jsxRuntimeExports.jsx(FolderIcon,{}),onClick:()=>{s(t?getPathForFolder(t.hash):RootFolderPage.path)},children:t?t.name:jsxRuntimeExports.jsx(Trans,{message:"Root"})})}),n&&jsxRuntimeExports.jsx(PropertyItem,{label:jsxRuntimeExports.jsx(Trans,{message:"Owner"}),value:n.name}),jsxRuntimeExports.jsx(PropertyItem,{label:jsxRuntimeExports.jsx(Trans,{message:"Modified"}),value:jsxRuntimeExports.jsx(FormattedDate,{date:e.updated_at})}),jsxRuntimeExports.jsx(PropertyItem,{label:jsxRuntimeExports.jsx(Trans,{message:"Created"}),value:jsxRuntimeExports.jsx(FormattedDate,{date:e.updated_at})})]})}function PropertyItem({label:e,value:t}){return jsxRuntimeExports.jsxs("div",{className:"mb-14 flex items-center",children:[jsxRuntimeExports.jsx("div",{className:"w-1/3 text-xs text-muted",children:e}),jsxRuntimeExports.jsx("div",{className:"w-2/3 text-sm text-main",children:t})]})}function DetailsSidebar({className:e}){const t=useSelectedEntry();return jsxRuntimeExports.jsx("div",{className:clsx(e,"h-full overflow-y-auto border-l bg p-18 text-sm text-muted"),children:t?jsxRuntimeExports.jsx(DetailsSidebarProperties,{entry:t}):jsxRuntimeExports.jsx(NothingSelected,{})})}function NothingSelected(){return jsxRuntimeExports.jsxs(reactExports.Fragment,{children:[jsxRuntimeExports.jsx(DetailsSidebarHeader,{entryType:"folder",entryName:jsxRuntimeExports.jsx(Trans,{message:"All files"})}),jsxRuntimeExports.jsx(IllustratedMessage,{image:jsxRuntimeExports.jsx(SvgImage,{src:detailedExamination}),description:jsxRuntimeExports.jsx(Trans,{message:"Select file or folder to see details here"})})]})}function useRenameEntry(e){return useMutation({mutationFn:t=>renameEntry(t),onSuccess:(t,s)=>{invalidateEntryQueries(),toast(message(":oldName renamed to :newName",{values:{oldName:s.initialName,newName:t.fileEntry.name}}))},onError:t=>onFormQueryError(t,e)})}function renameEntry({entryId:e,...t}){return apiClient.put(`file-entries/${e}`,t).then(s=>s.data)}function RenameEntryDialog({entries:e}){var l;const{close:t,formId:s}=useDialogContext(),n=(l=e[0])==null?void 0:l.name,o=useForm({defaultValues:{name:n}}),i=useRenameEntry(o),a=u=>{i.mutate({entryId:e[0].id,name:u.name,initialName:n},{onSuccess:t})};return jsxRuntimeExports.jsxs(Dialog,{children:[jsxRuntimeExports.jsx(DialogHeader,{children:jsxRuntimeExports.jsx(Trans,{message:"Rename"})}),jsxRuntimeExports.jsx(DialogBody,{children:jsxRuntimeExports.jsx(Form,{onSubmit:a,form:o,id:s,children:jsxRuntimeExports.jsx(FormTextField,{placeholder:"Enter a name...","aria-label":"Entry name",autoFocus:!0,name:"name",required:!0,minLength:3,maxLength:200})})}),jsxRuntimeExports.jsxs(DialogFooter,{children:[jsxRuntimeExports.jsx(Button,{variant:"flat",onClick:()=>t(),children:jsxRuntimeExports.jsx(Trans,{message:"Cancel"})}),jsxRuntimeExports.jsx(Button,{form:s,type:"submit",variant:"flat",color:"primary",disabled:i.isPending||!o.formState.isDirty,children:jsxRuntimeExports.jsx(Trans,{message:"Save"})})]})]})}function createFolder({name:e,parentId:t}){return apiClient.post("folders",{name:e,parentId:t===0?null:t}).then(s=>s.data)}function useCreateFolder(e){return useMutation({mutationFn:({name:t,parentId:s})=>createFolder({name:t,parentId:s}),onSuccess:()=>invalidateEntryQueries(),onError:t=>onFormQueryError(t,e)})}function NewFolderDialog({parentId:e}){const{close:t,formId:s}=useDialogContext(),{trans:n}=useTrans(),o=useForm({defaultValues:{name:n({message:"Untitled Folder"})}}),i=useCreateFolder(o),a=l=>{i.mutate({...l,parentId:e},{onSuccess:u=>{t(u.folder),toast(message("Folder created"))}})};return jsxRuntimeExports.jsxs(Dialog,{children:[jsxRuntimeExports.jsx(DialogHeader,{children:jsxRuntimeExports.jsx(Trans,{message:"New Folder"})}),jsxRuntimeExports.jsx(DialogBody,{children:jsxRuntimeExports.jsx(Form,{onSubmit:a,form:o,id:s,children:jsxRuntimeExports.jsx(FormTextField,{placeholder:n({message:"Enter a name..."}),"aria-label":"Entry name",autoFocus:!0,autoSelectText:!0,name:"name",required:!0,minLength:3,maxLength:200})})}),jsxRuntimeExports.jsxs(DialogFooter,{children:[jsxRuntimeExports.jsx(Button,{variant:"flat",onClick:()=>t(),children:jsxRuntimeExports.jsx(Trans,{message:"Cancel"})}),jsxRuntimeExports.jsx(Button,{form:s,type:"submit",variant:"flat",color:"primary",disabled:i.isPending,children:jsxRuntimeExports.jsx(Trans,{message:"Create"})})]})]})}function EntryPreviewDialog({selectedEntry:e}){const t=useEntries().filter(i=>i.type!=="folder"),s=t.findIndex(i=>i.id===(e==null?void 0:e.id)),[n,o]=reactExports.useState(s);return jsxRuntimeExports.jsx(FilePreviewDialog,{allowDownload:e.permissions["files.download"],headerActionsLeft:jsxRuntimeExports.jsx(DriveActions,{activeIndex:n,entries:t}),activeIndex:n,onActiveIndexChange:o,entries:t})}function DriveActions({activeIndex:e,entries:t}){const s=t[e],n=useShareAction([s]);return!s||!n?null:jsxRuntimeExports.jsxs(reactExports.Fragment,{children:[jsxRuntimeExports.jsx(IconButton,{className:"md:hidden",onClick:()=>{n.execute()},children:reactExports.createElement(n.icon)}),jsxRuntimeExports.jsx(Button,{className:"max-md:hidden",variant:"text",startIcon:reactExports.createElement(n.icon),onClick:()=>{n.execute()},children:jsxRuntimeExports.jsx(Trans,{...n.label})})]})}function shareEntry({entryId:e,...t}){return apiClient.post(`file-entries/${e}/share`,t).then(s=>s.data)}function useShareEntry(){return useMutation({mutationFn:e=>shareEntry(e),onSuccess:()=>{invalidateEntryQueries()},onError:e=>{var t,s;if(axios.isAxiosError(e)&&e.response){const n=e.response.data;(t=n.errors)!=null&&t.emails?toast.danger((s=n.errors)==null?void 0:s.emails[0]):showHttpErrorToast(e)}}})}const DRIVE_ENTRY_FULL_PERMISSIONS={edit:!0,view:!0,download:!0},PermissionSelectorItems=[{key:"view",value:{view:!0},label:message("Can view")},{key:"download",value:{view:!0,download:!0},label:message("Can Download")},{key:"edit",value:DRIVE_ENTRY_FULL_PERMISSIONS,label:message("Can edit")}];function PermissionSelector({value:e,onChange:t,isDisabled:s}){return jsxRuntimeExports.jsxs(MenuTrigger,{selectedValue:e.key,selectionMode:"single",onSelectionChange:n=>{n!==e.key&&t(PermissionSelectorItems.find(o=>o.key===n))},children:[jsxRuntimeExports.jsx(Button,{variant:"flat",color:"chip",size:"xs",endIcon:jsxRuntimeExports.jsx(ArrowDropDownIcon,{}),disabled:s,children:jsxRuntimeExports.jsx(Trans,{...e.label})}),jsxRuntimeExports.jsx(Menu,{children:PermissionSelectorItems.map(n=>jsxRuntimeExports.jsx(Item,{value:n.key,children:jsxRuntimeExports.jsx(Trans,{...n.label})},n.key))})]})}function getPermissionItemForUser(e){const{download:t,edit:s}=e.entry_permissions;return s?PermissionSelectorItems.find(n=>n.key==="edit"):t?PermissionSelectorItems.find(n=>n.key==="download"):PermissionSelectorItems.find(n=>n.key==="view")}function useChangePermission(){return useMutation({mutationFn:e=>changePermission(e),onSuccess:()=>{invalidateEntryQueries(),toast(message("Updated user permissions"))},onError:e=>showHttpErrorToast(e,message("Could not update permissions"))})}function changePermission({entryId:e,...t}){return apiClient.put(`file-entries/${e}/change-permissions`,t).then(s=>s.data)}function MemberList({className:e,entry:t}){if(!t)return null;const s=t.users;return jsxRuntimeExports.jsxs("div",{className:clsx(e,"overflow-hidden"),children:[jsxRuntimeExports.jsx("div",{className:"mb-14 text-sm",children:jsxRuntimeExports.jsx(Trans,{message:"Who has access"})}),jsxRuntimeExports.jsx(AnimatePresence,{initial:!1,children:s.map(n=>jsxRuntimeExports.jsx(MemberListItem,{user:n,entry:t},n.id))})]})}function MemberListItem({user:e,entry:t}){return jsxRuntimeExports.jsxs(m.div,{initial:{x:"-100%",opacity:0},animate:{x:0,opacity:1},exit:{x:"100%",opacity:0},transition:{type:"tween",duration:.125},className:"mb-20 flex items-center gap-14 text-sm",children:[jsxRuntimeExports.jsx(UserAvatar,{user:e,circle:!0,size:"w-44 h-44"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{children:e.name}),jsxRuntimeExports.jsx("div",{className:"text-muted",children:e.email})]}),jsxRuntimeExports.jsx("div",{className:"ml-auto",children:e.owns_entry?jsxRuntimeExports.jsx("span",{className:"text-muted",children:jsxRuntimeExports.jsx(Trans,{message:"Owner"})}):jsxRuntimeExports.jsx(ActionButtons,{user:e,entry:t})})]},e.id)}function ActionButtons({user:e,entry:t}){const s=useChangePermission(),n=useUnshareEntries(),[o,i]=reactExports.useState(()=>getPermissionItemForUser(e));return jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-10",children:[jsxRuntimeExports.jsx(PermissionSelector,{isDisabled:s.isPending,onChange:a=>{s.mutate({userId:e.id,permissions:a.value,entryId:t.id}),i(a)},value:o}),jsxRuntimeExports.jsx(IconButton,{disabled:n.isPending,onClick:()=>{n.mutate({userId:e.id,entryIds:[t.id]},{onSuccess:()=>{toast(message("Member removed"))},onError:a=>showHttpErrorToast(a,message("Could not remove member"))})},children:jsxRuntimeExports.jsx(CloseIcon,{})})]})}function SharePanel({className:e,entry:t}){var f;const{trans:s}=useTrans(),{share:n}=useSettings(),o=useShareEntry(),[i,a]=reactExports.useState([]),[l,u]=reactExports.useState(!1),[c,x]=reactExports.useState(PermissionSelectorItems[0]),d=i.every(v=>!v.invalid),[p,h]=reactExports.useState(""),g=useNormalizedModels("normalized-models/user",{perPage:7,query:p},{enabled:n==null?void 0:n.suggest_emails}),j=v=>v.description||v.name;return jsxRuntimeExports.jsxs("div",{className:e,children:[jsxRuntimeExports.jsx(ChipField,{value:i,onChange:a,isAsync:!0,isLoading:g.fetchStatus==="fetching",inputValue:p,onInputValueChange:h,suggestions:(f=g.data)==null?void 0:f.results,displayWith:j,validateWith:v=>{const R=!isEmail(v.description);return{...v,invalid:R,errorMessage:R?s({message:"Not a valid email"}):void 0}},placeholder:s({message:"Enter email addresses"}),label:jsxRuntimeExports.jsx(Trans,{message:"Invite people"}),children:v=>jsxRuntimeExports.jsx(Item,{value:v.id,startIcon:jsxRuntimeExports.jsx(Avatar,{circle:!0,src:v.image,alt:""}),description:v.description,children:v.name})}),jsxRuntimeExports.jsxs("div",{className:"mt-14 flex items-center justify-between gap-14",children:[jsxRuntimeExports.jsx(PermissionSelector,{onChange:x,value:c}),i.length?jsxRuntimeExports.jsx(Button,{variant:"flat",color:"primary",size:"sm",disabled:l||!d,onClick:()=>{u(!0),o.mutate({emails:i.map(v=>j(v)),permissions:c.value,entryId:t.id},{onSuccess:()=>{a([])},onSettled:()=>{u(!1)}})},children:jsxRuntimeExports.jsx(Trans,{message:"Share"})}):null]}),jsxRuntimeExports.jsx(MemberList,{className:"mt-30",entry:t})]})}function useEntryShareableLink(e){return useQuery({queryKey:DriveQueryKeys.fetchEntryShareableLink(e),queryFn:()=>fetchLinkByEntryId(e),enabled:!!e})}function fetchLinkByEntryId(e){return apiClient.get(`file-entries/${e}/shareable-link`,{params:{loader:"shareableLink"}}).then(t=>t.data)}function deleteShareableLink({entryId:e}){return apiClient.delete(`file-entries/${e}/shareable-link`).then(t=>t.data)}function useDeleteShareableLink(){return useMutation({mutationFn:({entryId:e})=>deleteShareableLink({entryId:e}),onSuccess:(e,{entryId:t})=>{queryClient.setQueryData(DriveQueryKeys.fetchEntryShareableLink(t),{...e,link:null})},onError:e=>showHttpErrorToast(e,message("Could not delete link"))})}function randomString(e=36){let t="";const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let n=0;n<e;n+=1)t+=s.charAt(Math.floor(Math.random()*s.length));return t}function ShareableLinkPanel({setActivePanel:e,entry:t,focusInput:s}){var u,c;const n=useEntryShareableLink(t.id),o=!!((u=n.data)!=null&&u.link),i=useCreateShareableLink(),a=useDeleteShareableLink(),l=n.isLoading||i.isPending||a.isPending;return jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"mb-10",children:jsxRuntimeExports.jsx(Trans,{message:"Share link"})}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between gap-14 px-2 pb-4",children:[jsxRuntimeExports.jsx(Switch,{checked:o,disabled:l,onChange:()=>{o?a.mutate({entryId:t.id}):i.mutate({entryId:t.id})},children:o?jsxRuntimeExports.jsx(Trans,{message:"Shareable link is created"}):jsxRuntimeExports.jsx(Trans,{message:"Create shareable link"})}),o&&jsxRuntimeExports.jsx(Button,{variant:"link",color:"primary",onClick:()=>{e("linkSettings")},children:jsxRuntimeExports.jsx(Trans,{message:"Link settings"})})]}),jsxRuntimeExports.jsx(ShareableLinkInput,{autoFocus:s,link:(c=n.data)==null?void 0:c.link})]})}function ShareableLinkInput({link:e,autoFocus:t}){const{base_url:s}=useSettings(),{trans:n}=useTrans(),o=useActiveDialogEntry(),i=(e==null?void 0:e.hash)||(o==null?void 0:o.hash)||randomString(),a=`${s}/drive/s/${i}`,[l,u]=useClipboard(a,{successDuration:1e3});return jsxRuntimeExports.jsx(TextField,{autoFocus:t,disabled:!e,className:"mt-10",readOnly:!0,value:a,"aria-label":n({message:"Shareable link"}),onFocus:c=>{c.target.select()},endAppend:jsxRuntimeExports.jsx(Button,{className:"min-w-100",variant:"flat",color:"primary",onClick:u,children:l?jsxRuntimeExports.jsx(Trans,{message:"Copied!"}):jsxRuntimeExports.jsx(Trans,{message:"Copy"})})})}function updateShareableLink({entryId:e,...t}){return apiClient.put(`file-entries/${e}/shareable-link`,t).then(s=>s.data)}function useUpdateShareableLink(e){return useMutation({mutationFn:t=>updateShareableLink(t),onSuccess:(t,{entryId:s})=>{queryClient.setQueryData(DriveQueryKeys.fetchEntryShareableLink(s),t)},onError:t=>onFormQueryError(t,e)})}function LinkSettingsDialog({className:e,setActivePanel:t,entry:s}){const{formId:n}=useDialogContext(),{data:o}=useEntryShareableLink(s.id),i=o==null?void 0:o.link,a=useForm({defaultValues:{allowDownload:i==null?void 0:i.allow_download,allowEdit:i==null?void 0:i.allow_edit,expiresAt:i==null?void 0:i.expires_at,entryId:s.id}}),l=useUpdateShareableLink(a);return jsxRuntimeExports.jsxs(reactExports.Fragment,{children:[jsxRuntimeExports.jsx(DialogHeader,{onDismiss:()=>{t("main")},children:jsxRuntimeExports.jsx(Trans,{message:"Shareable Link Settings"})}),jsxRuntimeExports.jsx(DialogBody,{children:jsxRuntimeExports.jsx(m.div,{className:"min-h-[335px]",animate:{opacity:1,y:0},initial:{opacity:0,y:20},exit:{opacity:0,y:-20},transition:{duration:.1},children:jsxRuntimeExports.jsxs(Form,{id:n,className:e,form:a,onSubmit:u=>{l.mutate(u,{onSuccess:()=>{t("main"),toast(message("Link settings saved"))}})},children:[jsxRuntimeExports.jsx(LinkExpirationOption,{showField:!!(i!=null&&i.expires_at)}),jsxRuntimeExports.jsx(LinkPasswordOption,{showField:!!(i!=null&&i.password)}),jsxRuntimeExports.jsxs(LinkOption,{children:[jsxRuntimeExports.jsx(Trans,{message:"Allow download"}),jsxRuntimeExports.jsx(FormSwitch,{name:"allowDownload",children:jsxRuntimeExports.jsx(Trans,{message:"Users with link can download this item"})})]}),jsxRuntimeExports.jsxs(LinkOption,{showBorder:!1,children:[jsxRuntimeExports.jsx(Trans,{message:"Allow import"}),jsxRuntimeExports.jsx(FormSwitch,{name:"allowEdit",children:jsxRuntimeExports.jsx(Trans,{message:"Users with link can import this item into their own drive"})})]})]})},"link-settings-content")}),jsxRuntimeExports.jsxs(DialogFooter,{children:[jsxRuntimeExports.jsx(Button,{type:"button",onClick:()=>{t("main")},children:jsxRuntimeExports.jsx(Trans,{message:"Cancel"})}),jsxRuntimeExports.jsx(Button,{type:"submit",form:n,variant:"flat",color:"primary",disabled:l.isPending,children:jsxRuntimeExports.jsx(Trans,{message:"Save"})})]})]})}const minDate=$14e0f24ef4ac5c92$export$461939dd4422153($14e0f24ef4ac5c92$export$aa8b41735afcabd2());function LinkExpirationOption({showField:e}){const{trans:t}=useTrans(),[s,n]=reactExports.useState(e);return jsxRuntimeExports.jsxs(LinkOption,{children:[jsxRuntimeExports.jsx(Trans,{message:"Link expiration"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Switch,{checked:s,onChange:o=>{n(o.target.checked)},children:jsxRuntimeExports.jsx(Trans,{message:"Link is valid until"})}),s&&jsxRuntimeExports.jsx(FormDatePicker,{min:minDate,name:"expiresAt",granularity:"minute",className:"mt-20","aria-label":t({message:"Link expiration date and time"})})]})]})}function LinkPasswordOption({showField:e}){const{trans:t}=useTrans(),[s,n]=reactExports.useState(e);return jsxRuntimeExports.jsxs(LinkOption,{children:[jsxRuntimeExports.jsx(Trans,{message:"Password protect"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Switch,{checked:s,onChange:o=>{n(o.target.checked)},children:jsxRuntimeExports.jsx(Trans,{message:"Users will need to enter password in order to view this link"})}),s&&jsxRuntimeExports.jsx(FormTextField,{type:"password",autoFocus:!0,name:"password",className:"mt-20","aria-label":t({message:"Link password"}),description:jsxRuntimeExports.jsx(Trans,{message:"Password will not be requested when viewing the link as file owner."}),placeholder:t({message:"Enter new password..."})})]})]})}function LinkOption({children:e,showBorder:t=!0}){const[s,n]=e;return jsxRuntimeExports.jsxs("div",{className:clsx(t&&"mb-20 border-b pb-20"),children:[jsxRuntimeExports.jsx("div",{className:"mb-8 text-sm font-medium",children:s}),n]})}function ShareDialog({entry:e,focusLinkInput:t}){const{data:{fileEntry:s}}=useQuery({queryKey:DriveQueryKeys.fetchFileEntry(e.id),queryFn:()=>apiClient.get(`drive/file-entries/${e.id}/model`).then(i=>i.data),initialData:{fileEntry:e}}),[n,o]=reactExports.useState("main");return jsxRuntimeExports.jsx(Dialog,{size:"lg",children:jsxRuntimeExports.jsx(AnimatePresence,{initial:!1,mode:"wait",children:n==="linkSettings"?jsxRuntimeExports.jsx(LinkSettingsDialog,{setActivePanel:o,entry:s},"one"):jsxRuntimeExports.jsx(MainDialog,{setActivePanel:o,entry:s,focusLinkInput:t},"two")})})}function MainDialog({setActivePanel:e,entry:t,focusLinkInput:s}){return jsxRuntimeExports.jsxs(reactExports.Fragment,{children:[jsxRuntimeExports.jsx(DialogHeader,{children:jsxRuntimeExports.jsx(Trans,{message:"Share ‘:name’",values:{name:t.name}})}),jsxRuntimeExports.jsx(DialogBody,{className:"relative",children:jsxRuntimeExports.jsxs(m.div,{animate:{opacity:1,y:0},initial:{opacity:0,y:20},exit:{opacity:0,y:-20},transition:{duration:.1},children:[jsxRuntimeExports.jsx(SharePanel,{className:"mb-30 border-b pb-30",entry:t}),jsxRuntimeExports.jsx(ShareableLinkPanel,{setActivePanel:e,entry:t,focusInput:!!s})]},"share-content")})]})}function useMoveEntriesDialogFolderSearch({query:e}){const{workspaceId:t}=useActiveWorkspaceId(),s=reactExports.useMemo(()=>({section:"search",workspaceId:t,query:e,filters:encodeBackendFilters([{key:"type",value:"folder"}])}),[t,e]);return useQuery({queryKey:DriveQueryKeys.fetchEntries(s),queryFn:({signal:n})=>fetchEntries$1(s,n),enabled:!!e,placeholderData:keepPreviousData})}async function fetchEntries$1(e,t){return e.query&&await new Promise(s=>setTimeout(s,300)),apiClient.get("drive/file-entries",{params:e,signal:e.query?t:void 0}).then(s=>s.data)}function MoveEntriesDialogSearch({onFolderSelected:e}){const{trans:t}=useTrans(),s=t({message:"Search folders"}),[n,o]=reactExports.useState(""),{isFetching:i,data:a}=useMoveEntriesDialogFolderSearch({query:n}),l=a==null?void 0:a.data;return jsxRuntimeExports.jsx(ComboBoxForwardRef,{size:"sm",maxItems:10,placeholder:s,"aria-label":s,className:"pt-20",endAdornmentIcon:jsxRuntimeExports.jsx(SearchIcon,{}),isAsync:!0,isLoading:i,inputValue:n,onInputValueChange:o,blurReferenceOnItemSelection:!0,clearInputOnItemSelection:!0,selectionMode:"none",openMenuOnFocus:!1,children:l==null?void 0:l.map(u=>jsxRuntimeExports.jsx(Item,{value:u.id,textLabel:u.name,onSelected:()=>{e(u)},children:u.name},u.id))})}function MoveEntriesDialogBreadcrumbs({selectedFolder:e,onFolderSelected:t}){const{data:s}=useFolderPath({hash:e.hash,isEnabled:(e==null?void 0:e.hash)!==RootFolderPage.folder.hash});let n=null;return s!=null&&s.path&&(s.path.length===1?n=RootFolderPage.folder:n=s.path[s.path.length-2]),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-6 border-b pb-10",children:[jsxRuntimeExports.jsx(IconButton,{className:"flex-shrink-0",variant:"outline",size:"xs",disabled:!n,onClick:()=>{n&&t(n)},children:jsxRuntimeExports.jsx(ArrowBackIcon,{})}),jsxRuntimeExports.jsxs(Breadcrumb,{size:"sm",className:"flex-auto",children:[jsxRuntimeExports.jsxs(BreadcrumbItem,{onSelected:()=>{t(RootFolderPage.folder)},className:"flex items-center gap-8",children:[jsxRuntimeExports.jsx(FolderIcon,{className:"icon-sm"}),jsxRuntimeExports.jsx(Trans,{message:RootFolderPage.folder.name})]}),s==null?void 0:s.path.map(o=>jsxRuntimeExports.jsxs(BreadcrumbItem,{onSelected:()=>{t(o)},className:"flex items-center gap-8",children:[!o.id&&jsxRuntimeExports.jsx(FolderIcon,{className:"icon-sm"}),o.name]},o.id||"root"))]})]})}const myFilesSvg=""+new URL("my-files-88476671.svg",import.meta.url).href;function useMoveEntriesDialogFolders({selectedFolder:e,movingSharedFiles:t}){const{workspaceId:s}=useActiveWorkspaceId(),n=reactExports.useMemo(()=>{const o=encodeBackendFilters([{key:"type",value:"folder"}]);return{section:"folder",folderId:e.hash=="0"&&t?"sharedWithMe":e.hash,workspaceId:s,filters:o}},[s,e.hash,t]);return useInfiniteQuery({queryKey:DriveQueryKeys.fetchEntries(n),queryFn:({pageParam:o=1})=>fetchEntries({...n,page:o}),initialPageParam:1,getNextPageParam:o=>{const i=o.current_page;if(hasNextPage$1(o))return i+1}})}function fetchEntries(e){return apiClient.get("drive/file-entries",{params:e}).then(t=>t.data)}function MoveEntriesDialogFolderList({onFolderSelected:e,selectedFolder:t,movingSharedFiles:s}){var i,a,l;const n=useMoveEntriesDialogFolders({selectedFolder:t,movingSharedFiles:s});let o;return n.isLoading?o=jsxRuntimeExports.jsx("div",{className:"flex h-full w-full items-center justify-center",children:jsxRuntimeExports.jsx(ProgressCircle,{isIndeterminate:!0,size:"md"})}):((a=(i=n.data)==null?void 0:i.pages[0])==null?void 0:a.data.length)===0?o=jsxRuntimeExports.jsx(IllustratedMessage,{size:"xs",className:"pb-20 pt-64",image:jsxRuntimeExports.jsx(SvgImage,{src:myFilesSvg}),title:jsxRuntimeExports.jsx(Trans,{message:'There are no subfolders in ":folder"',values:{folder:t.name}})}):o=jsxRuntimeExports.jsxs(reactExports.Fragment,{children:[jsxRuntimeExports.jsx(List,{children:(l=n.data)==null?void 0:l.pages.flatMap(u=>u.data).map(u=>jsxRuntimeExports.jsx(ListItem,{className:"min-h-48 border-b",onSelected:()=>{e(u)},startIcon:jsxRuntimeExports.jsx(FileTypeIcon,{type:"folder"}),endIcon:jsxRuntimeExports.jsx(ChevronRightIcon,{size:"md"}),children:u.name},u.id))}),jsxRuntimeExports.jsx(InfiniteScrollSentinel,{query:n})]}),jsxRuntimeExports.jsx("div",{className:"h-288 overflow-y-auto",children:o})}function MoveEntriesDialog({entries:e}){const{user:t}=useAuth(),s=useDriveStore(a=>a.activePage),[n,o]=reactExports.useState((s==null?void 0:s.folder)||RootFolderPage.folder),i=e.some(a=>{var l;return!((l=a.users.find(u=>u.id===t.id))!=null&&l.owns_entry)});return jsxRuntimeExports.jsxs(Dialog,{size:"lg",children:[jsxRuntimeExports.jsx(DialogHeader,{children:jsxRuntimeExports.jsx(Trans,{message:"Move [one ‘:name‘|other :count items]",values:{count:e.length,name:e[0].name}})}),jsxRuntimeExports.jsxs(DialogBody,{children:[jsxRuntimeExports.jsx("div",{className:"text-sm",children:jsxRuntimeExports.jsx(Trans,{message:"Select a destination folder."})}),jsxRuntimeExports.jsx(MoveEntriesDialogSearch,{onFolderSelected:o}),jsxRuntimeExports.jsxs("div",{className:"mb-20 mt-40",children:[jsxRuntimeExports.jsx(MoveEntriesDialogBreadcrumbs,{selectedFolder:n,onFolderSelected:o}),jsxRuntimeExports.jsx(MoveEntriesDialogFolderList,{movingSharedFiles:i,selectedFolder:n,onFolderSelected:o})]})]}),jsxRuntimeExports.jsx(Footer,{selectedFolder:n,setSelectedFolder:o,entries:e})]})}function Footer({selectedFolder:e,setSelectedFolder:t,entries:s}){const{close:n}=useDialogContext(),o=useMoveEntries();return jsxRuntimeExports.jsxs(DialogFooter,{className:"border-t",startAction:jsxRuntimeExports.jsxs(DialogTrigger,{type:"modal",onClose:i=>{i&&t(i)},children:[jsxRuntimeExports.jsx(Button,{startIcon:jsxRuntimeExports.jsx(CreateNewFolderIcon,{}),variant:"text",children:jsxRuntimeExports.jsx(Trans,{message:"New Folder"})}),jsxRuntimeExports.jsx(NewFolderDialog,{parentId:e.id})]}),children:[jsxRuntimeExports.jsx(Button,{className:"max-md:hidden",variant:"flat",onClick:()=>n(),children:jsxRuntimeExports.jsx(Trans,{message:"Cancel"})}),jsxRuntimeExports.jsx(Button,{type:"submit",variant:"flat",color:"primary",disabled:!canMoveEntriesInto(s,e)||o.isPending,onClick:()=>{o.mutate({destinationId:e.id,entryIds:s.map(i=>i.id)},{onSuccess:n})},children:jsxRuntimeExports.jsx(Trans,{message:"Move here"})})]})}function DeleteEntriesForeverDialog({entries:e}){const t=useDeleteEntries(),{close:s}=useDialogContext(),n=e.length===1?jsxRuntimeExports.jsx(Trans,{message:"‘:name‘ will be deleted forever and you won't be able to restore it.",values:{name:e[0].name}}):jsxRuntimeExports.jsx(Trans,{message:":count items will be deleted forever and you won't be able to restore them.",values:{count:e.length}});return jsxRuntimeExports.jsx(ConfirmationDialog,{isDanger:!0,title:jsxRuntimeExports.jsx(Trans,{message:"Delete forever?"}),body:n,confirm:jsxRuntimeExports.jsx(Trans,{message:"Delete forever"}),isLoading:t.isPending,onConfirm:()=>{t.mutate({entryIds:e.map(o=>o.id),deleteForever:!0},{onSuccess:()=>{s(),driveState().selectEntries([])}})}})}function BlockTrashFolderViewDialog({entries:e}){const t=useRestoreEntries(),{close:s}=useDialogContext();return jsxRuntimeExports.jsx(ConfirmationDialog,{title:jsxRuntimeExports.jsx(Trans,{message:"This folder is in your trash"}),body:jsxRuntimeExports.jsx(Trans,{message:"To view this folder, restore it from the trash."}),confirm:jsxRuntimeExports.jsx(Trans,{message:"Restore"}),isLoading:t.isPending,onConfirm:()=>{t.mutate({entryIds:e.map(n=>n.id)},{onSuccess:()=>{s(),driveState().selectEntries([])}})}})}function DriveDialogsContainer(){const e=useDriveStore(s=>s.activeActionDialog),t=getDialog(e);return jsxRuntimeExports.jsx(DialogTrigger,{type:"modal",isOpen:!!t,onClose:()=>{driveState().setActiveActionDialog(null)},children:t})}function getDialog(e){var t;switch(e==null?void 0:e.name){case"rename":return jsxRuntimeExports.jsx(RenameEntryDialog,{entries:e.entries});case"newFolder":return jsxRuntimeExports.jsx(NewFolderDialog,{parentId:(t=e.entries[0])==null?void 0:t.id});case"preview":return jsxRuntimeExports.jsx(EntryPreviewDialog,{selectedEntry:e.entries[0]});case"share":return jsxRuntimeExports.jsx(ShareDialog,{entry:e.entries[0]});case"getLink":return jsxRuntimeExports.jsx(ShareDialog,{entry:e.entries[0],focusLinkInput:!0});case"moveTo":return jsxRuntimeExports.jsx(MoveEntriesDialog,{entries:e.entries});case"confirmAndDeleteForever":return jsxRuntimeExports.jsx(DeleteEntriesForeverDialog,{entries:e.entries});case"trashFolderBlock":return jsxRuntimeExports.jsx(BlockTrashFolderViewDialog,{entries:e.entries});default:return null}}function NavbarSearch(){const{trans:e}=useTrans(),t=useNavigate(),s=useDriveStore(a=>a.activePage),[n]=useSearchParams(),[o,i]=reactExports.useState(n.get("query")||"");return jsxRuntimeExports.jsx("form",{className:"max-w-620 flex-auto",onSubmit:a=>{a.preventDefault(),t({pathname:SearchPage.path,search:`?query=${o}`},{replace:!0})},children:jsxRuntimeExports.jsx(TextField,{size:"sm",background:"bg",value:o,onChange:a=>i(a.target.value),onFocus:()=>{s!==SearchPage&&t(SearchPage.path)},startAdornment:jsxRuntimeExports.jsx(IconButton,{type:"submit",children:jsxRuntimeExports.jsx(SearchIcon,{})}),className:"max-w-420 flex-auto",placeholder:e({message:"Search"}),"aria-label":e({message:"Search files and folders"})})})}function useDragMonitor(e){const t=reactExports.useRef(e),s=reactExports.useId();reactExports.useEffect(()=>(dragMonitors.set(s,t.current),()=>{dragMonitors.delete(s)}),[s])}function EntryDragPreview(){const e=reactExports.useRef(null),[t,s]=reactExports.useState(),[n,o]=reactExports.useState({});useDragMonitor({type:"fileEntry",onDragStart:(a,l)=>{const u=l;u&&(o({entries:u.getData(),e:a,draggingTreeItem:isFolderTreeDragId(u.id)}),s({start:a}))},onDragMove:a=>{o(l=>({...l,e:a})),s(l=>({...l,end:a}))},onDragEnd:(a,l,u)=>{o({status:u})}});let i=null;return n.entries&&n.e&&(i=jsxRuntimeExports.jsx("div",{ref:e,style:n.e?{transform:`translate(${n.e.x}px, ${n.e.y}px)`,width:`${n.e.rect.width}px`}:void 0,className:"pointer-events-none fixed left-0 top-0 isolate",children:n.entries.map((a,l)=>jsxRuntimeExports.jsx(EntryPreview,{index:l,entry:a,points:t,state:n},a.id))})),jsxRuntimeExports.jsx(AnimatePresence,{custom:n.status,children:i})}const EntryPreview=reactExports.memo(({entry:e,points:t,index:s,state:n})=>{var x,d,p,h;const o=useDriveStore(g=>g.viewMode),i=n.draggingTreeItem?makeFolderTreeDragId(e):e.id,a=droppables.get(i);if(!(a!=null&&a.rect)||!(t!=null&&t.start))return null;const l=a.rect,u=((x=n.entries)==null?void 0:x.length)||0,c=g=>{var j,f,v;return g==="dropSuccess"?{x:0,y:0,opacity:0,transition:{duration:.1,delay:0}}:{x:l.left-(((j=t.end)==null?void 0:j.x)||0),y:l.top-(((f=t.end)==null?void 0:f.y)||0),width:`${(v=n.e)==null?void 0:v.rect.width}px`}};return jsxRuntimeExports.jsxs(m.div,{transition:{delay:.01*s,bounce:0,duration:.2},initial:{x:l.left-t.start.x,y:l.top-t.start.y,width:`${(d=n.e)==null?void 0:d.rect.width}px`},animate:{x:0,y:0,width:o==="list"?288:void 0},exit:c,style:{width:o==="grid"?`${(p=n.e)==null?void 0:p.rect.width}px`:void 0,height:`${(h=n.e)==null?void 0:h.rect.height}px`},className:clsx("absolute max-h-48 whitespace-nowrap rounded border border-primary-light bg-paper",s<2&&"shadow",s===0&&"left-0 top-0 z-10",s>0&&"left-6 top-6"),children:[u>1&&s===0&&jsxRuntimeExports.jsx(EntryCount,{count:u}),jsxRuntimeExports.jsxs("div",{className:"flex h-full items-center justify-center gap-10 overflow-hidden bg-primary-light/20 px-16 text-sm",children:[jsxRuntimeExports.jsx(FileTypeIcon,{type:e.type}),jsxRuntimeExports.jsx("div",{className:"flex-auto overflow-hidden text-ellipsis",children:e.name})]})]},e.id)}),EntryCount=reactExports.memo(({count:e})=>jsxRuntimeExports.jsx(m.div,{initial:{opacity:0},animate:{opacity:1,transition:{delay:.1}},exit:{opacity:0},transition:{duration:.1},className:"absolute -right-6 -top-6 z-10 z-30 flex h-20 w-20 items-center justify-center rounded-full bg-danger text-sm font-bold text-white shadow-lg",children:e},"entryCount"));function DashboardContentHeader({children:e,className:t}){return jsxRuntimeExports.jsx("div",{className:clsx(t,"dashboard-grid-header"),children:e})}function DriveContentHeader(){const{isMobileMode:e}=reactExports.useContext(DashboardLayoutContext),t=useDriveStore(s=>s.activePage);return jsxRuntimeExports.jsxs(DashboardContentHeader,{className:"flex h-60 items-center gap-20 border-b px-8 py-4 md:px-26",children:[e?jsxRuntimeExports.jsx(DriveSortButton,{isDisabled:t==null?void 0:t.disableSort}):jsxRuntimeExports.jsx(PageBreadcrumbs,{}),jsxRuntimeExports.jsxs("div",{className:"ml-auto flex-shrink-0 text-muted",children:[jsxRuntimeExports.jsx(ToggleViewModeButton,{}),jsxRuntimeExports.jsx(ToggleDetailsButton,{})]})]})}function ToggleViewModeButton(){const e=useDriveStore(s=>s.viewMode),t=e==="grid"?jsxRuntimeExports.jsx(Trans,{message:"List view"}):jsxRuntimeExports.jsx(Trans,{message:"Grid view"});return jsxRuntimeExports.jsx(Tooltip,{label:t,children:jsxRuntimeExports.jsx(IconButton,{size:"md",onClick:()=>{driveState().setViewMode(driveState().viewMode==="list"?"grid":"list")},children:e==="list"?jsxRuntimeExports.jsx(ViewListIcon,{}):jsxRuntimeExports.jsx(ViewModuleIcon,{})})})}function ToggleDetailsButton(){const{rightSidenavStatus:e,setRightSidenavStatus:t}=reactExports.useContext(DashboardLayoutContext),s=e?jsxRuntimeExports.jsx(Trans,{message:"Hide details"}):jsxRuntimeExports.jsx(Trans,{message:"Show details"});return jsxRuntimeExports.jsx(Tooltip,{label:s,children:jsxRuntimeExports.jsx(IconButton,{size:"md",color:e==="open"?"primary":null,onClick:()=>{t(e==="open"?"closed":"open")},children:jsxRuntimeExports.jsx(InfoIcon,{})})})}function DashboardSidenav({className:e,position:t,children:s,size:n="md",mode:o,overlayPosition:i="fixed",display:a="flex",overflow:l="overflow-hidden",forceClosed:u=!1}){const{isMobileMode:c,leftSidenavStatus:x,setLeftSidenavStatus:d,rightSidenavStatus:p,setRightSidenavStatus:h}=reactExports.useContext(DashboardLayoutContext),g=c||o==="overlay";let j=t==="left"?x:p;g&&j==="compact"&&(j="open");const f={open:{display:a,width:getAnimateSize(j==="compact"?"compact":n)},closed:{width:0,transitionEnd:{display:"none"}}},v=getSizeClassName(j==="compact"?"compact":n);return jsxRuntimeExports.jsx(m.div,{variants:f,initial:!1,animate:u||j==="closed"?"closed":"open",transition:{type:"tween",duration:.15},onClick:R=>{const E=R.target;c&&(E.closest("button")||E.closest("a"))&&(d("closed"),h("closed"))},className:clsx(e,t==="left"?"dashboard-grid-sidenav-left":"dashboard-grid-sidenav-right",l,v,g&&`${i} bottom-0 top-0 z-20 shadow-2xl`,g&&t==="left"&&"left-0",g&&t==="right"&&"right-0"),children:reactExports.cloneElement(s,{className:clsx(s.props.className,"w-full h-full overflow-y-auto compact-scrollbar",j==="compact"&&"hidden-scrollbar"),isCompactMode:j==="compact",isOverlayMode:g})})}function getSizeClassName(e){switch(e){case"compact":return"w-60";case"sm":return"w-224";case"md":return"w-240";case"lg":return"w-288";default:return e||""}}function getAnimateSize(e){switch(e){case"compact":return 60;case"sm":return 224;case"md":return 240;case"lg":return 288;default:return null}}function DashboardNavbar({children:e,className:t,hideToggleButton:s,...n}){const{isMobileMode:o,leftSidenavStatus:i,setLeftSidenavStatus:a,name:l,leftSidenavCanBeCompact:u}=reactExports.useContext(DashboardLayoutContext),c=u&&!o,x=!s&&(o||u),d=()=>{a(i==="open"?"closed":"open")},p=()=>{const h=i==="compact"?"open":"compact";setInLocalStorage(`${l}.sidenav.compact`,h==="compact"),a(h)};return jsxRuntimeExports.jsx(Navbar$1,{className:clsx("dashboard-grid-navbar",t),border:"border-b",size:"sm",toggleButton:x?jsxRuntimeExports.jsx(IconButton,{size:"md",onClick:()=>{c?p():d()},children:jsxRuntimeExports.jsx(MenuOpenIcon,{})}):void 0,...n,children:e})}function useBlockBodyOverflow(e=!1){reactExports.useEffect(()=>(e?document.documentElement.classList.remove("no-page-overflow"):document.documentElement.classList.add("no-page-overflow"),()=>{document.documentElement.classList.remove("no-page-overflow")}),[e])}function DashboardLayout({children:e,leftSidenavStatus:t,onLeftSidenavChange:s,rightSidenavStatus:n,compactByDefault:o,initialRightSidenavStatus:i,onRightSidenavChange:a,name:l,leftSidenavCanBeCompact:u,height:c="h-screen",className:x,gridClassName:d="dashboard-grid",blockBodyOverflow:p=!0,...h}){useBlockBodyOverflow(!p);const g=useMediaQuery("(max-width: 1024px)"),f=reactExports.useMemo(()=>{if(!l)return o??!1;const w=getFromLocalStorage(`${l}.sidenav.compact`);return w??o??!1},[l,o])?"compact":"open",[v,R]=$458b0a5536c1a7cf$export$40bfa8c7b0832715(t,g?"closed":f,s),E=reactExports.useMemo(()=>{if(g)return"closed";if(i!=null)return i;const w=getFromLocalStorage(`${l}.sidenav.right.position`,"open");return w??(i||"closed")},[g,l,i]),[b,I]=$458b0a5536c1a7cf$export$40bfa8c7b0832715(n,E,a),S=reactExports.useCallback(w=>{I(w),setInLocalStorage(`${l}.sidenav.right.position`,w)},[I,l]),P=usePrevious(g);reactExports.useEffect(()=>{g!==P&&(g?(R("closed"),S("closed")):(R(f),S(E)))},[g,f,E,P,R,S]);const y=g&&(v==="open"||b==="open");return jsxRuntimeExports.jsx(DashboardLayoutContext.Provider,{value:{leftSidenavStatus:v,setLeftSidenavStatus:R,rightSidenavStatus:b,setRightSidenavStatus:S,leftSidenavCanBeCompact:u,name:l,isMobileMode:g},children:jsxRuntimeExports.jsxs("div",{...h,className:clsx("relative isolate",d,x,c),children:[e,jsxRuntimeExports.jsx(AnimatePresence,{children:y&&jsxRuntimeExports.jsx(Underlay,{position:"fixed",onClick:()=>{R("closed"),S("closed")}},"dashboard-underlay")})]})})}const uploadStoreOptions={modifyUploadedFile:e=>{const t=getActiveWorkspaceId();return e.fingerprint=`${e.fingerprint}-w-${t}`,e}};function DriveLayout(){const{pathname:e}=useLocation(),{hash:t}=useParams(),{workspaceId:s}=useActiveWorkspaceId(),n=useDriveStore(i=>i.activePage);reactExports.useEffect(()=>{driveState().setActivePage(DRIVE_PAGES.find(i=>i.path===e)||makePartialFolderPage(t))},[e,t]);const o=reactExports.useMemo(()=>({workspaceId:s}),[s]);return reactExports.useEffect(()=>()=>{driveState().reset()},[]),jsxRuntimeExports.jsxs(reactExports.Fragment,{children:[(n==null?void 0:n.label)&&jsxRuntimeExports.jsx(StaticPageTitle,{children:jsxRuntimeExports.jsx(Trans,{message:typeof n.label=="string"?n.label:n.label.message})}),jsxRuntimeExports.jsxs(FileUploadProvider,{options:uploadStoreOptions,children:[jsxRuntimeExports.jsx(FileEntryUrlsContext.Provider,{value:o,children:jsxRuntimeExports.jsxs(DashboardLayout,{name:"drive",onDragOver:i=>{i.preventDefault(),i.stopPropagation(),i.dataTransfer.dropEffect="none"},onDrop:i=>{i.preventDefault()},children:[jsxRuntimeExports.jsx(Navbar,{}),jsxRuntimeExports.jsx(DashboardSidenav,{position:"left",size:"md",children:jsxRuntimeExports.jsx(Sidebar,{})}),jsxRuntimeExports.jsx(DriveContentHeader,{}),jsxRuntimeExports.jsx(DashboardContent,{children:jsxRuntimeExports.jsx(FileView,{})}),jsxRuntimeExports.jsx(UploadQueue,{}),jsxRuntimeExports.jsx(DriveDialogsContainer,{}),jsxRuntimeExports.jsx(DashboardSidenav,{position:"right",size:"lg",children:jsxRuntimeExports.jsx(DetailsSidebar,{})})]})}),jsxRuntimeExports.jsx(EntryDragPreview,{})]})]})}function Navbar(){const{isMobileMode:e}=reactExports.useContext(DashboardLayoutContext),t=useDriveStore(i=>i.activePage),s=e?null:jsxRuntimeExports.jsx(NavbarSearch,{}),n=jsxRuntimeExports.jsx(IconButton,{elementType:Link,to:SearchPage.path,children:jsxRuntimeExports.jsx(SearchIcon,{})}),o=jsxRuntimeExports.jsxs(reactExports.Fragment,{children:[t!==SearchPage&&n,jsxRuntimeExports.jsx(CreateNewButton,{isCompact:!0})]});return jsxRuntimeExports.jsxs(reactExports.Fragment,{children:[jsxRuntimeExports.jsx(DashboardNavbar,{rightChildren:e&&o,menuPosition:"drive-navbar",children:s}),e&&jsxRuntimeExports.jsx(FloatingActionList,{})]})}function FloatingActionList(){const e=useDriveStore(t=>t.selectedEntries.size);return e?jsxRuntimeExports.jsxs("div",{className:"fixed right-0 top-0 z-10 flex h-54 w-full items-center justify-center gap-10 rounded bg-primary px-6 text-on-primary shadow-xl",children:[jsxRuntimeExports.jsx(IconButton,{onClick:()=>{driveState().selectEntries([])},children:jsxRuntimeExports.jsx(CloseIcon,{})}),jsxRuntimeExports.jsx(Trans,{message:":count selected",values:{count:e}}),jsxRuntimeExports.jsx(EntryActionList,{className:"ml-auto"})]}):null}const useLinkPageStore=create()(immer(e=>({password:null,viewMode:getFromLocalStorage("drive.viewMode"),activeSort:{orderBy:"updated_at",orderDir:"desc"},setPassword:t=>{e(s=>{s.password=t})},isPasswordProtected:!1,setIsPasswordProtected:t=>{e(s=>{s.isPasswordProtected=t})},setViewMode:t=>{e(s=>{s.viewMode=t,setInLocalStorage("drive.viewMode",t)})},setActiveSort:t=>{e(s=>{s.activeSort=t})}})));function linkPageState(){return useLinkPageStore.getState()}function useShareableLinkPage(){var l,u;const{hash:e}=useParams(),{orderBy:t,orderDir:s}=useLinkPageStore(c=>c.activeSort),n=`${t}:${s}`,o=useLinkPageStore(c=>c.isPasswordProtected),i=useLinkPageStore(c=>c.password),a=useInfiniteQuery({queryKey:DriveQueryKeys.fetchShareableLink({hash:e,sort:n}),queryFn:async({pageParam:c=1})=>{const x=await fetchLinkByHash({hash:e,page:c,order:n,password:i});return x.passwordInvalid&&linkPageState().setIsPasswordProtected(!0),x},initialData:()=>{var x,d;const c=(x=getBootstrapData().loaders)==null?void 0:x.shareableLinkPage;if(c&&((d=c.link)==null?void 0:d.hash)===e)return c.passwordInvalid&&linkPageState().setIsPasswordProtected(!0),{pageParams:[void 0,1],pages:[c]}},initialPageParam:1,getNextPageParam:c=>{if(!c.folderChildren)return;const x=c.folderChildren.current_page,d=c.folderChildren.last_page;if(!(x>=d))return x+1},enabled:!!e&&!o||i!=null,placeholderData:keepPreviousData});return{...a,link:(l=a.data)==null?void 0:l.pages[0].link,entries:(u=a.data)==null?void 0:u.pages.flatMap(c=>{var x;return(x=c.folderChildren)==null?void 0:x.data})}}function fetchLinkByHash({hash:e,page:t=1,order:s,password:n}){return apiClient.get(`shareable-links/${e}`,{params:{loader:"shareableLinkPage",page:t,order:s,password:n}}).then(o=>o.data)}function checkLinkPassword({password:e,linkHash:t}){return apiClient.post(`shareable-links/${t}/check-password`,{password:e}).then(s=>s.data)}function useCheckLinkPassword(){return useMutation({mutationFn:e=>checkLinkPassword(e),onSuccess:(e,t)=>{e.matches&&linkPageState().setPassword(t.password)},onError:e=>showHttpErrorToast(e,message("Could not create link"))})}function importIntoOwnDrive({linkId:e,password:t}){return apiClient.post(`shareable-links/${e}/import`,{password:t}).then(s=>s.data)}function useImportIntoOwnDrive(){const e=useLinkPageStore(t=>t.password);return useMutation({mutationFn:t=>importIntoOwnDrive({...t,password:e}),onSuccess:async()=>{await queryClient.invalidateQueries({queryKey:DriveQueryKeys.fetchShareableLink()}),toast(message("Item imported into your drive"))},onError:t=>showHttpErrorToast(t,message("Could not create link"))})}function ShareableLinkPageActionButtons(){var a;const{link:e}=useShareableLinkPage(),{user:t,isLoggedIn:s}=useAuth(),{downloadUrl:n}=useFileEntryUrls(e==null?void 0:e.entry),o=useImportIntoOwnDrive(),i=(a=e==null?void 0:e.entry)==null?void 0:a.users.find(l=>l.id===(t==null?void 0:t.id));return e!=null&&e.entry?jsxRuntimeExports.jsxs("div",{children:[e.allow_download&&jsxRuntimeExports.jsx(DownloadButton,{downloadUrl:n}),!i&&s&&e.allow_edit&&jsxRuntimeExports.jsxs(MenuTrigger,{onItemSelected:l=>{l==="import"?o.mutate({linkId:e.id}):l==="download"&&n&&downloadFileFromUrl(n)},children:[jsxRuntimeExports.jsx(IconButton,{className:"ml-6",disabled:o.isPending,children:jsxRuntimeExports.jsx(KeyboardArrowDownIcon,{})}),jsxRuntimeExports.jsxs(Menu,{children:[jsxRuntimeExports.jsx(Item,{value:"download",startIcon:jsxRuntimeExports.jsx(FileDownloadIcon,{}),children:jsxRuntimeExports.jsx(Trans,{message:"Download"})}),jsxRuntimeExports.jsx(Item,{value:"import",startIcon:jsxRuntimeExports.jsx(ImportExportIcon,{}),children:jsxRuntimeExports.jsx(Trans,{message:"Save a copy to your own drive"})})]})]})]}):null}function DownloadButton({downloadUrl:e}){return jsxRuntimeExports.jsxs(reactExports.Fragment,{children:[jsxRuntimeExports.jsx(Tooltip,{label:jsxRuntimeExports.jsx(Trans,{message:"Download"}),children:jsxRuntimeExports.jsx(IconButton,{className:"md:hidden",onClick:()=>{e&&downloadFileFromUrl(e)},children:jsxRuntimeExports.jsx(FileDownloadIcon,{})})}),jsxRuntimeExports.jsx(Button,{className:"max-md:hidden",size:"sm",variant:"flat",color:"chip",startIcon:jsxRuntimeExports.jsx(FileDownloadIcon,{}),onClick:()=>{e&&downloadFileFromUrl(e)},children:jsxRuntimeExports.jsx(Trans,{message:"Download"})})]})}function ShareableLinkNavbar(){const{link:e}=useShareableLinkPage(),t=useIsMobileMediaQuery();return jsxRuntimeExports.jsx(Navbar$1,{size:"md",color:"bg",className:"flex-shrink-0",rightChildren:(e==null?void 0:e.entry)&&jsxRuntimeExports.jsx(ShareableLinkPageActionButtons,{}),menuPosition:"shareable-link-page",hideLogo:t,children:(e==null?void 0:e.entry)&&e.entry.type!=="folder"&&jsxRuntimeExports.jsxs("div",{className:"fex-auto flex min-w-0 items-center gap-10",children:[jsxRuntimeExports.jsx(FileTypeIcon,{className:"flex-shrink-0",type:e.entry.type}),jsxRuntimeExports.jsx("div",{className:"flex-auto overflow-hidden overflow-ellipsis whitespace-nowrap font-medium",children:e.entry.name})]})})}function PasswordPage(){const{trans:e}=useTrans(),{hash:t}=useParams(),s=e({message:"Password"}),[n,o]=reactExports.useState(""),i=useCheckLinkPassword(),a=t?t.split(":")[0]:null,l=i.data&&!i.data.matches;return jsxRuntimeExports.jsxs("div",{className:"flex h-screen flex-col bg-alt",children:[jsxRuntimeExports.jsx(ShareableLinkNavbar,{}),jsxRuntimeExports.jsx("div",{className:"mx-auto my-80 px-10 md:px-20",children:jsxRuntimeExports.jsxs("div",{className:"flex max-w-[560px] flex-col items-center gap-40 rounded border bg p-24 md:flex-row md:gap-14",children:[jsxRuntimeExports.jsx("div",{className:"h-132 w-[165px]",children:jsxRuntimeExports.jsx(SvgImage,{src:secureFilesSvg})}),jsxRuntimeExports.jsxs("form",{onSubmit:u=>{u.preventDefault(),i.mutate({linkHash:a,password:n})},children:[jsxRuntimeExports.jsx("span",{className:"text-sm",children:jsxRuntimeExports.jsx(Trans,{message:"The link you are trying to access is password protected."})}),jsxRuntimeExports.jsx(TextField,{autoFocus:!0,placeholder:s,"aria-label":s,className:"mb-20 mt-10",type:"password",value:n,required:!0,errorMessage:l&&jsxRuntimeExports.jsx(Trans,{message:"Password is not valid"}),onChange:u=>{o(u.target.value)}}),jsxRuntimeExports.jsx("div",{className:"text-right",children:jsxRuntimeExports.jsx(Button,{variant:"flat",color:"primary",type:"submit",className:"w-full md:w-auto",disabled:i.isPending,children:jsxRuntimeExports.jsx(Trans,{message:"Enter"})})})]})]})})]})}function FolderPreviewFileGrid({entries:e,onEntrySelected:t}){return jsxRuntimeExports.jsx("div",{className:"file-grid",children:e.map((s,n)=>jsxRuntimeExports.jsx(BaseFileGridItem,{tabIndex:-1,className:"hover:shadow-md cursor-pointer bg",entry:s,onContextMenu:o=>{o.preventDefault()},onKeyDown:o=>{(o.key==="Enter"||o.key===" ")&&t(s,n)},onClick:()=>{t(s,n)}},s.id))})}const mobileColumns=fileTableColumns.filter(e=>e.key!=="updated_at");function FolderPreviewFileTable({entries:e,onEntrySelected:t}){const s=useLinkPageStore(o=>o.activeSort),n=useIsMobileMediaQuery();return jsxRuntimeExports.jsx(Table,{columns:n?mobileColumns:fileTableColumns,data:e,sortDescriptor:s,onSortChange:o=>{linkPageState().setActiveSort(o)},onAction:(o,i)=>{t(o,i)},enableSelection:!1})}function buildFolderHash(e,t){var n;let s=e.hash;return t&&((n=e.entry)==null?void 0:n.hash)!==t&&(s=`${s}:${t}`),s}function useNavigateToSubfolder(){const{link:e}=useShareableLinkPage(),t=useNavigate$1();return s=>{e&&t(`/drive/s/${buildFolderHash(e,s)}`)}}function FolderPreviewFileView({className:e}){const{pathname:t}=useLocation(),s=useNavigateToSubfolder(),[n,o]=reactExports.useState(),i=useLinkPageStore(j=>j.viewMode),a=reactExports.useRef(null),{link:l,entries:u,isFetchingNextPage:c,hasNextPage:x,fetchNextPage:d,isPlaceholderData:p}=useShareableLinkPage();if(reactExports.useEffect(()=>{o(void 0)},[t]),reactExports.useEffect(()=>{const j=a.current;if(!j)return;const f=new IntersectionObserver(([v])=>{v.isIntersecting&&x&&d()});return f.observe(j),()=>{f.unobserve(j)}},[x,d]),!l||p)return jsxRuntimeExports.jsx("div",{className:clsx("flex justify-center",e),children:jsxRuntimeExports.jsx(ProgressCircle,{isIndeterminate:!0})});const h=(j,f)=>{j.type==="folder"?s(j.hash):o(f)},g=u||[];return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:clsx("file-grid-container flex-auto overflow-auto px-14 pb-14 md:px-24 md:pb-24",e),children:[jsxRuntimeExports.jsx(AdHost,{slot:"file-preview",className:"mb-40"}),i==="grid"?jsxRuntimeExports.jsx(FolderPreviewFileGrid,{entries:g,onEntrySelected:h}):jsxRuntimeExports.jsx(FolderPreviewFileTable,{entries:g,onEntrySelected:h}),jsxRuntimeExports.jsx("span",{ref:a,"aria-hidden":!0}),jsxRuntimeExports.jsx(AnimatePresence,{children:c&&jsxRuntimeExports.jsx(m.div,{className:"mt-24 flex w-full justify-center",...opacityAnimation,children:jsxRuntimeExports.jsx(ProgressCircle,{isIndeterminate:!0,"aria-label":"loading"})})})]}),jsxRuntimeExports.jsx(DialogTrigger,{type:"modal",isOpen:n!=null,onClose:()=>o(void 0),children:jsxRuntimeExports.jsx(FilePreviewDialog,{entries:g,defaultActiveIndex:n,allowDownload:l.allow_download})})]})}function FolderPreviewBreadcrumb({className:e,folder:t,link:s}){const n=useNavigateToSubfolder(),o=useLinkPageStore(l=>l.password),i=useFolderPath({hash:t==null?void 0:t.hash,params:{shareable_link:s.id,password:o}});let a;if(i.isLoading)a=null;else{const l=[];i.data&&i.data.path.forEach(u=>{l.push({folder:u,label:jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:u.name})})}),a=jsxRuntimeExports.jsx(Breadcrumb,{size:"lg",isNavigation:!0,children:l.map(u=>jsxRuntimeExports.jsx(BreadcrumbItem,{onSelected:()=>{n(u.folder.hash)},children:u.label},u.folder.hash))})}return jsxRuntimeExports.jsx("div",{className:clsx("h-36 flex-shrink-0",e),children:a})}function FolderPreviewHeader(){const e=useLinkPageStore(o=>o.activeSort),{link:t,isFetching:s}=useShareableLinkPage(),n=t&&t.entry;return jsxRuntimeExports.jsxs("div",{className:"flex flex-col justify-between gap-14 p-14 md:h-90 md:flex-row md:items-center md:p-24",children:[n&&jsxRuntimeExports.jsx(FolderPreviewBreadcrumb,{link:t,folder:t.entry,className:"flex-auto"}),n&&jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between text-muted md:justify-start",children:[jsxRuntimeExports.jsx(EntriesSortButton,{isDisabled:s,descriptor:e,onChange:o=>{linkPageState().setActiveSort(o)}}),jsxRuntimeExports.jsx("div",{className:"ml-10 md:border-l md:pl-10",children:jsxRuntimeExports.jsx(IconButton,{onClick:()=>{linkPageState().setViewMode(linkPageState().viewMode==="grid"?"list":"grid")},children:jsxRuntimeExports.jsx(GridViewIcon,{})})})]})]})}function FolderPreview(){const{entries:e,isFetched:t}=useShareableLinkPage(),s=t&&!(e!=null&&e.length);return jsxRuntimeExports.jsxs(DashboardLayout,{name:"folder-preview",children:[jsxRuntimeExports.jsx(DashboardNavbar,{hideToggleButton:!0,rightChildren:jsxRuntimeExports.jsx(ShareableLinkPageActionButtons,{}),color:"bg"}),jsxRuntimeExports.jsx(DashboardContentHeader,{children:jsxRuntimeExports.jsx(FolderPreviewHeader,{})}),jsxRuntimeExports.jsx(FileUploadProvider,{children:jsxRuntimeExports.jsx(DashboardContent,{children:s?jsxRuntimeExports.jsx(EmptyMessage,{}):jsxRuntimeExports.jsx(FolderPreviewFileView,{})})})]})}function EmptyMessage({className:e}){return jsxRuntimeExports.jsx(IllustratedMessage,{className:clsx(e,"mt-80"),image:jsxRuntimeExports.jsx(SvgImage,{src:shareSvg}),title:jsxRuntimeExports.jsx(Trans,{message:"Folder is empty"}),description:jsxRuntimeExports.jsx(Trans,{message:"No files have been uploaded to this folder yet"})})}function ShareableLinkPageFilePreview(){const{link:e}=useShareableLinkPage();return e!=null&&e.entry?jsxRuntimeExports.jsxs("div",{className:"flex h-screen flex-col bg-alt",children:[jsxRuntimeExports.jsx(ShareableLinkNavbar,{}),jsxRuntimeExports.jsx(AdHost,{slot:"file-preview",className:"mx-auto mt-24"}),jsxRuntimeExports.jsx(FilePreviewContainer,{entries:[e.entry],showHeader:!1,allowDownload:e.allow_download})]}):null}function ShareableLinkPage(){var d;const{status:e,link:t,entries:s}=useShareableLinkPage(),{user:n,isLoggedIn:o}=useAuth(),i=!o,a=(s==null?void 0:s.reduce((p,h)=>p+(h.file_size||0),0))||0,{trans:l}=useTrans(),u=useLinkPageStore(p=>p.isPasswordProtected),c=useLinkPageStore(p=>p.password);let x;if(e==="pending")x=jsxRuntimeExports.jsx("div",{className:"flex h-screen flex-auto items-center justify-center",children:jsxRuntimeExports.jsx(ProgressCircle,{"aria-label":l({message:"Loading link"}),isIndeterminate:!0})});else{if(!t&&!u)return jsxRuntimeExports.jsx(NotFoundPage,{});u&&!c?x=jsxRuntimeExports.jsx(PasswordPage,{}):((d=t==null?void 0:t.entry)==null?void 0:d.type)==="folder"?x=jsxRuntimeExports.jsx(FolderPreview,{}):i?x=jsxRuntimeExports.jsx(GuestDownloadView,{files:s,totalSize:a,expiresAt:t==null?void 0:t.expires_at}):x=jsxRuntimeExports.jsx(ShareableLinkPageFilePreview,{})}return jsxRuntimeExports.jsx(ActiveWorkspaceProvider,{children:jsxRuntimeExports.jsx(FileEntryUrlsContext.Provider,{value:{shareable_link:t==null?void 0:t.id,password:c},children:x})})}export{DriveLayout,ShareableLinkPage};
//# sourceMappingURL=drive-routes.lazy-798c8152.js.map
