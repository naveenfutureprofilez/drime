import{j as s,A as C,E as Ee,t as ie,r as m,L as is,i as Be,h as yn,n as bn,$ as Ge,X as Xe,aq as os,R as wn,ab as Sn,W as kn,w as Ys,H as ls,v as In}from"./vendor-react-1bca9862.js";import{u as En,W as X,a as Z,P as Pe,b as Pn,c as cs,D as _,i as Q,d as De,e as g,f as w,C as Dn,g as Nn,M as _e,h as Fn,N as Gs,A as Cn}from"./main-e1627169.js";import{b as c,aH as Mn,m as x,s as z,h as D,v as O,D as ne,d as oe,e as J,J as Ne,w as je,a as N,P as te,H as V,Q as me,I as M,U as ye,X as xe,Y as fe,O as R,k as Ze,B as Xs,av as Zs,K as Js,j as et,E as We,a7 as An,$ as Fe,a0 as Ce,T as ae,aV as Tn,am as st,p as Ke,ac as Oe,ab as $s,a3 as ds,aD as Ln,M as tt,N as ns,aw as us,W as zs,ax as Rn,aW as $n,S as zn,aT as qn,al as nt}from"./admin-analytics-86be46fb.js";import{ap as _n,t as F,F as Me,s as T,C as be,A as ms,e as rt,af as at,aa as xs,a7 as Bn,o as Se,Q as fs,a0 as hs,aq as Je,u as le,ar as it,b as Wn,_ as Ve,as as ot,H as lt,at as Kn,au as qs,Z as ps,I as es,S as Ae,an as ee,E as On,a4 as Vn,R as Un,U as Qn,av as _s,K as gs,g as rs,c as ct}from"./admin-appearance-b070f98f.js";import{c as P,A as H,m as K}from"./vendor-utils-eb3e2af6.js";import{o as Te,w as q,al as Hn,am as dt,e as Yn,H as Gn,an as ut,ao as Xn,ap as Zn,aq as Jn,ar as Ue,as as mt,at as er,au as xt,av as vs,aw as ft,ax as sr,ay as $e,az as ze,aA as tr,aB as nr,aC as rr,aD as ar,L as ir,aE as or,aF as lr,aG as cr,aH as dr,aI as ur,aJ as mr,aK as ht,aL as Qe,aM as He,R as xr,aN as fr,aO as js,aP as ys,ab as pt,aQ as gt,aR as hr,aS as pr,aT as bs,aU as Ie,aV as ws,aW as gr,k as Le,C as vr,aX as Bs,aY as jr,aZ as vt,U as yr,a_ as br,a$ as wr,b0 as jt,b1 as Sr,b2 as kr,b3 as Ir,b4 as Er,b5 as Pr,b6 as Dr,b7 as Nr,b8 as yt,b9 as bt,ba as Fr,bb as Cr,bc as Mr,bd as Ar,N as Tr}from"./admin-core-bdc4c510.js";import{bY as Lr,m as Rr,D as Ss,a as $r,g as zr,$ as qr,c as _r,E as Br}from"./vendor-04d6d13f.js";import{G as Wr}from"./guest-download-view-3bec0176.js";import"./vendor-editor-07ee6cb6.js";import"./admin-settings-52edf337.js";function Kr(e){return s.jsx(_n,{...e,role:"meter progressbar"})}function Or(){const{isLoading:e,data:t}=En(),n=s.jsx("span",{className:P("whitespace-nowrap",e&&"invisible"),children:s.jsx(c,{message:":used of :available used",values:{used:t==null?void 0:t.usedFormatted,available:t==null?void 0:t.availableFormatted}})});return s.jsxs("div",{className:"mt-24 flex items-start gap-16 border-t pl-24 pt-24",children:[s.jsx(Mn,{className:"-mt-4 icon-md"}),s.jsx(Kr,{className:"max-w-144 flex-auto",size:"xs",value:t==null?void 0:t.percentage,label:n,showValueLabel:!1,labelPosition:"bottom"})]})}function Vr(e){return C({mutationFn:t=>Ur(t),onSuccess:()=>{F(x("Created workspace")),z.invalidateQueries({queryKey:X.fetchUserWorkspaces})},onError:t=>Te(t,e)})}function Ur(e){return D.post("workspace",e).then(t=>t.data)}function Qr(){const e=Ee(),{formId:t,close:n}=O(),r=Vr(e);return s.jsxs(ne,{children:[s.jsx(oe,{children:s.jsx(c,{message:"Create workspace"})}),s.jsx(J,{children:s.jsx(Me,{form:e,id:t,onSubmit:()=>{r.mutate(e.getValues(),{onSuccess:a=>{n(a.workspace.id)}})},children:s.jsx(Ne,{name:"name",autoFocus:!0,label:s.jsx(c,{message:"Workspace name"}),minLength:3,required:!0})})}),s.jsxs(je,{children:[s.jsx(N,{variant:"text",onClick:n,children:s.jsx(c,{message:"Cancel"})}),s.jsx(N,{variant:"flat",color:"primary",type:"submit",form:t,disabled:r.isPending,children:s.jsx(c,{message:"Create"})})]})]})}function Hr(e){return D.get(`workspace/${e}`).then(t=>t.data)}function Yr(e){return ie({queryKey:X.workspaceWithMembers(e),queryFn:()=>Hr(e)})}function Gr({workspaceId:e,...t}){return D.post(`workspace/${e}/invite`,t).then(n=>n.data)}function Xr(){return C({mutationFn:e=>Gr(e),onSuccess:(e,t)=>{z.invalidateQueries({queryKey:X.workspaceWithMembers(t.workspaceId)})},onError:e=>T(e)})}function Zr({workspaceId:e,inviteId:t,...n}){return D.post(`workspace/${e}/${t}/resend`,n).then(r=>r.data)}function Jr(){return C({mutationFn:e=>Zr(e),onSuccess:()=>{F("Invite sent")},onError:e=>T(e)})}function ea({workspaceId:e,member:t,...n}){const r=t.model_type,a=t.model_type==="invite"?t.id:t.member_id;return D.post(`workspace/${e}/${r}/${a}/change-role`,n).then(i=>i.data)}function sa(){return C({mutationFn:e=>ea(e),onSuccess:(e,t)=>{F(x("Role changed")),z.invalidateQueries({queryKey:X.workspaceWithMembers(t.workspaceId)})},onError:e=>T(e)})}function ta({workspaceId:e,memberId:t,memberType:n}){const r=n==="invite"?`workspace/invite/${t}`:`workspace/${e}/member/${t}`;return D.delete(r).then(a=>a.data)}function wt(){const{workspaceId:e,setWorkspaceId:t}=Z(),{user:n}=q();return C({mutationFn:r=>ta(r),onSuccess:(r,a)=>{z.invalidateQueries({queryKey:X.fetchUserWorkspaces}),z.invalidateQueries({queryKey:X.workspaceWithMembers(a.workspaceId)}),a.memberId===(n==null?void 0:n.id)&&e===a.workspaceId&&t(Pe.id)},onError:r=>T(r)})}function St({onConfirm:e,isLoading:t}){return s.jsx(be,{isDanger:!0,title:s.jsx(c,{message:"Leave workspace"}),isLoading:t,onConfirm:e,body:s.jsxs("div",{children:[s.jsx(c,{message:"Are you sure you want to leave this workspace?"}),s.jsx("div",{className:"mt-8 font-semibold",children:s.jsx(c,{message:"All resources you've created in the workspace will be transferred to workspace owner."})})]}),confirm:s.jsx(c,{message:"Leave"})})}const na=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;function kt(e){return!e||e.length>320?!1:na.test(e)}function ra({workspace:e}){const{data:t,isLoading:n}=Yr(e.id);return s.jsxs(ne,{size:"lg",children:[s.jsx(oe,{children:s.jsx(c,{message:"Manage workspace members"})}),s.jsx(J,{children:n?s.jsx("div",{className:"flex min-h-[238px] items-center justify-center",children:s.jsx(te,{isIndeterminate:!0,"aria-label":"Loading workspace..."})}):s.jsx(aa,{workspace:t.workspace})})]})}function aa({workspace:e}){const{user:t}=q(),n=ks(e),r=[...e.members||[],...e.invites||[]],a=!n.update&&!n.delete;return s.jsxs("div",{children:[n.invite&&s.jsx(la,{workspace:e}),s.jsxs("div",{className:"mb-14 flex items-center gap-10 text-base",children:[s.jsx(Hn,{className:"icon-sm"}),s.jsx(c,{message:"Members of `:workspace`",values:{workspace:e.name}})]}),s.jsxs(H,{initial:!1,children:[r.map(i=>a&&i.id!==(t==null?void 0:t.id)?null:s.jsx(ia,{workspace:e,member:i},`${i.model_type}.${i.id}`)),a&&s.jsx("div",{className:"text-muted",children:s.jsx(c,{message:"And [one one other member|:count other members]",values:{count:r.length}})})]})]})}function ia({workspace:e,member:t}){return s.jsxs(K.div,{initial:{x:"-100%",opacity:0},animate:{x:0,opacity:1},exit:{x:"100%",opacity:0},transition:{type:"tween",duration:.125},className:"mb-20 flex items-start gap-14 text-sm",children:[s.jsx(ms,{className:"flex-shrink-0",size:"lg",circle:!0,label:t.name,src:t.image,fallback:"initials"}),s.jsxs("div",{className:"min-w-0 flex-auto items-center justify-between gap-14 md:flex",children:[s.jsxs("div",{className:"mb-10 overflow-hidden md:mb-0 md:mr-10",children:[s.jsxs("div",{className:"flex items-center justify-start gap-6",children:[s.jsx("div",{className:"overflow-hidden text-ellipsis whitespace-nowrap",children:t.name}),s.jsx(ua,{workspace:e,member:t})]}),s.jsx("div",{className:"text-muted",children:t.email})]}),s.jsx(oa,{workspace:e,member:t})]})]},`${t.model_type}.${t.id}`)}function ks(e){var i;const{user:t}=q(),n={update:!1,invite:!1,delete:!1},r=["update","invite","delete"],a=(i=e.members)==null?void 0:i.find(o=>o.id===(t==null?void 0:t.id));return a&&r.forEach(o=>{var l;n[o]=a.is_owner||!!((l=a.permissions)!=null&&l.find(d=>d.name===`workspace_members.${o}`))}),n}function oa({workspace:e,member:t}){const[n,r]=m.useState(t.role_id),a=sa(),{user:i}=q(),o=ks(e),l=t.model_type==="member"&&t.is_owner,d=t.model_type==="member"&&(i==null?void 0:i.id)===t.id,u=!o.update||l||d?s.jsx("div",{className:"ml-auto text-muted first:capitalize",children:s.jsx(c,{message:t.role_name})}):s.jsx(It,{className:"ml-auto flex-shrink-0",size:"xs",value:n,isDisabled:a.isPending,onChange:h=>{r(h),a.mutate({roleId:h,workspaceId:e.id,member:t})}});return s.jsxs(s.Fragment,{children:[u,!l&&(d||o.delete)&&s.jsx(ca,{type:d?"leave":"remove",member:t,workspace:e})]})}function la({workspace:e}){const{trans:t}=V(),[n,r]=m.useState([]),a=n.every(h=>!h.invalid),i=h=>h.description||h.name,[o,l]=m.useState(),d=Xr(),{data:u}=rt(["workspaceRoles"]);return m.useEffect(()=>{var h;!o&&((h=u==null?void 0:u.workspaceRoles)!=null&&h.length)&&l(u.workspaceRoles[0].id)},[u,o]),s.jsxs("div",{className:"mb-30",children:[s.jsx(at,{value:n,onChange:r,displayWith:i,validateWith:h=>{const f=!kt(h.description);return{...h,invalid:f,errorMessage:f?t({message:"Not a valid email"}):void 0}},placeholder:t({message:"Enter email addresses"}),label:s.jsx(c,{message:"Invite people"})}),s.jsxs("div",{className:"mt-14 flex items-center justify-between gap-14",children:[s.jsx(It,{onChange:l,value:o}),n.length&&o?s.jsx(N,{variant:"flat",color:"primary",size:"sm",disabled:d.isPending||!a,onClick:()=>{d.mutate({emails:n.map(h=>i(h)),roleId:o,workspaceId:e.id},{onSuccess:()=>{r([])}})},children:s.jsx(c,{message:"Invite"})}):null]})]})}function ca({member:e,workspace:t,type:n}){const r=wt(),{close:a}=O();return s.jsxs(me,{type:"modal",onClose:i=>{i&&(r.mutate({workspaceId:t.id,memberId:e.id,memberType:e.model_type}),n==="leave"&&(a(),F(x("Left workspace"))))},children:[s.jsx(M,{size:"md",className:"flex-shrink-0 text-muted",disabled:r.isPending,children:n==="leave"?s.jsx(dt,{}):s.jsx(ye,{})}),n==="leave"?s.jsx(St,{}):s.jsx(da,{member:e})]})}function da({member:e}){return s.jsx(be,{isDanger:!0,title:s.jsx(c,{message:"Remove member"}),body:s.jsxs("div",{children:[s.jsx(c,{message:"Are you sure you want to remove `:name`?",values:{name:e.name}}),s.jsx("div",{className:"mt-8 font-semibold",children:s.jsx(c,{message:"All workspace resources created by `:name` will be transferred to workspace owner.",values:{name:e.name}})})]}),confirm:s.jsx(c,{message:"Remove"})})}function It({value:e,onChange:t,size:n="xs",className:r,isDisabled:a}){var l;const{data:i}=rt(["workspaceRoles"]),o=(l=i==null?void 0:i.workspaceRoles)==null?void 0:l.find(d=>d.id===e);return!e||!o||!(i!=null&&i.workspaceRoles)?null:s.jsxs(xe,{selectionMode:"single",selectedValue:e,onSelectionChange:d=>{t(d)},children:[s.jsx(N,{className:r,size:n,variant:"flat",color:"chip",disabled:a,endIcon:s.jsx(xs,{}),children:s.jsx(c,{message:o.name})}),s.jsx(fe,{children:i.workspaceRoles.map(d=>s.jsx(R,{value:d.id,description:d.description,children:s.jsx(c,{message:d.name})},d.id))})]})}function ua({member:e,workspace:t}){const{user:n}=q(),r=ks(t);return(n==null?void 0:n.id)===e.id?s.jsxs("div",{className:"font-medium",children:["(",s.jsx(c,{message:"You"}),")"]}):e.model_type==="invite"?s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{children:"·"}),s.jsx("div",{className:"font-medium",children:s.jsx(c,{message:"Invited"})}),r.invite?s.jsxs(s.Fragment,{children:[s.jsx("div",{children:"·"}),s.jsx(ma,{member:e,workspace:t})]}):null]}):null}function ma({member:e,workspace:t}){const n=Jr();return s.jsxs(me,{type:"modal",onClose:r=>{r&&n.mutate({workspaceId:t.id,inviteId:e.id})},children:[s.jsx(N,{variant:"link",size:"sm",color:"primary",disabled:n.isPending,children:s.jsx(c,{message:"Resend invite"})}),s.jsx(be,{title:s.jsx(c,{message:"Resend invite"}),body:s.jsx(c,{message:"Are you sure you want to send this invite again?"}),confirm:s.jsx(c,{message:"Send"})})]})}function xa({id:e,...t}){return D.put(`workspace/${e}`,t).then(n=>n.data)}function fa(e){const{close:t}=O();return C({mutationFn:n=>xa(n),onSuccess:n=>{t(),F(x("Updated workspace")),z.invalidateQueries({queryKey:X.fetchUserWorkspaces}),z.invalidateQueries({queryKey:X.workspaceWithMembers(n.workspace.id)})},onError:n=>Te(n,e)})}function ha({workspace:e}){const t=Ee({defaultValues:{id:e.id,name:e.name}}),{formId:n,close:r}=O(),a=fa(t);return s.jsxs(ne,{children:[s.jsx(oe,{children:s.jsx(c,{message:"Rename workspace"})}),s.jsx(J,{children:s.jsx(Me,{form:t,id:n,onSubmit:()=>{a.mutate(t.getValues())},children:s.jsx(Ne,{name:"name",autoFocus:!0,label:s.jsx(c,{message:"Name"}),minLength:3,required:!0})})}),s.jsxs(je,{children:[s.jsx(N,{variant:"text",onClick:r,children:s.jsx(c,{message:"Cancel"})}),s.jsx(N,{variant:"flat",color:"primary",type:"submit",form:n,disabled:a.isPending,children:s.jsx(c,{message:"Rename"})})]})]})}function pa({id:e}){return D.delete(`workspace/${e}`).then(t=>t.data)}function ga(){const{workspaceId:e,setWorkspaceId:t}=Z();return C({mutationFn:n=>pa(n),onSuccess:(n,r)=>{F(x("Deleted workspace")),z.invalidateQueries({queryKey:X.fetchUserWorkspaces}),z.invalidateQueries({queryKey:X.workspaceWithMembers(r.id)}),e===r.id&&t(Pe.id)},onError:n=>T(n)})}function va({resourceName:e,className:t,size:n="md",color:r="bgAlt",reason:a="overQuota",...i}){const o=i.message??s.jsx(ja,{resourceName:e,reason:a});return s.jsx(Yn,{color:r,size:n,className:t,description:o})}function ja({resourceName:e,reason:t}){const{billing:n}=Ze();if(t==="noWorkspacePermission")return s.jsx(c,{message:"You can't create new :name in this workspace.",values:{name:e}});const r={name:e,a:a=>s.jsx(is,{className:Gn,to:"/pricing",children:a})};return t==="overQuota"&&n.enable?s.jsx(c,{message:"Your plan is at its maximum number of :name allowed. <a>Upgrade to add more.</a>",values:r}):t==="noPermission"&&n.enable?s.jsx(c,{message:"To unlock ability to create :name. <a>Upgrade your plan.</a>",values:r}):s.jsx(c,{message:"You don't have permissions to create :name."})}function ya({onChange:e,className:t,trigger:n,placement:r="top"}){const{data:a,isFetched:i,isFetching:o}=Pn(),{setWorkspaceId:l}=Z(),d=cs(),[u,h]=m.useState(!1),{hasPermission:f}=q();return m.useEffect(()=>{i&&!o&&!d&&l(Pe.id)},[d,a,l,i,o]),!n&&(!d||!f("workspaces.create")&&(a==null?void 0:a.length)===1)?null:s.jsx(m.Fragment,{children:s.jsxs(me,{type:"popover",placement:r,isOpen:u,onClose:()=>{h(!1)},children:[n?m.cloneElement(n,{onClick:()=>h(!u)}):s.jsx(wa,{onClick:()=>h(!u),workspace:d,className:t}),s.jsx(ne,{size:"min-w-320",children:s.jsxs(J,{padding:"p-10",children:[s.jsx("div",{className:"mb-16 border-b pb-10",children:a==null?void 0:a.map(p=>s.jsx(Sa,{workspace:p,setSelectorIsOpen:h,onChange:e},p.id))}),s.jsx("div",{className:"mb-4 px-4 text-center",children:s.jsx(ba,{onClick:()=>h(!1),onCreated:p=>e==null?void 0:e(p),workspaceCount:a?a.length-1:0})})]})})]})})}function ba({onClick:e,onCreated:t,workspaceCount:n}){const{setWorkspaceId:r}=Z(),{checkOverQuotaOrNoPermission:a}=q(),{overQuotaOrNoPermission:i}=a("workspaces.create","count",n);return s.jsxs(m.Fragment,{children:[s.jsx(N,{disabled:i,onClick:async o=>{o.preventDefault(),o.stopPropagation(),e();const l=await Se(Qr);l&&(r(l),t==null||t(l))},variant:"outline",startIcon:s.jsx(fs,{}),color:"primary",className:"h-40 w-full",children:s.jsx(c,{message:"Create new workspace"})}),i&&s.jsx(va,{size:"sm",className:"mt-12 max-w-288",resourceName:s.jsx(c,{message:"worksapces"})})]})}const wa=m.forwardRef(({workspace:e,className:t,onClick:n,...r},a)=>s.jsxs(Xs,{ref:a,onClick:n,className:P("flex items-center gap-10 rounded ring-inset hover:bg-hover focus-visible:ring-2",t),...r,children:[s.jsxs("span",{className:"mr-auto block flex-auto overflow-hidden text-left",children:[s.jsx("span",{className:"block overflow-hidden overflow-ellipsis text-sm font-medium text-main",children:e.default?s.jsx(c,{message:e.name}):e.name}),s.jsx("span",{className:"block text-xs text-muted",children:e.default?s.jsx(c,{message:"Personal workspace"}):s.jsx(c,{message:":count members",values:{count:e.members_count}})})]}),s.jsx(Bn,{className:"shrink-0 icon-md"})]}));function Sa({workspace:e,onChange:t,setSelectorIsOpen:n}){const{workspaceId:r,setWorkspaceId:a}=Z(),i=r===e.id;return s.jsxs("div",{onClick:()=>{a(e.id),t==null||t(e.id),n(!1)},className:P("mb-4 flex cursor-pointer items-center gap-12 rounded-lg p-10 text-left",i&&"bg-primary/5",!i&&"hover:bg-hover"),children:[s.jsx(Zs,{size:"sm",className:P("flex-shrink-0 text-primary",!i&&"invisible")}),s.jsxs("div",{className:"flex-auto",children:[s.jsx("div",{className:P("text-sm",i&&"font-semibold"),children:e.name}),s.jsx("div",{className:"text-sm text-muted",children:e.default?s.jsx(c,{message:"Personal workspace"}):s.jsx(c,{message:":count members",values:{count:e.members_count}})})]}),e.id!==0&&s.jsx(Ea,{setSelectorIsOpen:n,workspace:e,onChange:t})]})}function ka({workspace:e,onChange:t}){const n=wt(),{user:r}=q(),{close:a}=O();return s.jsx(St,{isLoading:n.isPending,onConfirm:()=>{n.mutate({workspaceId:e.id,memberId:r.id,memberType:"member"},{onSuccess:()=>{a(),t==null||t(Pe.id)}})}})}function Ia({workspace:e,onChange:t}){const n=ga(),{close:r}=O();return s.jsx(be,{isDanger:!0,title:s.jsx(c,{message:"Delete workspace"}),body:s.jsx(c,{message:"Are you sure you want to delete “:name“?",values:{name:e.name}}),confirm:s.jsx(c,{message:"Delete"}),isLoading:n.isPending,onConfirm:()=>{n.mutate({id:e.id},{onSuccess:()=>{r(),t==null||t(Pe.id)}})}})}function Ea({setSelectorIsOpen:e,workspace:t,onChange:n}){const{user:r}=q();return s.jsxs(xe,{onItemSelected:()=>e(!1),children:[s.jsx(N,{onClick:a=>{a.preventDefault(),a.stopPropagation()},color:"primary",size:"xs",variant:"outline",endIcon:s.jsx(Js,{}),children:s.jsx(c,{message:"Manage"})}),s.jsxs(fe,{children:[s.jsx(R,{onClick:a=>{a.stopPropagation(),Se(ra,{workspace:t})},value:"workspaceMembers",startIcon:s.jsx(ut,{}),children:s.jsx(c,{message:"Members"})}),t.owner_id===(r==null?void 0:r.id)&&s.jsx(R,{onClick:a=>{a.stopPropagation(),Se(ha,{workspace:t})},value:"updateWorkspace",startIcon:s.jsx(Xn,{}),children:s.jsx(c,{message:"Rename"})}),t.owner_id!==(r==null?void 0:r.id)&&s.jsx(R,{onClick:a=>{a.stopPropagation(),Se(ka,{workspace:t,onChange:n})},value:"leaveWorkspace",startIcon:s.jsx(dt,{}),children:s.jsx(c,{message:"Leave"})}),t.owner_id===(r==null?void 0:r.id)&&s.jsx(R,{onClick:a=>{a.stopPropagation(),Se(Ia,{workspace:t,onChange:n})},value:"deleteWorkspace",startIcon:s.jsx(hs,{}),children:s.jsx(c,{message:"Delete"})})]})]})}const Et="/build/assets/add-files-107c40dd.svg",Pa="/build/assets/time-management-5219b76e.svg",Ws="/build/assets/file-searching-49556098.svg",Da="/build/assets/throw-away-389510cc.svg",Na="/build/assets/loving-it-585c130e.svg",Pt="/build/assets/share-70babf29.svg",we={orderBy:"updated_at",orderDir:"desc"};function Fa(e){return{name:"allChildren",uniqueId:`${e.hash}-all`,label:`All files in ${e.name}`,path:`/drive/folders/${e.hash}/all`,hasActions:!1,canUpload:!1,sortDescriptor:we,queryParams:{section:"allChildren",folderId:e.hash},folder:e,noContentMessage:()=>({title:x("No files found"),description:x("This folder and its subfolders contain no files"),image:Et})}}function Is(e){return{...Dt(e.hash),canUpload:e.permissions["files.create"]||e.permissions["files.update"],label:e.name,folder:e}}function Dt(e){return{name:"folder",uniqueId:e,label:"",path:ss(e),hasActions:!0,canUpload:!1,sortDescriptor:we,isFolderPage:!0,noContentMessage:()=>({title:x("Drop files or folders here"),description:x('Or use the "Upload" button'),image:Et})}}function ss(e){return e==="0"?"/drive":`/drive/folders/${e}`}const Ca=et().rootFolder,L={...Is(Ca),name:"home"},Ma={name:"recent",uniqueId:"recent",label:x("Recent"),path:"/drive/recent",disableSort:!0,sortDescriptor:{orderBy:"created_at",orderDir:"desc"},queryParams:{recentOnly:!0},noContentMessage:()=>({title:x("No recent entries"),description:x("You have not uploaded any files or folders yet"),image:Pa})},se={name:"search",uniqueId:"search",label:x("Search results"),path:"/drive/search",sortDescriptor:we,noContentMessage:e=>e?{title:x("No matching results"),description:x("Try changing your search query or filters"),image:Ws}:{title:x("Begin typing or select a filter to search"),description:x("Search for files, folders and other content"),image:Ws}},ve={name:"sharedWithMe",uniqueId:"sharedWithMe",label:x("Shared"),path:"/drive/shares",sortDescriptor:we,queryParams:{sharedOnly:!0},noContentMessage:()=>({title:x("Shared with me"),description:x("Files and folders other people have shared with you"),image:Pt})},A={name:"trash",uniqueId:"trash",label:x("Trash"),path:"/drive/trash",sortDescriptor:we,hasActions:!0,queryParams:{deletedOnly:!0},noContentMessage:()=>({title:x("Trash is empty"),description:x("There are no files or folders in your trash currently"),image:Da})},Aa={name:"starred",uniqueId:"starred",label:x("Starred"),path:"/drive/starred",sortDescriptor:we,queryParams:{starredOnly:!0},noContentMessage:()=>({title:x("Nothing is starred"),description:x("Add stars to files and folders that you want to easily find later"),image:Na})},Ta=[L,Ma,se,ve,A,Aa];let La=function(e){return e.DriveSidebar="drive-sidebar",e}({});function Ra(e){return D.get(`users/${e.userId}/folders`,{params:e}).then(t=>t.data)}function Nt(){const{user:e}=q(),{workspaceId:t}=Z(),n={userId:e.id,workspaceId:t};return ie({queryKey:_.fetchUserFolders(n),queryFn:()=>Ra(n),enabled:!!e})}function Ft(){return C({mutationFn:e=>(F.loading(x("Moving [one 1 item|other :count items]...",{values:{count:e.entryIds.length}}),{disableExitAnimation:!0}),$a(e)),onSuccess:(e,t)=>{Q(),F(x('Moved [one 1 item|other :count items] to ":destination"',{values:{count:t.entryIds.length,destination:(e.destination||L.folder).name}}),{disableEnterAnimation:!0})},onError:e=>T(e,x("Could not move items"),null,{disableEnterAnimation:!0})})}function $a(e){return e.destinationId=e.destinationId?e.destinationId:null,D.post("file-entries/move",e).then(t=>t.data)}function Es(e,t){return t.type!=="folder"||!t.permissions["files.update"]&&!e.every(n=>n.permissions["files.update"])?!1:e.every(n=>!n||t.id===n.parent_id||!n.parent_id&&t.id===0?!1:!za(t,n))}function za(e,t){const n=(e.path||"").split("/");return(t.path||"").split("/").every((a,i)=>n[i]===a)}function Ct(e){const t=Ft(),{uploadFiles:n}=De();return{onDrop:async a=>{if(e.type==="folder"){if(a.type==="nativeFile")n(await a.getData(),{metadata:{parentId:e.id}});else if(a.type==="fileEntry"){const i=a.getData();i!=null&&i.length&&Es(i,e)&&(t.mutate({destinationId:e.id,entryIds:i.map(o=>o.id)}),g().deselectEntries("all"))}}}}}function as(e,t){if(e.type==="fileEntry"){const n=e.getData();return Es(n,t)}return!0}function Ps(e){return`${e.id}-tree`}function qa(e){return`${e}`.endsWith("-tree")}function _a({folder:e,ref:t}){const[n,r]=m.useState(!1),{onDrop:a}=Ct(e);return{...Je({id:Ps(e),ref:t,types:["fileEntry","nativeFile"],acceptsDrop:o=>as(o,e),onDragEnter:o=>{as(o,e)&&r(!0)},onDragLeave:()=>{r(!1)},onDropActivate:()=>{g().sidebarExpandedKeys.includes(e.id)||g().setSidebarExpandedKeys([...g().sidebarExpandedKeys,e.id])},onDrop:a}),isDragOver:n}}const Ds=m.createContext(null);function Mt({nodes:e,itemRenderer:t,parentNode:n,level:r}){return e.map((a,i)=>m.cloneElement(t(a),{level:r==null?0:r+1,index:i,node:a,parentNode:n,key:a.id,itemRenderer:t}))}function Ba({children:e,nodes:t,...n}){const[r,a]=Be(n.expandedKeys,n.defaultSelectedKeys,n.onExpandedKeysChange),[i,o]=Be(n.selectedKeys,n.defaultSelectedKeys,n.onSelectedKeysChange),[l,d]=m.useState(),u={expandedKeys:r,setExpandedKeys:a,selectedKeys:i,setSelectedKeys:o,focusedNode:l,setFocusedNode:d};return s.jsx(Ds.Provider,{value:u,children:s.jsx(yn,{children:s.jsx(Wa,{nodes:t,itemRenderer:e})})})}function Wa(e){return s.jsx("ul",{className:"overflow-hidden text-sm",role:"tree",children:Mt(e)})}const At=m.forwardRef(({icon:e,label:t,level:n=0,node:r,className:a,...i},o)=>{const{expandedKeys:l,setExpandedKeys:d,selectedKeys:u,setSelectedKeys:h}=m.useContext(Ds),f=l.includes(r.id),p=u.includes(r.id),v=j=>{j.stopPropagation();const y=l.indexOf(r.id),k=[...l];y>-1?k.splice(y,1):k.push(r.id),d(k)};return s.jsxs("div",{...i,ref:o,onClick:j=>{j.stopPropagation(),h([r.id])},className:P("header tree-label flex cursor-pointer flex-nowrap items-center gap-4 overflow-hidden text-ellipsis whitespace-nowrap rounded py-6",a,p&&"bg-primary/selected font-bold text-primary",!p&&"hover:bg-hover"),children:[n>0&&s.jsx("div",{className:"flex",children:Array.from({length:n}).map((j,y)=>s.jsx("div",{className:"h-24 w-24"},y))}),s.jsx("div",{onClick:v,children:s.jsx(Zn,{className:P("cursor-default transition-transform icon-sm",f&&"rotate-90")})}),e,s.jsx("div",{className:"overflow-hidden text-ellipsis pr-6",children:t})]})});At.displayName="TreeLabel";function Ka({label:e,icon:t,node:n,level:r,index:a,itemRenderer:i,labelRef:o,labelClassName:l,className:d,parentNode:u,...h}){const f=bn(),{expandedKeys:p,selectedKeys:v,focusedNode:j,setFocusedNode:y,setExpandedKeys:k,setSelectedKeys:S}=m.useContext(Ds);if(m.useEffect(()=>()=>{j===(n==null?void 0:n.id)&&y(void 0)},[j,n==null?void 0:n.id,y]),!n||!i)return null;const I=n.children.length,b=I&&p.includes(n.id),$=v.includes(n.id),G=r===0&&a===0,B=j==null?G:j===n.id,de=E=>{var W,Rs;if(j!=null)switch(E.key){case"Enter":case" ":E.stopPropagation(),E.preventDefault(),S([j]);break;case"ArrowRight":if(E.stopPropagation(),E.preventDefault(),!I)return;b?f==null||f.focusNext():k([...p,j]);break;case"ArrowLeft":if(E.stopPropagation(),E.preventDefault(),b){const re=p.indexOf(j),he=[...p];he.splice(re,1),k(he)}else if(u){const re=(Rs=(W=document.activeElement)==null?void 0:W.parentElement)==null?void 0:Rs.closest("[tabindex]");re&&re.focus()}break;case"ArrowDown":E.stopPropagation(),E.preventDefault(),f==null||f.focusNext();break;case"ArrowUp":E.stopPropagation(),E.preventDefault(),f==null||f.focusPrevious();break;case"Home":E.stopPropagation(),E.preventDefault(),f==null||f.focusFirst();break;case"End":E.stopPropagation(),E.preventDefault(),f==null||f.focusLast();break;case"*":if(E.stopPropagation(),E.preventDefault(),u!=null&&u.children){const re=[...p];u.children.forEach(he=>{he.children.length&&!p.includes(he.id)&&re.push(he.id)}),re.length!==p.length&&k(re)}break}};return s.jsxs("li",{role:"treeitem","aria-expanded":b?"true":"false","aria-selected":$,tabIndex:B?0:-1,onKeyDown:We(de),onFocus:E=>{E.stopPropagation(),y(n.id)},onBlur:E=>{E.stopPropagation(),E.currentTarget.contains(E.relatedTarget)||y(void 0)},className:P("outline-none","[&>.tree-label]:focus-visible:ring [&>.tree-label]:focus-visible:ring-2 [&>.tree-label]:focus-visible:ring-inset",d),children:[s.jsx(At,{ref:o,className:l,node:n,level:r,label:e,icon:t,...h}),s.jsx(H,{initial:!1,children:b?s.jsx(K.ul,{role:"group",initial:"closed",animate:"open",exit:"closed",variants:{open:{opacity:1,height:"auto"},closed:{opacity:0,height:0,overflow:"hidden"}},children:Mt({nodes:n.children,parentNode:n,itemRenderer:i,level:r})},`${n.id}-group`):null})]})}function Oa(){const e=le(),{data:t}=Nt(),n=w(o=>o.sidebarExpandedKeys),r=w(o=>o.activePage);let a=[];r!=null&&r.isFolderPage&&(a=r.folder?[r.folder.id]:[]);const i=m.useMemo(()=>{const o=Lr.arrayToTree((t==null?void 0:t.folders)||[],{parentId:"parent_id",dataField:null});return[{...L.folder,children:o}]},[t==null?void 0:t.folders]);return s.jsx(Ba,{nodes:i,expandedKeys:n,onExpandedKeysChange:o=>{g().setSidebarExpandedKeys(o)},selectedKeys:a,onSelectedKeysChange:([o])=>{const l=Tt(o,i);e(l?ss(l):L.path)},children:()=>s.jsx(Va,{})})}function Va(e){const{node:t}=e,n=m.useRef(null),r=t.id===0,a=w(d=>d.entriesBeingDragged.includes(t.id)),{draggableProps:i}=it({type:"fileEntry",id:Ps(t),ref:n,disabled:r,hidePreview:!0,onDragStart:(d,u)=>{const h=u;g().setEntriesBeingDragged(h.getData().map(f=>f.id)),g().selectEntries([])},onDragEnd:()=>{g().setEntriesBeingDragged([])},getData:()=>[t]}),{droppableProps:o,isDragOver:l}=_a({folder:t,ref:n});return s.jsx(Ka,{...Ge(i,o,e),onContextMenu:d=>{d.preventDefault(),d.stopPropagation(),g().deselectEntries("all"),g().setContextMenuData({x:d.clientX,y:d.clientY,entry:t})},labelRef:n,className:r?"focus-visible:ring-2":void 0,labelClassName:P(l&&"bg-primary/selected ring ring-2 ring-inset ring-primary",a&&"opacity-30",r&&"h-40"),icon:r?s.jsx(Jn,{size:"md",className:"mr-6"}):s.jsx(Ue,{size:"sm",className:"mr-4"}),label:t.name})}const Tt=(e,t)=>{for(const n of t){if(n.id===e)return n.hash;if(n.children){const r=Tt(e,n.children);if(r)return r}}};function Ua(e){return D.post("file-entries/delete",e).then(t=>t.data)}function Re(){return C({mutationFn:e=>(F.loading(Qa(e),{disableExitAnimation:!0}),Ua(e)),onSuccess:(e,{entryIds:t,emptyTrash:n,deleteForever:r})=>{Q(),z.invalidateQueries({queryKey:_.fetchStorageSummary}),n?F(x("Emptied trash"),{disableEnterAnimation:!0}):r?F(x("Permanently deleted [one 1 item|other :count items]",{values:{count:t.length}}),{disableEnterAnimation:!0}):F(x("Moved [one 1 item|other :count items] to trash",{values:{count:t.length}}),{disableEnterAnimation:!0})},onError:(e,{emptyTrash:t})=>{const n=Wn(e);n?F.danger(n,{disableEnterAnimation:!0}):t?F.danger("could not empty trash",{disableEnterAnimation:!0}):F.danger("Could not delete items",{disableEnterAnimation:!0})}})}function Qa(e){return e.emptyTrash?x("Emptying trash..."):e.deleteForever?x("Deleting files..."):x("Moving to trash...")}function Ha(){return s.jsxs("div",{className:"mt-2 px-2 text-muted",children:[s.jsx(Oa,{}),s.jsx(Nn,{menu:La.DriveSidebar,orientation:"vertical",gap:"gap-0",children:e=>e.action==="/drive/trash"?s.jsx(Ya,{item:e},e.id):s.jsx(Lt,{item:e},e.id)})]})}const Lt=m.forwardRef(({item:e,className:t,...n},r)=>s.jsx(Dn,{className:({isActive:a})=>P(t,"my-4 h-40 w-full rounded px-24",a?"cursor-default bg-primary/selected font-bold text-primary":"hover:bg-hover"),item:e,ref:r,...n}));function Ya({item:e}){const t=Re(),[n,r]=m.useState(!1),a=m.useRef(null),{droppableProps:i}=Je({id:"trash",types:["fileEntry"],ref:a,onDragEnter:()=>{r(!0)},onDragLeave:()=>{r(!1)},onDrop:o=>{const l=o.getData().map(d=>d.id);t.mutate({entryIds:l,deleteForever:!1})}});return s.jsx(Lt,{className:P(n&&"bg-primary/selected"),ref:a,...i,item:e})}function Rt({isCompact:e,className:t}){const n=w(i=>i.activePage),{uploadFiles:r}=De(),a=e?s.jsx(M,{size:"md",disabled:!(n!=null&&n.canUpload),children:s.jsx(fs,{})}):s.jsx(N,{color:"primary",variant:"flat",size:"sm",startIcon:s.jsx(mt,{}),disabled:!(n!=null&&n.canUpload),children:s.jsx(c,{message:"Upload"})});return s.jsx("div",{className:t,children:s.jsxs(xe,{onItemSelected:async i=>{var o;if(i==="uploadFiles")r(await Ve({multiple:!0}));else if(i==="uploadFolder")r(await Ve({directory:!0}));else if(i==="newFolder"){const l=(o=g().activePage)==null?void 0:o.folder;g().setActiveActionDialog("newFolder",l?[l]:[])}},children:[a,s.jsxs(fe,{children:[s.jsx(R,{value:"uploadFiles",startIcon:s.jsx(er,{}),children:s.jsx(c,{message:"Upload files"})}),s.jsx(R,{value:"uploadFolder",startIcon:s.jsx(xt,{}),children:s.jsx(c,{message:"Upload folder"})}),s.jsx(R,{value:"newFolder",startIcon:s.jsx(vs,{}),children:s.jsx(c,{message:"Create folder"})})]})]})})}function Ga({className:e}){const{isSubscribed:t}=q(),{billing:n}=Ze();return s.jsxs("div",{className:P(e,"flex flex-col gap-20 border-r bg-alt text-sm font-medium text-muted"),children:[s.jsxs("div",{className:"compact-scrollbar flex-auto overflow-y-auto",children:[s.jsx(Rt,{className:"px-2 pt-2 text-center"}),s.jsx(Ha,{}),s.jsx(Or,{}),n.enable?s.jsx("div",{className:"mt-2 pl-60",children:s.jsx(N,{elementType:is,to:t?"/billing/change-plan":"/pricing",variant:"outline",color:"primary",size:"xs",children:s.jsx(c,{message:"Upgrade"})})}):null]}),s.jsx(Xa,{})]})}function Xa(){const e=le();return s.jsx(ya,{onChange:()=>{e(L.path)},className:"mt-auto w-full flex-shrink-0 border-t px-24 py-18"})}function Za(e){return D.get("drive/file-entries",{params:e}).then(t=>t.data)}const Ja=e=>{var a;const n=e.pages[0].folder,r=g().activePage;return n&&r&&r.uniqueId===n.hash&&(!r.folder||!An(n.permissions,(a=r.folder)==null?void 0:a.permissions))&&g().setActivePage(Is(n)),e};function $t(){const e=w(l=>l.activePage),t=w(l=>l.sortDescriptor),[n]=Xe(),{workspaceId:r}=Z(),a={section:e==null?void 0:e.name,...e==null?void 0:e.queryParams,...Object.fromEntries(n),folderId:e!=null&&e.isFolderPage?e.uniqueId:null,workspaceId:r,...t},i=e===se&&!a.query&&!a.filters,o=os({queryKey:_.fetchEntries(a),queryFn:({pageParam:l=1})=>Za({...a,page:l}),initialPageParam:1,getNextPageParam:l=>{const d=l.current_page;if(ft(l))return d+1},enabled:e!=null&&!i});return m.useEffect(()=>{var l;(l=o.data)!=null&&l.pages[0].folder&&Ja(o.data)},[o.data]),o}function ei(){return z.getQueriesData({queryKey:_.fetchEntries()}).reduce((t,n)=>{const r=n[1]?n[1].pages.flatMap(a=>a.data):[];return[...t,...r]},[])}const zt=[sr,{key:"owner_id",label:x("Owner"),description:x("User file was uploaded by"),defaultOperator:$e.eq,control:{type:ze.Select,defaultValue:"02",options:[{key:"01",label:x("anyone"),value:{value:null,operator:"!="}},{key:"02",label:x("me"),value:"{authId}"},{key:"03",label:x("not me"),value:{value:"{authId}",operator:"!="}}]}},tr({description:x("Date file was uploaded")}),nr({description:x("Date file was last changed")}),{key:"deleted_at",label:x("In trash"),description:x("Only show files that are in the trash"),defaultOperator:$e.ne,control:{type:ze.BooleanToggle,defaultValue:null}},{key:"shareableLink",label:x("Has shareable link"),description:x("Only show files that have a shareable link"),defaultOperator:$e.has,control:{type:ze.BooleanToggle,defaultValue:"*"}},{control:{type:ze.BooleanToggle,defaultValue:!0},key:"sharedByMe",label:x("Shared by me"),description:x("Only show files that are shared with someone"),defaultOperator:$e.eq}],Y=m.createContext(null),si=zt.map(e=>e.key);function ti(){const e=w(l=>l.activePage),{isMobileMode:t}=m.useContext(Y),{trans:n}=V(),r=le(),[a]=Xe(),[i,o]=m.useState(a.get("query")||"");return e!==se?null:s.jsxs("div",{className:"mb-30 mt-10 px-10 md:px-26",children:[t&&s.jsx("form",{className:"contents",onSubmit:l=>{var d;l.preventDefault(),((d=document.activeElement)==null?void 0:d.tagName)==="INPUT"&&document.activeElement.blur(),r({pathname:se.path,search:`?query=${i}`},{replace:!0})},children:s.jsx(Fe,{autoFocus:!0,className:"mb-20",startAdornment:s.jsx(M,{type:"submit",children:s.jsx(Ce,{})}),placeholder:n(x("Type to search")),value:i,onChange:l=>o(l.target.value)})}),s.jsx(rr,{filters:zt,pinnedFilters:si})]})}function ni(e,t){const n={...e};n.left=Math.max(0,n.left);const r=n.left-e.left;r>0&&(n.width-=r),n.top=Math.max(0,n.top);const a=n.top-e.top;return a>0&&(n.height-=a),n.width=Math.min(n.width,t.width-n.left),n.height=Math.min(n.height,t.height-n.top),n}const ke=new Map;function ri(e){const{id:t,ref:n}=e,r=m.useRef(e);r.current=e,m.useLayoutEffect(()=>{if(n.current)return ke.set(t,{...ke.get(t),id:t,ref:n,onSelected:()=>{var a,i;(i=(a=r.current).onSelected)==null||i.call(a)},onDeselected:()=>{var a,i;return(i=(a=r.current).onDeselected)==null?void 0:i.call(a)}}),()=>{ot.delete(t)}},[t,r,n])}function ai(e,t){return!e||!t?!1:e.left<=t.left+t.width&&e.left+e.width>=t.left&&e.top<=t.top+t.height&&e.top+e.height>=t.top}function ii({onPointerDown:e,...t}={}){const n=m.useRef(null),r=t.containerRef||n,a=m.useRef(null);let i=m.useRef({}).current;const o=()=>{var S,I,b,$,G,B,de;if(i.rafId&&cancelAnimationFrame(i.rafId),!i.startPoint||!i.endPoint||!i.boundaryRect)return;const d=i.startPoint,u=i.endPoint,h=d.scrollTop||0,f=((S=r.current)==null?void 0:S.scrollTop)||0,p={left:Math.min(d.x,u.x),top:Math.min(d.y,u.y),width:Math.abs(d.x-u.x),height:Math.abs(d.y-u.y)};p.left-=i.boundaryRect.left,p.top-=i.boundaryRect.top,p.top+=h;const v=f-h,j=Math.abs(v);v<0&&(p.top-=j),p.height+=j;const y=i.boundaryRect?ni(p,i.boundaryRect):{...p};a.current&&(i.rafId=requestAnimationFrame(()=>{a.current&&(a.current.style.display="block",a.current.style.transform=`translate(${y.left}px, ${y.top}px)`,a.current.style.width=`${y.width}px`,a.current.style.height=`${y.height}px`),i.rafId=void 0}));const k={...y,left:y.left+i.boundaryRect.left,top:y.top+i.boundaryRect.top-f};for(const[,E]of ke){const W=ai(E.rect,k);W&&!((I=i.selectedIds)!=null&&I.has(E.id))?((b=i.selectedIds)==null||b.add(E.id),($=E.onSelected)==null||$.call(E)):!W&&((G=i.selectedIds)!=null&&G.has(E.id))&&((B=i.selectedIds)==null||B.delete(E.id),(de=E.onDeselected)==null||de.call(E))}};return{containerProps:{...lt({minimumMovement:4,onPointerDown:e,onMoveStart:d=>{if(Kn)return!1;qs(ke),i={selectedIds:new Set};const u=r.current;if(i.startPoint={x:d.clientX,y:d.clientY,scrollTop:(u==null?void 0:u.scrollTop)||0},i.scrollListener=h=>{var f;i.startPoint&&(qs(ke),(f=i.boundaryRect)!=null&&f.height&&(i.boundaryRect.height=h.target.scrollHeight),o())},u){const h=u.getBoundingClientRect();u.addEventListener("scroll",i.scrollListener),i.boundaryRect={top:h.top,left:h.left,height:u.scrollHeight,heightWithoutScroll:h.height,width:u.scrollWidth}}},onMove:d=>{if(i.endPoint={x:d.clientX,y:d.clientY},i.boundaryRect&&r.current){const u=d.clientY+20>i.boundaryRect.heightWithoutScroll+i.boundaryRect.top,h=d.clientY-20<i.boundaryRect.top;u?r.current.scrollBy({top:10}):h&&r.current.scrollBy({top:-10})}o()},onMoveEnd:()=>{i.rafId&&cancelAnimationFrame(i.rafId),r.current&&i.scrollListener&&r.current.removeEventListener("scroll",i.scrollListener),a.current&&(a.current.style.display="none",a.current.style.transform="",a.current.style.width="",a.current.style.height=""),i={}}}).domProps,ref:r},boxProps:{ref:a}}}function oi(e){return e?D.post(`file-entries/${e}/shareable-link`).then(t=>t.data):Promise.reject(new Error("Invalid entry id"))}function qt(){return C({mutationFn:({entryId:e})=>oi(e),onSuccess:(e,{entryId:t})=>{z.setQueryData(_.fetchEntryShareableLink(t),e)},onError:e=>T(e,x("Could not create link"))})}function li({entryIds:e}){return D.post("file-entries/star",{entryIds:e}).then(t=>t.data)}function ci(){return C({mutationFn:e=>li(e),onSuccess:(e,{entryIds:t})=>{Q(),F(x("Starred [one 1 item|other :count items]",{values:{count:t.length}}))},onError:e=>T(e,x("Could not star items"))})}function di({entryIds:e}){return D.post("file-entries/unstar",{entryIds:e}).then(t=>t.data)}function ui(){return C({mutationFn:e=>di(e),onSuccess:(e,{entryIds:t})=>{Q(),F(x("Removed star from [one 1 item|other :count items]",{values:{count:t.length}}))},onError:e=>T(e,x("Could not remove star"))})}function mi(e){return D.post("file-entries/duplicate",e).then(t=>t.data)}function xi(){return C({mutationFn:e=>(F.loading(x("Duplicating [one 1 item|other :count items]...",{values:{count:e.entryIds.length}}),{disableExitAnimation:!0}),mi(e)),onSuccess:(e,t)=>{Q(),z.invalidateQueries({queryKey:_.fetchStorageSummary}),F(x("Duplicated [one 1 item|other :count items]",{values:{count:t.entryIds.length}}),{disableEnterAnimation:!0})},onError:e=>T(e,x("Could not duplicate items"),null,{disableEnterAnimation:!0})})}function _t(){return C({mutationFn:e=>fi(e),onSuccess:()=>Q()})}function fi({entryIds:e,...t}){return D.post(`file-entries/${e.join(",")}/unshare`,t).then(n=>n.data)}function Bt(){return C({mutationFn:e=>hi(e),onSuccess:(e,t)=>{Q(),F(x("Restored [one 1 item|other :count items]",{values:{count:t.entryIds.length}}))},onError:e=>T(e,x("Could not restore items"))})}function hi(e){return D.post("file-entries/restore",e).then(t=>t.data)}function Wt(e){const t=Kt(e),n=Ns(e),r=pi(e),a=gi(e),i=vi(e),o=ji(e),l=yi(e),d=bi(e),u=wi(e),h=Si(e),f=Ot(e),p=Vt(e),v=ki(e);return[t,n,r,a,i,o,l,d,u,h,f,p,v].filter(j=>!!j)}function Kt(e){if(e.some(t=>t.type!=="folder"))return{label:x("Preview"),icon:ar,key:"preview",execute:()=>{g().setActiveActionDialog("preview",e)}}}function Ns(e){const t=w(n=>n.activePage);if(!(e.length>1||!e.every(n=>n.permissions["files.update"])||t===A))return{label:x("Share"),icon:ut,key:"share",execute:()=>{g().setActiveActionDialog("share",e)}}}function pi(e){const t=w(r=>r.activePage),n=qt();if(!(e.length>1||!e.every(r=>r.permissions["files.update"])||t===A))return{label:x("Get link"),icon:ir,key:"getLink",execute:()=>{n.mutate({entryId:e[0].id}),g().setActiveActionDialog("getLink",e)}}}function gi(e){const t=w(r=>r.activePage),n=ci();if(!(e.every(r=>{var a;return(a=r.tags)==null?void 0:a.find(i=>i.name==="starred")})||!e.every(r=>r.permissions["files.update"])||t===A))return{label:x("Add to starred"),icon:or,key:"addToStarred",execute:()=>{n.mutate({entryIds:e.map(r=>r.id)}),g().selectEntries([])}}}function vi(e){const t=w(r=>r.activePage),n=ui();if(!(!e.every(r=>{var a;return(a=r.tags)==null?void 0:a.find(i=>i.name==="starred")})||t===A))return{label:x("Remove from starred"),icon:lr,key:"removeFromStarred",execute:()=>{n.mutate({entryIds:e.map(r=>r.id)}),g().selectEntries([])}}}function ji(e){const t=le(),n=w(r=>r.activePage);if(!(e.length!==1||e[0].type!=="folder"||n===A))return{label:x("Show all files"),icon:cr,key:"showAllFiles",execute:()=>{const r=e[0];t(`/drive/folders/${r.hash}/all`)}}}function yi(e){const t=w(n=>n.activePage);if(!(!e.every(n=>n.permissions["files.update"])||t===ve||t===A))return{label:x("Move to"),icon:dr,key:"moveTo",execute:()=>{g().setActiveActionDialog("moveTo",e)}}}function bi(e){const t=w(n=>n.activePage);if(!(e.length>1||!e.every(n=>n.permissions["files.update"])||t===A))return{label:x("Rename"),icon:ur,key:"rename",execute:()=>{g().setActiveActionDialog("rename",e)}}}function wi(e){const t=w(r=>r.activePage),n=xi();if(!(e.length>1||!e.every(r=>r.permissions["files.update"])||t===A))return{label:x("Make a copy"),icon:mr,key:"makeCopy",execute:()=>{var r;n.mutate({entryIds:e.map(a=>a.id),destinationId:(r=t==null?void 0:t.folder)==null?void 0:r.id}),g().selectEntries([])}}}function Si(e){const{downloadUrl:t}=ht(e[0],{downloadHashes:e.map(n=>n.hash)});if(e.every(n=>n.permissions["files.download"]))return{label:x("Download"),icon:Qe,key:"download",execute:()=>{t&&He(t),g().selectEntries([])}}}function Ot(e){const t=Re(),n=w(r=>r.activePage);if(!(n===ve||!e.every(r=>r.permissions["files.delete"])))return{label:n===A?x("Delete forever"):x("Remove"),icon:hs,key:"delete",execute:()=>{n===A?g().setActiveActionDialog("confirmAndDeleteForever",e):(t.mutate({entryIds:e.map(r=>r.id),deleteForever:n===A}),g().selectEntries([]))}}}function ki(e){const t=Bt();if(!(w(r=>r.activePage)!==A||!e.every(r=>r.permissions["files.delete"])))return{label:x("Restore"),icon:xr,key:"restore",execute:()=>{t.mutate({entryIds:e.map(r=>r.id)}),g().selectEntries([])}}}function Vt(e){const t=_t();if(w(r=>r.activePage)===ve)return{label:x("Remove"),icon:hs,key:"removeSharedEntry",execute:()=>{t.mutate({entryIds:e.map(r=>r.id),userId:"me"},{onSuccess:(r,a)=>{F(x("Removed [one 1 item|other {count} items]",{values:{count:a.entryIds.length}}))},onError:r=>T(r,x("Could not remove items"))}),g().selectEntries([])}}}function Ut(e){const t=Ii(e),n=Ei(e),r=Pi(e),a=Di();return[t,n,r,a].filter(i=>!!i)}function Ii(e){if(!(!e.folder||!e.folder.permissions["files.update"]))return{label:x("New folder"),icon:vs,key:"newFolder",execute:()=>{e.folder&&g().setActiveActionDialog("newFolder",[e.folder])}}}function Ei(e){const{uploadFiles:t}=De();if(!(!e.folder||!e.folder.permissions["files.update"]))return{label:x("Upload files"),icon:mt,key:"uploadFiles",execute:async()=>{t(await Ve({multiple:!0}))}}}function Pi(e){const{uploadFiles:t}=De();if(!(!e.folder||!e.folder.permissions["files.update"]))return{label:x("Upload folder"),icon:xt,key:"uploadFolder",execute:async()=>{t(await Ve({directory:!0}))}}}function Di(e){const t=Re();if(w(r=>r.activePage)===A)return{label:x("Empty trash"),icon:fr,key:"emptyTrash",execute:()=>{t.mutate({entryIds:[],emptyTrash:!0}),g().selectEntries([])}}}function ts({children:e,entries:t,page:n,showIfNoActions:r}){return(n==null?void 0:n.name)===L.name?s.jsx(Os,{page:L,showIfNoActions:r,children:e}):n===A?s.jsx(Os,{page:A,showIfNoActions:r,children:e}):n!=null&&n.folder?s.jsx(Ks,{entries:[n.folder],showIfNoActions:r,children:e}):t!=null&&t.length?s.jsx(Ks,{entries:t,showIfNoActions:r,children:e}):null}function Ks({entries:e,children:t,showIfNoActions:n}){const r=Wt(e);return s.jsx(Qt,{actions:r,showIfNoActions:n,children:t})}function Os({page:e,children:t,showIfNoActions:n}){const r=Ut(e);return s.jsx(Qt,{actions:r,showIfNoActions:n,children:t})}function Qt({actions:e,children:t,showIfNoActions:n}){return!e.length&&!n?null:s.jsxs(xe,{children:[t,s.jsx(fe,{children:e.map(r=>s.jsx(R,{onSelected:()=>{r.execute()},value:r.key,startIcon:m.createElement(r.icon),children:s.jsx(c,{...r.label})},r.key))})]})}function Fs(){const e=$t();return e.data?e.data.pages.flatMap(t=>t.data):[]}function Cs(){const e=w(n=>n.selectedEntries),t=Fs();return Array.from(e).map(n=>t.find(r=>r.id===n)).filter(n=>!!n)}function Ht(){return Cs()[0]}function Ni(){const e=Ht(),{data:t}=Nt();if(!(!e||!(t!=null&&t.folders)))return t.folders.find(n=>n.id===e.parent_id)}function Ms(){const e=Array.from(g().selectedEntries),t=ei();return e.map(n=>t.find(r=>r.id===n)).filter(n=>!!n)}function Yt({className:e}){const t=Cs();return t.length?s.jsx("div",{className:e,children:s.jsx(Fi,{entries:t})}):null}function Fi({entries:e}){const t=Kt(e),n=Ns(e),r=Ot(e),a=Vt(e),i=[t,n,r,a].filter(o=>!!o);return s.jsxs("div",{className:"entry-action-list",children:[i.map(o=>s.jsx(ae,{label:s.jsx(c,{...o.label}),children:s.jsx(M,{size:"sm",onClick:()=>{o.execute()},children:m.createElement(o.icon)})},o.key)),s.jsx(ts,{entries:e,children:s.jsx(ae,{label:s.jsx(c,{message:"More actions"}),children:s.jsx(M,{children:s.jsx(ps,{})})})})]})}function Ci(){var a;const e=Cs(),t=w(i=>i.activePage),n=w(i=>i.contextMenuData),r=n!=null&&n.entry?[n.entry]:e;return((a=n==null?void 0:n.entry)==null?void 0:a.id)===0?s.jsx(Vs,{position:n,page:L}):n&&r.length?s.jsx(Mi,{entries:r,position:n}):n&&t?s.jsx(Vs,{position:n,page:t}):null}function Mi({entries:e,position:t}){const n=Wt(e);return s.jsx(Gt,{position:t,actions:n})}function Vs({page:e,position:t}){const n=Ut(e);return s.jsx(Gt,{position:t,actions:n})}function Gt({position:e,actions:t}){return s.jsx(Tn,{position:e,onOpenChange:n=>{n||g().setContextMenuData(null)},children:t.map(n=>s.jsx(R,{value:n.key,onSelected:n.execute,startIcon:m.createElement(n.icon),children:s.jsx(c,{...n.label})},n.key))})}function Ai(){return st("((pointer: coarse))")}function Xt(e){const t=Ai(),n=m.useRef(null),{onDrop:r}=Ct(e),[a,i]=m.useState(!1),o=w(f=>f.entriesBeingDragged.includes(e.id)),l=w(f=>f.activePage),{draggableProps:d}=it({disabled:!!t||l===A,id:e.id,type:"fileEntry",ref:n,hidePreview:!0,onDragStart:(f,p)=>{g().selectedEntries.has(e.id)||g().selectEntries([e.id]),g().setEntriesBeingDragged(p.getData().map(v=>v.id))},onDragEnd:()=>{g().setEntriesBeingDragged([])},getData:()=>Ms()}),{droppableProps:u}=Je({id:e.id,disabled:t||e.type!=="folder",ref:n,types:["fileEntry","nativeFile"],acceptsDrop:f=>as(f,e),onDragEnter:()=>i(!0),onDragLeave:()=>i(!1),onDrop:r});ri({id:e.id,ref:n,onSelected:()=>{g().selectEntries([e.id],!0)},onDeselected:()=>{g().deselectEntries([e.id])}});const h=P(o&&"opacity-20",a&&"ring ring-offset-4 ring-primary bg-primary-light/10 rounded");return{draggableProps:d,droppableProps:u,isDragOver:a,isDragging:o,itemClassName:h,ref:n}}function Ti({item:e,children:t,className:n,...r}){const{isCollapsedMode:a}=m.useContext(js),{draggableProps:i,droppableProps:o,itemClassName:l,ref:d}=Xt(e);return s.jsx("div",{className:P(n,l),ref:d,...Ge(i,o,r,{onContextMenu:u=>{u.preventDefault(),u.stopPropagation(),a||(g().selectedEntries.has(e.id)||g().selectEntries([e.id]),g().setContextMenuData({x:u.clientX,y:u.clientY}))}}),children:t})}function Zt(){const e=le();return{performViewItemAction:m.useCallback(n=>{if(n&&n.type==="folder")g().activePage===A?g().setActiveActionDialog("trashFolderBlock",[n]):e(ss(n.hash));else{const r=Ms();g().setActiveActionDialog("preview",r.length?r:[n])}},[e])}}const Jt=Rr(e=>Ke(e)),As=[{key:"name",allowsSorting:!0,header:()=>s.jsx(c,{message:"Name"}),visibleInMode:"all",width:"flex-3 min-w-200",body:e=>s.jsx(Li,{entry:e})},{key:"updated_at",allowsSorting:!0,maxWidth:"max-w-184",header:()=>s.jsx(c,{message:"Last modified"}),body:e=>s.jsx(Oe,{date:e.updated_at})},{key:"file_size",allowsSorting:!0,header:()=>s.jsx(c,{message:"Size"}),maxWidth:"max-w-144",body:e=>Jt(e.file_size)??"-"},{key:"actions",hideHeader:!0,header:()=>s.jsx(c,{message:"Actions"}),align:"end",width:"w-42 flex-shrink-0",visibleInMode:"all",body:e=>s.jsx(Ri,{entry:e})}];function Li({entry:e}){const{isCollapsedMode:t}=m.useContext(js),n=t?"w-30 h-30":"w-24 h-24";return s.jsxs("div",{className:"flex items-center gap-14",children:[s.jsx(ys,{className:P("rounded",n),iconClassName:n,file:e}),s.jsxs("div",{className:"min-w-0",children:[s.jsx("div",{className:"overflow-hidden overflow-ellipsis",children:e.name}),t&&s.jsxs("div",{className:"mt-4 flex items-center text-xs text-muted",children:[s.jsx(Oe,{date:e.updated_at}),s.jsx("div",{children:"·"}),s.jsx("div",{children:Jt(e.file_size)})]})]})]})}function Ri({entry:e}){const{selectedRows:t}=m.useContext(js);return t.length?s.jsx(pt,{className:"mr-8 block",checked:t.includes(e.id)}):s.jsx(ts,{entries:[e],children:s.jsx(M,{className:"text-muted",children:s.jsx(ps,{})})})}function $i({entries:e}){const{performViewItemAction:t}=Zt(),n=w(i=>i.selectedEntries),r=w(i=>i.sortDescriptor),a=m.useMemo(()=>[...n],[n]);return s.jsx(gt,{columns:As,data:e,sortDescriptor:r,onSortChange:i=>{g().setSortDescriptor(i)},onAction:t,selectedRows:a,selectionStyle:"highlight",renderRowAs:Ti,onSelectionChange:i=>{g().selectEntries(i)}})}const en=wn.forwardRef(({entry:e,className:t,isSelected:n,isMobileMode:r,footerAdornment:a,...i},o)=>s.jsxs("div",{...i,ref:o,className:P("grid-item flex aspect-square select-none flex-col overflow-hidden rounded border shadow outline-none transition-shadow-opacity dark:bg-alt",n&&"border-primary",t),children:[s.jsx("div",{className:"relative min-h-0 flex-auto",children:s.jsx(ys,{className:"h-full w-full",iconClassName:"block w-70 h-70 absolute m-auto inset-0",file:e})}),s.jsx(zi,{entry:e,isSelected:n,isMobile:r,adornment:a})]}));function zi({entry:e,isSelected:t,isMobile:n,adornment:r}){return s.jsxs("div",{className:P("flex h-48 flex-shrink-0 items-center text-sm",n?"justify-between gap-10 pl-18 pr-2":"justify-center px-16",t&&"bg-primary-light/20"),children:[s.jsx("div",{className:"min-w-0 overflow-hidden overflow-ellipsis whitespace-nowrap",children:e.name}),r]})}function qi({entry:e}){const t=w(v=>v.selectedEntries.has(e.id)),{performViewItemAction:n}=Zt(),{isMobileMode:r}=m.useContext(Y),{draggableProps:a,droppableProps:i,itemClassName:o,ref:l}=Xt(e),d=()=>{t?g().deselectEntries([e.id]):g().selectEntries([e.id],!0)},u=(v,j)=>{r?g().selectedEntries.size?d():n(e):hr(v)?d():g().selectEntries([e.id])},{domProps:h}=lt({onLongPress:r?()=>d():void 0,onPress:u}),f=v=>{(v.key==="Enter"||v.key===" ")&&(v.preventDefault(),v.stopPropagation(),n(e))},p=v=>{v.preventDefault(),v.stopPropagation(),r||(g().selectedEntries.has(e.id)||g().selectEntries([e.id]),g().setContextMenuData({x:v.clientX,y:v.clientY}))};return s.jsx(en,{...Ge(a,i,h,{onKeyDown:We(f)}),ref:l,entry:e,isSelected:t,isMobileMode:!!r,tabIndex:-1,onDoubleClick:v=>{v.preventDefault(),v.stopPropagation(),r||n(e)},footerAdornment:r&&s.jsx(_i,{entry:e,isSelected:t}),onContextMenu:We(p),className:o})}function _i({entry:e,isSelected:t}){return w(r=>r.selectedEntries.size)?s.jsx(pt,{className:"mr-8 block",checked:t}):s.jsx(ts,{entries:[e],children:s.jsx(M,{className:"text-muted",onPointerDown:r=>{r.stopPropagation()},children:s.jsx(ps,{})})})}function Bi({entries:e}){return s.jsx("div",{className:"file-grid-container",children:s.jsx("div",{className:"file-grid",children:e.map(t=>s.jsx(qi,{entry:t},t.id))})})}const Us=[{id:"file_size",label:x("Size")},{id:"name",label:x("Name")},{id:"updated_at",label:x("Last modified")},{id:"created_at",label:x("Upload date")},{id:"type",label:x("Type")},{id:"extension",label:x("Extension")}];function sn({descriptor:e,onChange:t,isDisabled:n=!1}){const r=e.orderBy,a=e.orderDir,i=Us.find(o=>o.id===r);return s.jsxs(xe,{showCheckmark:!0,selectionMode:"multiple",selectedValue:[a||"desc",r||""],onItemSelected:o=>{t(o==="asc"||o==="desc"?{orderBy:r,orderDir:o}:{orderBy:o,orderDir:a})},children:[s.jsx(N,{className:"text-muted",variant:"text",size:"sm",startIcon:s.jsx(pr,{}),disabled:n,children:i?s.jsx(c,{...i.label}):null}),s.jsxs(fe,{children:[s.jsxs($s,{label:s.jsx(c,{message:"Direction"}),children:[s.jsx(R,{value:"asc",children:s.jsx(c,{message:"Ascending"})}),s.jsx(R,{value:"desc",children:s.jsx(c,{message:"Descending"})})]}),s.jsx($s,{label:s.jsx(c,{message:"Sort By"}),children:Us.map(o=>s.jsx(R,{value:o.id,children:s.jsx(c,{...o.label})},o.id))})]})]})}function tn({isDisabled:e}){const t=w(n=>n.sortDescriptor);return s.jsx(sn,{isDisabled:e,descriptor:t,onChange:n=>{g().setSortDescriptor(n)}})}function Ts({hash:e,params:t,isEnabled:n=!0}){return ie({queryKey:_.fetchFolderPath(e,t),queryFn:()=>Wi(e,t),enabled:!!e&&n})}function Wi(e,t){return D.get(`folders/${e}/path`,{params:t}).then(n=>n.data)}function nn({className:e}){const{isMobileMode:t}=m.useContext(Y),n=le(),r=w(h=>h.activePage),a=r==null?void 0:r.folder,i=Ts({hash:a==null?void 0:a.hash,isEnabled:(a==null?void 0:a.hash)!==L.folder.hash}),o=cs(),l=Ki(),d=!r||!o||r.isFolderPage&&!a||i.fetchStatus!=="idle";let u;if(d)u=null;else{const h=l?[l]:[];i.data&&i.data.path.forEach(f=>{h.push({page:Is(f),label:f.name})}),u=s.jsx(bs,{className:e,size:t?"md":"lg",currentIsClickable:!0,children:h.map((f,p)=>p===h.length-1?s.jsx(Ie,{children:({isMenuItem:j})=>j||!f.page.folder&&f.page!==A?s.jsx(_e,{value:f.label}):s.jsx(ts,{page:f.page,showIfNoActions:!0,children:s.jsxs(Xs,{className:"flex items-center gap-2 rounded focus-visible:ring-offset-4",children:[s.jsx(_e,{value:f.label}),s.jsx(xs,{className:"text-muted icon-md"})]})})},f.page.uniqueId):s.jsx(Ie,{onSelected:()=>{n(f.page.path)},children:s.jsx(_e,{value:f.label})},f.page.uniqueId))})}return u}function Ki(){var r,a;const e=w(i=>i.activePage),t=cs(),{user:n}=q();if(!e)return null;if(t&&!t.default&&e!=null&&e.isFolderPage&&((e==null?void 0:e.name)===L.name||((r=e.folder)==null?void 0:r.workspace_id)===t.id))return{label:t.name,page:L};if(e!=null&&e.isFolderPage){const i=(a=e.folder)==null?void 0:a.users.find(o=>o.owns_entry);return(i==null?void 0:i.id)!==(n==null?void 0:n.id)?{label:ve.label,page:ve}:{label:L.label,page:L}}return{label:e.label,page:e}}function rn({query:{isInitialLoading:e,fetchNextPage:t,isFetchingNextPage:n,hasNextPage:r},children:a,loaderMarginTop:i="mt-24",style:o,className:l,variant:d="infiniteScroll",loadMoreExtraContent:u,size:h="sm"}){const f=m.useRef(null),p=n||e,[v,j]=m.useState(0),y=d==="loadMore"&&v<3?"loadMore":"infiniteScroll",k=m.useRef(!1);m.useEffect(()=>{const I=f.current;if(!I||y==="loadMore")return;const b=new IntersectionObserver(([$])=>{if($.isIntersecting){if(!k.current)return;r&&!p&&(k.current=!1,t())}else k.current=!0});return b.observe(I),()=>{b.unobserve(I)}},[t,r,p,y]);let S;return a?S=n?a:null:y==="loadMore"?S=!e&&r&&s.jsxs("div",{className:P("flex items-center gap-8",i),children:[u,s.jsx(N,{size:h==="md"?"sm":"xs",className:P(h==="sm"?"min-h-24 min-w-96":"min-h-36 min-w-112"),variant:"outline",color:"primary",onClick:()=>{t(),j(v+1)},disabled:p,children:v>=2&&!n?s.jsx(c,{message:"Load all"}):s.jsx(c,{message:"Show more"})})]}):S=s.jsx(H,{children:n&&s.jsx(K.div,{className:P("flex w-full justify-center",i),...ds,children:s.jsx(te,{size:h,isIndeterminate:!0,"aria-label":"loading"})})}),s.jsxs("div",{style:o,className:P("w-full",l,r&&"min-h-36"),role:"presentation",children:[s.jsx("div",{ref:f,"aria-hidden":!0}),S]})}function Oi({isVisible:e}){const t=s.jsx(K.div,{...ds,transition:{duration:.3},className:"pointer-events-none absolute inset-0 min-h-full w-full border-2 border-dashed border-primary bg-primary-light/30",children:s.jsx(K.div,{initial:{y:"100%",opacity:0},animate:{y:"-10px",opacity:1},exit:{y:"100%",opacity:0},className:"fixed bottom-0 left-0 right-0 mx-auto max-w-max rounded bg-primary p-10 text-on-primary",children:s.jsx(c,{message:"Drop files to upload them to this folder."})})},"dragTargetMask");return s.jsx(H,{children:e?t:null})}function Vi({className:e}){const[t]=Xe(),n=!!t.get("query")||!!t.get("filters"),r=m.useRef(null),a=$t(),i=Fs(),{uploadFiles:o}=De(),l=Re(),d=w(b=>b.activePage),[u,h]=m.useState(!1),f=w(b=>b.viewMode),{isMobileMode:p}=m.useContext(Y),{containerProps:v,boxProps:j}=ii({containerRef:r,onPointerDown:b=>{b.target.closest(".entry-action-list")||g().deselectEntries("all")}}),{droppableProps:y}=Je({id:"driveRoot",ref:r,types:["nativeFile"],disabled:!(d!=null&&d.canUpload),onDragEnter:()=>{h(!0)},onDragLeave:()=>{h(!1)},onDrop:async b=>{b.type==="nativeFile"&&o(await b.getData())}});if(!d)return null;let k;if(!i.length&&(!a.isLoading||a.fetchStatus==="idle")){const b=d.noContentMessage(n);k=s.jsx(es,{className:"mt-40",image:s.jsx(Ae,{src:b.image}),title:s.jsx(c,{...b.title}),description:s.jsx(c,{...b.description})})}else a.isLoading||(k=f==="list"?s.jsx($i,{entries:i}):s.jsx(Bi,{entries:i}));const S=b=>{b.preventDefault(),b.stopPropagation(),g().deselectEntries("all"),g().setContextMenuData({x:b.clientX,y:b.clientY})},I=b=>{b.key==="a"&&gr(b)&&(b.preventDefault(),b.stopPropagation(),g().selectEntries(i.map($=>$.id))),b.key==="Delete"&&(b.preventDefault(),b.stopPropagation(),g().selectedEntries.size&&!l.isPending&&(d===A?g().setActiveActionDialog("confirmAndDeleteForever",Ms()):(l.mutate({entryIds:[...g().selectedEntries],deleteForever:d===A}),g().selectEntries([]))))};return s.jsx("div",{className:P("relative outline-none",e),tabIndex:-1,...Ge(v,y,{onKeyDown:We(I)}),onContextMenu:S,children:s.jsxs("div",{className:"relative flex min-h-full flex-col pt-10",children:[p?s.jsx(nn,{className:"mb-10 px-14"}):s.jsx(Ui,{}),s.jsx(ti,{}),s.jsxs("div",{className:"relative flex-auto px-18 pb-18 md:px-24",children:[s.jsx(ws,{slot:"drive",className:"mb-24"}),k,s.jsx(rn,{query:a})]}),s.jsx("div",{...j,className:"pointer-events-none absolute left-0 top-0 z-10 hidden border border-primary-light bg-primary-light/20 shadow-md"}),s.jsx(Ci,{}),s.jsx(Oi,{isVisible:u})]})})}function Ui(){const e=w(t=>t.activePage);return s.jsxs("div",{className:"my-10 flex min-h-42 items-center justify-between gap-40 px-10 text-muted md:px-18",children:[s.jsx(tn,{isDisabled:e==null?void 0:e.disableSort}),s.jsx(Yt,{className:"text-muted"})]})}function Qi(e){if(e===0)return"";const t=["B/s","KB/s","MB/s","GB/s"];let n=e,r=0;for(;n>=1024&&r<t.length-1;)n/=1024,r++;return`${n.toFixed(1)} ${t[r]}`}function Hi(e){if(e===0||!isFinite(e))return"";const t=Math.floor(e/3600),n=Math.floor(e%3600/60),r=Math.floor(e%60);return t>0?`${t}h ${n}m ${r}s`:n>0?`${n}m ${r}s`:`${r}s`}function an(e){const t=ee(n=>n.fileUploads.get(e));return m.useMemo(()=>{const n=(t==null?void 0:t.percentage)||0,r=(t==null?void 0:t.bytesUploaded)||0,a=(t==null?void 0:t.speed)||0,i=(t==null?void 0:t.eta)||0,o=(t==null?void 0:t.status)||"pending";return{percentage:n,bytesUploaded:r,speed:a,eta:i,speedFormatted:Qi(a),etaFormatted:Hi(i),status:o}},[t==null?void 0:t.percentage,t==null?void 0:t.bytesUploaded,t==null?void 0:t.speed,t==null?void 0:t.eta,t==null?void 0:t.status])}const Yi=m.memo(({file:e,style:t})=>s.jsxs("div",{className:"absolute left-0 top-0 flex w-full items-center gap-14 p-10",style:t,children:[s.jsx("div",{className:"shrink-0 rounded border p-8",children:s.jsx(Le,{className:"h-22 w-22",mime:e.mime})}),s.jsxs("div",{className:"min-w-0 flex-auto pr-10",children:[s.jsx("div",{className:"mb-2 flex min-w-0 items-center gap-10",children:s.jsx("div",{className:"min-w-0 flex-auto overflow-hidden overflow-ellipsis whitespace-nowrap font-medium",children:e.name})}),s.jsx(Gi,{file:e})]}),s.jsx("div",{className:"mr-10",children:s.jsx(Xi,{file:e})})]}));function Gi({file:e}){const t=an(e.id),n=ee(o=>o.fileUploads.get(e.id)),r=m.useMemo(()=>Ke(e.size),[e]),a=m.useMemo(()=>Ke(t.bytesUploaded),[t.bytesUploaded]);let i;if(t.status==="completed")i=s.jsx(c,{message:"Upload complete"});else if(t.status==="aborted")i=s.jsx(c,{message:"Upload cancelled"});else if(t.status==="failed"){const o=(n==null?void 0:n.retryCount)||0,l=(n==null?void 0:n.maxRetries)||0,d=((n==null?void 0:n.errorType)==="network"||(n==null?void 0:n.errorType)==="server")&&o<l;let u="Upload failed";(n==null?void 0:n.errorType)==="network"?u="Network error - check your connection":(n==null?void 0:n.errorType)==="server"?u="Server error - please try again":(n==null?void 0:n.errorType)==="validation"&&(u="File validation failed"),d&&o>0&&(u+=` (Attempt ${o}/${l})`),i=s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx(c,{message:u}),d&&s.jsx("span",{className:"text-primary",children:"• Click retry button"})]})}else{const{speedFormatted:o,etaFormatted:l}=t;if(n!=null&&n.isRetrying){const d=(n==null?void 0:n.retryCount)||0;i=s.jsx(c,{message:"Retrying... (Attempt :attempt)",values:{attempt:d}})}else i=s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx(c,{message:":bytesUploaded of :totalBytes",values:{bytesUploaded:a,totalBytes:r}}),o&&s.jsx("span",{children:"-"}),s.jsx("span",{children:o}),l&&s.jsx("span",{children:"-"}),s.jsx("span",{children:l})]})}return s.jsx("div",{className:"text-xs text-muted",children:i})}function Xi({file:e}){const t=ee(p=>p.fileUploads.get(e.id)),n=ee(p=>p.abortUpload),r=ee(p=>p.retryUpload),a=an(e.id),i=t==null?void 0:t.errorMessage,[o,l]=m.useState(!1),d=s.jsx(M,{size:"xs",iconSize:"sm",onClick:()=>{n(e.id)},children:s.jsx(ye,{})}),u=s.jsx(te,{"aria-label":"Upload progress",size:"w-24 h-24",value:a.percentage,trackWidth:3}),h=s.jsx(ae,{label:"Retry Upload",children:s.jsx(M,{size:"xs",iconSize:"sm",onClick:()=>r(e.id),children:s.jsx(Ln,{})})});let f;if(a.status==="failed"){const p=i||x("This file could not be uploaded"),v=(t==null?void 0:t.errorType)==="network"||(t==null?void 0:t.errorType)==="server";f=s.jsx(qe,{children:s.jsx(ae,{variant:"danger",label:s.jsx(_e,{value:`${p} (Error code: ${(t==null?void 0:t.errorCode)||"N/A"})`}),children:v?h:s.jsx(On,{className:"text-danger",size:"md"})})})}else a.status==="aborted"?f=s.jsx(qe,{children:s.jsx(Vn,{className:"text-warning",size:"md"})}):a.status==="completed"?f=s.jsx(qe,{children:s.jsx(vr,{size:"md",className:"text-positive"})}):f=s.jsx(qe,{onPointerEnter:p=>{p.pointerType==="mouse"&&l(!0)},onPointerLeave:p=>{p.pointerType==="mouse"&&l(!1)},children:o?d:u});return s.jsx(H,{children:f})}function qe({children:e,...t}){return s.jsx(K.div,{...t,initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},children:e})}function Zi(){const e=w(t=>t.uploadQueueIsOpen);return s.jsx(H,{children:e&&s.jsxs(K.div,{className:"fixed bottom-16 right-16 z-modal w-375 rounded border bg text-sm shadow-xl",initial:{y:"100%",opacity:0},animate:{y:0,opacity:1},exit:{y:"100%",opacity:0},children:[s.jsx(Ji,{}),s.jsx(eo,{})]},"upload-queue")})}function Ji(){const e=ee(a=>a.activeUploadsCount),t=ee(a=>a.completedUploadsCount),n=ee(a=>a.clearInactive);let r;return e?r=s.jsx(c,{message:"Uploading :count files",values:{count:e}}):t?r=s.jsx(c,{message:"Uploaded :count files",values:{count:t}}):r=s.jsx(c,{message:"No active uploads"}),s.jsxs("div",{className:"flex min-h-[45px] items-center justify-between gap-10 border-b bg-alt px-10 py-4",children:[r,e===0?s.jsx(M,{size:"sm",onClick:()=>{g().setUploadQueueIsOpen(!1),setTimeout(()=>{n()},200)},children:s.jsx(ye,{})}):void 0]})}function eo(){const e=ee(a=>a.fileUploads),t=[...e.values()],n=m.useRef(null),r=Sn({count:e.size,getScrollElement:()=>n.current,estimateSize:()=>60,overscan:4});return s.jsx("div",{className:"max-h-320 overflow-y-auto",ref:n,children:s.jsx("div",{className:"relative w-full",style:{height:`${r.getTotalSize()}px`},children:r.getVirtualItems().map(a=>{const i=t[a.index];return s.jsx(Yi,{style:{height:`${a.size}px`,transform:`translateY(${a.start}px)`},file:i.file},i.file.id)})})})}const so="/build/assets/detailed-examination-33c85772.svg";function on({entryType:e,entryName:t}){const{setRightSidenavStatus:n}=m.useContext(Y);return s.jsxs("div",{className:"mb-38 flex items-center gap-16 text-text-main",children:[s.jsx(Le,{className:"h-24 w-24",type:e}),s.jsx("div",{className:"mr-auto min-w-0 flex-auto text-ellipsis break-words text-xl font-normal",children:t}),s.jsx(M,{size:"md",className:"flex-shrink-0",onClick:()=>{n("closed")},children:s.jsx(ye,{})})]})}function Ls({children:e,margin:t="mb-20"}){return s.jsx("div",{className:P("text-base text-main",t),children:e})}function to(e){return ie({queryKey:ln(e),queryFn:()=>no(e),initialData:e.initialData?{tags:e.initialData}:void 0})}function ln(e){const{taggableType:t,taggableId:n,type:r,notType:a}=e,i=["tags","taggable",t,`${n}`];return r!=null&&i.push(r),a!=null&&i.push(a),i}function cn({taggableType:e,taggableIds:t}){return Promise.allSettled(t.map(n=>z.invalidateQueries({queryKey:ln({taggableType:e,taggableId:n})})))}async function no({taggableType:e,taggableId:t,notType:n,type:r}){return D.get(`taggable/${e}/${t}/list-tags`,{params:{notType:n,type:r}}).then(a=>a.data)}function dn(){return C({mutationFn:e=>ro(e),onSuccess:(e,t)=>{cn(t)},onError:e=>T(e)})}function ro(e){return D.post("taggable/detach-tag",e).then(t=>t.data)}function ao(e){return ie({queryKey:["tags",e],queryFn:({signal:t})=>io(e,t),placeholderData:Ss})}async function io(e,t){return e.query&&await new Promise(n=>setTimeout(n,300)),D.get("tags",{params:{paginate:"simple",...e},signal:e.query?t:void 0}).then(n=>n.data)}function oo(){return C({mutationFn:e=>lo(e),onSuccess:async(e,t)=>{cn(t)},onError:e=>T(e)})}function lo(e){return D.post("taggable/attach-tag",e).then(t=>t.data)}function co({attachedTags:e,tagType:t,notTagType:n,taggableType:r,taggableIds:a,userId:i,isLoading:o,onChange:l}){const{trans:d}=V(),[u,h]=m.useState(""),{data:f,isPlaceholderData:p,isLoading:v}=ao({type:t,notType:n,query:u,userId:i}),j=dn(),y=oo(),{tags:k,attachedTagIds:S}=m.useMemo(()=>{const I=(f==null?void 0:f.pagination.data)||[],b=e||[],$=b.map(B=>B.id),G=I.filter(B=>!$.includes(B.id));return G.unshift(...b),{tags:G,attachedTagIds:$}},[e,f]);return s.jsx(ne,{children:s.jsxs(J,{padding:"p-8",children:[s.jsx("form",{children:s.jsx(Fe,{placeholder:d({message:"Type tag name..."}),inputBorder:"border-b",inputRadius:"rounded-none",inputRing:"ring-0",inputShadow:"shadow-none",startAdornment:s.jsx(Ce,{}),value:u,onChange:I=>h(I.target.value),endAdornment:p&&s.jsx(te,{isIndeterminate:!0,size:"w-24 h-24"})})}),s.jsxs(tt,{className:"compact-scrollbar h-320 overflow-y-auto stable-scrollbar",children:[k.map(I=>{const b=S.includes(I.id),$=y.isPending||j.isPending||o;return s.jsx(ns,{isDisabled:$,onSelected:()=>{b?j.mutate({tagId:I.id,taggableIds:a,taggableType:r},{onSuccess:()=>l==null?void 0:l(I.id)}):y.mutate({taggableType:r,taggableIds:a,tagName:I.name,userId:i,tagType:t},{onSuccess:()=>l==null?void 0:l(I.id)})},className:P(b&&($?"text-primary-light":"text-primary")),startIcon:s.jsx(Bs,{size:"xs"}),endSection:b?s.jsx(Zs,{size:"sm",className:"block text-primary"}):s.jsx("div",{className:"h-20 w-20"}),children:I.display_name||I.name},I.id)}),!p&&!(f!=null&&f.pagination.data.length)&&u&&s.jsx(ns,{startIcon:s.jsx(Bs,{size:"xs"}),onSelected:()=>{y.mutate({taggableType:r,taggableIds:a,tagName:u,userId:i,tagType:t},{onSuccess:I=>{h(""),l==null||l(I.tag.id)}})},children:s.jsx(c,{message:'Create tag ":name"',values:{name:u}})}),f&&!k.length&&!u&&s.jsx("li",{className:"text-center text-muted",children:s.jsx(c,{message:"No tags found"})}),v&&s.jsx("li",{className:"flex justify-center",children:s.jsx(te,{isIndeterminate:!0,size:"w-24 h24"})})]})]})})}function uo({entry:e}){var i;const{user:t}=q(),n=dn(),{data:r,isFetching:a}=to({taggableType:"fileEntry",taggableId:e.id,initialData:(i=e.tags)==null?void 0:i.filter(o=>o.type!=="label"),type:"custom"});return s.jsxs("div",{className:"mt-20 border-t pt-20",children:[s.jsx(Ls,{margin:"mb-10",children:s.jsx(c,{message:"Tags"})}),s.jsx("div",{className:"flex items-center gap-8",children:s.jsx(Un,{size:"sm",radius:"rounded-button",startButton:s.jsxs(me,{type:"modal",children:[s.jsx(N,{variant:"outline",startIcon:s.jsx(fs,{}),size:"2xs",className:"min-h-26",children:s.jsx(c,{message:"Add tag"})}),s.jsx(co,{attachedTags:r==null?void 0:r.tags,isLoading:a,tagType:"custom",taggableType:"fileEntry",taggableIds:[e.id],userId:t==null?void 0:t.id})]}),children:r==null?void 0:r.tags.map(o=>s.jsx(Qn,{disabled:n.isPending||a,onRemove:()=>{n.mutate({tagId:o.id,taggableIds:[e.id],taggableType:"fileEntry"})},children:o.display_name||o.name},o.id))})})]})}function mo({entry:e}){return s.jsxs("div",{children:[s.jsx(on,{entryType:e.type,entryName:e.name}),e.type==="image"&&s.jsx(ys,{className:"mb-20",file:e}),s.jsxs("div",{children:[s.jsx(Ls,{children:s.jsx(c,{message:"Who has access"})}),s.jsxs("div",{className:"flex items-center gap-14",children:[e.workspace_id?s.jsx("div",{className:"flex h-32 w-32 items-center justify-center rounded-full border",children:s.jsx(jr,{className:"icon-md"})}):null,e.users.map(t=>s.jsx(ae,{label:t.name,children:s.jsx(ms,{src:t.image,size:"md",circle:!0})},t.id))]}),e.permissions["files.update"]&&s.jsx(N,{className:"mt-20 block",variant:"link",color:"primary",onClick:()=>{g().setActiveActionDialog("share",[e])},children:s.jsx(c,{message:"Manage Access"})})]}),s.jsx(xo,{entry:e}),s.jsx(uo,{entry:e})]})}function xo({entry:e}){const t=Ni(),n=le(),r=e.users.find(i=>i.owns_entry),a=m.useMemo(()=>Ke(e.file_size),[e.file_size]);return s.jsxs("div",{className:"mt-20 border-t pt-20",children:[s.jsx(Ls,{children:s.jsx(c,{message:"Properties"})}),s.jsx(pe,{label:s.jsx(c,{message:"Type"}),value:s.jsx("span",{className:"capitalize",children:s.jsx(c,{message:e.type})})}),s.jsx(pe,{label:s.jsx(c,{message:"Size"}),value:e.file_size?a:"-"}),s.jsx(pe,{label:s.jsx(c,{message:"Location"}),value:s.jsx(N,{variant:"link",startIcon:s.jsx(Ue,{}),onClick:()=>{n(t?ss(t.hash):L.path)},children:t?t.name:s.jsx(c,{message:"Root"})})}),r&&s.jsx(pe,{label:s.jsx(c,{message:"Owner"}),value:r.name}),s.jsx(pe,{label:s.jsx(c,{message:"Modified"}),value:s.jsx(Oe,{date:e.updated_at})}),s.jsx(pe,{label:s.jsx(c,{message:"Created"}),value:s.jsx(Oe,{date:e.updated_at})})]})}function pe({label:e,value:t}){return s.jsxs("div",{className:"mb-14 flex items-center",children:[s.jsx("div",{className:"w-1/3 text-xs text-muted",children:e}),s.jsx("div",{className:"w-2/3 text-sm text-main",children:t})]})}function fo({className:e}){const t=Ht();return s.jsx("div",{className:P(e,"h-full overflow-y-auto border-l bg p-18 text-sm text-muted"),children:t?s.jsx(mo,{entry:t}):s.jsx(ho,{})})}function ho(){return s.jsxs(m.Fragment,{children:[s.jsx(on,{entryType:"folder",entryName:s.jsx(c,{message:"All files"})}),s.jsx(es,{image:s.jsx(Ae,{src:so}),description:s.jsx(c,{message:"Select file or folder to see details here"})})]})}function po(e){return C({mutationFn:t=>go(t),onSuccess:(t,n)=>{Q(),F(x(":oldName renamed to :newName",{values:{oldName:n.initialName,newName:t.fileEntry.name}}))},onError:t=>Te(t,e)})}function go({entryId:e,...t}){return D.put(`file-entries/${e}`,t).then(n=>n.data)}function vo({entries:e}){var l;const{close:t,formId:n}=O(),r=(l=e[0])==null?void 0:l.name,a=Ee({defaultValues:{name:r}}),i=po(a),o=d=>{i.mutate({entryId:e[0].id,name:d.name,initialName:r},{onSuccess:t})};return s.jsxs(ne,{children:[s.jsx(oe,{children:s.jsx(c,{message:"Rename"})}),s.jsx(J,{children:s.jsx(Me,{onSubmit:o,form:a,id:n,children:s.jsx(Ne,{placeholder:"Enter a name...","aria-label":"Entry name",autoFocus:!0,name:"name",required:!0,minLength:3,maxLength:200})})}),s.jsxs(je,{children:[s.jsx(N,{variant:"flat",onClick:()=>t(),children:s.jsx(c,{message:"Cancel"})}),s.jsx(N,{form:n,type:"submit",variant:"flat",color:"primary",disabled:i.isPending||!a.formState.isDirty,children:s.jsx(c,{message:"Save"})})]})]})}function jo({name:e,parentId:t}){return D.post("folders",{name:e,parentId:t===0?null:t}).then(n=>n.data)}function yo(e){return C({mutationFn:({name:t,parentId:n})=>jo({name:t,parentId:n}),onSuccess:()=>Q(),onError:t=>Te(t,e)})}function un({parentId:e}){const{close:t,formId:n}=O(),{trans:r}=V(),a=Ee({defaultValues:{name:r({message:"Untitled Folder"})}}),i=yo(a),o=l=>{i.mutate({...l,parentId:e},{onSuccess:d=>{t(d.folder),F(x("Folder created"))}})};return s.jsxs(ne,{children:[s.jsx(oe,{children:s.jsx(c,{message:"New Folder"})}),s.jsx(J,{children:s.jsx(Me,{onSubmit:o,form:a,id:n,children:s.jsx(Ne,{placeholder:r({message:"Enter a name..."}),"aria-label":"Entry name",autoFocus:!0,autoSelectText:!0,name:"name",required:!0,minLength:3,maxLength:200})})}),s.jsxs(je,{children:[s.jsx(N,{variant:"flat",onClick:()=>t(),children:s.jsx(c,{message:"Cancel"})}),s.jsx(N,{form:n,type:"submit",variant:"flat",color:"primary",disabled:i.isPending,children:s.jsx(c,{message:"Create"})})]})]})}function bo({selectedEntry:e}){const t=Fs().filter(i=>i.type!=="folder"),n=t.findIndex(i=>i.id===(e==null?void 0:e.id)),[r,a]=m.useState(n);return s.jsx(vt,{allowDownload:e.permissions["files.download"],headerActionsLeft:s.jsx(wo,{activeIndex:r,entries:t}),activeIndex:r,onActiveIndexChange:a,entries:t})}function wo({activeIndex:e,entries:t}){const n=t[e],r=Ns([n]);return!n||!r?null:s.jsxs(m.Fragment,{children:[s.jsx(M,{className:"md:hidden",onClick:()=>{r.execute()},children:m.createElement(r.icon)}),s.jsx(N,{className:"max-md:hidden",variant:"text",startIcon:m.createElement(r.icon),onClick:()=>{r.execute()},children:s.jsx(c,{...r.label})})]})}function So({entryId:e,...t}){return D.post(`file-entries/${e}/share`,t).then(n=>n.data)}function ko(){return C({mutationFn:e=>So(e),onSuccess:()=>{Q()},onError:e=>{var t,n;if($r.isAxiosError(e)&&e.response){const r=e.response.data;(t=r.errors)!=null&&t.emails?F.danger((n=r.errors)==null?void 0:n.emails[0]):T(e)}}})}const Io={edit:!0,view:!0,download:!0},ge=[{key:"view",value:{view:!0},label:x("Can view")},{key:"download",value:{view:!0,download:!0},label:x("Can Download")},{key:"edit",value:Io,label:x("Can edit")}];function mn({value:e,onChange:t,isDisabled:n}){return s.jsxs(xe,{selectedValue:e.key,selectionMode:"single",onSelectionChange:r=>{r!==e.key&&t(ge.find(a=>a.key===r))},children:[s.jsx(N,{variant:"flat",color:"chip",size:"xs",endIcon:s.jsx(xs,{}),disabled:n,children:s.jsx(c,{...e.label})}),s.jsx(fe,{children:ge.map(r=>s.jsx(R,{value:r.key,children:s.jsx(c,{...r.label})},r.key))})]})}function Eo(e){const{download:t,edit:n}=e.entry_permissions;return n?ge.find(r=>r.key==="edit"):t?ge.find(r=>r.key==="download"):ge.find(r=>r.key==="view")}function Po(){return C({mutationFn:e=>Do(e),onSuccess:()=>{Q(),F(x("Updated user permissions"))},onError:e=>T(e,x("Could not update permissions"))})}function Do({entryId:e,...t}){return D.put(`file-entries/${e}/change-permissions`,t).then(n=>n.data)}function No({className:e,entry:t}){if(!t)return null;const n=t.users;return s.jsxs("div",{className:P(e,"overflow-hidden"),children:[s.jsx("div",{className:"mb-14 text-sm",children:s.jsx(c,{message:"Who has access"})}),s.jsx(H,{initial:!1,children:n.map(r=>s.jsx(Fo,{user:r,entry:t},r.id))})]})}function Fo({user:e,entry:t}){return s.jsxs(K.div,{initial:{x:"-100%",opacity:0},animate:{x:0,opacity:1},exit:{x:"100%",opacity:0},transition:{type:"tween",duration:.125},className:"mb-20 flex items-center gap-14 text-sm",children:[s.jsx(yr,{user:e,circle:!0,size:"w-44 h-44"}),s.jsxs("div",{children:[s.jsx("div",{children:e.name}),s.jsx("div",{className:"text-muted",children:e.email})]}),s.jsx("div",{className:"ml-auto",children:e.owns_entry?s.jsx("span",{className:"text-muted",children:s.jsx(c,{message:"Owner"})}):s.jsx(Co,{user:e,entry:t})})]},e.id)}function Co({user:e,entry:t}){const n=Po(),r=_t(),[a,i]=m.useState(()=>Eo(e));return s.jsxs("div",{className:"flex items-center gap-10",children:[s.jsx(mn,{isDisabled:n.isPending,onChange:o=>{n.mutate({userId:e.id,permissions:o.value,entryId:t.id}),i(o)},value:a}),s.jsx(M,{disabled:r.isPending,onClick:()=>{r.mutate({userId:e.id,entryIds:[t.id]},{onSuccess:()=>{F(x("Member removed"))},onError:o=>T(o,x("Could not remove member"))})},children:s.jsx(ye,{})})]})}function Mo({className:e,entry:t}){var k;const{trans:n}=V(),{share:r}=Ze(),a=ko(),[i,o]=m.useState([]),[l,d]=m.useState(!1),[u,h]=m.useState(ge[0]),f=i.every(S=>!S.invalid),[p,v]=m.useState(""),j=br("normalized-models/user",{perPage:7,query:p},{enabled:r==null?void 0:r.suggest_emails}),y=S=>S.description||S.name;return s.jsxs("div",{className:e,children:[s.jsx(at,{value:i,onChange:o,isAsync:!0,isLoading:j.fetchStatus==="fetching",inputValue:p,onInputValueChange:v,suggestions:(k=j.data)==null?void 0:k.results,displayWith:y,validateWith:S=>{const I=!kt(S.description);return{...S,invalid:I,errorMessage:I?n({message:"Not a valid email"}):void 0}},placeholder:n({message:"Enter email addresses"}),label:s.jsx(c,{message:"Invite people"}),children:S=>s.jsx(R,{value:S.id,startIcon:s.jsx(ms,{circle:!0,src:S.image,alt:""}),description:S.description,children:S.name})}),s.jsxs("div",{className:"mt-14 flex items-center justify-between gap-14",children:[s.jsx(mn,{onChange:h,value:u}),i.length?s.jsx(N,{variant:"flat",color:"primary",size:"sm",disabled:l||!f,onClick:()=>{d(!0),a.mutate({emails:i.map(S=>y(S)),permissions:u.value,entryId:t.id},{onSuccess:()=>{o([])},onSettled:()=>{d(!1)}})},children:s.jsx(c,{message:"Share"})}):null]}),s.jsx(No,{className:"mt-30",entry:t})]})}function xn(e){return ie({queryKey:_.fetchEntryShareableLink(e),queryFn:()=>Ao(e),enabled:!!e})}function Ao(e){return D.get(`file-entries/${e}/shareable-link`,{params:{loader:"shareableLink"}}).then(t=>t.data)}function To({entryId:e}){return D.delete(`file-entries/${e}/shareable-link`).then(t=>t.data)}function Lo(){return C({mutationFn:({entryId:e})=>To({entryId:e}),onSuccess:(e,{entryId:t})=>{z.setQueryData(_.fetchEntryShareableLink(t),{...e,link:null})},onError:e=>T(e,x("Could not delete link"))})}function Ro(e=36){let t="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let r=0;r<e;r+=1)t+=n.charAt(Math.floor(Math.random()*n.length));return t}function $o({setActivePanel:e,entry:t,focusInput:n}){var d,u;const r=xn(t.id),a=!!((d=r.data)!=null&&d.link),i=qt(),o=Lo(),l=r.isLoading||i.isPending||o.isPending;return s.jsxs("div",{children:[s.jsx("div",{className:"mb-10",children:s.jsx(c,{message:"Share link"})}),s.jsxs("div",{className:"flex items-center justify-between gap-14 px-2 pb-4",children:[s.jsx(us,{checked:a,disabled:l,onChange:()=>{a?o.mutate({entryId:t.id}):i.mutate({entryId:t.id})},children:a?s.jsx(c,{message:"Shareable link is created"}):s.jsx(c,{message:"Create shareable link"})}),a&&s.jsx(N,{variant:"link",color:"primary",onClick:()=>{e("linkSettings")},children:s.jsx(c,{message:"Link settings"})})]}),s.jsx(zo,{autoFocus:n,link:(u=r.data)==null?void 0:u.link})]})}function zo({link:e,autoFocus:t}){const{base_url:n}=Ze(),{trans:r}=V(),a=Fn(),i=(e==null?void 0:e.hash)||(a==null?void 0:a.hash)||Ro(),o=`${n}/drive/s/${i}`,[l,d]=kn(o,{successDuration:1e3});return s.jsx(Fe,{autoFocus:t,disabled:!e,className:"mt-10",readOnly:!0,value:o,"aria-label":r({message:"Shareable link"}),onFocus:u=>{u.target.select()},endAppend:s.jsx(N,{className:"min-w-100",variant:"flat",color:"primary",onClick:d,children:l?s.jsx(c,{message:"Copied!"}):s.jsx(c,{message:"Copy"})})})}function qo({entryId:e,...t}){return D.put(`file-entries/${e}/shareable-link`,t).then(n=>n.data)}function _o(e){return C({mutationFn:t=>qo(t),onSuccess:(t,{entryId:n})=>{z.setQueryData(_.fetchEntryShareableLink(n),t)},onError:t=>Te(t,e)})}function Bo({className:e,setActivePanel:t,entry:n}){const{formId:r}=O(),{data:a}=xn(n.id),i=a==null?void 0:a.link,o=Ee({defaultValues:{allowDownload:i==null?void 0:i.allow_download,allowEdit:i==null?void 0:i.allow_edit,expiresAt:i==null?void 0:i.expires_at,entryId:n.id}}),l=_o(o);return s.jsxs(m.Fragment,{children:[s.jsx(oe,{onDismiss:()=>{t("main")},children:s.jsx(c,{message:"Shareable Link Settings"})}),s.jsx(J,{children:s.jsx(K.div,{className:"min-h-[335px]",animate:{opacity:1,y:0},initial:{opacity:0,y:20},exit:{opacity:0,y:-20},transition:{duration:.1},children:s.jsxs(Me,{id:r,className:e,form:o,onSubmit:d=>{l.mutate(d,{onSuccess:()=>{t("main"),F(x("Link settings saved"))}})},children:[s.jsx(Ko,{showField:!!(i!=null&&i.expires_at)}),s.jsx(Oo,{showField:!!(i!=null&&i.password)}),s.jsxs(Ye,{children:[s.jsx(c,{message:"Allow download"}),s.jsx(zs,{name:"allowDownload",children:s.jsx(c,{message:"Users with link can download this item"})})]}),s.jsxs(Ye,{showBorder:!1,children:[s.jsx(c,{message:"Allow import"}),s.jsx(zs,{name:"allowEdit",children:s.jsx(c,{message:"Users with link can import this item into their own drive"})})]})]})},"link-settings-content")}),s.jsxs(je,{children:[s.jsx(N,{type:"button",onClick:()=>{t("main")},children:s.jsx(c,{message:"Cancel"})}),s.jsx(N,{type:"submit",form:r,variant:"flat",color:"primary",disabled:l.isPending,children:s.jsx(c,{message:"Save"})})]})]})}const Wo=zr(qr());function Ko({showField:e}){const{trans:t}=V(),[n,r]=m.useState(e);return s.jsxs(Ye,{children:[s.jsx(c,{message:"Link expiration"}),s.jsxs("div",{children:[s.jsx(us,{checked:n,onChange:a=>{r(a.target.checked)},children:s.jsx(c,{message:"Link is valid until"})}),n&&s.jsx(wr,{min:Wo,name:"expiresAt",granularity:"minute",className:"mt-20","aria-label":t({message:"Link expiration date and time"})})]})]})}function Oo({showField:e}){const{trans:t}=V(),[n,r]=m.useState(e);return s.jsxs(Ye,{children:[s.jsx(c,{message:"Password protect"}),s.jsxs("div",{children:[s.jsx(us,{checked:n,onChange:a=>{r(a.target.checked)},children:s.jsx(c,{message:"Users will need to enter password in order to view this link"})}),n&&s.jsx(Ne,{type:"password",autoFocus:!0,name:"password",className:"mt-20","aria-label":t({message:"Link password"}),description:s.jsx(c,{message:"Password will not be requested when viewing the link as file owner."}),placeholder:t({message:"Enter new password..."})})]})]})}function Ye({children:e,showBorder:t=!0}){const[n,r]=e;return s.jsxs("div",{className:P(t&&"mb-20 border-b pb-20"),children:[s.jsx("div",{className:"mb-8 text-sm font-medium",children:n}),r]})}function Qs({entry:e,focusLinkInput:t}){const{data:{fileEntry:n}}=ie({queryKey:_.fetchFileEntry(e.id),queryFn:()=>D.get(`drive/file-entries/${e.id}/model`).then(i=>i.data),initialData:{fileEntry:e}}),[r,a]=m.useState("main");return s.jsx(ne,{size:"lg",children:s.jsx(H,{initial:!1,mode:"wait",children:r==="linkSettings"?s.jsx(Bo,{setActivePanel:a,entry:n},"one"):s.jsx(Vo,{setActivePanel:a,entry:n,focusLinkInput:t},"two")})})}function Vo({setActivePanel:e,entry:t,focusLinkInput:n}){return s.jsxs(m.Fragment,{children:[s.jsx(oe,{children:s.jsx(c,{message:"Share ‘:name’",values:{name:t.name}})}),s.jsx(J,{className:"relative",children:s.jsxs(K.div,{animate:{opacity:1,y:0},initial:{opacity:0,y:20},exit:{opacity:0,y:-20},transition:{duration:.1},children:[s.jsx(Mo,{className:"mb-30 border-b pb-30",entry:t}),s.jsx($o,{setActivePanel:e,entry:t,focusInput:!!n})]},"share-content")})]})}function Uo({query:e}){const{workspaceId:t}=Z(),n=m.useMemo(()=>({section:"search",workspaceId:t,query:e,filters:jt([{key:"type",value:"folder"}])}),[t,e]);return ie({queryKey:_.fetchEntries(n),queryFn:({signal:r})=>Qo(n,r),enabled:!!e,placeholderData:Ss})}async function Qo(e,t){return e.query&&await new Promise(n=>setTimeout(n,300)),D.get("drive/file-entries",{params:e,signal:e.query?t:void 0}).then(n=>n.data)}function Ho({onFolderSelected:e}){const{trans:t}=V(),n=t({message:"Search folders"}),[r,a]=m.useState(""),{isFetching:i,data:o}=Uo({query:r}),l=o==null?void 0:o.data;return s.jsx(Sr,{size:"sm",maxItems:10,placeholder:n,"aria-label":n,className:"pt-20",endAdornmentIcon:s.jsx(Ce,{}),isAsync:!0,isLoading:i,inputValue:r,onInputValueChange:a,blurReferenceOnItemSelection:!0,clearInputOnItemSelection:!0,selectionMode:"none",openMenuOnFocus:!1,children:l==null?void 0:l.map(d=>s.jsx(R,{value:d.id,textLabel:d.name,onSelected:()=>{e(d)},children:d.name},d.id))})}function Yo({selectedFolder:e,onFolderSelected:t}){const{data:n}=Ts({hash:e.hash,isEnabled:(e==null?void 0:e.hash)!==L.folder.hash});let r=null;return n!=null&&n.path&&(n.path.length===1?r=L.folder:r=n.path[n.path.length-2]),s.jsxs("div",{className:"flex items-center gap-6 border-b pb-10",children:[s.jsx(M,{className:"flex-shrink-0",variant:"outline",size:"xs",disabled:!r,onClick:()=>{r&&t(r)},children:s.jsx(Rn,{})}),s.jsxs(bs,{size:"sm",className:"flex-auto",children:[s.jsxs(Ie,{onSelected:()=>{t(L.folder)},className:"flex items-center gap-8",children:[s.jsx(Ue,{className:"icon-sm"}),s.jsx(c,{message:L.folder.name})]}),n==null?void 0:n.path.map(a=>s.jsxs(Ie,{onSelected:()=>{t(a)},className:"flex items-center gap-8",children:[!a.id&&s.jsx(Ue,{className:"icon-sm"}),a.name]},a.id||"root"))]})]})}const Go="/build/assets/my-files-88476671.svg";function Xo({selectedFolder:e,movingSharedFiles:t}){const{workspaceId:n}=Z(),r=m.useMemo(()=>{const a=jt([{key:"type",value:"folder"}]);return{section:"folder",folderId:e.hash=="0"&&t?"sharedWithMe":e.hash,workspaceId:n,filters:a}},[n,e.hash,t]);return os({queryKey:_.fetchEntries(r),queryFn:({pageParam:a=1})=>Zo({...r,page:a}),initialPageParam:1,getNextPageParam:a=>{const i=a.current_page;if(ft(a))return i+1}})}function Zo(e){return D.get("drive/file-entries",{params:e}).then(t=>t.data)}function Jo({onFolderSelected:e,selectedFolder:t,movingSharedFiles:n}){var i,o,l;const r=Xo({selectedFolder:t,movingSharedFiles:n});let a;return r.isLoading?a=s.jsx("div",{className:"flex h-full w-full items-center justify-center",children:s.jsx(te,{isIndeterminate:!0,size:"md"})}):((o=(i=r.data)==null?void 0:i.pages[0])==null?void 0:o.data.length)===0?a=s.jsx(es,{size:"xs",className:"pb-20 pt-64",image:s.jsx(Ae,{src:Go}),title:s.jsx(c,{message:'There are no subfolders in ":folder"',values:{folder:t.name}})}):a=s.jsxs(m.Fragment,{children:[s.jsx(tt,{children:(l=r.data)==null?void 0:l.pages.flatMap(d=>d.data).map(d=>s.jsx(ns,{className:"min-h-48 border-b",onSelected:()=>{e(d)},startIcon:s.jsx(Le,{type:"folder"}),endIcon:s.jsx(kr,{size:"md"}),children:d.name},d.id))}),s.jsx(rn,{query:r})]}),s.jsx("div",{className:"h-288 overflow-y-auto",children:a})}function el({entries:e}){const{user:t}=q(),n=w(o=>o.activePage),[r,a]=m.useState((n==null?void 0:n.folder)||L.folder),i=e.some(o=>{var l;return!((l=o.users.find(d=>d.id===t.id))!=null&&l.owns_entry)});return s.jsxs(ne,{size:"lg",children:[s.jsx(oe,{children:s.jsx(c,{message:"Move [one ‘:name‘|other :count items]",values:{count:e.length,name:e[0].name}})}),s.jsxs(J,{children:[s.jsx("div",{className:"text-sm",children:s.jsx(c,{message:"Select a destination folder."})}),s.jsx(Ho,{onFolderSelected:a}),s.jsxs("div",{className:"mb-20 mt-40",children:[s.jsx(Yo,{selectedFolder:r,onFolderSelected:a}),s.jsx(Jo,{movingSharedFiles:i,selectedFolder:r,onFolderSelected:a})]})]}),s.jsx(sl,{selectedFolder:r,setSelectedFolder:a,entries:e})]})}function sl({selectedFolder:e,setSelectedFolder:t,entries:n}){const{close:r}=O(),a=Ft();return s.jsxs(je,{className:"border-t",startAction:s.jsxs(me,{type:"modal",onClose:i=>{i&&t(i)},children:[s.jsx(N,{startIcon:s.jsx(vs,{}),variant:"text",children:s.jsx(c,{message:"New Folder"})}),s.jsx(un,{parentId:e.id})]}),children:[s.jsx(N,{className:"max-md:hidden",variant:"flat",onClick:()=>r(),children:s.jsx(c,{message:"Cancel"})}),s.jsx(N,{type:"submit",variant:"flat",color:"primary",disabled:!Es(n,e)||a.isPending,onClick:()=>{a.mutate({destinationId:e.id,entryIds:n.map(i=>i.id)},{onSuccess:r})},children:s.jsx(c,{message:"Move here"})})]})}function tl({entries:e}){const t=Re(),{close:n}=O(),r=e.length===1?s.jsx(c,{message:"‘:name‘ will be deleted forever and you won't be able to restore it.",values:{name:e[0].name}}):s.jsx(c,{message:":count items will be deleted forever and you won't be able to restore them.",values:{count:e.length}});return s.jsx(be,{isDanger:!0,title:s.jsx(c,{message:"Delete forever?"}),body:r,confirm:s.jsx(c,{message:"Delete forever"}),isLoading:t.isPending,onConfirm:()=>{t.mutate({entryIds:e.map(a=>a.id),deleteForever:!0},{onSuccess:()=>{n(),g().selectEntries([])}})}})}function nl({entries:e}){const t=Bt(),{close:n}=O();return s.jsx(be,{title:s.jsx(c,{message:"This folder is in your trash"}),body:s.jsx(c,{message:"To view this folder, restore it from the trash."}),confirm:s.jsx(c,{message:"Restore"}),isLoading:t.isPending,onConfirm:()=>{t.mutate({entryIds:e.map(r=>r.id)},{onSuccess:()=>{n(),g().selectEntries([])}})}})}function rl(){const e=w(n=>n.activeActionDialog),t=al(e);return s.jsx(me,{type:"modal",isOpen:!!t,onClose:()=>{g().setActiveActionDialog(null)},children:t})}function al(e){var t;switch(e==null?void 0:e.name){case"rename":return s.jsx(vo,{entries:e.entries});case"newFolder":return s.jsx(un,{parentId:(t=e.entries[0])==null?void 0:t.id});case"preview":return s.jsx(bo,{selectedEntry:e.entries[0]});case"share":return s.jsx(Qs,{entry:e.entries[0]});case"getLink":return s.jsx(Qs,{entry:e.entries[0],focusLinkInput:!0});case"moveTo":return s.jsx(el,{entries:e.entries});case"confirmAndDeleteForever":return s.jsx(tl,{entries:e.entries});case"trashFolderBlock":return s.jsx(nl,{entries:e.entries});default:return null}}function il(){const{trans:e}=V(),t=le(),n=w(o=>o.activePage),[r]=Xe(),[a,i]=m.useState(r.get("query")||"");return s.jsx("form",{className:"max-w-620 flex-auto",onSubmit:o=>{o.preventDefault(),t({pathname:se.path,search:`?query=${a}`},{replace:!0})},children:s.jsx(Fe,{size:"sm",background:"bg",value:a,onChange:o=>i(o.target.value),onFocus:()=>{n!==se&&t(se.path)},startAdornment:s.jsx(M,{type:"submit",children:s.jsx(Ce,{})}),className:"max-w-420 flex-auto",placeholder:e({message:"Search"}),"aria-label":e({message:"Search files and folders"})})})}function ol(e){const t=m.useRef(e),n=m.useId();m.useEffect(()=>(_s.set(n,t.current),()=>{_s.delete(n)}),[n])}function ll(){const e=m.useRef(null),[t,n]=m.useState(),[r,a]=m.useState({});ol({type:"fileEntry",onDragStart:(o,l)=>{const d=l;d&&(a({entries:d.getData(),e:o,draggingTreeItem:qa(d.id)}),n({start:o}))},onDragMove:o=>{a(l=>({...l,e:o})),n(l=>({...l,end:o}))},onDragEnd:(o,l,d)=>{a({status:d})}});let i=null;return r.entries&&r.e&&(i=s.jsx("div",{ref:e,style:r.e?{transform:`translate(${r.e.x}px, ${r.e.y}px)`,width:`${r.e.rect.width}px`}:void 0,className:"pointer-events-none fixed left-0 top-0 isolate",children:r.entries.map((o,l)=>s.jsx(cl,{index:l,entry:o,points:t,state:r},o.id))})),s.jsx(H,{custom:r.status,children:i})}const cl=m.memo(({entry:e,points:t,index:n,state:r})=>{var h,f,p,v;const a=w(j=>j.viewMode),i=r.draggingTreeItem?Ps(e):e.id,o=ot.get(i);if(!(o!=null&&o.rect)||!(t!=null&&t.start))return null;const l=o.rect,d=((h=r.entries)==null?void 0:h.length)||0,u=j=>{var y,k,S;return j==="dropSuccess"?{x:0,y:0,opacity:0,transition:{duration:.1,delay:0}}:{x:l.left-(((y=t.end)==null?void 0:y.x)||0),y:l.top-(((k=t.end)==null?void 0:k.y)||0),width:`${(S=r.e)==null?void 0:S.rect.width}px`}};return s.jsxs(K.div,{transition:{delay:.01*n,bounce:0,duration:.2},initial:{x:l.left-t.start.x,y:l.top-t.start.y,width:`${(f=r.e)==null?void 0:f.rect.width}px`},animate:{x:0,y:0,width:a==="list"?288:void 0},exit:u,style:{width:a==="grid"?`${(p=r.e)==null?void 0:p.rect.width}px`:void 0,height:`${(v=r.e)==null?void 0:v.rect.height}px`},className:P("absolute max-h-48 whitespace-nowrap rounded border border-primary-light bg-paper",n<2&&"shadow",n===0&&"left-0 top-0 z-10",n>0&&"left-6 top-6"),children:[d>1&&n===0&&s.jsx(dl,{count:d}),s.jsxs("div",{className:"flex h-full items-center justify-center gap-10 overflow-hidden bg-primary-light/20 px-16 text-sm",children:[s.jsx(Le,{type:e.type}),s.jsx("div",{className:"flex-auto overflow-hidden text-ellipsis",children:e.name})]})]},e.id)}),dl=m.memo(({count:e})=>s.jsx(K.div,{initial:{opacity:0},animate:{opacity:1,transition:{delay:.1}},exit:{opacity:0},transition:{duration:.1},className:"absolute -right-6 -top-6 z-10 z-30 flex h-20 w-20 items-center justify-center rounded-full bg-danger text-sm font-bold text-white shadow-lg",children:e},"entryCount"));function fn({children:e,className:t}){return s.jsx("div",{className:P(t,"dashboard-grid-header"),children:e})}function ul(){const{isMobileMode:e}=m.useContext(Y),t=w(n=>n.activePage);return s.jsxs(fn,{className:"flex h-60 items-center gap-20 border-b px-8 py-4 md:px-26",children:[e?s.jsx(tn,{isDisabled:t==null?void 0:t.disableSort}):s.jsx(nn,{}),s.jsxs("div",{className:"ml-auto flex-shrink-0 text-muted",children:[s.jsx(ml,{}),s.jsx(xl,{})]})]})}function ml(){const e=w(n=>n.viewMode),t=e==="grid"?s.jsx(c,{message:"List view"}):s.jsx(c,{message:"Grid view"});return s.jsx(ae,{label:t,children:s.jsx(M,{size:"md",onClick:()=>{g().setViewMode(g().viewMode==="list"?"grid":"list")},children:e==="list"?s.jsx(Ir,{}):s.jsx(Er,{})})})}function xl(){const{rightSidenavStatus:e,setRightSidenavStatus:t}=m.useContext(Y),n=e?s.jsx(c,{message:"Hide details"}):s.jsx(c,{message:"Show details"});return s.jsx(ae,{label:n,children:s.jsx(M,{size:"md",color:e==="open"?"primary":null,onClick:()=>{t(e==="open"?"closed":"open")},children:s.jsx(Pr,{})})})}function Hs({className:e,position:t,children:n,size:r="md",mode:a,overlayPosition:i="fixed",display:o="flex",overflow:l="overflow-hidden",forceClosed:d=!1}){const{isMobileMode:u,leftSidenavStatus:h,setLeftSidenavStatus:f,rightSidenavStatus:p,setRightSidenavStatus:v}=m.useContext(Y),j=u||a==="overlay";let y=t==="left"?h:p;j&&y==="compact"&&(y="open");const k={open:{display:o,width:hl(y==="compact"?"compact":r)},closed:{width:0,transitionEnd:{display:"none"}}},S=fl(y==="compact"?"compact":r);return s.jsx(K.div,{variants:k,initial:!1,animate:d||y==="closed"?"closed":"open",transition:{type:"tween",duration:.15},onClick:I=>{const b=I.target;u&&(b.closest("button")||b.closest("a"))&&(f("closed"),v("closed"))},className:P(e,t==="left"?"dashboard-grid-sidenav-left":"dashboard-grid-sidenav-right",l,S,j&&`${i} bottom-0 top-0 z-20 shadow-2xl`,j&&t==="left"&&"left-0",j&&t==="right"&&"right-0"),children:m.cloneElement(n,{className:P(n.props.className,"w-full h-full overflow-y-auto compact-scrollbar",y==="compact"&&"hidden-scrollbar"),isCompactMode:y==="compact",isOverlayMode:j})})}function fl(e){switch(e){case"compact":return"w-60";case"sm":return"w-224";case"md":return"w-240";case"lg":return"w-288";default:return e||""}}function hl(e){switch(e){case"compact":return 60;case"sm":return 224;case"md":return 240;case"lg":return 288;default:return null}}function hn({children:e,className:t,hideToggleButton:n,...r}){const{isMobileMode:a,leftSidenavStatus:i,setLeftSidenavStatus:o,name:l,leftSidenavCanBeCompact:d}=m.useContext(Y),u=d&&!a,h=!n&&(a||d),f=()=>{o(i==="open"?"closed":"open")},p=()=>{const v=i==="compact"?"open":"compact";gs(`${l}.sidenav.compact`,v==="compact"),o(v)};return s.jsx(Gs,{className:P("dashboard-grid-navbar",t),border:"border-b",size:"sm",toggleButton:h?s.jsx(M,{size:"md",onClick:()=>{u?p():f()},children:s.jsx(Dr,{})}):void 0,...r,children:e})}function pl(e=!1){m.useEffect(()=>(e?document.documentElement.classList.remove("no-page-overflow"):document.documentElement.classList.add("no-page-overflow"),()=>{document.documentElement.classList.remove("no-page-overflow")}),[e])}function pn({children:e,leftSidenavStatus:t,onLeftSidenavChange:n,rightSidenavStatus:r,compactByDefault:a,initialRightSidenavStatus:i,onRightSidenavChange:o,name:l,leftSidenavCanBeCompact:d,height:u="h-screen",className:h,gridClassName:f="dashboard-grid",blockBodyOverflow:p=!0,...v}){pl(!p);const j=st("(max-width: 1024px)"),k=m.useMemo(()=>{if(!l)return a??!1;const W=rs(`${l}.sidenav.compact`);return W??a??!1},[l,a])?"compact":"open",[S,I]=Be(t,j?"closed":k,n),b=m.useMemo(()=>{if(j)return"closed";if(i!=null)return i;const W=rs(`${l}.sidenav.right.position`,"open");return W??(i||"closed")},[j,l,i]),[$,G]=Be(r,b,o),B=m.useCallback(W=>{G(W),gs(`${l}.sidenav.right.position`,W)},[G,l]),de=Nr(j);m.useEffect(()=>{j!==de&&(j?(I("closed"),B("closed")):(I(k),B(b)))},[j,k,b,de,I,B]);const E=j&&(S==="open"||$==="open");return s.jsx(Y.Provider,{value:{leftSidenavStatus:S,setLeftSidenavStatus:I,rightSidenavStatus:$,setRightSidenavStatus:B,leftSidenavCanBeCompact:d,name:l,isMobileMode:j},children:s.jsxs("div",{...v,className:P("relative isolate",f,h,u),children:[e,s.jsx(H,{children:E&&s.jsx($n,{position:"fixed",onClick:()=>{I("closed"),B("closed")}},"dashboard-underlay")})]})})}const gl={modifyUploadedFile:e=>{const t=qn();return e.fingerprint=`${e.fingerprint}-w-${t}`,e}};function Ql(){const{pathname:e}=Ys(),{hash:t}=ls(),{workspaceId:n}=Z(),r=w(i=>i.activePage);m.useEffect(()=>{e.includes("/all")&&t?g().setActivePage(Fa({hash:t})):g().setActivePage(Ta.find(o=>o.path===e)||Dt(t))},[e,t]);const a=m.useMemo(()=>({workspaceId:n}),[n]);return m.useEffect(()=>()=>{g().reset()},[]),s.jsxs(m.Fragment,{children:[(r==null?void 0:r.label)&&s.jsx(zn,{children:s.jsx(c,{message:typeof r.label=="string"?r.label:r.label.message})}),s.jsxs(ct,{options:gl,children:[s.jsx(yt.Provider,{value:a,children:s.jsxs(pn,{name:"drive",onDragOver:i=>{i.preventDefault(),i.stopPropagation(),i.dataTransfer.dropEffect="none"},onDrop:i=>{i.preventDefault()},children:[s.jsx(vl,{}),s.jsx(Hs,{position:"left",size:"md",children:s.jsx(Ga,{})}),s.jsx(ul,{}),s.jsx(bt,{children:s.jsx(Vi,{})}),s.jsx(Zi,{}),s.jsx(rl,{}),s.jsx(Hs,{position:"right",size:"lg",children:s.jsx(fo,{})})]})}),s.jsx(ll,{})]})]})}function vl(){const{isMobileMode:e}=m.useContext(Y),t=w(i=>i.activePage),n=e?null:s.jsx(il,{}),r=s.jsx(M,{elementType:is,to:se.path,children:s.jsx(Ce,{})}),a=s.jsxs(m.Fragment,{children:[t!==se&&r,s.jsx(Rt,{isCompact:!0})]});return s.jsxs(m.Fragment,{children:[s.jsx(hn,{rightChildren:e&&a,menuPosition:"drive-navbar",children:n}),e&&s.jsx(jl,{})]})}function jl(){const e=w(t=>t.selectedEntries.size);return e?s.jsxs("div",{className:"fixed right-0 top-0 z-10 flex h-54 w-full items-center justify-center gap-10 rounded bg-primary px-6 text-on-primary shadow-xl",children:[s.jsx(M,{onClick:()=>{g().selectEntries([])},children:s.jsx(ye,{})}),s.jsx(c,{message:":count selected",values:{count:e}}),s.jsx(Yt,{className:"ml-auto"})]}):null}const U=_r()(Br(e=>({password:null,viewMode:rs("drive.viewMode"),activeSort:{orderBy:"updated_at",orderDir:"desc"},setPassword:t=>{e(n=>{n.password=t})},isPasswordProtected:!1,setIsPasswordProtected:t=>{e(n=>{n.isPasswordProtected=t})},setViewMode:t=>{e(n=>{n.viewMode=t,gs("drive.viewMode",t)})},setActiveSort:t=>{e(n=>{n.activeSort=t})}})));function ue(){return U.getState()}function ce(){var l,d;const{hash:e}=ls(),{orderBy:t,orderDir:n}=U(u=>u.activeSort),r=`${t}:${n}`,a=U(u=>u.isPasswordProtected),i=U(u=>u.password),o=os({queryKey:_.fetchShareableLink({hash:e,sort:r}),queryFn:async({pageParam:u=1})=>{const h=await yl({hash:e,page:u,order:r,password:i});return h.passwordInvalid&&ue().setIsPasswordProtected(!0),h},initialData:()=>{var h,f;const u=(h=et().loaders)==null?void 0:h.shareableLinkPage;if(u&&((f=u.link)==null?void 0:f.hash)===e)return u.passwordInvalid&&ue().setIsPasswordProtected(!0),{pageParams:[void 0,1],pages:[u]}},initialPageParam:1,getNextPageParam:u=>{if(!u.folderChildren)return;const h=u.folderChildren.current_page,f=u.folderChildren.last_page;if(!(h>=f))return h+1},enabled:!!e&&!a||i!=null,placeholderData:Ss});return{...o,link:(l=o.data)==null?void 0:l.pages[0].link,entries:(d=o.data)==null?void 0:d.pages.flatMap(u=>{var h;return(h=u.folderChildren)==null?void 0:h.data})}}function yl({hash:e,page:t=1,order:n,password:r}){return D.get(`shareable-links/${e}`,{params:{loader:"shareableLinkPage",page:t,order:n,password:r}}).then(a=>a.data)}function bl({password:e,linkHash:t}){return D.post(`shareable-links/${t}/check-password`,{password:e}).then(n=>n.data)}function wl(){return C({mutationFn:e=>bl(e),onSuccess:(e,t)=>{e.matches&&ue().setPassword(t.password)},onError:e=>T(e,x("Could not create link"))})}function Sl({linkId:e,password:t}){return D.post(`shareable-links/${e}/import`,{password:t}).then(n=>n.data)}function kl(){const e=U(t=>t.password);return C({mutationFn:t=>Sl({...t,password:e}),onSuccess:async()=>{await z.invalidateQueries({queryKey:_.fetchShareableLink()}),F(x("Item imported into your drive"))},onError:t=>T(t,x("Could not create link"))})}function gn(){var o;const{link:e}=ce(),{user:t,isLoggedIn:n}=q(),{downloadUrl:r}=ht(e==null?void 0:e.entry),a=kl(),i=(o=e==null?void 0:e.entry)==null?void 0:o.users.find(l=>l.id===(t==null?void 0:t.id));return e!=null&&e.entry?s.jsxs("div",{children:[e.allow_download&&s.jsx(Il,{downloadUrl:r}),!i&&n&&e.allow_edit&&s.jsxs(xe,{onItemSelected:l=>{l==="import"?a.mutate({linkId:e.id}):l==="download"&&r&&He(r)},children:[s.jsx(M,{className:"ml-6",disabled:a.isPending,children:s.jsx(Js,{})}),s.jsxs(fe,{children:[s.jsx(R,{value:"download",startIcon:s.jsx(Qe,{}),children:s.jsx(c,{message:"Download"})}),s.jsx(R,{value:"import",startIcon:s.jsx(Fr,{}),children:s.jsx(c,{message:"Save a copy to your own drive"})})]})]})]}):null}function Il({downloadUrl:e}){return s.jsxs(m.Fragment,{children:[s.jsx(ae,{label:s.jsx(c,{message:"Download"}),children:s.jsx(M,{className:"md:hidden",onClick:()=>{e&&He(e)},children:s.jsx(Qe,{})})}),s.jsx(N,{className:"max-md:hidden",size:"sm",variant:"flat",color:"chip",startIcon:s.jsx(Qe,{}),onClick:()=>{e&&He(e)},children:s.jsx(c,{message:"Download"})})]})}function vn(){const{link:e}=ce(),t=nt();return s.jsx(Gs,{size:"md",color:"bg",className:"flex-shrink-0",rightChildren:(e==null?void 0:e.entry)&&s.jsx(gn,{}),menuPosition:"shareable-link-page",hideLogo:t,children:(e==null?void 0:e.entry)&&e.entry.type!=="folder"&&s.jsxs("div",{className:"fex-auto flex min-w-0 items-center gap-10",children:[s.jsx(Le,{className:"flex-shrink-0",type:e.entry.type}),s.jsx("div",{className:"flex-auto overflow-hidden overflow-ellipsis whitespace-nowrap font-medium",children:e.entry.name})]})})}function El(){const{trans:e}=V(),{hash:t}=ls(),n=e({message:"Password"}),[r,a]=m.useState(""),i=wl(),o=t?t.split(":")[0]:null,l=i.data&&!i.data.matches;return s.jsxs("div",{className:"flex h-screen flex-col bg-alt",children:[s.jsx(vn,{}),s.jsx("div",{className:"mx-auto my-80 px-10 md:px-20",children:s.jsxs("div",{className:"flex max-w-[560px] flex-col items-center gap-40 rounded border bg p-24 md:flex-row md:gap-14",children:[s.jsx("div",{className:"h-132 w-[165px]",children:s.jsx(Ae,{src:Cr})}),s.jsxs("form",{onSubmit:d=>{d.preventDefault(),i.mutate({linkHash:o,password:r})},children:[s.jsx("span",{className:"text-sm",children:s.jsx(c,{message:"The link you are trying to access is password protected."})}),s.jsx(Fe,{autoFocus:!0,placeholder:n,"aria-label":n,className:"mb-20 mt-10",type:"password",value:r,required:!0,errorMessage:l&&s.jsx(c,{message:"Password is not valid"}),onChange:d=>{a(d.target.value)}}),s.jsx("div",{className:"text-right",children:s.jsx(N,{variant:"flat",color:"primary",type:"submit",className:"w-full md:w-auto",disabled:i.isPending,children:s.jsx(c,{message:"Enter"})})})]})]})})]})}function Pl({entries:e,onEntrySelected:t}){return s.jsx("div",{className:"file-grid",children:e.map((n,r)=>s.jsx(en,{tabIndex:-1,className:"hover:shadow-md cursor-pointer bg",entry:n,onContextMenu:a=>{a.preventDefault()},onKeyDown:a=>{(a.key==="Enter"||a.key===" ")&&t(n,r)},onClick:()=>{t(n,r)}},n.id))})}const Dl=As.filter(e=>e.key!=="updated_at");function Nl({entries:e,onEntrySelected:t}){const n=U(a=>a.activeSort),r=nt();return s.jsx(gt,{columns:r?Dl:As,data:e,sortDescriptor:n,onSortChange:a=>{ue().setActiveSort(a)},onAction:(a,i)=>{t(a,i)},enableSelection:!1})}function Fl(e,t){var r;let n=e.hash;return t&&((r=e.entry)==null?void 0:r.hash)!==t&&(n=`${n}:${t}`),n}function jn(){const{link:e}=ce(),t=In();return n=>{e&&t(`/drive/s/${Fl(e,n)}`)}}function Cl({className:e}){const{pathname:t}=Ys(),n=jn(),[r,a]=m.useState(),i=U(y=>y.viewMode),o=m.useRef(null),{link:l,entries:d,isFetchingNextPage:u,hasNextPage:h,fetchNextPage:f,isPlaceholderData:p}=ce();if(m.useEffect(()=>{a(void 0)},[t]),m.useEffect(()=>{const y=o.current;if(!y)return;const k=new IntersectionObserver(([S])=>{S.isIntersecting&&h&&f()});return k.observe(y),()=>{k.unobserve(y)}},[h,f]),!l||p)return s.jsx("div",{className:P("flex justify-center",e),children:s.jsx(te,{isIndeterminate:!0})});const v=(y,k)=>{y.type==="folder"?n(y.hash):a(k)},j=d||[];return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:P("file-grid-container flex-auto overflow-auto px-14 pb-14 md:px-24 md:pb-24",e),children:[s.jsx(ws,{slot:"file-preview",className:"mb-40"}),i==="grid"?s.jsx(Pl,{entries:j,onEntrySelected:v}):s.jsx(Nl,{entries:j,onEntrySelected:v}),s.jsx("span",{ref:o,"aria-hidden":!0}),s.jsx(H,{children:u&&s.jsx(K.div,{className:"mt-24 flex w-full justify-center",...ds,children:s.jsx(te,{isIndeterminate:!0,"aria-label":"loading"})})})]}),s.jsx(me,{type:"modal",isOpen:r!=null,onClose:()=>a(void 0),children:s.jsx(vt,{entries:j,defaultActiveIndex:r,allowDownload:l.allow_download})})]})}function Ml({className:e,folder:t,link:n}){const r=jn(),a=U(l=>l.password),i=Ts({hash:t==null?void 0:t.hash,params:{shareable_link:n.id,password:a}});let o;if(i.isLoading)o=null;else{const l=[];i.data&&i.data.path.forEach(d=>{l.push({folder:d,label:s.jsx(s.Fragment,{children:d.name})})}),o=s.jsx(bs,{size:"lg",isNavigation:!0,children:l.map(d=>s.jsx(Ie,{onSelected:()=>{r(d.folder.hash)},children:d.label},d.folder.hash))})}return s.jsx("div",{className:P("h-36 flex-shrink-0",e),children:o})}function Al(){const e=U(a=>a.activeSort),{link:t,isFetching:n}=ce(),r=t&&t.entry;return s.jsxs("div",{className:"flex flex-col justify-between gap-14 p-14 md:h-90 md:flex-row md:items-center md:p-24",children:[r&&s.jsx(Ml,{link:t,folder:t.entry,className:"flex-auto"}),r&&s.jsxs("div",{className:"flex items-center justify-between text-muted md:justify-start",children:[s.jsx(sn,{isDisabled:n,descriptor:e,onChange:a=>{ue().setActiveSort(a)}}),s.jsx("div",{className:"ml-10 md:border-l md:pl-10",children:s.jsx(M,{onClick:()=>{ue().setViewMode(ue().viewMode==="grid"?"list":"grid")},children:s.jsx(Mr,{})})})]})]})}function Tl(){const{entries:e,isFetched:t}=ce(),n=t&&!(e!=null&&e.length);return s.jsxs(pn,{name:"folder-preview",children:[s.jsx(hn,{hideToggleButton:!0,rightChildren:s.jsx(gn,{}),color:"bg"}),s.jsx(fn,{children:s.jsx(Al,{})}),s.jsx(ct,{children:s.jsx(bt,{children:n?s.jsx(Ll,{}):s.jsx(Cl,{})})})]})}function Ll({className:e}){return s.jsx(es,{className:P(e,"mt-80"),image:s.jsx(Ae,{src:Pt}),title:s.jsx(c,{message:"Folder is empty"}),description:s.jsx(c,{message:"No files have been uploaded to this folder yet"})})}function Rl(){const{link:e}=ce();return e!=null&&e.entry?s.jsxs("div",{className:"flex h-screen flex-col bg-alt",children:[s.jsx(vn,{}),s.jsx(ws,{slot:"file-preview",className:"mx-auto mt-24"}),s.jsx(Ar,{entries:[e.entry],showHeader:!1,allowDownload:e.allow_download})]}):null}function Hl(){var f;const{status:e,link:t,entries:n}=ce(),{user:r,isLoggedIn:a}=q(),i=!a,o=(n==null?void 0:n.reduce((p,v)=>p+(v.file_size||0),0))||0,{trans:l}=V(),d=U(p=>p.isPasswordProtected),u=U(p=>p.password);let h;if(e==="pending")h=s.jsx("div",{className:"flex h-screen flex-auto items-center justify-center",children:s.jsx(te,{"aria-label":l({message:"Loading link"}),isIndeterminate:!0})});else{if(!t&&!d)return s.jsx(Tr,{});d&&!u?h=s.jsx(El,{}):((f=t==null?void 0:t.entry)==null?void 0:f.type)==="folder"?h=s.jsx(Tl,{}):i?h=s.jsx(Wr,{files:n,totalSize:o,expiresAt:t==null?void 0:t.expires_at}):h=s.jsx(Rl,{})}return s.jsx(Cn,{children:s.jsx(yt.Provider,{value:{shareable_link:t==null?void 0:t.id,password:u},children:h})})}export{Ql as DriveLayout,Hl as ShareableLinkPage};
//# sourceMappingURL=drive-routes.lazy-49696c47.js.map
