import{r as n,j as e,H as g,t as D,N as M,X as $}from"./vendor-react-fefbac25.js";import{S as q,b as x,h as w,a3 as z,a4 as v,k as S,m as l}from"./admin-analytics-cad99b47.js";import{N as G,g as A,m as H,n as Q}from"./main-c6885f20.js";import{aw as T,d as U,u as Y}from"./admin-appearance-7a196083.js";import{aj as I,bg as K,ai as R}from"./admin-core-a6fad5ad.js";import{D as O,bZ as W,b_ as X}from"./vendor-e6c98b2f.js";import{m as E}from"./vendor-utils-f24f35c9.js";import{S as Z,B as F}from"./billing-redirect-message-86be5c7b.js";import"./vendor-editor-a92125c6.js";import"./admin-settings-9cf13e73.js";function N({children:s}){const[t,r]=s;return n.useEffect(()=>{T("be.onboarding.selected")},[]),e.jsxs(n.Fragment,{children:[e.jsx(q,{children:e.jsx(x,{message:"Checkout"})}),e.jsx(G,{size:"sm",color:"transparent",className:"z-10 mb-20 md:mb-0",textColor:"text-main",logoColor:"dark",darkModeColor:"transparent",menuPosition:"checkout-page-navbar"}),e.jsxs("div",{className:"mx-auto w-full justify-between px-20 md:flex md:max-w-950 md:px-0 md:pt-128",children:[e.jsx("div",{className:"fixed right-0 top-0 hidden h-full w-1/2 bg-alt shadow-[15px_0_30px_0_rgb(0_0_0_/_18%)] md:block"}),e.jsxs("div",{className:"overflow-hidden md:w-400",children:[t,e.jsx(A,{menu:"checkout-page-footer",className:"mt-50 overflow-x-auto text-xs text-muted"}),e.jsx("div",{className:"mt-40",children:e.jsx(H,{})})]}),e.jsx("div",{className:"hidden w-384 md:block",children:e.jsx("div",{className:"relative z-10",children:r})})]})]})}const B=s=>`billing/products/${s}`;function J(){var i;const{productId:s,priceId:t}=g(),r=D({queryKey:[B(s)],queryFn:()=>V(s),placeholderData:O,enabled:s!=null&&t!=null}),a=(i=r.data)==null?void 0:i.product,d=(a==null?void 0:a.prices.find(o=>o.id===parseInt(t)))||(a==null?void 0:a.prices[0]);return{status:r.status,product:a,price:d}}function V(s){return w.get(B(s)).then(t=>t.data)}function _({showBillingLine:s=!0}){const{status:t,product:r,price:a}=J();return t==="error"||t!=="pending"&&(!r||!a)?null:e.jsxs("div",{children:[e.jsx("h2",{className:"mb-30 text-2xl",children:e.jsx(x,{message:"Summary"})}),t==="pending"?e.jsx(se,{},"loading-skeleton"):e.jsx(ee,{product:r,price:a,showBillingLine:s})]})}function ee({product:s,price:t,showBillingLine:r}){return e.jsxs(E.div,{children:[e.jsx("div",{className:"mb-6 text-xl font-semibold",children:s.name}),s.description&&e.jsx("div",{className:"text-sm text-muted",children:s.description}),e.jsx(I,{priceClassName:"font-bold text-4xl",periodClassName:"text-muted text-xs",variant:"separateLine",price:t,className:"mt-32"}),e.jsx(Q,{product:s}),r&&e.jsxs("div",{className:"mt-32 flex items-center justify-between gap-24 border-t pt-24 font-medium",children:[e.jsx("div",{children:e.jsx(x,{message:"Billed today"})}),e.jsx("div",{children:e.jsx(K,{value:t.amount,currency:t.currency})})]})]})}function se(){return e.jsxs(E.div,{...z,className:"max-w-180",children:[e.jsx(v,{className:"mb-6 text-xl"}),e.jsx(v,{className:"text-sm"}),e.jsx(v,{className:"mt-32 text-4xl"})]})}function te({productId:s,priceId:t}){const{data:r}=R(),a=n.useRef(!1),d=n.useRef(!1),[i,o]=n.useState(!1),c=n.useRef(null),{base_url:m,billing:{stripe:{enable:p},paypal:{enable:u,public_key:b}}}=S();return n.useEffect(()=>{!u||!b||a.current||(W({clientId:b,intent:"subscription",vault:!0,disableFunding:p?"card":void 0}).then(()=>{o(!0)}),a.current=!0)},[b,u,p]),n.useEffect(()=>{var L;if(!i||!((L=window.paypal)!=null&&L.Buttons)||!c.current||!(r!=null&&r.products.length)||!s||!t||d.current)return;const h=r.products.find(f=>f.id===parseInt(s)),y=h==null?void 0:h.prices.find(f=>f.id===parseInt(t));window.paypal.Buttons({style:{label:"pay"},createSubscription:(f,j)=>j.subscription.create({application_context:{shipping_preference:"NO_SHIPPING"},plan_id:y==null?void 0:y.paypal_id}),onApprove:(f,j)=>(j.redirect(`${m}/checkout/${s}/${t}/paypal/done?subscriptionId=${f.subscriptionID}&status=success`),Promise.resolve()),onError:f=>{location.href=`${m}/checkout/${s}/${t}/paypal/done?status=error`}}).render(c.current).then(()=>{d.current=!0})},[s,t,r,i,m]),{paypalElementRef:c,stripeIsEnabled:b!=null&&u}}function ge(){var m;const{productId:s,priceId:t}=g(),r=R(),{paypalElementRef:a}=te({productId:s,priceId:t}),{base_url:d,billing:{stripe:i}}=S();if(r.isLoading)return e.jsx(U,{screen:!0});const o=(m=r.data)==null?void 0:m.products.find(p=>p.id===parseInt(s)),c=o==null?void 0:o.prices.find(p=>p.id===parseInt(t));return!o||!c||r.status==="error"?e.jsx(M,{to:"/pricing",replace:!0}):e.jsxs(N,{children:[e.jsxs(n.Fragment,{children:[e.jsx("h1",{className:"mb-40 text-4xl",children:e.jsx(x,{message:"Checkout"})}),i.enable?e.jsxs(n.Fragment,{children:[e.jsx(Z,{productId:s,priceId:t,submitLabel:e.jsx(x,{message:"Upgrade"}),type:"subscription",returnUrl:`${d}/checkout/${s}/${t}/stripe/done`}),e.jsx(re,{})]}):null,e.jsx("div",{ref:a}),e.jsx("div",{className:"mt-30 text-xs text-muted",children:e.jsx(x,{message:"You’ll be charged until you cancel your subscription. Previous charges won’t be refunded when you cancel unless it’s legally required. Your payment data is encrypted and secure. By subscribing your agree to our terms of service and privacy policy."})})]}),e.jsx(_,{})]})}function re(){return e.jsx("div",{className:"relative my-20 text-center before:absolute before:left-0 before:top-1/2 before:h-1 before:w-full before:-translate-y-1/2 before:bg-divider",children:e.jsx("span",{className:"relative z-10 bg px-10 text-sm text-muted",children:e.jsx(x,{message:"or"})})})}function he(){const{productId:s,priceId:t}=g(),r=Y(),{billing:{stripe_public_key:a}}=S(),[d]=$(),i=d.get("payment_intent_client_secret"),[o,c]=n.useState(),m=n.useRef();return n.useEffect(()=>{m.current||(X(a).then(async p=>{if(!p||!i){c(k());return}p.retrievePaymentIntent(i).then(async({paymentIntent:u})=>{(u==null?void 0:u.status)==="succeeded"?(await ae(u.id),c(k("succeeded",s,t)),window.location.href="/billing"):c(k(u==null?void 0:u.status,s,t))})}),m.current=!0)},[a,i,t,s]),i?e.jsxs(N,{children:[e.jsx(F,{config:o}),e.jsx(_,{showBillingLine:!1})]}):(r("/"),null)}function k(s,t,r){switch(s){case"succeeded":return{message:l("Subscription successful!"),status:"success",buttonLabel:l("Return to site"),link:"/billing"};case"processing":return{message:l("Payment processing. We'll update you when payment is received."),status:"success",buttonLabel:l("Return to site"),link:"/billing"};case"requires_payment_method":return{message:l("Payment failed. Please try another payment method."),status:"error",buttonLabel:l("Go back"),link:P(t,r)};default:return{message:l("Something went wrong"),status:"error",buttonLabel:l("Go back"),link:P(t,r)}}}function P(s,t){return s&&t?`/checkout/${s}/${t}`:"/"}function ae(s){return w.post("billing/stripe/store-subscription-details-locally",{payment_intent_id:s})}function ye(){const{productId:s,priceId:t}=g(),[r]=$(),a=n.useRef(!1),[d,i]=n.useState();return n.useEffect(()=>{const o=r.get("subscriptionId"),c=r.get("status");a.current||(o&&c==="success"?ie(o).then(()=>{i(C("success",s,t)),window.location.href="/billing"}):i(C(c,s,t)),a.current=!0)},[t,s,r]),e.jsxs(N,{children:[e.jsx(F,{config:d}),e.jsx(_,{showBillingLine:!1})]})}function C(s,t,r){switch(s){case"success":return{message:l("Subscription successful!"),status:"success",buttonLabel:l("Return to site"),link:"/billing"};default:return{message:l("Something went wrong. Please try again."),status:"error",buttonLabel:l("Go back"),link:ne(t,r)}}}function ne(s,t){return s&&t?`/checkout/${s}/${t}`:"/"}function ie(s){return w.post("billing/paypal/store-subscription-details-locally",{paypal_subscription_id:s})}export{ge as Checkout,ye as CheckoutPaypalDone,he as CheckoutStripeDone};
//# sourceMappingURL=checkout-routes.lazy-db8aef79.js.map
