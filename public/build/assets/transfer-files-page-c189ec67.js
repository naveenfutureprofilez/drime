import{H as de,aT as ce,a as q,R as K,r as f,bb as L,cN as ue,j as e,cg as me,T as r,a6 as xe,o as p,a0 as I,cd as he,bE as J,al as pe,V as X,am as je,an as fe,a4 as ge,X as Z,y as ne,D as ye,z as be,A as ve,x as Ne,B as we,aG as ke,G as M,$ as Se,Z as le,ay as Fe,az as De,q as A,aJ as re,bp as W,c3 as Ce,cX as Ae,b6 as Ie,aM as Pe,aN as _e,p as Y,t as P,v as _,aA as B,aW as ze,a7 as ae}from"./main-014f9b6c.js";import{h as Te,n as ee,b as C,I as Ee,N as Ve,o as Ke,p as Me,S as Re,B as $e,c as Be,d as qe,F as Le,D as ie}from"./table-a975fd38.js";import{K as Qe}from"./formatted-number-d70e542a.js";import{L as He}from"./Link-ea1853b0.js";const R=(s,a,t)=>{const n=t?[...t]:s.split("/");return a&&n.push(a),n};function Oe(s,a,t,n){a.paginate||(a.paginate="preferLengthAware");const d=t==null?void 0:t.baseQueryKey;return t==null||delete t.baseQueryKey,de({...t,queryKey:R(s,a,d),queryFn:({signal:i})=>Ue(s,a,n,i),placeholderData:ce})}async function Ue(s,a,t,n){a.query&&await new Promise(i=>setTimeout(i,300));const d=await q.get(s,{params:a,signal:a.query?n:void 0}).then(i=>i.data);return t==null||t(d),d}const se=K.createContext(null);function Ss(){return f.useContext(se)}const Ge=15,We=[{key:10},{key:15},{key:20},{key:50},{key:100}];function Xe({query:s,onPerPageChange:a,onPageChange:t,className:n}){var h;const d=L(),i=ue(),l=(h=s.data)==null?void 0:h.pagination;if(!l)return null;const c=a?e.jsx(me,{minWidth:"min-w-auto",selectionMode:"single",disabled:s.isLoading,labelPosition:"side",size:"xs",label:e.jsx(r,{message:"Items per page"}),selectedValue:l.per_page?+l.per_page:Ge,onSelectionChange:o=>a(o),children:We.map(o=>e.jsx(xe,{value:o.key,children:o.key},o.key))}):null;return e.jsxs("div",{className:p("flex h-54 select-none items-center justify-end gap-20 px-2",n),children:[!d&&c,l.from&&l.to&&"total"in l?e.jsx("div",{className:"text-sm",children:e.jsx(r,{message:":from - :to of :total",values:{from:l.from,to:l.to,total:i.format(l.total)}})}):null,e.jsxs("div",{className:"text-muted",children:[e.jsx(I,{disabled:s.isFetching||l.current_page<2,onClick:()=>{t==null||t((l==null?void 0:l.current_page)-1)},children:e.jsx(he,{})}),e.jsx(I,{disabled:s.isFetching||!Te(l),onClick:()=>{t==null||t((l==null?void 0:l.current_page)+1)},children:e.jsx(Qe,{})})]})]})}const Je=J(e.jsx("path",{d:"M7 6h10l-5.01 6.3L7 6zm-2.75-.39C6.27 8.2 10 13 10 13v6c0 .55.45 1 1 1h2c.55 0 1-.45 1-1v-6s3.72-4.8 5.74-7.39c.51-.66.04-1.61-.79-1.61H5.04c-.83 0-1.3.95-.79 1.61z"}),"FilterAltOutlined"),te={variants:{open:{height:"auto",visibility:"visible",transitionEnd:{overflow:"auto"}},closed:{height:0,overflow:"hidden",transitionEnd:{visibility:"hidden"}}},transition:{type:"tween",duration:.2}},Ze=K.forwardRef(({variant:s="default",mode:a="single",children:t,className:n,isLazy:d,...i},l)=>{const[c,h]=pe(i.expandedValues,i.defaultExpandedValues||[],i.onExpandedChange),o=K.Children.count(t);return e.jsx("div",{className:p(s==="outline"&&"space-y-10",n),ref:l,role:"presentation",children:e.jsx(X,{children:e.jsx(je,{children:K.Children.map(t,(m,x)=>f.isValidElement(m)?f.cloneElement(m,{key:m.key||x,value:m.props.value||x,isFirst:x===0,isLast:x===o-1,mode:a,variant:s,expandedValues:c,setExpandedValues:h,isLazy:d}):null)})})})});function Ye(s){const{children:a,label:t,disabled:n,bodyClassName:d,bodyPadding:i="p-16",labelClassName:l,buttonPadding:c="py-10 pl-14 pr-10",startIcon:h,description:o,endAppend:m,chevronPosition:x="right",isFirst:k,mode:Q,isLazy:H,variant:v,footerContent:O,onHeaderMouseEnter:$,onHeaderMouseLeave:z}=s,S=s.expandedValues||[],F=s.value||0,T=s.setExpandedValues||(()=>{}),U=f.useRef(null),g=!n&&S.includes(F),j=f.useRef(!1);g&&(j.current=!0);const u=fe(),N=f.useId(),E=`${N}-button`,b=`${N}-panel`,G=D=>{switch(D.key){case"ArrowDown":u==null||u.focusNext();break;case"ArrowUp":u==null||u.focusPrevious();break;case"Home":u==null||u.focusFirst();break;case"End":u==null||u.focusLast();break}},w=()=>{const D=S.indexOf(F);if(D>-1){const y=[...S];y.splice(D,1),T(y)}else T(Q==="single"?[F]:[...S,F])},V=e.jsx("div",{className:p(v==="minimal"&&""),children:e.jsx(ge,{"aria-hidden":"true",size:"md",className:p(n?"text-disabled":"text-muted",g&&"rotate-180 transition-transform")})});return e.jsxs("div",{className:p(v==="default"&&"border-b",v==="outline"&&"rounded-panel border",n&&"text-disabled"),children:[e.jsxs("h3",{className:p("flex w-full items-center justify-between text-sm",n&&"pointer-events-none",k&&v==="default"&&"border-t",g&&v!=="minimal"?"border-b":"border-b border-b-transparent",v==="outline"?g?"rounded-panel-t":"rounded-panel":void 0),onMouseEnter:$,onMouseLeave:z,children:[e.jsxs("button",{disabled:n,"aria-expanded":g,id:E,"aria-controls":b,type:"button",ref:U,onKeyDown:G,onClick:()=>{n||w()},className:p("flex flex-auto items-center gap-10 text-left outline-none hover:bg-hover focus-visible:bg-primary/focus",c),children:[x==="left"&&V,h&&f.cloneElement(h,{size:"md",className:p(h.props.className,n?"text-disabled":"text-muted")}),e.jsxs("div",{className:"flex-auto overflow-hidden overflow-ellipsis",children:[e.jsx("div",{className:l,"data-testid":"accordion-label",children:t}),o&&e.jsx("div",{className:"text-xs text-muted",children:o})]}),x==="right"&&V]}),m&&e.jsx("div",{className:"flex-shrink-0 px-4 text-sm text-muted",children:m})]}),e.jsxs(Z.div,{"aria-labelledby":N,role:"region",variants:te.variants,transition:te.transition,initial:!1,animate:g?"open":"closed",children:[e.jsx("div",{className:p(i,d),children:!H||j?a:null}),O]})]})}function es({filter:s}){return null}function ss({filters:s}){const{decodedFilters:a}=ee(s),{formId:t}=ne(),[n,d]=f.useState(()=>a.map(c=>c.key)),i=e.jsx(M,{size:"xs",variant:"outline",className:"mr-auto",onClick:()=>{d([])},children:e.jsx(r,{message:"Clear"})}),l=e.jsx(M,{size:"xs",variant:"flat",color:"primary",className:"ml-auto",type:"submit",form:t,children:e.jsx(r,{message:"Apply"})});return e.jsxs(ye,{className:"min-w-[300px]",maxWidth:"max-w-400",size:"auto",children:[e.jsx(be,{padding:"px-14 py-10",leftAdornment:i,rightAdornment:l,children:e.jsx(r,{message:"Filter"})}),e.jsx(ve,{padding:"p-0",children:e.jsx(as,{filters:s,expandedFilters:n,setExpandedFilters:d})})]})}function as({filters:s,expandedFilters:a,setExpandedFilters:t}){const{decodedFilters:n,replaceAll:d}=ee(s),i={};s.forEach(o=>{const m=n.find(x=>x.key===o.key);i[o.key]=(m==null?void 0:m.value)!==void 0?m:{value:o.control.defaultValue,operator:o.defaultOperator}});const l=Ne({defaultValues:i}),{formId:c,close:h}=ne();return e.jsx(we,{form:l,id:c,onSubmit:o=>{const m=Object.entries(o).filter(([x,k])=>a.includes(x)&&k!==void 0).map(([x,k])=>({key:x,...k}));d(m),h()},children:e.jsx(Ze,{mode:"multiple",expandedValues:a,onExpandedChange:t,children:s.map(o=>e.jsxs(Ye,{startIcon:e.jsx(ke,{checked:a.includes(o.key)}),value:o.key,label:e.jsx(r,{...o.label}),bodyClassName:"max-h-288 overflow-y-auto compact-scrollbar",children:[o.description&&e.jsx("div",{className:p("text-xs text-muted",o.control.type!==C.BooleanToggle&&"mb-14"),children:e.jsx(r,{...o.description})}),e.jsx(ts,{filter:o})]},o.key))})})}function ts({filter:s}){switch(s.control.type){case C.Select:return e.jsx(Re,{filter:s});case C.ChipField:return e.jsx(Me,{filter:s});case C.DateRangePicker:return e.jsx(Ke,{filter:s});case C.SelectModel:return e.jsx(Ve,{filter:s});case C.Input:return e.jsx(Ee,{filter:s});case C.BooleanToggle:return e.jsx(es,{filter:s});case"custom":const a=s.control.panel;return e.jsx(a,{filter:s});default:return null}}function ns({filters:s,icon:a=e.jsx(Je,{}),color:t="primary",variant:n="outline",size:d="sm",disabled:i,className:l}){const c=L(),h=e.jsx(M,{variant:n,color:t,startIcon:a,disabled:i,size:d,className:l,children:e.jsx(r,{message:"Filter"})}),o=e.jsx(I,{color:t,size:"sm",variant:n,disabled:i,className:l,children:a});return e.jsxs(Se,{type:"popover",children:[c?o:h,e.jsx(ss,{filters:s})]})}function ls({actions:s,filters:a,filtersLoading:t,searchPlaceholder:n=A("Type to search..."),searchValue:d="",onSearchChange:i}){const{trans:l}=le();return e.jsxs(oe,{children:[e.jsx(Fe,{size:"sm",className:"mr-auto min-w-180 max-w-440 flex-auto",inputWrapperClassName:"mr-24 md:mr-0",placeholder:l(n),startAdornment:e.jsx(De,{size:"sm"}),value:d,onChange:c=>{i(c.target.value)}}),a&&e.jsx(ns,{filters:a,disabled:t}),s]})}function oe({children:s,...a}){return e.jsx("div",{className:"hidden-scrollbar relative mb-6 flex items-center gap-4 overflow-x-auto text-muted md:gap-12",...a,children:s})}function rs({actions:s,selectedItemsCount:a}){return e.jsxs(oe,{"data-testid":"datatable-selected-header",children:[e.jsx("div",{className:"mr-auto",children:e.jsx(r,{message:"[one 1 item|other :count items] selected",values:{count:a}})}),s]})}function is(){return e.jsxs(Z.div,{className:"flex h-30 items-center gap-6",...re,children:[e.jsx(W,{variant:"rect",size:"h-full w-144",radius:"rounded-md"}),e.jsx(W,{variant:"rect",size:"h-full w-112",radius:"rounded-md"}),e.jsx(W,{variant:"rect",size:"h-full w-172",radius:"rounded-md"})]},"filter-list-skeleton")}function os({filters:s,pinnedFilters:a,filtersLoading:t,columns:n,searchPlaceholder:d,queryParams:i,endpoint:l,baseQueryKey:c,actions:h,selectedActions:o,emptyStateMessage:m,tableDomProps:x,onRowAction:k,enableSelection:Q=!0,selectionStyle:H="checkbox",children:v,cellHeight:O,collapseTableOnMobile:$=!0,skeletonsWhileLoading:z,border:S}){var D;const F=f.useRef(c),T=L(),{trans:U}=le(),{encodedFilters:g}=ee(s),[j,u]=f.useState({perPage:15}),[N,E]=f.useState([]),b=Oe(l,{...j,...i,[$e]:g},{baseQueryKey:F.current},()=>E([])),G=!!(j.query||j.filters||g),w=(D=b.data)==null?void 0:D.pagination,V=(w==null?void 0:w.data)||(b.isLoading&&z?Array.from({length:z}).map(()=>({id:Ce(),isPlaceholder:!0})):[]);return console.log("data",V),e.jsxs(se.Provider,{value:{selectedRows:N,setSelectedRows:E,endpoint:l,params:j,setParams:u,query:b,baseQueryKey:F.current},children:[v,e.jsx(X,{initial:!1,mode:"wait",children:N.length?e.jsx(rs,{selectedItemsCount:N.length,actions:o},"selected"):e.jsx(ls,{searchPlaceholder:d,searchValue:j.query,onSearchChange:y=>u({...j,query:y}),actions:h,filters:s,filtersLoading:t},"default")}),s&&e.jsx("div",{className:"mb-14",children:e.jsx(X,{initial:!1,mode:"wait",children:t&&(g||a!=null&&a.length)?e.jsx(is,{}):e.jsx(Z.div,{...re,children:e.jsx(Be,{filters:s,pinnedFilters:a})},"filter-list")})}),e.jsxs("div",{className:p("relative rounded-panel",S||(!T||!$)&&"border"),children:[b.isFetching&&!z&&e.jsx(Ae,{isIndeterminate:!0,className:"absolute left-0 top-0 z-10 w-full","aria-label":U({message:"Loading"}),size:"xs"}),e.jsx("div",{className:"relative overflow-x-auto md:overflow-hidden",children:e.jsx(qe,{...x,columns:n,data:V,sortDescriptor:j,onSortChange:y=>{u({...j,...y})},selectedRows:N,enableSelection:Q,selectionStyle:H,onSelectionChange:E,onAction:k,collapseOnMobile:$,cellHeight:O})}),(b.isFetched||b.isPlaceholderData)&&!(w!=null&&w.data.length)?e.jsx("div",{className:"pt-50",children:f.cloneElement(m,{isFiltering:G})}):void 0,e.jsx(Xe,{query:b,onPageChange:y=>u({...j,page:y}),onPerPageChange:y=>u({...j,perPage:y})})]})]})}function ds({title:s,headerContent:a,headerItemsAlign:t="items-end",className:n,padding:d,variant:i,...l}){const c=f.useId();return e.jsxs("div",{className:p(d??i==="fullPage"?"p-0":"p-4",n),children:[s&&e.jsxs("div",{className:p(i==="fullPage"?"mb-6 px-24 py-12":"mb-8",a&&`flex ${t} gap-4`),children:[e.jsx(Ie,{children:s}),e.jsx("h1",{className:"heading text-[24px] capitalize",id:c,children:s}),a]}),e.jsx("div",{className:p(i==="fullPage"?"p-12 md:p-24":"p-0"),children:e.jsx(os,{...l,tableDomProps:{"aria-labelledby":s?c:void 0}})})]})}function cs({isFiltering:s,title:a,filteringTitle:t,image:n,size:d,className:i}){const l=L();return d||(d=l?"sm":"md"),e.jsx(Pe,{className:i,size:d,image:e.jsx(_e,{src:n}),title:s&&t?t:a,description:s&&t?e.jsx(r,{message:"Try another search query or different filters"}):void 0})}function us(){return Y({mutationFn:({id:s})=>q.delete(`admin/transfer-files/${s}`).then(a=>a.data),onSuccess:()=>{P.positive(A("Transfer file deleted")),_.invalidateQueries({queryKey:R("admin-transfer-files")}),_.invalidateQueries({queryKey:["admin","transfer-files","stats"]})},onError:s=>{var t,n;const a=((n=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:n.message)||"Failed to delete transfer file";P.danger(A(a))}})}function ms(){return Y({mutationFn:({ids:s})=>q.post("admin/transfer-files/bulk-delete",{ids:s}).then(a=>a.data),onSuccess:s=>{const a=s.deleted_count||0;P.positive(A(`Successfully deleted ${a} transfer files`)),_.invalidateQueries({queryKey:R("admin-transfer-files")}),_.invalidateQueries({queryKey:["admin","transfer-files","stats"]})},onError:s=>{var t,n;const a=((n=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:n.message)||"Failed to delete transfer files";P.danger(A(a))}})}function xs(){return Y({mutationFn:()=>q.post("admin/transfer-files/cleanup").then(s=>s.data),onSuccess:s=>{const a=s.deleted_uploads||0;P.positive(A(`Cleanup completed. Removed ${a} expired files`)),_.invalidateQueries({queryKey:R("admin-transfer-files")}),_.invalidateQueries({queryKey:["admin","transfer-files","stats"]})},onError:s=>{var t,n;const a=((n=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:n.message)||"Cleanup failed";P.danger(A(a))}})}const hs=J(e.jsx("path",{d:"M15 16h4v2h-4zm0-8h7v2h-7zm0 4h6v2h-6zM3 18c0 1.1.9 2 2 2h6c1.1 0 2-.9 2-2V8H3v10zm2-8h6v8H5v-8zm5-6H6L5 5H2v2h12V5h-3z"}),"DeleteSweepOutlined"),ps=J(e.jsx("path",{d:"M12 6c3.79 0 7.17 2.13 8.82 5.5C19.17 14.87 15.79 17 12 17s-7.17-2.13-8.82-5.5C4.83 8.13 8.21 6 12 6m0-2C7 4 2.73 7.11 1 11.5 2.73 15.89 7 19 12 19s9.27-3.11 11-7.5C21.27 7.11 17 4 12 4zm0 5c1.38 0 2.5 1.12 2.5 2.5S13.38 14 12 14s-2.5-1.12-2.5-2.5S10.62 9 12 9m0-2c-2.48 0-4.5 2.02-4.5 4.5S9.52 16 12 16s4.5-2.02 4.5-4.5S14.48 7 12 7z"}),"VisibilityOutlined"),js=[{key:"original_filename",allowsSorting:!0,header:()=>e.jsx(r,{message:"File Name"}),body:s=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.original_filename||"Untitled"}),e.jsxs("div",{className:"text-sm text-muted",children:[s.formatted_size,s.files_count>1&&e.jsxs("span",{children:[" • ",s.files_count," files"]}),s.has_password&&e.jsx("span",{children:" • 🔒 Protected"})]})]})},{key:"title",allowsSorting:!1,header:()=>e.jsx(r,{message:"Title"}),body:s=>e.jsx("div",{className:"text-sm",children:s.title||e.jsx("span",{className:"text-muted",children:"No title"})})},{key:"recipient_emails",allowsSorting:!1,header:()=>e.jsx(r,{message:"Recipient Email"}),body:s=>e.jsx("div",{className:"text-sm",children:s.recipient_emails||e.jsx("span",{className:"text-muted",children:"No recipient"})})},{key:"message",allowsSorting:!1,header:()=>e.jsx(r,{message:"Message"}),body:s=>e.jsx("div",{className:"text-sm",children:s.message?e.jsx(B,{label:s.message,children:e.jsx("div",{className:"truncate ",children:s.message})}):e.jsx("span",{className:"text-muted",children:"No message"})})},{key:"sender_email",allowsSorting:!1,header:()=>e.jsx(r,{message:"Sender"}),body:s=>e.jsx("div",{className:"text-sm",children:s.sender_email||e.jsx("span",{className:"text-muted",children:"Anonymous"})})},{key:"status",allowsSorting:!1,header:()=>e.jsx(r,{message:"Status"}),body:s=>{let a="positive",t="Active";return s.status==="expired"?(a="danger",t="Expired"):s.status==="download_limit_reached"&&(a="warning",t="Limit Reached"),e.jsx(ze,{color:a,size:"xs",children:t})}},{key:"download_count",allowsSorting:!0,header:()=>e.jsx(r,{message:"Downloads"}),body:s=>e.jsxs("div",{className:"text-sm",children:[s.download_count,s.max_downloads&&e.jsxs("span",{className:"text-muted",children:[" / ",s.max_downloads]})]})},{key:"created_at",allowsSorting:!0,header:()=>e.jsx(r,{message:"Created"}),body:s=>e.jsx("div",{className:"text-sm",children:s.created_at?new Date(s.created_at).toLocaleDateString("en-US"):"-"})},{key:"expires_at",allowsSorting:!0,header:()=>e.jsx(r,{message:"Expires"}),body:s=>e.jsx("div",{className:"text-sm",children:s.expires_at?new Date(s.expires_at).toLocaleDateString("en-US"):e.jsx("span",{className:"text-muted",children:"Never"})})},{key:"actions",header:()=>e.jsx(r,{message:"Actions"}),hideHeader:!0,align:"end",body:s=>e.jsx(fs,{file:s})}];function fs({file:s}){const a=us();return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(B,{label:e.jsx(r,{message:"View details"}),children:e.jsx(I,{size:"md",elementType:ae,to:`/admin/transfer-files/${s.id}`,className:"text-muted",children:e.jsx(ps,{})})}),e.jsx(B,{label:e.jsx(r,{message:"Copy share link"}),children:e.jsx(I,{size:"md",elementType:ae,to:s.share_url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:bg-primary/10",children:e.jsx(He,{})})}),e.jsx(B,{label:e.jsx(r,{message:"Delete"}),children:e.jsx(I,{size:"md",color:"danger",onClick:()=>{window.confirm(`Delete "${s.original_filename}"?

This action cannot be undone.`)&&a.mutate({id:s.id})},disabled:a.isPending,className:"text-danger hover:bg-danger/10",children:e.jsx(ie,{})})})]})})}function gs(){return e.jsx(e.Fragment,{children:e.jsx(ds,{endpoint:"admin/transfer-files",title:e.jsx(r,{message:"Transfer Files "}),queryKey:R("admin-transfer-files"),columns:js,searchPlaceholder:e.jsx(r,{message:"Search files..."}),filters:[{key:"status",label:e.jsx(r,{message:"Status"}),description:e.jsx(r,{message:"Filter by file status"}),defaultOperator:"=",control:{type:"Select",defaultValue:"active",options:[{key:"active",label:e.jsx(r,{message:"Active"}),value:"active"},{key:"expired",label:e.jsx(r,{message:"Expired"}),value:"expired"}]}}],actions:e.jsx(ys,{}),selectedActions:e.jsx(bs,{}),emptyStateMessage:e.jsx(cs,{image:e.jsx(Le,{size:"xl",className:"text-muted"}),title:e.jsx(r,{message:"No transfer files uploaded yet"}),filteringTitle:e.jsx(r,{message:"No matching files"})})})})}function ys(){const s=xs();return e.jsx("div",{className:"flex items-center gap-8",children:e.jsx(M,{variant:"flat",color:"primary",startIcon:e.jsx(hs,{}),onClick:()=>s.mutate(),disabled:s.isPending,children:e.jsx(r,{message:"Cleanup Expired"})})})}function bs(){const{selectedRows:s}=K.useContext(se);console.log("selectedRows",s);const a=ms();return e.jsx(M,{variant:"flat",color:"danger",startIcon:e.jsx(ie,{}),onClick:()=>{const t=s.map(n=>n.id);a.mutate({ids:t})},disabled:a.isPending,children:e.jsx(r,{message:"Delete selected"})})}const Fs=Object.freeze(Object.defineProperty({__proto__:null,TransferFilesPage:gs},Symbol.toStringTag,{value:"Module"}));export{Ze as A,R as D,Je as F,gs as T,ps as V,ds as a,cs as b,Ye as c,os as d,hs as e,Fs as t,Ss as u};
//# sourceMappingURL=transfer-files-page-c189ec67.js.map
