import{H as Q,aT as J,a as X,r as l,Z as K,bz as k,j as t,q as v,T as g,bA as Y,o as y,V as ee,X as P,aJ as B,bp as te,S as se,bB as ae,aD as ne,bC as re,ax as oe,ag as ie,by as z,h as le,bD as ce,aK as E,bE as me,$ as O,a0 as de,D as ue,z as fe,A as xe,G as q,bb as U,bF as ge,b6 as he}from"./main-40e0a36e.js";import{T as pe,a as je,b as be}from"./TrendingFlat-9b40b7d3.js";import{g as L,F as A,D as ve,a as ye,u as H,b as we,c as De,d as Ne}from"./formatted-number-d46ea765.js";import{F as Ce}from"./formatted-bytes-e15cb6ba.js";import{t as S}from"./theme-value-to-hex-237f0ed4.js";import{A as Te}from"./ArrowBack-e07e925a.js";import"./switch-cc33e143.js";const W="admin/reports";function ke(e={}){return Q({queryKey:[W,e],queryFn:()=>ze(e),placeholderData:J})}function ze({types:e,dateRange:a}){const s={};return e&&(s.types=e.join(",")),a&&(s.startDate=a.start.toAbsoluteString(),s.endDate=a.end.toAbsoluteString(),s.timezone=a.start.timeZone),X.get(W,{params:s}).then(n=>n.data)}const $e=l.memo(({minutes:e,seconds:a,ms:s,startDate:n,endDate:r,verbose:o=!1,addZeroToFirstUnit:m=!0,isLive:i,maxIsLiveMs:d,minDuration:c=0,liveInterval:f=5e3})=>{const{trans:h}=K(),u=l.useMemo(()=>{if(n||r){const R=n?k(n):L(),T=(r?k(r):L()).toDate().getTime()-R.toDate().getTime();return T>c?T:c}return e?e*6e4:a?a*1e3:s||c},[e,a,s,n,r,c]),[j,$]=l.useState(u);l.useEffect(()=>{$(u)},[u]);const C=l.useRef(j);C.current=j,l.useEffect(()=>{const R=d&&C.current>d;if(i&&!R){const V=setInterval(()=>{$(T=>T+f)},f);return()=>clearInterval(V)}},[i,f,d,u]);const b=j<0?-j:j,N={days:Math.trunc(b/864e5),hours:Math.trunc(b/36e5)%24,minutes:Math.trunc(b/6e4)%60,seconds:Math.trunc(b/1e3)%60};let w;return o?w=Re(N,h):w=Ae(N,m),t.jsx(l.Fragment,{children:w})});function Re(e,a){const s=[];return e.days&&s.push(`${e.days}${a(v("d"))}`),e.hours&&s.push(`${e.hours}${a(v("hr"))}`),e.minutes&&s.push(`${e.minutes}${a(v("min"))}`),e.seconds&&!e.hours&&s.push(`${e.seconds}${a(v("sec"))}`),s.join(" ")}function Ae(e,a=!0){const s=D(e.seconds);let n="";return e.days&&!n&&(n=`${e.days}:${D(e.hours)}:${D(e.minutes)}:${s}`),e.hours&&!n&&(n=`${D(e.hours,a)}:${D(e.minutes)}:${s}`),n||(n=`${D(e.minutes,a)}:${s}`),n}function D(e,a=!0){if(!a)return e;let s=`${e}`;return s.length===1&&(s="0"+s),s}function Fe({report:e,isLoading:a}){return e?t.jsx(l.Fragment,{children:e==null?void 0:e.map(s=>t.jsx(Ie,{icon:s.icon,type:s.type,currentValue:s.currentValue,previousValue:s.previousValue,percentageChange:s.percentageChange,isLoading:a,children:t.jsx(g,{message:s.name})},s.name))}):t.jsx("div",{className:"col-span-12 row-span-3 mt-3 mb-3"})}function Ie({icon:e,children:a,type:s,currentValue:n,previousValue:r,percentageChange:o,isLoading:m=!1,colSpan:i="col-span-3",rowSpan:d="row-span-3"}){let c;if(e)if(l.isValidElement(e))c=l.cloneElement(e,{size:"sm"});else{const f=Y(e);c=t.jsx(f,{size:"sm"})}return t.jsxs("div",{className:y("compact-scrollbar flex flex-wrap flex-col p-2 justify-left items-left overflow-x-auto  mb-4 overflow-y-hidden whitespace-nowrap rounded-panel border",i,d),children:[t.jsxs("div",{className:"flex items-center gap-6",children:[c,t.jsx("h2",{className:"text-sm font-semibold",children:a})]}),t.jsxs("div",{className:"flex gap-10",children:[t.jsx("div",{className:"text-4xl font-medium text-main",children:t.jsx(ee,{initial:!1,mode:"wait",children:m?t.jsx(P.div,{...B,children:t.jsx(te,{className:"min-w-40"})},"skeleton"):t.jsx(P.div,{...B,children:t.jsx(Me,{type:s,value:n})},"value")})}),n!=null&&(o!=null||r!=null)&&t.jsx("div",{className:"flex items-center gap-10",children:t.jsx(Ve,{currentValue:n,previousValue:r,percentageChange:o})})]})]})}function Me({type:e,value:a}){if(a==null)return"â€”";switch(e){case"fileSize":return t.jsx(Ce,{bytes:a});case"percentage":return t.jsx(A,{value:a,style:"percent",maximumFractionDigits:1});case"durationInSeconds":return t.jsx($e,{seconds:a,verbose:!0});default:return t.jsx(A,{value:a})}}function Ve(e){const a=Pe(e);let s;return a>0?s=t.jsx(pe,{size:"md",className:"text-positive"}):a===0?s=t.jsx(je,{className:"text-muted"}):s=t.jsx(be,{className:"text-danger"}),t.jsxs(l.Fragment,{children:[s,t.jsxs("div",{className:"text-sm font-semibold text-muted",children:[a,"%"]})]})}function Pe({percentageChange:e,previousValue:a,currentValue:s}){return e!=null||a==null||s==null?e??0:a===0?100:Math.round((s-a)/a*100)}function Z(e){const{title:a,description:s,children:n,className:r,contentIsFlex:o=!0,contentClassName:m,contentRef:i}=e;return t.jsxs("div",{className:y("flex h-full flex-auto flex-col rounded-panel border bg p-10 dark:bg-alt",r),children:[t.jsxs("div",{className:"flex flex-shrink-0 items-center justify-between pb-10 text-xs",children:[t.jsx("div",{className:"text-sm font-semibold",children:a}),s&&t.jsx("div",{className:"text-muted",children:s})]}),t.jsx("div",{ref:i,className:y("relative",o&&"flex flex-auto items-center justify-center",m),children:n})]})}function F(){return t.jsxs("div",{className:"absolute mx-auto flex items-center gap-10 text-sm",children:[t.jsx(se,{isIndeterminate:!0,size:"sm"}),t.jsx(g,{message:"Chart loading"})]})}const Be=l.lazy(()=>ae(()=>import("./lazy-chart-3a09beda.js"),["./lazy-chart-3a09beda.js","./main-40e0a36e.js","./main-f2214635.css"],import.meta.url));function I(e){const{title:a,description:s,className:n,rowSpan:r="row-span-11",colSpan:o="col-span-6",contentRef:m,isLoading:i}=e;return t.jsx(Z,{title:a,description:s,className:y(n,r,o),contentRef:m,children:t.jsxs(l.Suspense,{fallback:t.jsx(F,{}),children:[t.jsx(Be,{...e}),i&&t.jsx(F,{})]})})}function M(e,{localeCode:a="en",shareFirstDatasetLabels:s=!0}){if(!e)return{datasets:[]};const n=[];return{...e,datasets:e.datasets.map((r,o)=>{const m=r.data.map((i,d)=>{let c;return o===0||!s?(c=Ee(i,e.granularity,a),n[d]=c):c=n[d],{...c,value:i.value}});return{...r,data:m}})}}function Ee(e,a,s){return e.label?{label:e.label}:e.date?Le(e,a,s):{label:""}}function Le({date:e,endDate:a},s="day",n){const r=k(e).toDate(),o=a?k(a).toDate():null;switch(s){case"minute":return{label:x(n,{second:"2-digit"}).format(r),tooltipTitle:x(n,{day:"2-digit",hour:"numeric",minute:"numeric",second:"2-digit"}).format(r)};case"hour":return{label:x(n,{hour:"numeric",minute:"numeric"}).format(r),tooltipTitle:x(n,{month:"short",day:"2-digit",hour:"numeric",minute:"numeric"}).format(r)};case"day":return{label:x(n,{day:"2-digit",weekday:"short"}).format(r),tooltipTitle:x(n,{day:"2-digit",weekday:"short",month:"short"}).format(r)};case"week":return{label:x(n,{month:"short",day:"2-digit"}).format(r),tooltipTitle:x(n,{day:"2-digit",month:"long",year:"numeric"}).formatRange(r,o)};case"month":return{label:x(n,{month:"short",year:"numeric"}).format(r),tooltipTitle:x(n,{month:"long",year:"numeric"}).format(r)};case"year":return{label:x(n,{year:"numeric"}).format(r),tooltipTitle:x(n,{year:"numeric"}).format(r)}}}const x=ne((e,a)=>new re(e,a),{equals:(e,a)=>oe(e,a),callTimeout:void 0}),G=ie().themes[0].values["--be-primary"],p=[[`rgb(${G.replaceAll(" ",",")})`,`rgba(${G.replaceAll(" ",",")},0.2)`],["rgb(255,112,67)","rgb(255,112,67,0.2)"],["rgb(255,167,38)","rgb(255,167,38,0.2)"],["rgb(141,110,99)","rgb(141,110,99,0.2)"],["rgb(102,187,106)","rgba(102,187,106,0.2)"],["rgb(92,107,192)","rgb(92,107,192,0.2)"]],He={parsing:{xAxisKey:"label",yAxisKey:"value"},datasets:{line:{fill:"origin",tension:.1,pointBorderWidth:4,pointHitRadius:10}},plugins:{tooltip:{intersect:!1,mode:"index"}}};function Se({data:e,...a}){const{localeCode:s}=z(),n=l.useMemo(()=>{const r=M(e,{localeCode:s});return r.datasets=r.datasets.map((o,m)=>({...o,backgroundColor:p[m][1],borderColor:p[m][0],pointBackgroundColor:p[m][0]})),r},[e,s]);return t.jsx(I,{...a,data:n,type:"line",options:He})}const Ge={parsing:{key:"value"},plugins:{tooltip:{intersect:!0}}};function _e({data:e,className:a,...s}){const{localeCode:n}=z(),r=l.useMemo(()=>{var m;const o=M(e,{localeCode:n});return o.labels=(m=o.datasets[0])==null?void 0:m.data.map(i=>i.label),o.datasets=o.datasets.map((i,d)=>({...i,backgroundColor:p.map(c=>c[1]),borderColor:p.map(c=>c[0]),borderWidth:2})),o},[e,n]);return t.jsx(I,{type:"polarArea",data:r,options:Ge,className:a,...s})}function Ke({data:e,direction:a="vertical",individualBarColors:s=!1,className:n,...r}){const{localeCode:o}=z(),m=l.useMemo(()=>{const c=M(e,{localeCode:o});return c.datasets=c.datasets.map((f,h)=>({...f,backgroundColor:s?p.map(u=>u[1]):p[h][1],borderColor:s?p.map(u=>u[0]):p[h][0],borderWidth:2})),c},[e,o,s]),i=a==="horizontal",d=l.useMemo(()=>({indexAxis:i?"y":"x",parsing:{xAxisKey:i?"value":"label",yAxisKey:i?"label":"value"}}),[i]);return t.jsx(I,{type:"bar",className:n,data:m,options:d,...r})}const _="https://www.gstatic.com/charts/loader.js";function Oe({placeholderRef:e,data:a,country:s,onCountrySelected:n}){const{trans:r}=K(),{analytics:o}=le(),m=o==null?void 0:o.gchart_api_key,{selectedTheme:i}=ce(),d=l.useRef(),c=!!n&&!s,f=l.useCallback(()=>{var b,N;if(typeof google>"u")return;const u=a.map(w=>[w.label,w.value]);u.unshift([r(s?v("City"):v("Country")),r(v("Clicks"))]);const j=`${S(i.values["--be-paper"])}`,C={colorAxis:{colors:[`${S(i.values["--be-primary"])}`]},backgroundColor:j,region:s?s.toUpperCase():void 0,resolution:s?"provinces":"countries",displayMode:s?"markers":"regions",enableRegionInteractivity:c};!d.current&&e.current&&((b=google==null?void 0:google.visualization)!=null&&b.GeoChart)&&(d.current=new google.visualization.GeoChart(e.current)),(N=d.current)==null||N.draw(google.visualization.arrayToDataTable(u),C)},[i,a,e,r,s,c]),h=l.useCallback(async()=>{E.isLoadingOrLoaded(_)||(await E.loadAsset(_,{type:"js",id:"google-charts-js"}),await google.charts.load("current",{packages:["geochart"],mapsApiKey:m}),f())},[m,f]);return l.useEffect(()=>(d.current&&n&&google.visualization.events.addListener(d.current,"regionClick",u=>n==null?void 0:n(u.region)),()=>{d.current&&google.visualization.events.removeAllListeners(d.current)}),[n,d.current]),l.useEffect(()=>{h()},[h]),l.useEffect(()=>{f()},[i,f,a]),{drawGoogleChart:f}}const qe=me(t.jsx("path",{d:"M9 8a1 1 0 0 0-1-1H5.5a1 1 0 1 0 0 2H7v4a1 1 0 0 0 2 0zM4 0h8a4 4 0 0 1 4 4v8a4 4 0 0 1-4 4H4a4 4 0 0 1-4-4V4a4 4 0 0 1 4-4zm4 5.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"}),"InfoDialogTrigger");function Ue({title:e,body:a,dialogSize:s="sm",className:n}){return t.jsxs(O,{type:"popover",triggerOnHover:!0,children:[t.jsx(de,{className:y("ml-4 text-muted opacity-70",n),iconSize:"xs",size:"2xs",children:t.jsx(qe,{viewBox:"0 0 16 16"})}),t.jsxs(ue,{size:s,children:[e&&t.jsx(fe,{padding:"px-18 pt-12",size:"md",hideDismissButton:!0,children:e}),t.jsx(xe,{children:a})]})]})}const We=l.memo(({code:e})=>{const{localeCode:a}=z(),s=new Intl.DisplayNames([a],{type:"region"});let n;try{n=s.of(e.toUpperCase())}catch{}return t.jsx(l.Fragment,{children:n})});function Ze({data:e,isLoading:a,onCountrySelected:s,country:n,className:r,colSpan:o="col-span-7",rowSpan:m="row-span-11",...i}){const d=l.useRef(null),c=!!s,f=e==null?void 0:e.datasets[0].data,h=l.useMemo(()=>f||[],[f]);return Oe({placeholderRef:d,data:h,country:n,onCountrySelected:s}),t.jsxs(Z,{...i,className:y(r,o,m,"compact-scrollbar overflow-x-auto overflow-y-hidden"),title:t.jsxs("div",{className:"flex items-center",children:[t.jsx(g,{message:"Top Locations"}),n?t.jsxs("span",{className:"pl-4",children:["(",t.jsx(We,{code:n}),")"]}):null,c&&t.jsx(Qe,{})]}),contentIsFlex:a,children:[a&&t.jsx(F,{}),t.jsxs("div",{className:"flex gap-24",children:[t.jsx("div",{ref:d,className:"min-h-[340px] w-[480px] flex-auto"}),t.jsxs("div",{className:"w-[170px]",children:[t.jsx("div",{className:"max-h-[340px] w-full flex-initial overflow-y-auto text-sm",children:h.map(u=>t.jsxs("div",{className:y("mb-4 flex items-center gap-4",c&&"cursor-pointer hover:underline"),role:c?"button":void 0,onClick:()=>{s==null||s(u.code)},children:[t.jsx("div",{className:"max-w-110 overflow-hidden overflow-ellipsis whitespace-nowrap",children:u.label}),t.jsxs("div",{children:["(",u.percentage,")%"]})]},u.label))}),n&&t.jsx(q,{variant:"outline",size:"xs",className:"mt-14",startIcon:t.jsx(Te,{}),onClick:()=>{s==null||s(void 0)},children:t.jsx(g,{message:"Back to countries"})})]})]})]})}function Qe(){return t.jsx(Ue,{title:t.jsx(g,{message:"Zooming in"}),body:t.jsx(g,{message:"Click on a country inside the map or country list to zoom in and see city data for that country."})})}function Je({report:e,isLoading:a}){const s=e==null?void 0:e.pageViews.total;return t.jsxs(l.Fragment,{children:[t.jsx(Se,{colSpan:"col-span-8",isLoading:a,data:e==null?void 0:e.pageViews,title:t.jsx(g,{message:"Pageviews"}),description:s?t.jsx(g,{message:":count total views",values:{count:t.jsx(A,{value:s})}}):null}),t.jsx(_e,{colSpan:"col-span-4",isLoading:a,data:e==null?void 0:e.devices,title:t.jsx(g,{message:"Top devices"})}),t.jsx(Ze,{colSpan:"col-span-7",isLoading:a,data:e==null?void 0:e.locations,title:t.jsx(g,{message:"Top locations"})}),t.jsx(Ke,{colSpan:"col-span-5",isLoading:a,data:e==null?void 0:e.browsers,direction:"horizontal",individualBarColors:!0,hideLegend:!0,title:t.jsx(g,{message:"Top browsers"})})]})}const Xe={month:"short",day:"2-digit"};function Ye({value:e,onChange:a,disabled:s,compactOnMobile:n=!0,enableCompare:r=!1,granularity:o="minute"}){const m=U();return t.jsxs(O,{type:"popover",onClose:i=>{i&&a(i)},children:[t.jsx(q,{variant:"outline",color:"chip",endIcon:t.jsx(ve,{}),disabled:s,children:t.jsx(ye,{start:e.start,end:e.end,options:m&&n?Xe:ge.short})}),t.jsx(et,{value:e,enableCompare:r,granularity:o})]})}function et({value:e,enableCompare:a,granularity:s}){const n=U(),r=H({granularity:s,defaultValue:{start:e.start,end:e.end,preset:e.preset},closeDialogOnSelection:!1}),o=!!e.compareStart&&!!e.compareEnd,m=H({granularity:s,defaultValue:o?{start:e.compareStart,end:e.compareEnd,preset:e.comparePreset}:we[0].getRangeValue(r.selectedValue)});return t.jsx(De,{state:r,compareState:a?m:void 0,compareVisibleDefault:o,showInlineDatePickerField:!n})}function lt(){const[e,a]=l.useState(()=>Ne[2].getRangeValue()),{isLoading:s,data:n}=ke({dateRange:e}),r=t.jsx(g,{message:"Visitors report"});return t.jsxs("div",{className:"min-h-full gap-6 overflow-x-hidden p-4 mt-[12px] md:mt-0 md:gap-18 md:p-18",children:[t.jsxs("div",{className:"mb-2 md:mb-6 flex items-center justify-between gap-2  md:gap-24 ",children:[t.jsx(he,{children:r}),t.jsxs("h1",{className:"md:mb-24 text-lg md:text-3xl font-light md:mb-0",children:[r," "]}),t.jsx(Ye,{value:e,onChange:a})]}),t.jsxs("div",{className:"chart-grid mt-3",children:[t.jsx(Fe,{report:n==null?void 0:n.headerReport}),t.jsx(Je,{report:n==null?void 0:n.visitorsReport,isLoading:s})]})]})}export{lt as Component};
//# sourceMappingURL=admin-report-page-f95bc6b4.js.map
