import{H as ie,aV as oe,a as $,R as K,r as f,bd as L,cN as de,j as e,ca as ce,T as o,a6 as ue,o as h,a0 as V,c7 as me,bG as se,am as xe,V as Z,an as pe,ao as he,a4 as je,X as W,y as ae,D as fe,z as ge,A as ye,x as be,B as ve,aI as Ne,G as R,$ as we,Z as te,aA as ke,aB as Fe,q as P,aL as ne,br as G,bZ as Se,cU as De,b8 as Ce,aO as Pe,aP as Ae,p as X,t as A,v as I,aw as Ie,aC as _e,aY as ze,a7 as Ee}from"./main-036cb1f7.js";import{h as Te,m as Y,a as C,I as Ke,N as Ve,n as Re,o as Be,S as Me,B as $e,b as Le,c as qe,D as le,L as Qe}from"./table-c0039120.js";import{K as He}from"./formatted-number-14f69e88.js";const B=(s,a,t)=>{const n=t?[...t]:s.split("/");return a&&n.push(a),n};function Oe(s,a,t,n){a.paginate||(a.paginate="preferLengthAware");const d=t==null?void 0:t.baseQueryKey;return t==null||delete t.baseQueryKey,ie({...t,queryKey:B(s,a,d),queryFn:({signal:r})=>Ue(s,a,n,r),placeholderData:oe})}async function Ue(s,a,t,n){a.query&&await new Promise(r=>setTimeout(r,300));const d=await $.get(s,{params:a,signal:a.query?n:void 0}).then(r=>r.data);return t==null||t(d),d}const J=K.createContext(null);function ws(){return f.useContext(J)}const Ge=15,Ze=[{key:10},{key:15},{key:20},{key:50},{key:100}];function We({query:s,onPerPageChange:a,onPageChange:t,className:n}){var p;const d=L(),r=de(),l=(p=s.data)==null?void 0:p.pagination;if(!l)return null;const c=a?e.jsx(ce,{minWidth:"min-w-auto",selectionMode:"single",disabled:s.isLoading,labelPosition:"side",size:"xs",label:e.jsx(o,{message:"Items per page"}),selectedValue:l.per_page?+l.per_page:Ge,onSelectionChange:i=>a(i),children:Ze.map(i=>e.jsx(ue,{value:i.key,children:i.key},i.key))}):null;return e.jsxs("div",{className:h("flex h-54 select-none items-center justify-end gap-20 px-20",n),children:[!d&&c,l.from&&l.to&&"total"in l?e.jsx("div",{className:"text-sm",children:e.jsx(o,{message:":from - :to of :total",values:{from:l.from,to:l.to,total:r.format(l.total)}})}):null,e.jsxs("div",{className:"text-muted",children:[e.jsx(V,{disabled:s.isFetching||l.current_page<2,onClick:()=>{t==null||t((l==null?void 0:l.current_page)-1)},children:e.jsx(me,{})}),e.jsx(V,{disabled:s.isFetching||!Te(l),onClick:()=>{t==null||t((l==null?void 0:l.current_page)+1)},children:e.jsx(He,{})})]})]})}const Xe=se(e.jsx("path",{d:"M7 6h10l-5.01 6.3L7 6zm-2.75-.39C6.27 8.2 10 13 10 13v6c0 .55.45 1 1 1h2c.55 0 1-.45 1-1v-6s3.72-4.8 5.74-7.39c.51-.66.04-1.61-.79-1.61H5.04c-.83 0-1.3.95-.79 1.61z"}),"FilterAltOutlined"),ee={variants:{open:{height:"auto",visibility:"visible",transitionEnd:{overflow:"auto"}},closed:{height:0,overflow:"hidden",transitionEnd:{visibility:"hidden"}}},transition:{type:"tween",duration:.2}},Ye=K.forwardRef(({variant:s="default",mode:a="single",children:t,className:n,isLazy:d,...r},l)=>{const[c,p]=xe(r.expandedValues,r.defaultExpandedValues||[],r.onExpandedChange),i=K.Children.count(t);return e.jsx("div",{className:h(s==="outline"&&"space-y-10",n),ref:l,role:"presentation",children:e.jsx(Z,{children:e.jsx(pe,{children:K.Children.map(t,(m,x)=>f.isValidElement(m)?f.cloneElement(m,{key:m.key||x,value:m.props.value||x,isFirst:x===0,isLast:x===i-1,mode:a,variant:s,expandedValues:c,setExpandedValues:p,isLazy:d}):null)})})})});function Je(s){const{children:a,label:t,disabled:n,bodyClassName:d,bodyPadding:r="p-16",labelClassName:l,buttonPadding:c="py-10 pl-14 pr-10",startIcon:p,description:i,endAppend:m,chevronPosition:x="right",isFirst:k,mode:q,isLazy:Q,variant:v,footerContent:H,onHeaderMouseEnter:M,onHeaderMouseLeave:_}=s,F=s.expandedValues||[],S=s.value||0,z=s.setExpandedValues||(()=>{}),O=f.useRef(null),g=!n&&F.includes(S),j=f.useRef(!1);g&&(j.current=!0);const u=he(),N=f.useId(),E=`${N}-button`,b=`${N}-panel`,U=D=>{switch(D.key){case"ArrowDown":u==null||u.focusNext();break;case"ArrowUp":u==null||u.focusPrevious();break;case"Home":u==null||u.focusFirst();break;case"End":u==null||u.focusLast();break}},w=()=>{const D=F.indexOf(S);if(D>-1){const y=[...F];y.splice(D,1),z(y)}else z(q==="single"?[S]:[...F,S])},T=e.jsx("div",{className:h(v==="minimal"&&""),children:e.jsx(je,{"aria-hidden":"true",size:"md",className:h(n?"text-disabled":"text-muted",g&&"rotate-180 transition-transform")})});return e.jsxs("div",{className:h(v==="default"&&"border-b",v==="outline"&&"rounded-panel border",n&&"text-disabled"),children:[e.jsxs("h3",{className:h("flex w-full items-center justify-between text-sm",n&&"pointer-events-none",k&&v==="default"&&"border-t",g&&v!=="minimal"?"border-b":"border-b border-b-transparent",v==="outline"?g?"rounded-panel-t":"rounded-panel":void 0),onMouseEnter:M,onMouseLeave:_,children:[e.jsxs("button",{disabled:n,"aria-expanded":g,id:E,"aria-controls":b,type:"button",ref:O,onKeyDown:U,onClick:()=>{n||w()},className:h("flex flex-auto items-center gap-10 text-left outline-none hover:bg-hover focus-visible:bg-primary/focus",c),children:[x==="left"&&T,p&&f.cloneElement(p,{size:"md",className:h(p.props.className,n?"text-disabled":"text-muted")}),e.jsxs("div",{className:"flex-auto overflow-hidden overflow-ellipsis",children:[e.jsx("div",{className:l,"data-testid":"accordion-label",children:t}),i&&e.jsx("div",{className:"text-xs text-muted",children:i})]}),x==="right"&&T]}),m&&e.jsx("div",{className:"flex-shrink-0 px-4 text-sm text-muted",children:m})]}),e.jsxs(W.div,{"aria-labelledby":N,role:"region",variants:ee.variants,transition:ee.transition,initial:!1,animate:g?"open":"closed",children:[e.jsx("div",{className:h(r,d),children:!Q||j?a:null}),H]})]})}function es({filter:s}){return null}function ss({filters:s}){const{decodedFilters:a}=Y(s),{formId:t}=ae(),[n,d]=f.useState(()=>a.map(c=>c.key)),r=e.jsx(R,{size:"xs",variant:"outline",className:"mr-auto",onClick:()=>{d([])},children:e.jsx(o,{message:"Clear"})}),l=e.jsx(R,{size:"xs",variant:"flat",color:"primary",className:"ml-auto",type:"submit",form:t,children:e.jsx(o,{message:"Apply"})});return e.jsxs(fe,{className:"min-w-[300px]",maxWidth:"max-w-400",size:"auto",children:[e.jsx(ge,{padding:"px-14 py-10",leftAdornment:r,rightAdornment:l,children:e.jsx(o,{message:"Filter"})}),e.jsx(ye,{padding:"p-0",children:e.jsx(as,{filters:s,expandedFilters:n,setExpandedFilters:d})})]})}function as({filters:s,expandedFilters:a,setExpandedFilters:t}){const{decodedFilters:n,replaceAll:d}=Y(s),r={};s.forEach(i=>{const m=n.find(x=>x.key===i.key);r[i.key]=(m==null?void 0:m.value)!==void 0?m:{value:i.control.defaultValue,operator:i.defaultOperator}});const l=be({defaultValues:r}),{formId:c,close:p}=ae();return e.jsx(ve,{form:l,id:c,onSubmit:i=>{const m=Object.entries(i).filter(([x,k])=>a.includes(x)&&k!==void 0).map(([x,k])=>({key:x,...k}));d(m),p()},children:e.jsx(Ye,{mode:"multiple",expandedValues:a,onExpandedChange:t,children:s.map(i=>e.jsxs(Je,{startIcon:e.jsx(Ne,{checked:a.includes(i.key)}),value:i.key,label:e.jsx(o,{...i.label}),bodyClassName:"max-h-288 overflow-y-auto compact-scrollbar",children:[i.description&&e.jsx("div",{className:h("text-xs text-muted",i.control.type!==C.BooleanToggle&&"mb-14"),children:e.jsx(o,{...i.description})}),e.jsx(ts,{filter:i})]},i.key))})})}function ts({filter:s}){switch(s.control.type){case C.Select:return e.jsx(Me,{filter:s});case C.ChipField:return e.jsx(Be,{filter:s});case C.DateRangePicker:return e.jsx(Re,{filter:s});case C.SelectModel:return e.jsx(Ve,{filter:s});case C.Input:return e.jsx(Ke,{filter:s});case C.BooleanToggle:return e.jsx(es,{filter:s});case"custom":const a=s.control.panel;return e.jsx(a,{filter:s});default:return null}}function ns({filters:s,icon:a=e.jsx(Xe,{}),color:t="primary",variant:n="outline",size:d="sm",disabled:r,className:l}){const c=L(),p=e.jsx(R,{variant:n,color:t,startIcon:a,disabled:r,size:d,className:l,children:e.jsx(o,{message:"Filter"})}),i=e.jsx(V,{color:t,size:"sm",variant:n,disabled:r,className:l,children:a});return e.jsxs(we,{type:"popover",children:[c?i:p,e.jsx(ss,{filters:s})]})}function ls({actions:s,filters:a,filtersLoading:t,searchPlaceholder:n=P("Type to search..."),searchValue:d="",onSearchChange:r}){const{trans:l}=te();return e.jsxs(re,{children:[e.jsx(ke,{size:"sm",className:"mr-auto min-w-180 max-w-440 flex-auto",inputWrapperClassName:"mr-24 md:mr-0",placeholder:l(n),startAdornment:e.jsx(Fe,{size:"sm"}),value:d,onChange:c=>{r(c.target.value)}}),a&&e.jsx(ns,{filters:a,disabled:t}),s]})}function re({children:s,...a}){return e.jsx("div",{className:"hidden-scrollbar relative mb-6 flex items-center gap-4 overflow-x-auto text-muted md:gap-12",...a,children:s})}function rs({actions:s,selectedItemsCount:a}){return e.jsxs(re,{"data-testid":"datatable-selected-header",children:[e.jsx("div",{className:"mr-auto",children:e.jsx(o,{message:"[one 1 item|other :count items] selected",values:{count:a}})}),s]})}function is(){return e.jsxs(W.div,{className:"flex h-30 items-center gap-6",...ne,children:[e.jsx(G,{variant:"rect",size:"h-full w-144",radius:"rounded-md"}),e.jsx(G,{variant:"rect",size:"h-full w-112",radius:"rounded-md"}),e.jsx(G,{variant:"rect",size:"h-full w-172",radius:"rounded-md"})]},"filter-list-skeleton")}function os({filters:s,pinnedFilters:a,filtersLoading:t,columns:n,searchPlaceholder:d,queryParams:r,endpoint:l,baseQueryKey:c,actions:p,selectedActions:i,emptyStateMessage:m,tableDomProps:x,onRowAction:k,enableSelection:q=!0,selectionStyle:Q="checkbox",children:v,cellHeight:H,collapseTableOnMobile:M=!0,skeletonsWhileLoading:_,border:F}){var D;const S=f.useRef(c),z=L(),{trans:O}=te(),{encodedFilters:g}=Y(s),[j,u]=f.useState({perPage:15}),[N,E]=f.useState([]),b=Oe(l,{...j,...r,[$e]:g},{baseQueryKey:S.current},()=>E([])),U=!!(j.query||j.filters||g),w=(D=b.data)==null?void 0:D.pagination,T=(w==null?void 0:w.data)||(b.isLoading&&_?Array.from({length:_}).map(()=>({id:Se(),isPlaceholder:!0})):[]);return console.log("data",T),e.jsxs(J.Provider,{value:{selectedRows:N,setSelectedRows:E,endpoint:l,params:j,setParams:u,query:b,baseQueryKey:S.current},children:[v,e.jsx(Z,{initial:!1,mode:"wait",children:N.length?e.jsx(rs,{selectedItemsCount:N.length,actions:i},"selected"):e.jsx(ls,{searchPlaceholder:d,searchValue:j.query,onSearchChange:y=>u({...j,query:y}),actions:p,filters:s,filtersLoading:t},"default")}),s&&e.jsx("div",{className:"mb-14",children:e.jsx(Z,{initial:!1,mode:"wait",children:t&&(g||a!=null&&a.length)?e.jsx(is,{}):e.jsx(W.div,{...ne,children:e.jsx(Le,{filters:s,pinnedFilters:a})},"filter-list")})}),e.jsxs("div",{className:h("relative rounded-panel",F||(!z||!M)&&"border"),children:[b.isFetching&&!_&&e.jsx(De,{isIndeterminate:!0,className:"absolute left-0 top-0 z-10 w-full","aria-label":O({message:"Loading"}),size:"xs"}),e.jsx("div",{className:"relative overflow-x-auto md:overflow-hidden",children:e.jsx(qe,{...x,columns:n,data:T,sortDescriptor:j,onSortChange:y=>{u({...j,...y})},selectedRows:N,enableSelection:q,selectionStyle:Q,onSelectionChange:E,onAction:k,collapseOnMobile:M,cellHeight:H})}),(b.isFetched||b.isPlaceholderData)&&!(w!=null&&w.data.length)?e.jsx("div",{className:"pt-50",children:f.cloneElement(m,{isFiltering:U})}):void 0,e.jsx(We,{query:b,onPageChange:y=>u({...j,page:y}),onPerPageChange:y=>u({...j,perPage:y})})]})]})}function ds({title:s,headerContent:a,headerItemsAlign:t="items-end",className:n,padding:d,variant:r,...l}){const c=f.useId();return e.jsxs("div",{className:h(d??r==="fullPage"?"p-0":"p-4",n),children:[s&&e.jsxs("div",{className:h(r==="fullPage"?"mb-6 px-24 py-12":"mb-8",a&&`flex ${t} gap-4`),children:[e.jsx(Ce,{children:s}),e.jsx("h1",{className:"heading text-[24px] capitalize",id:c,children:s}),a]}),e.jsx("div",{className:h(r==="fullPage"?"p-12 md:p-24":"p-0"),children:e.jsx(os,{...l,tableDomProps:{"aria-labelledby":s?c:void 0}})})]})}function cs({isFiltering:s,title:a,filteringTitle:t,image:n,size:d,className:r}){const l=L();return d||(d=l?"sm":"md"),e.jsx(Pe,{className:r,size:d,image:e.jsx(Ae,{src:n}),title:s&&t?t:a,description:s&&t?e.jsx(o,{message:"Try another search query or different filters"}):void 0})}function us(){return X({mutationFn:({id:s})=>$.delete(`admin/transfer-files/${s}`).then(a=>a.data),onSuccess:()=>{A.positive(P("Transfer file deleted")),I.invalidateQueries({queryKey:B("admin-transfer-files")}),I.invalidateQueries({queryKey:["admin","transfer-files","stats"]})},onError:s=>{var t,n;const a=((n=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:n.message)||"Failed to delete transfer file";A.danger(P(a))}})}function ms(){return X({mutationFn:({ids:s})=>$.post("admin/transfer-files/bulk-delete",{ids:s}).then(a=>a.data),onSuccess:s=>{const a=s.deleted_count||0;A.positive(P(`Successfully deleted ${a} transfer files`)),I.invalidateQueries({queryKey:B("admin-transfer-files")}),I.invalidateQueries({queryKey:["admin","transfer-files","stats"]})},onError:s=>{var t,n;const a=((n=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:n.message)||"Failed to delete transfer files";A.danger(P(a))}})}function xs(){return X({mutationFn:()=>$.post("admin/transfer-files/cleanup").then(s=>s.data),onSuccess:s=>{const a=s.deleted_uploads||0;A.positive(P(`Cleanup completed. Removed ${a} expired files`)),I.invalidateQueries({queryKey:B("admin-transfer-files")}),I.invalidateQueries({queryKey:["admin","transfer-files","stats"]})},onError:s=>{var t,n;const a=((n=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:n.message)||"Cleanup failed";A.danger(P(a))}})}const ps=se(e.jsx("path",{d:"M15 16h4v2h-4zm0-8h7v2h-7zm0 4h6v2h-6zM3 18c0 1.1.9 2 2 2h6c1.1 0 2-.9 2-2V8H3v10zm2-8h6v8H5v-8zm5-6H6L5 5H2v2h12V5h-3z"}),"DeleteSweepOutlined"),hs=[{key:"original_filename",allowsSorting:!0,header:()=>e.jsx(o,{message:"File Name"}),body:s=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.original_filename||"Untitled"}),e.jsxs("div",{className:"text-sm text-muted",children:[s.formatted_size,s.files_count>1&&e.jsxs("span",{children:[" • ",s.files_count," files"]}),s.has_password&&e.jsx("span",{children:" • 🔒 Protected"})]})]})},{key:"title",allowsSorting:!1,header:()=>e.jsx(o,{message:"Title"}),body:s=>e.jsx("div",{className:"text-sm",children:s.title||e.jsx("span",{className:"text-muted",children:"No title"})})},{key:"recipient_emails",allowsSorting:!1,header:()=>e.jsx(o,{message:"Recipient Email"}),body:s=>e.jsx("div",{className:"text-sm",children:s.recipient_emails||e.jsx("span",{className:"text-muted",children:"No recipient"})})},{key:"message",allowsSorting:!1,header:()=>e.jsx(o,{message:"Message"}),body:s=>e.jsx("div",{className:"text-sm",children:s.message?e.jsx(_e,{label:s.message,children:e.jsx("div",{className:"truncate ",children:s.message})}):e.jsx("span",{className:"text-muted",children:"No message"})})},{key:"sender_email",allowsSorting:!1,header:()=>e.jsx(o,{message:"Sender"}),body:s=>e.jsx("div",{className:"text-sm",children:s.sender_email||e.jsx("span",{className:"text-muted",children:"Anonymous"})})},{key:"status",allowsSorting:!1,header:()=>e.jsx(o,{message:"Status"}),body:s=>{let a="positive",t="Active";return s.status==="expired"?(a="danger",t="Expired"):s.status==="download_limit_reached"&&(a="warning",t="Limit Reached"),e.jsx(ze,{color:a,size:"xs",children:t})}},{key:"download_count",allowsSorting:!0,header:()=>e.jsx(o,{message:"Downloads"}),body:s=>e.jsxs("div",{className:"text-sm",children:[s.download_count,s.max_downloads&&e.jsxs("span",{className:"text-muted",children:[" / ",s.max_downloads]})]})},{key:"created_at",allowsSorting:!0,header:()=>e.jsx(o,{message:"Created"}),body:s=>e.jsx("div",{className:"text-sm",children:s.created_at?new Date(s.created_at).toLocaleDateString("en-US"):"-"})},{key:"expires_at",allowsSorting:!0,header:()=>e.jsx(o,{message:"Expires"}),body:s=>e.jsx("div",{className:"text-sm",children:s.expires_at?new Date(s.expires_at).toLocaleDateString("en-US"):e.jsx("span",{className:"text-muted",children:"Never"})})},{key:"actions",header:()=>e.jsx(o,{message:"Actions"}),hideHeader:!0,align:"end",body:s=>e.jsx(js,{file:s})}];function js({file:s}){const a=us();return e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(V,{size:"md",elementType:Ee,to:s.share_url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:bg-primary/10",children:e.jsx(Qe,{})}),e.jsx(V,{size:"md",color:"danger",onClick:()=>{window.confirm(`Delete "${s.original_filename}"?

This action cannot be undone.`)&&a.mutate({id:s.id})},disabled:a.isPending,className:"text-danger hover:bg-danger/10",children:e.jsx(le,{})})]})}function fs(){return e.jsx(e.Fragment,{children:e.jsx(ds,{endpoint:"admin/transfer-files",title:e.jsx(o,{message:"Transfer Files "}),queryKey:B("admin-transfer-files"),columns:hs,searchPlaceholder:e.jsx(o,{message:"Search files..."}),filters:[{key:"status",label:e.jsx(o,{message:"Status"}),description:e.jsx(o,{message:"Filter by file status"}),defaultOperator:"=",control:{type:"Select",defaultValue:"active",options:[{key:"active",label:e.jsx(o,{message:"Active"}),value:"active"},{key:"expired",label:e.jsx(o,{message:"Expired"}),value:"expired"}]}}],actions:e.jsx(gs,{}),selectedActions:e.jsx(ys,{}),emptyStateMessage:e.jsx(cs,{image:e.jsx(Ie,{size:"xl",className:"text-muted"}),title:e.jsx(o,{message:"No transfer files uploaded yet"}),filteringTitle:e.jsx(o,{message:"No matching files"})})})})}function gs(){const s=xs();return e.jsx("div",{className:"flex items-center gap-8",children:e.jsx(R,{variant:"flat",color:"primary",startIcon:e.jsx(ps,{}),onClick:()=>s.mutate(),disabled:s.isPending,children:e.jsx(o,{message:"Cleanup Expired"})})})}function ys(){const{selectedRows:s}=K.useContext(J);console.log("selectedRows",s);const a=ms();return e.jsx(R,{variant:"flat",color:"danger",startIcon:e.jsx(le,{}),onClick:()=>{const t=s.map(n=>n.id);a.mutate({ids:t})},disabled:a.isPending,children:e.jsx(o,{message:"Delete selected"})})}const ks=Object.freeze(Object.defineProperty({__proto__:null,TransferFilesPage:fs},Symbol.toStringTag,{value:"Module"}));export{Ye as A,B as D,Xe as F,fs as T,ds as a,cs as b,Je as c,os as d,ps as e,ks as t,ws as u};
//# sourceMappingURL=transfer-files-page-b9cc9ce4.js.map
