import{r as a,j as e,L as _}from"./vendor-react-3d470e7b.js";import{c as w,A,m as E}from"./vendor-utils-237689e9.js";import{a5 as D,k as L,h as v,a as k,a4 as r,a3 as I,b as y}from"./admin-analytics-ee429683.js";import{b_ as M}from"./vendor-ea2ab13e.js";import{w as z,t as P,bh as B}from"./admin-core-fc173d4d.js";import{E as T}from"./admin-appearance-e5e13473.js";function C({type:t,productId:i,priceId:l}){const{user:s}=z(),f=P(),m=a.useRef(!1),n=a.useRef(null),{localeCode:h}=D(),[c,b]=a.useState(null),[g,j]=a.useState(null),{branding:{site_name:u},billing:{stripe_public_key:o,stripe:{enable:d}}}=L();return a.useEffect(()=>{!d||!o||m.current||(Promise.all([M(o,{apiVersion:"2022-08-01",locale:h}),t==="setupIntent"?F():V(i,l)]).then(([p,{clientSecret:S}])=>{if(p&&n.current){const x=p.elements({clientSecret:S,appearance:{theme:f?"night":"stripe"}});x.create("payment",{business:{name:u},terms:{card:"never"},fields:{billingDetails:{address:"auto"}},defaultValues:{billingDetails:{email:s==null?void 0:s.email}}}).mount(n.current),b(p),j(x)}}),m.current=!0)},[i,o,d,f,h,u,t,s==null?void 0:s.email]),{stripe:c,elements:g,paymentElementRef:n,stripeIsEnabled:o!=null&&d}}function F(){return v.post("billing/stripe/create-setup-intent").then(t=>t.data)}function V(t,i){return v.post("billing/stripe/create-partial-subscription",{product_id:t,price_id:i}).then(l=>l.data)}function W({productId:t,priceId:i,type:l="subscription",submitLabel:s,returnUrl:f}){const{stripe:m,elements:n,paymentElementRef:h,stripeIsEnabled:c}=C({type:l,productId:t,priceId:i}),[b,g]=a.useState(null),[j,u]=a.useState(!1),o=!c||n!=null&&m!=null,d=async p=>{var S,x;if(p.preventDefault(),!(!m||!n)){u(!0);try{const N=await m[l==="subscription"?"confirmPayment":"confirmSetup"]({elements:n,confirmParams:{return_url:f}});((S=N.error)==null?void 0:S.type)!=="validation_error"&&((x=N.error)!=null&&x.message)&&g(N.error.message)}catch{}u(!1)}};return e.jsxs("form",{onSubmit:d,children:[e.jsx("div",{ref:h,className:w("min-h-[303px]",!c&&"hidden"),children:c&&e.jsx(q,{})}),b&&!j&&e.jsx("div",{className:"mt-20 text-danger",children:b}),e.jsx(k,{variant:"flat",color:"primary",size:"md",className:"mt-40 w-full",type:"submit",disabled:j||!o,children:s})]})}function q(){return e.jsxs(a.Fragment,{children:[e.jsx(r,{className:"mb-20 h-30"}),e.jsx(r,{className:"mb-20 h-30"}),e.jsx(r,{className:"mb-20 h-30"}),e.jsx(r,{className:"h-30"})]})}function X({config:t}){return e.jsx(A,{initial:!1,mode:"wait",children:e.jsx("div",{className:"mt-80",children:t?e.jsxs(E.div,{className:"text-center",...I,children:[t.status==="success"?e.jsx(B,{className:"text-6xl text-positive"}):e.jsx(T,{className:"text-6xl text-danger"}),e.jsx("div",{className:"mt-30 text-2xl font-semibold",children:e.jsx(y,{...t.message})}),e.jsx(k,{variant:"flat",color:"primary",className:"mt-30 w-full",size:"md",elementType:_,to:t.link,children:e.jsx(y,{...t.buttonLabel})})]},"payment-status"):e.jsx(G,{},"loading-skeleton")})})}function G(){return e.jsxs(E.div,{className:"max-w-280 text-center",...I,children:[e.jsx(r,{size:"w-50 h-50",variant:"rect"}),e.jsx(r,{className:"mt-30 text-2xl"}),e.jsx(r,{size:"h-42",className:"mt-30"})]},"loading-skeleton")}export{X as B,W as S};
//# sourceMappingURL=billing-redirect-message-66698c84.js.map
